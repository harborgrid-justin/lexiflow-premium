# Integration Test Specifications for Agent 12
**Generated by Agent 11 - Coordinator**
**Last Updated: 2025-12-12**

---

## Overview
This document provides comprehensive test specifications for Agent 12 to validate the LexiFlow Premium system integration. Tests cover backend APIs, frontend components, database operations, and end-to-end workflows.

---

## 1. Backend API Endpoint Testing

### 1.1 Authentication Endpoints
**Base Path:** `/api/v1/auth`

| Endpoint | Method | Test Scenarios | Expected Status |
|----------|--------|----------------|----------------|
| `/auth/register` | POST | Valid registration | 201 |
| `/auth/register` | POST | Duplicate email | 409 |
| `/auth/login` | POST | Valid credentials | 200 |
| `/auth/login` | POST | Invalid credentials | 401 |
| `/auth/refresh` | POST | Valid refresh token | 200 |
| `/auth/refresh` | POST | Expired token | 401 |
| `/auth/logout` | POST | Valid session | 200 |
| `/auth/forgot-password` | POST | Valid email | 200 |
| `/auth/reset-password` | POST | Valid reset token | 200 |
| `/auth/2fa/setup` | POST | Authenticated user | 200 |
| `/auth/2fa/verify` | POST | Valid code | 200 |
| `/auth/2fa/disable` | POST | Valid code | 200 |
| `/auth/oauth/google` | GET | OAuth redirect | 302 |
| `/auth/oauth/microsoft` | GET | OAuth redirect | 302 |

**Test Data Requirements:**
- 10+ test users with various roles
- Valid/invalid JWT tokens
- 2FA test codes
- OAuth mock responses

---

### 1.2 User Management Endpoints
**Base Path:** `/api/v1/users`

| Endpoint | Method | Test Scenarios | Expected Status |
|----------|--------|----------------|----------------|
| `/users` | GET | List all users (admin) | 200 |
| `/users` | GET | List users (unauthorized) | 403 |
| `/users/:id` | GET | Get user by ID | 200 |
| `/users/:id` | GET | Non-existent user | 404 |
| `/users/:id` | PUT | Update user profile | 200 |
| `/users/:id` | PUT | Update other user (non-admin) | 403 |
| `/users/:id` | DELETE | Delete user (admin) | 200 |
| `/users/:id/activate` | POST | Activate user | 200 |
| `/users/:id/deactivate` | POST | Deactivate user | 200 |

---

### 1.3 Case Management Endpoints
**Base Path:** `/api/v1/cases`

| Endpoint | Method | Test Scenarios | Expected Status |
|----------|--------|----------------|----------------|
| `/cases` | GET | List cases with pagination | 200 |
| `/cases` | GET | Filter by status | 200 |
| `/cases` | POST | Create new case | 201 |
| `/cases` | POST | Invalid case data | 400 |
| `/cases/:id` | GET | Get case details | 200 |
| `/cases/:id` | PUT | Update case | 200 |
| `/cases/:id` | DELETE | Delete case (admin) | 200 |
| `/cases/:id/phases` | GET | Get case phases | 200 |
| `/cases/:id/team` | GET | Get case team | 200 |
| `/cases/:id/team` | POST | Add team member | 201 |
| `/cases/:id/parties` | GET | Get case parties | 200 |
| `/cases/:id/parties` | POST | Add party | 201 |

---

### 1.4 Document Management Endpoints
**Base Path:** `/api/v1/documents`

| Endpoint | Method | Test Scenarios | Expected Status |
|----------|--------|----------------|----------------|
| `/documents` | GET | List documents | 200 |
| `/documents` | POST | Upload document | 201 |
| `/documents` | POST | Invalid file type | 400 |
| `/documents` | POST | File too large | 413 |
| `/documents/:id` | GET | Get document details | 200 |
| `/documents/:id` | PUT | Update metadata | 200 |
| `/documents/:id` | DELETE | Delete document | 200 |
| `/documents/:id/download` | GET | Download file | 200 |
| `/documents/:id/versions` | GET | Get version history | 200 |
| `/documents/:id/versions` | POST | Upload new version | 201 |
| `/documents/:id/ocr` | POST | Trigger OCR | 202 |

---

### 1.5 Billing Endpoints
**Base Path:** `/api/v1/billing`

| Endpoint | Method | Test Scenarios | Expected Status |
|----------|--------|----------------|----------------|
| `/billing/time-entries` | GET | List time entries | 200 |
| `/billing/time-entries` | POST | Create time entry | 201 |
| `/billing/time-entries/:id` | PUT | Update time entry | 200 |
| `/billing/time-entries/:id` | DELETE | Delete time entry | 200 |
| `/billing/invoices` | GET | List invoices | 200 |
| `/billing/invoices` | POST | Generate invoice | 201 |
| `/billing/invoices/:id` | GET | Get invoice details | 200 |
| `/billing/invoices/:id/pdf` | GET | Download invoice PDF | 200 |
| `/billing/invoices/:id/send` | POST | Send invoice email | 200 |
| `/billing/expenses` | GET | List expenses | 200 |
| `/billing/expenses` | POST | Create expense | 201 |
| `/billing/rates` | GET | Get rate tables | 200 |

---

### 1.6 Discovery Endpoints
**Base Path:** `/api/v1/discovery`

| Endpoint | Method | Test Scenarios | Expected Status |
|----------|--------|----------------|----------------|
| `/discovery/requests` | GET | List discovery requests | 200 |
| `/discovery/requests` | POST | Create request | 201 |
| `/discovery/requests/:id` | GET | Get request details | 200 |
| `/discovery/requests/:id` | PUT | Update request | 200 |
| `/discovery/depositions` | GET | List depositions | 200 |
| `/discovery/depositions` | POST | Schedule deposition | 201 |
| `/discovery/esi-sources` | GET | List ESI sources | 200 |
| `/discovery/legal-holds` | GET | List legal holds | 200 |
| `/discovery/legal-holds` | POST | Create legal hold | 201 |

---

### 1.7 Analytics Endpoints
**Base Path:** `/api/v1/analytics`

| Endpoint | Method | Test Scenarios | Expected Status |
|----------|--------|----------------|----------------|
| `/analytics/dashboard` | GET | Get dashboard stats | 200 |
| `/analytics/cases` | GET | Get case analytics | 200 |
| `/analytics/billing` | GET | Get billing analytics | 200 |
| `/analytics/judge-stats` | GET | Get judge statistics | 200 |
| `/analytics/reports/generate` | POST | Generate report | 202 |

---

### 1.8 Search Endpoints
**Base Path:** `/api/v1/search`

| Endpoint | Method | Test Scenarios | Expected Status |
|----------|--------|----------------|----------------|
| `/search` | GET | Full-text search | 200 |
| `/search` | GET | Search with filters | 200 |
| `/search` | GET | Empty query | 400 |
| `/search/suggest` | GET | Auto-complete suggestions | 200 |
| `/search/index` | POST | Reindex documents (admin) | 202 |

---

### 1.9 Communication Endpoints
**Base Path:** `/api/v1`

| Endpoint | Method | Test Scenarios | Expected Status |
|----------|--------|----------------|----------------|
| `/messages` | GET | List messages | 200 |
| `/messages` | POST | Send message | 201 |
| `/messages/:id` | GET | Get message | 200 |
| `/notifications` | GET | List notifications | 200 |
| `/notifications/:id/read` | PUT | Mark as read | 200 |
| `/notifications/mark-all-read` | PUT | Mark all read | 200 |

---

### 1.10 GraphQL Endpoints
**Base Path:** `/graphql`

| Query/Mutation | Test Scenarios | Expected Result |
|----------------|----------------|-----------------|
| `cases` | Query cases list | Success |
| `case(id)` | Query single case | Success |
| `createCase` | Mutation create case | Success |
| `updateCase` | Mutation update case | Success |
| `documents` | Query documents | Success |
| `users` | Query users | Success |
| `billingStats` | Query billing stats | Success |

---

### 1.11 WebSocket Events
**Base Path:** `ws://localhost:3001`

| Event | Test Scenarios | Expected Behavior |
|-------|----------------|-------------------|
| `connection` | Client connects | Connection established |
| `disconnect` | Client disconnects | Clean disconnect |
| `message:new` | New message sent | Real-time notification |
| `notification:new` | New notification | Real-time update |
| `case:updated` | Case updated | Broadcast to team |
| `document:uploaded` | Document uploaded | Notify case team |

---

## 2. Database Integration Tests

### 2.1 Migration Tests
```bash
# Test migration execution
npm run migration:run

# Verify all 37 tables created
# Verify indexes created
# Verify foreign key constraints
```

### 2.2 Seed Data Tests
```bash
# Test seed execution
npm run seed

# Verify data loaded:
# - 10 users
# - 15 clients
# - 20 cases
# - 50+ documents
# - 100+ time entries
```

### 2.3 Connection Tests
- PostgreSQL connection pool
- Redis connection
- Connection timeout handling
- Connection recovery

---

## 3. Frontend Integration Tests

### 3.1 Component Rendering Tests
**Location:** `/components`

- **Authentication Components:**
  - LoginForm renders correctly
  - RegisterForm validation works
  - ForgotPasswordForm submits
  - TwoFactorSetup displays QR code

- **Layout Components:**
  - AppShell renders
  - Sidebar navigation works
  - AppHeader displays user info
  - HolographicDock loads

- **Case Components:**
  - CaseList displays cases
  - CaseDetail shows full info
  - Case creation modal works

### 3.2 Context Provider Tests
**Location:** `/context`

- **AuthContext:**
  - Login flow
  - Logout flow
  - Token refresh
  - User state persistence

- **ThemeContext:**
  - Theme switching
  - Persistence

- **ToastContext:**
  - Show success/error toasts
  - Auto-dismiss

### 3.3 Service Layer Tests
**Location:** `/services/api`

- **apiClient.ts:**
  - Request interceptor adds auth token
  - Response interceptor handles 401
  - Token refresh mechanism
  - Error handling

- **restApi.ts:**
  - CRUD operations
  - Error handling
  - Retry logic

- **graphqlClient.ts:**
  - Query execution
  - Mutation execution
  - Error handling

- **websocketClient.ts:**
  - Connection establishment
  - Event subscription
  - Reconnection logic

---

## 4. End-to-End Test Scenarios

### 4.1 User Registration & Authentication
1. Navigate to registration page
2. Fill registration form
3. Submit and verify email
4. Login with credentials
5. Verify dashboard loads
6. Setup 2FA
7. Logout
8. Login with 2FA

### 4.2 Case Management Workflow
1. Login as attorney
2. Create new case
3. Add case details
4. Add parties
5. Assign team members
6. Upload documents
7. Update case status
8. Verify notifications sent

### 4.3 Document Upload & OCR
1. Navigate to case documents
2. Upload PDF document
3. Verify file upload
4. Trigger OCR processing
5. Wait for completion
6. Verify extracted text
7. Download document

### 4.4 Billing Workflow
1. Create time entries
2. Add expenses
3. Generate invoice
4. Review invoice details
5. Download invoice PDF
6. Send invoice via email
7. Record payment

### 4.5 Discovery Management
1. Create discovery request
2. Set due dates
3. Add parties
4. Schedule deposition
5. Upload responses
6. Track completion

---

## 5. Performance Tests

### 5.1 Load Testing
- 100 concurrent users
- Response time < 500ms (95th percentile)
- Database query time < 100ms
- File upload < 30s for 50MB

### 5.2 Stress Testing
- 500 concurrent users
- Identify breaking point
- Memory usage monitoring
- CPU usage monitoring

### 5.3 Endurance Testing
- 24-hour continuous operation
- Memory leak detection
- Connection pool stability

---

## 6. Security Tests

### 6.1 Authentication & Authorization
- SQL injection prevention
- XSS prevention
- CSRF protection
- JWT validation
- Role-based access control
- Rate limiting (100 req/min)

### 6.2 Data Protection
- Password hashing (bcrypt)
- Sensitive data encryption
- HTTPS enforcement
- Secure headers (Helmet)

---

## 7. Error Handling Tests

### 7.1 API Error Responses
- 400 Bad Request (invalid data)
- 401 Unauthorized (no token)
- 403 Forbidden (insufficient permissions)
- 404 Not Found (resource missing)
- 409 Conflict (duplicate data)
- 413 Payload Too Large (file size)
- 429 Too Many Requests (rate limit)
- 500 Internal Server Error

### 7.2 Frontend Error Handling
- Network errors
- API errors
- Validation errors
- Loading states
- Error boundaries

---

## 8. Test Execution Plan

### Phase 1: Unit Tests (Day 1)
- Backend services
- Frontend components
- Utility functions

### Phase 2: Integration Tests (Day 2)
- API endpoints
- Database operations
- Service integrations

### Phase 3: E2E Tests (Day 3)
- User workflows
- Critical paths
- Cross-browser testing

### Phase 4: Performance Tests (Day 4)
- Load testing
- Stress testing
- Optimization

### Phase 5: Security Tests (Day 5)
- Penetration testing
- Vulnerability scanning
- Compliance verification

---

## 9. Test Coverage Goals

| Component | Target Coverage |
|-----------|----------------|
| Backend Services | 90% |
| Backend Controllers | 85% |
| Frontend Components | 80% |
| Frontend Services | 85% |
| Critical Paths | 100% |

---

## 10. CI/CD Integration

### Automated Test Execution
```yaml
on: [push, pull_request]
jobs:
  test:
    - Backend unit tests
    - Frontend unit tests
    - Integration tests
    - E2E tests (critical paths)
    - Build verification
```

### Quality Gates
- All tests must pass
- Coverage threshold met
- No security vulnerabilities
- Build succeeds
- Linting passes

---

## 11. Test Reports

### Required Outputs
1. **Test Summary Report**
   - Total tests executed
   - Pass/Fail counts
   - Coverage percentage
   - Execution time

2. **Failed Test Details**
   - Test name
   - Error message
   - Stack trace
   - Screenshot (E2E)

3. **Performance Metrics**
   - Response times
   - Resource usage
   - Bottlenecks identified

4. **Security Scan Results**
   - Vulnerabilities found
   - Severity levels
   - Remediation steps

---

## 12. Test Data Management

### Test Database
- Separate test database
- Reset between test suites
- Seed data provided
- Transaction rollback

### Mock Services
- OAuth providers
- Email service
- Payment gateway
- External APIs

---

## Commands for Agent 12

### Backend Tests
```bash
cd backend
npm install
docker-compose up -d
npm run migration:run
npm run seed
npm run test
npm run test:e2e
npm run test:cov
```

### Frontend Tests
```bash
npm install
npm run build
npm run preview
# Manual E2E testing via browser
```

### Full Integration Test
```bash
# Start backend
cd backend && npm run start:dev

# Start frontend
npm run dev

# Access: http://localhost:3000
# Test all critical user flows
```

---

## Success Criteria

✅ All API endpoints return expected status codes
✅ Database migrations execute successfully
✅ Seed data loads without errors
✅ Frontend builds without errors
✅ All authentication flows work
✅ File upload/download works
✅ Real-time notifications work
✅ GraphQL queries execute
✅ WebSocket connections stable
✅ Performance meets targets
✅ Security tests pass
✅ No critical vulnerabilities

---

**Note to Agent 12:** Execute tests systematically and report any failures immediately via GitHub Issues. Do not proceed to next phase if critical tests fail.
