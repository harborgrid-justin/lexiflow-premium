# LexiFlow Backend - Environment Configuration
# Memory Optimization Settings for Enterprise Production

# ============================================================================
# NODE.JS RUNTIME CONFIGURATION
# ============================================================================

NODE_ENV=production

# V8 Heap Configuration
NODE_MAX_OLD_SPACE_SIZE=2048
NODE_MAX_SEMI_SPACE_SIZE=16
NODE_INITIAL_OLD_SPACE_SIZE=512
NODE_EXPOSE_GC=true
NODE_OPTIMIZE_FOR_MEMORY=true

# Garbage Collection Settings
NODE_GC_MAX_OLD_GEN_SIZE=1536
NODE_GC_MAX_YOUNG_GEN_SIZE=128

# ============================================================================
# MEMORY MONITORING
# ============================================================================

MEMORY_MONITORING_ENABLED=true
MEMORY_WARNING_THRESHOLD=0.75
MEMORY_CRITICAL_THRESHOLD=0.85
MEMORY_CHECK_INTERVAL=30000
MEMORY_GC_AFTER_THRESHOLD=true

# Memory Cleanup
MEMORY_CLEANUP_ENABLED=true
MEMORY_CLEANUP_INTERVAL=300000
MEMORY_CLEANUP_AGGRESSIVE=false

# ============================================================================
# STREAM PROCESSING
# ============================================================================

STREAM_FILE_THRESHOLD=10485760
STREAM_CHUNK_SIZE=65536
STREAM_HIGH_WATER_MARK=16384

# ============================================================================
# COMPRESSION
# ============================================================================

COMPRESSION_ENABLED=true
COMPRESSION_LEVEL=6
COMPRESSION_THRESHOLD=1024
COMPRESSION_MEM_LEVEL=8

# ============================================================================
# CACHE CONFIGURATION
# ============================================================================

CACHE_MAX_SIZE=100
CACHE_MAX_AGE=300000
CACHE_TTL=30000
CACHE_CHECK_PERIOD=60000

# ============================================================================
# PAYLOAD LIMITS
# ============================================================================

PAYLOAD_JSON_LIMIT=10mb
PAYLOAD_URLENCODED_LIMIT=10mb
PAYLOAD_TEXT_LIMIT=10mb
PAYLOAD_RAW_LIMIT=50mb

# ============================================================================
# DATABASE CONNECTION POOLING
# ============================================================================

DB_POOL_MAX=20
DB_POOL_MIN=5
DB_IDLE_TIMEOUT=30000
DB_ACQUIRE_TIMEOUT=60000
DB_CONNECTION_TIMEOUT=10000
DB_STATEMENT_TIMEOUT=60000
DB_QUERY_TIMEOUT=60000
DB_EVICTION_RUN_INTERVAL=10000
DB_MAX_USES=7500

# Database Cache
DB_CACHE_ENABLED=true
DB_CACHE_DURATION=30000
DB_CACHE_TYPE=redis

# ============================================================================
# REDIS CONNECTION POOLING
# ============================================================================

REDIS_ENABLED=true
REDIS_MAX_CLIENTS=50
REDIS_MIN_CLIENTS=5
REDIS_ACQUIRE_TIMEOUT=10000
REDIS_MAX_RETRIES_PER_REQUEST=3
REDIS_CONNECT_TIMEOUT=10000
REDIS_COMMAND_TIMEOUT=5000
REDIS_KEEP_ALIVE=30000

# ============================================================================
# REQUEST CONFIGURATION
# ============================================================================

REQUEST_BODY_LIMIT=50mb
REQUEST_PARAMETER_LIMIT=10000
REQUEST_TIMEOUT_MS=30000

# ============================================================================
# RATE LIMITING
# ============================================================================

RATE_LIMIT_TTL=60000
RATE_LIMIT_LIMIT=100

# ============================================================================
# FILE STORAGE
# ============================================================================

FILE_MAX_SIZE=104857600
FILE_MIN_DISK_SPACE=5368709120

# ============================================================================
# OCR PROCESSING
# ============================================================================

OCR_MAX_FILE_SIZE=52428800
OCR_TIMEOUT_MS=300000
OCR_CHUNK_SIZE=1048576

# ============================================================================
# QUEUE PROCESSING
# ============================================================================

QUEUE_JOB_TIMEOUT_MS=300000
QUEUE_MAX_ATTEMPTS=3
QUEUE_BACKOFF_DELAY_MS=5000
QUEUE_REMOVE_ON_COMPLETE=100
QUEUE_REMOVE_ON_FAIL=50

# ============================================================================
# WEBSOCKET LIMITS
# ============================================================================

WS_MAX_CONNECTIONS_PER_USER=10
WS_MAX_GLOBAL_CONNECTIONS=1000
WS_MAX_ROOMS_PER_USER=20
WS_RATE_LIMIT_EVENTS_PER_MINUTE=60

# ============================================================================
# HEALTH CHECK
# ============================================================================

HEALTH_CHECK_TIMEOUT_MS=5000

# ============================================================================
# TELEMETRY (Optional)
# ============================================================================

OTEL_ENABLED=false

# ============================================================================
# DATABASE CONNECTION (Required)
# ============================================================================

DATABASE_URL=postgresql://user:password@localhost:5432/lexiflow
DB_FALLBACK_SQLITE=false
DEMO_MODE=false

# ============================================================================
# REDIS CONNECTION (Optional, but recommended for production)
# ============================================================================

REDIS_HOST=localhost
REDIS_PORT=6379

# ============================================================================
# SECURITY
# ============================================================================

JWT_SECRET=your-secret-key-change-in-production
JWT_EXPIRES_IN=900

# ============================================================================
# CORS
# ============================================================================

CORS_ORIGIN=http://localhost:3000
CORS_CREDENTIALS=true

# ============================================================================
# SERVER
# ============================================================================

PORT=5000
