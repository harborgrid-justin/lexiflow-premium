import{j as e,r as c,aV as D,a$ as R,bK as I,cp as C,cn as E,cq as T,a_ as $,ab as w,m as L,b3 as v}from"./vendor-core-V-oW58GW.js";import{c as s,u as A,q as G}from"./useQueryHooks-Oyt-TMLP.js";import{q as N}from"./queryKeys-BBVgMz36.js";import{D as M}from"./dataService-BWLMkXM4.js";import{u as f}from"./ThemeContext-OPG61qw5.js";import{C as B}from"./Card-CDOiP5UM.js";import{B as S}from"./Badge-bF-hTHJZ.js";import{G as U}from"./geminiService-_CYFbtO8.js";import{a as V}from"./SyncContext-B5_p5hCg.js";import"./vendor-misc-Dwkhvdtg.js";import"./vendor-charts-KZIdMATq.js";import"./preload-helper-BXl3LOEh.js";import"./type-mappings-DEPYyX4d.js";import"./schemas-B2_dy3tf.js";const W=({history:a,activeSessionId:l,onSelectSession:r})=>{const{theme:n}=f();return e.jsxs("div",{className:s("w-80 border-r hidden md:flex md:flex-col shrink-0",n.surface.default,n.border.default),children:[e.jsx("div",{className:s("p-4 border-b font-bold text-xs uppercase tracking-wide",n.border.default,n.text.tertiary),children:"Recent Sessions"}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[a.length===0&&e.jsx("div",{className:s("p-6 text-center text-sm",n.text.tertiary),children:"No research history."}),a.map(t=>e.jsxs("div",{onClick:()=>r(t.id),className:s("p-4 border-b cursor-pointer transition-colors border-l-4",n.border.default,l===t.id?s("border-l-blue-600",n.surface.highlight):s("border-l-transparent",`hover:${n.surface.highlight}`)),children:[e.jsx("p",{className:s("text-sm font-medium line-clamp-2",l===t.id?n.primary.text:n.text.primary),children:t.query}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("span",{className:s("text-[10px]",n.text.tertiary),children:t.timestamp}),e.jsxs("span",{className:s("text-[10px] px-1.5 py-0.5 rounded border",n.surface.default,n.border.default,n.text.secondary),children:[t.sources.length," Sources"]})]})]},t.id))]})]})};function F(a,l={}){const r=c.useRef(null),[n,t]=c.useState(!1),[i,o]=c.useState(0),d=c.useRef(null),u=c.useRef(null),h=c.useRef(0),p=c.useRef(l.onRead),b=c.useRef(l.thresholdMs);return c.useEffect(()=>{p.current=l.onRead,b.current=l.thresholdMs},[l.onRead,l.thresholdMs]),c.useEffect(()=>{const m=new IntersectionObserver(x=>{x.forEach(g=>{if(g.isIntersecting)d.current=Date.now(),u.current=window.setInterval(()=>{d.current&&Date.now()-d.current<6e4&&(o(y=>y+1),h.current+=1)},1e3);else if(u.current&&clearInterval(u.current),d.current){const j=Date.now()-d.current,y=b.current||3e3;j>y&&t(k=>(!k&&p.current&&p.current(a,j),!0)),d.current=null}})},{threshold:.5});return r.current&&m.observe(r.current),()=>{m.disconnect(),u.current&&clearInterval(u.current)}},[a]),{ref:r,isRead:n,duration:i}}const O=({source:a,onView:l})=>{const{theme:r}=f(),{ref:n,isRead:t}=F(a.id,{thresholdMs:2e3,onRead:(i,o)=>console.log(`[Analytics] User read search result ${i} for ${o}ms`)});return e.jsxs("div",{ref:n,className:s("p-4 rounded-lg border transition-all shadow-sm flex flex-col group cursor-pointer",r.surface.default,r.border.default,`hover:${r.primary.border}`,t&&"border-green-200 dark:border-green-800"),onClick:l,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:s("text-sm font-bold hover:underline line-clamp-1 flex items-center",r.primary.text),children:[a.title," ",e.jsx(D,{className:"h-3 w-3 ml-2 opacity-50"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsx(S,{variant:"success",children:"Viewed"}),e.jsx(S,{variant:"neutral",children:"Web Source"})]})]}),e.jsx("p",{className:s("text-xs mt-1 line-clamp-1 font-mono",r.text.tertiary),children:a.url}),e.jsx("p",{className:s("text-xs mt-2 line-clamp-2",r.text.secondary),children:a.snippet})]})},Q=({text:a})=>{const[l,r]=c.useState(""),{theme:n}=f(),t=c.useRef(0);return c.useEffect(()=>{r(""),t.current=0;const i=setInterval(()=>{if(t.current<a.length){const o=a.slice(t.current,t.current+3);r(d=>d+o),t.current+=3}else clearInterval(i)},15);return()=>clearInterval(i)},[a]),e.jsxs("div",{className:s("prose prose-sm max-w-none leading-relaxed whitespace-pre-line font-serif",n.text.primary),children:[l,t.current<a.length&&e.jsx("span",{className:"inline-block w-2 h-4 ml-1 bg-blue-500 animate-pulse align-middle"})]})},q=({session:a,onViewSource:l})=>{const{theme:r}=f();return a?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:s("text-lg font-bold leading-snug",r.text.primary),children:a.query}),e.jsx("p",{className:s("text-xs mt-1",r.text.secondary),children:"Generated by LexiFlow AI â€¢ Grounded via Google Search"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:s("p-2 border rounded transition-colors",r.surface.default,r.border.default,r.text.secondary,`hover:${r.surface.highlight}`),children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx("button",{className:s("p-2 border rounded transition-colors",r.surface.default,r.border.default,r.text.secondary,`hover:${r.surface.highlight}`),children:e.jsx(C,{className:"h-4 w-4"})})]})]}),e.jsxs(B,{className:s("shadow-md",r.primary.border),children:[e.jsx(Q,{text:a.response}),e.jsxs("div",{className:s("mt-6 flex items-center justify-end space-x-4 border-t pt-4",r.border.default),children:[e.jsx("span",{className:s("text-xs",r.text.tertiary),children:"Was this answer helpful?"}),e.jsx("button",{className:s("p-1.5 rounded transition-colors hover:bg-green-50 hover:text-green-600",r.text.tertiary),children:e.jsx(E,{className:"h-4 w-4"})}),e.jsx("button",{className:s("p-1.5 rounded transition-colors hover:bg-red-50 hover:text-red-600",r.text.tertiary),children:e.jsx(T,{className:"h-4 w-4"})})]})]}),a.sources.length>0&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-700 delay-300 fill-mode-backwards",children:[e.jsx("h4",{className:s("text-xs font-bold uppercase tracking-wider mb-3 ml-1",r.text.secondary),children:"Authorities Cited"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:a.sources.map((n,t)=>e.jsx(O,{source:n,onView:()=>l&&n.url&&l(n.url,n.title)},t))})]})]}):e.jsxs("div",{className:s("flex flex-col items-center justify-center h-full opacity-60",r.text.tertiary),children:[e.jsx(R,{className:"h-16 w-16 mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"Enter a legal query to begin research"})]})},H=({query:a,setQuery:l,onSearch:r,isLoading:n})=>{const{theme:t}=f(),[i,o]=c.useState("general"),[d,u]=c.useState(!1);return c.useEffect(()=>{if(a.length>5){u(!0);const h=setTimeout(()=>{/section|code|statute|act|usc/i.test(a)?o("statute"):/v\.|versus|holding|precedent|court/i.test(a)?o("caselaw"):o("general"),u(!1)},600);return()=>clearTimeout(h)}else o("general")},[a]),e.jsxs("div",{className:s("border-b px-6 py-4 shadow-sm z-10 shrink-0",t.surface.default,t.border.default),children:[e.jsxs("h2",{className:s("text-xl font-bold mb-4 flex items-center",t.text.primary),children:[e.jsx(R,{className:s("h-6 w-6 mr-2",t.primary.text)})," Legal Research Center"]}),e.jsxs("form",{onSubmit:r,className:"relative max-w-4xl",children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"text",value:a,onChange:h=>l(h.target.value),placeholder:"Enter natural language query (e.g., 'Standard for piercing corporate veil in Delaware')...",className:s("w-full pl-12 pr-4 py-3 border rounded-lg outline-none transition-all text-sm shadow-inner",t.surface.highlight,t.border.default,t.text.primary,"focus:ring-2 focus:ring-blue-500 focus:border-blue-500")}),e.jsx($,{className:s("absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5",t.text.tertiary)}),a.length>0&&e.jsxs("div",{className:s("absolute right-24 top-1/2 -translate-y-1/2 px-2 py-1 rounded text-[10px] font-bold uppercase flex items-center transition-all",d?"opacity-50":"opacity-100",i==="caselaw"?"bg-blue-100 text-blue-700":i==="statute"?"bg-purple-100 text-purple-700":"bg-slate-100 text-slate-500"),children:[d?e.jsx(w,{className:"h-3 w-3 animate-spin mr-1"}):e.jsx(L,{className:"h-3 w-3 mr-1"}),i==="general"?"General Search":i]}),e.jsx("button",{type:"submit",disabled:n||!a.trim(),className:s("absolute right-2 top-1/2 -translate-y-1/2 px-4 py-1.5 rounded-md font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center transition-colors text-sm shadow-sm",t.primary.DEFAULT,t.text.inverse,t.primary.hover),children:n?e.jsx(w,{className:"h-4 w-4 animate-spin mr-2"}):"Search"})]}),e.jsxs("div",{className:s("flex gap-4 mt-2 text-xs px-2",t.text.secondary),children:[e.jsxs("button",{type:"button",onClick:()=>o("general"),className:s("flex items-center cursor-pointer transition-colors",i==="general"?t.primary.text:`hover:${t.primary.text}`),children:[e.jsx(v,{className:"h-3 w-3 mr-1"})," All Jurisdictions"]}),e.jsxs("button",{type:"button",onClick:()=>o("caselaw"),className:s("flex items-center cursor-pointer transition-colors",i==="caselaw"?t.primary.text:`hover:${t.primary.text}`),children:[e.jsx(v,{className:"h-3 w-3 mr-1"})," Case Law Only"]}),e.jsxs("button",{type:"button",onClick:()=>o("statute"),className:s("flex items-center cursor-pointer transition-colors",i==="statute"?t.primary.text:`hover:${t.primary.text}`),children:[e.jsx(v,{className:"h-3 w-3 mr-1"})," Statutes"]})]})]})]})},K=async(a,l)=>{if(!a.trim())throw new Error("Query is empty");const r=await U.conductResearch(a),n={id:Date.now().toString(),userId:"current-user",query:a,response:r.text,sources:r.sources,timestamp:new Date().toLocaleTimeString()},t=[n,...l];return{newSession:n,updatedHistory:t}},ce=()=>{const{theme:a}=f(),{openWindow:l}=V(),[r,n]=c.useState(""),[t,i]=c.useState(!1),[o,d]=c.useState(null),{data:u=[]}=A(N.research.history(),()=>M.research.getHistory()),h=async m=>{m.preventDefault(),i(!0);try{const{newSession:x}=await K(r,u);G.invalidate(N.research.history()),d(x.id),n("")}catch(x){console.error("Search failed:",x)}finally{i(!1)}},p=(m,x)=>{const g=`source-${Date.now()}`;l(g,`Source: ${x}`,e.jsxs("div",{className:"h-full w-full flex flex-col",children:[e.jsxs("div",{className:"p-2 border-b bg-slate-100 flex items-center gap-2 text-xs truncate",children:[e.jsx("span",{className:"font-bold",children:"URL:"})," ",m]}),e.jsx("iframe",{src:m,className:"flex-1 w-full h-full border-0 bg-white",title:x,sandbox:"allow-scripts allow-same-origin"})]}))},b=u.find(m=>m.id===o)||u[0];return e.jsxs("div",{className:s("flex flex-col h-full rounded-lg border overflow-hidden shadow-sm",a.surface.default,a.border.default),children:[e.jsx(H,{query:r,setQuery:n,onSearch:h,isLoading:t}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx(W,{history:u,activeSessionId:o,onSelectSession:d}),e.jsx("div",{className:s("flex-1 overflow-y-auto p-6 transition-colors",a.surface.highlight),children:e.jsx(q,{session:b,onViewSource:p})})]})]})};export{ce as ActiveResearch};
