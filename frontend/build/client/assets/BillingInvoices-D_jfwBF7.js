import{l as P,r as v,j as e,b3 as T,al as A,v as B,a5 as k,ae as E}from"./vendor-core-V-oW58GW.js";import{u as F,d as b,q as a,c as n}from"./useQueryHooks-Oyt-TMLP.js";import{D as m}from"./dataService-BWLMkXM4.js";import{g as M,h as Q}from"./case-detail-q84K17Pa.js";import{u as w}from"./useNotify-DdRjm5G5.js";import{u as _}from"./ThemeContext-OPG61qw5.js";import{T as L,a as R,b as d,c as z,d as y,e as l}from"./Table-C_bcd1kC.js";import{B as O}from"./Badge-bF-hTHJZ.js";import{B as f}from"./Button-CDQlLg6j.js";import{b as o}from"./queryKeys-Dex4MaB7.js";import{I as p}from"./type-mappings-DEPYyX4d.js";import{F as q}from"./formatters-stMuSkc6.js";import"./vendor-misc-Dwkhvdtg.js";import"./vendor-charts-KZIdMATq.js";import"./preload-helper-BXl3LOEh.js";import"./schemas-B2_dy3tf.js";import"./SyncContext-B5_p5hCg.js";import"./VirtualList-r2WXvtCD.js";import"./AppShell-Cug-APl3.js";import"./tabs.config-D59pmwVC.js";import"./PageHeader-C4TFe3Td.js";import"./EmptyState-7A4cJUVU.js";import"./Card-CDOiP5UM.js";import"./MetricCard-BH_9X7pi.js";import"./queryKeys-BBVgMz36.js";import"./useSessionStorage-D_292xEY.js";import"./ErrorState-WL3az5ve.js";import"./ConfirmDialog--jvbqDAw.js";import"./Modal-Rns91qFF.js";import"./Kanban-BI78PbzY.js";import"./dateUtils-rLIRMrtk.js";import"./FilterPanel-BteidCPx.js";import"./AdaptiveLoader-D5wOoiN1.js";import"./UserAvatar-BPVf-Spq.js";import"./Tabs-7xONCRTX.js";import"./Input-Dmln04Yk.js";import"./TextArea-DrtcCAyn.js";import"./geminiService-_CYFbtO8.js";import"./TaskCreationModal-D5xiqN6m.js";import"./search.config-B6mvIgDA.js";import"./useToggle-CjLp2PQ4.js";import"./sanitize-k_Tw3ej1.js";import"./useModalState-Cst_3NmK.js";import"./scheduler-BERajRBE.js";import"./RouteErrorBoundary-Nha8Il06.js";import"./meta-utils-lVs9HXG9.js";const H=()=>{const{theme:s}=_(),u=w(),[h,S]=v.useState(""),[x,I]=v.useState("All"),{data:j=[]}=F(o.billing.invoices(),()=>m&&m.billing?m.billing.getInvoices():Promise.resolve([]));M({"mod+s":()=>{u.info("Send selected invoice (to be implemented)")},"mod+p":()=>{u.info("Mark invoice as paid (to be implemented)")}});const{mutate:D}=b(t=>m&&m.billing?m.billing.sendInvoice(t):Promise.resolve(!1),{onMutate:async t=>{const r=a.getQueryState(o.billing.invoices())?.data;return a.setQueryData(o.billing.invoices(),(i=[])=>i.map(c=>c.id===t?{...c,status:p.SENT}:c)),{previousInvoices:r}},onSuccess:(t,r)=>{u.success(`Invoice ${r} sent successfully.`)},onError:(t,r,i)=>{i?.previousInvoices&&a.setQueryData(o.billing.invoices(),i.previousInvoices),u.error("Failed to send invoice")},onSettled:()=>{a.invalidate(o.billing.invoices())}}),{mutate:C}=b(t=>m.billing.updateInvoice(t,{status:p.PAID}),{onMutate:async t=>{const r=a.getQueryState(o.billing.invoices())?.data;return a.setQueryData(o.billing.invoices(),(i=[])=>i.map(c=>c.id===t?{...c,status:p.PAID}:c)),{previousInvoices:r}},onSuccess:()=>{u.success("Invoice marked as PAID. Transaction recorded in immutable ledger.")},onError:(t,r,i)=>{i?.previousInvoices&&a.setQueryData(o.billing.invoices(),i.previousInvoices),u.error("Failed to update invoice.")},onSettled:()=>{a.invalidate(o.billing.invoices())}}),g=v.useMemo(()=>j.filter(t=>{const r=(t.client||"").toLowerCase().includes(h.toLowerCase())||t.id.toLowerCase().includes(h.toLowerCase()),i=x==="All"||t.status===x;return r&&i}),[j,h,x]),N=v.useCallback(t=>t===p.PAID?"success":t===p.OVERDUE?"error":t===p.DRAFT?"neutral":"info",[]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx(Q,{value:h,onChange:S,placeholder:"Search invoices...",actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:n("flex items-center px-3 py-1.5 border rounded-md",s.surface.highlight,s.border.default),children:[e.jsx(T,{className:n("h-4 w-4 mr-2",s.text.tertiary)}),e.jsxs("select",{className:n("bg-transparent text-sm outline-none border-none cursor-pointer",s.text.primary),value:x,onChange:t=>I(t.target.value),children:[e.jsx("option",{value:"All",children:"All Statuses"}),e.jsx("option",{value:"Draft",children:"Draft"}),e.jsx("option",{value:"Sent",children:"Sent"}),e.jsx("option",{value:"Paid",children:"Paid"}),e.jsx("option",{value:"Overdue",children:"Overdue"})]})]}),e.jsx(f,{variant:"primary",icon:A,children:"Create Invoice"})]})}),e.jsxs(L,{responsive:"card",children:[e.jsxs(R,{children:[e.jsx(d,{children:"Invoice ID"}),e.jsx(d,{children:"Client / Matter"}),e.jsx(d,{children:"Date Issued"}),e.jsx(d,{children:"Due Date"}),e.jsx(d,{className:"text-right",children:"Amount"}),e.jsx(d,{children:"Status"}),e.jsx(d,{className:"text-right",children:"Actions"})]}),e.jsxs(z,{children:[g.map(t=>e.jsxs(y,{children:[e.jsx(l,{className:n("font-mono font-medium",s.text.primary),children:t.id}),e.jsx(l,{children:e.jsxs("div",{children:[e.jsx("div",{className:n("font-bold text-sm",s.text.primary),children:t.client}),e.jsx("div",{className:n("text-xs",s.text.secondary),children:t.matter})]})}),e.jsx(l,{children:t.date}),e.jsx(l,{children:t.dueDate}),e.jsx(l,{className:n("text-right font-mono font-bold",s.text.primary),children:q.currency(t.amount)}),e.jsx(l,{children:e.jsx(O,{variant:N(t.status),children:t.status})}),e.jsx(l,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[t.status!=="Paid"&&e.jsx(f,{size:"sm",variant:"secondary",icon:B,onClick:()=>C(t.id),title:"Mark Paid & Log Audit",children:"Pay"}),t.status==="Draft"&&e.jsx(f,{size:"sm",variant:"ghost",icon:k,onClick:()=>D(t.id),children:"Send"}),e.jsx(f,{size:"sm",variant:"ghost",icon:E,children:"PDF"})]})})]},t.id)),g.length===0&&e.jsx(y,{children:e.jsx(l,{colSpan:7,className:n("text-center py-8 italic",s.text.tertiary),children:"No invoices found."})})]})]})]})},we=P.memo(H);export{we as BillingInvoices};
