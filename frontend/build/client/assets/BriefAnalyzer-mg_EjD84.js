import{r as u,j as e,F as P,an as V,aV as G,ab as J,ct as b,V as _,cu as H}from"./vendor-core-V-oW58GW.js";import{m as C}from"./case-detail-CN_DMmR8.js";import{B as y}from"./Button-PaGqeZoR.js";import{C as d}from"./Card-D56KNEnI.js";import{T as K}from"./Tabs-BTz8yyZK.js";import{u as Q}from"./useNotify-Bhb3OIEg.js";import{u as k,d as $,c as a}from"./useQueryHooks-BdeOvP9e.js";import{u as U}from"./ThemeContext-OPG61qw5.js";import{a as Z}from"./SyncContext-DYD5yPAv.js";import{D as N}from"./dataService-75QCl8KS.js";import{G as X}from"./geminiService-DjDdWyh4.js";import{s as Y}from"./utils-DPkCh2_M.js";import"./vendor-misc-Dwkhvdtg.js";import"./vendor-charts-KZIdMATq.js";import"./Badge-B08w10nz.js";import"./schemas-B2_dy3tf.js";import"./VirtualList-B1zORm91.js";import"./AppShell-Z1zGEOCG.js";import"./preload-helper-BXl3LOEh.js";import"./tabs.config-F85gN5xx.js";import"./PageHeader-os9pD5mt.js";import"./formatters-stMuSkc6.js";import"./Table-C8OsWLsz.js";import"./EmptyState-BwtZeBY5.js";import"./dateUtils-rLIRMrtk.js";import"./MetricCard-CDV5joW_.js";import"./queryKeys-BBVgMz36.js";import"./useSessionStorage-HC9RvMcM.js";import"./ErrorState-BA0dmAVI.js";import"./ConfirmDialog-CTAXMvML.js";import"./Modal-BlJFylOy.js";import"./Kanban-BbECSZhC.js";import"./FilterPanel-C0WYx6xs.js";import"./AdaptiveLoader-gvY3s3Bs.js";import"./type-mappings-DEPYyX4d.js";import"./UserAvatar-lVqVFNPb.js";import"./Input-JNgj1Ekc.js";import"./TextArea-BMpffac7.js";import"./TaskCreationModal-B2VECu1_.js";import"./search.config-B6mvIgDA.js";import"./useToggle-CjLp2PQ4.js";import"./sanitize-k_Tw3ej1.js";import"./useModalState-Cst_3NmK.js";import"./scheduler-BERajRBE.js";import"./RouteErrorBoundary-Nha8Il06.js";import"./meta-utils-lVs9HXG9.js";const R={extractCitations:t=>{const m=/(\d+)\s+([a-zA-Z0-9\.\s]+?)\s+(\d+)/g,h=/(\d+)\s+U\.?S\.?C\.?(\s+§+\s+)?(\d+)/gi,o=new Set;let r;for(;(r=m.exec(t))!==null;)r[2]&&!r[2].match(/Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec|AM|PM/i)&&o.add(r[0]);for(;(r=h.exec(t))!==null;)o.add(r[0]);return Array.from(o)},scanForInternalNexus:(t,m)=>{const h=[],o=new Map;m.forEach(x=>{x.parties?.forEach(l=>{const p=l.name.toLowerCase();o.has(p)||o.set(p,[]),o.get(p)?.push({caseId:x.id,caseTitle:x.title,role:l.role})})});const r=t.toLowerCase();return o.forEach((x,l)=>{l.length>4&&r.includes(l)&&h.push({entity:l,potentialMatches:x})}),h}},_e=()=>{const{theme:t}=U(),m=Q(),{openWindow:h,closeWindow:o}=Z(),[r,x]=u.useState(""),[l,p]=u.useState(!1),[f,j]=u.useState("authority"),[g,z]=u.useState([]),[n,D]=u.useState(null),[v,I]=u.useState([]),w=N.citations,E=N.cases,L=N.analysis,{data:S=[]}=k(["citations","all"],w.getAll),{data:M=[]}=k(["cases","all"],E.getAll),{mutate:T}=$(w.quickAdd,{onSuccess:s=>{const i=s;m.success(`Added ${i.citation} to Library`)}}),{mutate:B,isLoading:W}=$(L.add,{onSuccess:()=>m.success("Analysis session saved to case file.")}),q=async()=>{if(r.trim()){p(!0),j("authority");try{const s=R.extractCitations(r);z(s);const i=R.scanForInternalNexus(r,M);I(i);const c=await X.critiqueBrief(r);D(c),c.score&&j("strategy")}catch(s){console.error("Analysis failed",s),m.error("Analysis failed to complete.")}finally{p(!1)}}},F=()=>{if(!n)return;const s=`analysis-${Date.now()}`;h(s,"Brief Analysis Report",e.jsxs("div",{className:"p-6 bg-white h-full overflow-y-auto",children:[e.jsxs("div",{className:"mb-6 border-b pb-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"AI Critique Results"}),e.jsxs("p",{className:"text-sm text-slate-500",children:["Generated on ",new Date().toLocaleString()]})]}),e.jsx("button",{onClick:()=>O(s),className:"text-slate-400 hover:text-slate-600",children:"✕"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsx(d,{title:"Strength Score",children:e.jsx(C,{value:n.score,type:"strength"})}),e.jsx(d,{title:"Key Weaknesses",children:e.jsx("ul",{className:"list-disc pl-5 space-y-1 text-sm",children:n.weaknesses.map((i,c)=>e.jsx("li",{className:"text-red-700",children:i},`weakness-${c}-${i.substring(0,20)}`))})})]}),e.jsx(d,{title:"Recommendations",children:e.jsx("ul",{className:"list-disc pl-5 space-y-1 text-sm",children:n.suggestions.map((i,c)=>e.jsx("li",{children:i},`suggestion-${c}-${i.substring(0,20)}`))})})]}))},A=u.useMemo(()=>g.map(s=>{const i=S.find(c=>s.includes(c.citation)||c.citation.includes(s));return{text:s,match:i}}),[g,S]),O=s=>{o(s)};return e.jsxs("div",{className:"h-full flex flex-col lg:flex-row gap-6 animate-fade-in",children:[e.jsxs("div",{className:a("flex-1 flex flex-col min-h-[500px] rounded-xl shadow-sm border overflow-hidden",t.surface.default,t.border.default),children:[e.jsxs("div",{className:a("p-4 border-b flex justify-between items-center",t.surface.highlight,t.border.default),children:[e.jsxs("h3",{className:a("font-bold text-sm flex items-center",t.text.primary),children:[e.jsx(P,{className:"h-4 w-4 mr-2 text-blue-600"})," Brief Editor"]}),e.jsxs("span",{className:a("text-xs font-mono",t.text.tertiary),children:[r.length," chars"]})]}),e.jsx("textarea",{className:a("flex-1 w-full p-6 font-serif text-base leading-relaxed outline-none resize-none",t.text.primary,t.surface.input),placeholder:"Paste your brief, motion, or opposing counsel's filing here for analysis...",value:r,onChange:s=>x(s.target.value)}),e.jsxs("div",{className:a("p-4 border-t flex justify-between",t.border.default,t.surface.highlight),children:[e.jsx("div",{className:"flex gap-2",children:n&&e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"secondary",size:"sm",icon:V,onClick:()=>B({id:`ans-${Date.now()}`,textSnapshot:Y(r.substring(0,1e3)),extractedCitations:g,riskScore:100-n.score,strengths:n.strengths,weaknesses:n.weaknesses,suggestions:n.suggestions,missingAuthority:n.missingAuthority,timestamp:new Date().toISOString()}),isLoading:W,children:"Save Report"}),e.jsx(y,{variant:"outline",size:"sm",icon:G,onClick:F,children:"Pop Out"})]})}),e.jsx(y,{variant:"primary",icon:l?J:b,onClick:q,disabled:l||!r,className:"w-full md:w-auto",children:l?"Analyzing...":"Run Analysis Engine"})]})]}),e.jsxs("div",{className:a("w-full lg:w-[450px] flex flex-col rounded-xl shadow-sm border overflow-hidden",t.surface.default,t.border.default),children:[e.jsx("div",{className:a("px-4 pt-4 border-b",t.border.subtle),children:e.jsx(K,{tabs:[{id:"authority",label:"Authority",icon:_},{id:"strategy",label:"Strategy",icon:b},{id:"nexus",label:"Nexus",icon:H}],activeTab:f,onChange:s=>j(s),variant:"underline",className:"border-none"})}),e.jsxs("div",{className:a("flex-1 overflow-y-auto p-6",t.surface.highlight),children:[!n&&!l&&g.length===0&&e.jsxs("div",{className:a("flex flex-col items-center justify-center h-full text-center p-8",t.text.tertiary),children:[e.jsx(b,{className:"h-16 w-16 mb-4 opacity-20"}),e.jsx("p",{className:"text-sm font-medium",children:"Ready to Analyze"}),e.jsx("p",{className:"text-xs mt-2",children:"AI will extract citations, check signals, and critique arguments."})]}),f==="authority"&&A.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:a("font-semibold text-sm",t.text.primary),children:"Citation Verification"}),A.map((s,i)=>e.jsx(d,{className:"p-3",children:e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:a("text-sm font-mono",t.text.secondary),children:s.text}),s.match?e.jsxs("div",{className:a("mt-2 text-xs",t.status.success.text),children:["✓ Verified in database: ",s.match.signal||"N/A"]}):e.jsx("div",{className:a("mt-2 text-xs",t.status.warning.text),children:"⚠ Not found in citation database"})]}),!s.match&&e.jsx(y,{size:"sm",variant:"outline",onClick:()=>T({id:`cite-${Date.now()}-${i}`,citation:s.text,signal:"unknown",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),userId:"current-user"}),children:"Add to Library"})]})},i))]}),f==="strategy"&&n&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{title:"Strength Assessment",children:e.jsx(C,{value:n.score,type:"strength"})}),e.jsx(d,{title:"Strengths",children:e.jsx("ul",{className:a("list-disc pl-5 space-y-1 text-sm",t.status.success.text),children:n.strengths.map((s,i)=>e.jsx("li",{children:s},`strength-strat-${i}-${s.substring(0,20)}`))})}),e.jsx(d,{title:"Weaknesses",children:e.jsx("ul",{className:a("list-disc pl-5 space-y-1 text-sm",t.status.error.text),children:n.weaknesses.map((s,i)=>e.jsx("li",{children:s},`weakness-strat-${i}-${s.substring(0,20)}`))})}),e.jsx(d,{title:"Recommendations",children:e.jsx("ul",{className:a("list-disc pl-5 space-y-1 text-sm",t.text.secondary),children:n.suggestions.map((s,i)=>e.jsx("li",{children:s},`recommendation-strat-${i}-${s.substring(0,20)}`))})})]}),f==="nexus"&&v.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:a("font-semibold text-sm",t.text.primary),children:"Internal Case Conflicts"}),v.map((s,i)=>e.jsxs(d,{className:"p-3",children:[e.jsx("div",{className:a("text-sm font-semibold mb-1",t.status.warning.text),children:s.type==="client"?"Client Conflict":s.type==="party"?"Party Conflict":"Position Conflict"}),e.jsx("p",{className:a("text-xs",t.text.secondary),children:s.description}),e.jsxs("p",{className:a("text-xs mt-2",t.text.tertiary),children:["Risk: ",s.severity]})]},i))]})]})]})]})};export{_e as BriefAnalyzer,_e as default};
