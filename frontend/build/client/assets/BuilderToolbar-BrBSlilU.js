import{l as k,c9 as U,bb as oe,ca as le,v as ie,aa as de,q as ce,cb as ue,bF as fe,cc as xe,bZ as be,r as p,j as t,z as he,aQ as me,aR as pe}from"./vendor-core-V-oW58GW.js";import{c as n}from"./useQueryHooks-BdeOvP9e.js";import{u as Z}from"./ThemeContext-OPG61qw5.js";import{u as ge}from"./useNotify-Bhb3OIEg.js";const $e={"Rule 12(b)(6)":[{id:"granted",label:"Granted"},{id:"denied",label:"Denied"}],"Rule 56":[{id:"granted",label:"Granted"},{id:"denied",label:"Denied"}],"Motion in Limine":[{id:"granted",label:"Granted"},{id:"denied",label:"Denied"}],Default:[{id:"success",label:"Success"},{id:"failure",label:"Failure"}]},we=h=>{switch(h){case"Start":return k.createElement(be,{className:"h-4 w-4 text-green-600"});case"End":return k.createElement(xe,{className:"h-4 w-4 text-red-600"});case"Task":return k.createElement(U,{className:"h-4 w-4 text-blue-600"});case"Decision":return k.createElement(fe,{className:"h-4 w-4 text-purple-600"});case"Parallel":return k.createElement(ue,{className:"h-4 w-4 text-orange-600"});case"Delay":return k.createElement(ce,{className:"h-4 w-4 text-amber-600"});case"Phase":return k.createElement(de,{className:"h-4 w-4 text-indigo-600"});case"Event":return k.createElement(ie,{className:"h-4 w-4 text-emerald-600"});case"Milestone":return k.createElement(le,{className:"h-4 w-4 text-rose-600"});case"Comment":return k.createElement(oe,{className:"h-4 w-4 text-slate-500"});default:return k.createElement(U,{className:"h-4 w-4 text-blue-600"})}},W=we,ke=(h,w,c)=>{const f=n("absolute flex flex-col rounded-xl border-2 shadow-md cursor-pointer transition-all duration-200 select-none","hover:shadow-xl hover:-translate-y-0.5"),j=w?"ring-4 ring-offset-2 z-20":"z-10",v=c.border.focused;let d=c.border.default,g="",x="";switch(h){case"Start":d=n(c.status.success.border,c.status.success.bg),g="w-32 h-14",x="p-3 items-center justify-center rounded-full";break;case"End":d=n(c.status.error.border,c.status.error.bg),g="w-32 h-14",x="p-3 items-center justify-center rounded-full";break;case"Decision":d=n(c.border.default,"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800"),g="w-32 h-32 rotate-45 !rounded-2xl";break;case"Milestone":d=n(c.border.default,"bg-teal-50 dark:bg-teal-900/20 border-teal-200 dark:border-teal-800"),g="w-32 h-32 rotate-45 !rounded-3xl";break;case"Task":d=n(c.border.default,c.surface.default),g="w-48 h-22 !rounded-lg",x="p-0";break;case"Delay":d=n(c.status.warning.border,c.status.warning.bg,"border-dashed"),g="w-40 h-20",x="p-3 items-center justify-center";break;case"Event":d=n(c.border.default,"bg-pink-50 dark:bg-pink-900/20 border-pink-200 dark:border-pink-800"),g="w-40 h-16",x="p-3 items-center justify-center rounded-full";break;case"Phase":return d=n(c.border.default,c.surface.highlight,"backdrop-blur-sm !rounded-2xl"),x="p-0 justify-start items-start",`absolute flex flex-col cursor-pointer transition-all select-none ${d} ${x} ${w?"ring-2 z-0":"z-0"}`;case"Comment":d=n(c.status.warning.bg,"border-yellow-300 dark:border-yellow-700 shadow-none"),g="w-48 h-auto",x="p-3";break}return`${f} ${d} ${g} ${x} ${j} ${w?v:""}`},Me=({nodes:h,connections:w,selectedNodeId:c,selectedConnectionId:f,onSelectConnection:j,scale:v,pan:d,setPan:g,canvasRef:x,onMouseDownNode:A,onBackgroundClick:K,onAddConnection:V})=>{const{theme:N,mode:R}=Z(),Q=ge(),[D,G]=p.useState(!1),[m,L]=p.useState(null),[$,S]=p.useState(null),H=p.useRef(d),q=p.useRef(v),B=p.useRef(m),T=p.useRef(D),z=p.useRef({x:0,y:0});p.useEffect(()=>{H.current=d,q.current=v,B.current=m,T.current=D},[d,v,m,D]);const I=p.useCallback((e,r)=>{if(e===r)return{valid:!1,reason:"Cannot connect a node to itself."};if(w.find(a=>a.from===e&&a.to===r))return{valid:!1,reason:"Connection already exists."};const o=h.find(a=>a.id===e),l=h.find(a=>a.id===r);if(o?.type==="End")return{valid:!1,reason:"End node cannot have outgoing connections."};if(l?.type==="Start")return{valid:!1,reason:"Start node cannot have incoming connections."};const i=(a,b,u=new Set)=>a===b?!0:u.has(a)?!1:(u.add(a),w.filter(M=>M.from===a).some(M=>i(M.to,b,new Set(u))));return i(r,e)?{valid:!1,reason:"Connection would create a cycle."}:{valid:!0}},[w,h]),X=p.useMemo(()=>!m||!$?!0:I(m.from,$.nodeId).valid,[m,$,I]),Y=e=>{let r=160,s=80;return e==="Start"||e==="End"?(r=128,s=56):e==="Decision"||e==="Milestone"?(r=128,s=128):e==="Phase"?(r=600,s=400):e==="Event"?(r=160,s=64):e==="Task"&&(r=192,s=88),{w:r,h:s}},_=p.useCallback(e=>{const r=h.find(P=>P.id===e.from),s=h.find(P=>P.id===e.to);if(!r||!s)return{path:"",midX:0,midY:0};const o=Y(r.type),l=Y(s.type);let i=o.h/2;if(r.ports&&e.fromPort){const P=r.ports.findIndex(ne=>ne.id===e.fromPort);P!==-1&&(i=o.h/(r.ports.length+1)*(P+1))}const a=r.x+o.w,b=r.y+i,u=s.x,y=s.y+l.h/2,M=Math.abs(u-a),C=Math.max(M*.5,50),E=`M ${a} ${b} C ${a+C} ${b}, ${u-C} ${y}, ${u} ${y}`,O=a*.25+(a+C)*.25+(u-C)*.25+u*.25,ae=b*.25+b*.25+y*.25+y*.25;return{path:E,midX:O,midY:ae}},[h]);p.useEffect(()=>{const e=s=>{if(T.current){const o=s.clientX-z.current.x,l=s.clientY-z.current.y;g(i=>({x:i.x+o,y:i.y+l})),z.current={x:s.clientX,y:s.clientY}}if(B.current&&x.current){const o=x.current.getBoundingClientRect(),l=H.current,i=q.current;L(a=>a?{...a,x2:(s.clientX-o.left-l.x)/i,y2:(s.clientY-o.top-l.y)/i}:null)}},r=()=>{T.current&&G(!1),B.current&&(L(null),S(null))};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",r),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",r)}},[g,x]);const J=e=>{e.button===1||e.shiftKey||e.metaKey?(G(!0),z.current={x:e.clientX,y:e.clientY},e.preventDefault()):K()},F=(e,r,s)=>{e.stopPropagation();const o=h.find(E=>E.id===r);if(!o||!x.current)return;const{w:l,h:i}=Y(o.type);let a=i/2;if(o.ports){const E=o.ports.findIndex(O=>O.id===s);E!==-1&&(a=i/(o.ports.length+1)*(E+1))}const b=x.current.getBoundingClientRect(),u=o.x+l,y=o.y+a,M=(e.clientX-b.left-d.x)/v,C=(e.clientY-b.top-d.y)/v;L({from:r,fromPort:s,x1:u,y1:y,x2:M,y2:C})},ee=(e,r)=>{if(m){e.stopPropagation();const s=I(m.from,r);s.valid?V(m.from,r,m.fromPort):Q.error(s.reason||"Invalid connection"),L(null),S(null)}},te=(e,r)=>{m&&m.from!==e&&S({nodeId:e,portId:r})},re=()=>{S(null)},se=R==="dark"?"#334155":"#cbd5e1";return t.jsxs("div",{ref:x,className:n("flex-1 relative overflow-hidden outline-none",D?"cursor-grabbing":"cursor-default"),onMouseDown:J,children:[t.jsx("div",{className:"absolute inset-0 pointer-events-none z-0",style:{backgroundImage:`radial-gradient(${se} 1px, transparent 1px)`,backgroundSize:`${20*v}px ${20*v}px`,backgroundPosition:`${d.x}px ${d.y}px`,opacity:.5}}),t.jsxs("div",{className:"absolute top-0 left-0 w-full h-full",style:{transform:`translate(${d.x}px, ${d.y}px) scale(${v})`,transformOrigin:"0 0"},children:[t.jsxs("svg",{className:"absolute w-[10000px] h-[10000px] -top-[5000px] -left-[5000px] pointer-events-none overflow-visible z-0",children:[t.jsxs("defs",{children:[t.jsx("marker",{id:"arrow-default",viewBox:"0 0 10 10",refX:"8",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse",children:t.jsx("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:R==="dark"?"#64748b":"#94a3b8"})}),t.jsx("marker",{id:"arrow-selected",viewBox:"0 0 10 10",refX:"8",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse",children:t.jsx("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#2563eb"})}),t.jsx("marker",{id:"arrow-denied",viewBox:"0 0 10 10",refX:"8",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse",children:t.jsx("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#ef4444"})}),t.jsx("marker",{id:"arrow-granted",viewBox:"0 0 10 10",refX:"8",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse",children:t.jsx("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#22c55e"})})]}),w.map(e=>{const{path:r,midX:s,midY:o}=_(e);if(!r)return null;const l=f===e.id,i=e.label?.toLowerCase().includes("denied"),a=e.label?.toLowerCase().includes("granted"),b=l?"#2563eb":i?"#ef4444":a?"#22c55e":R==="dark"?"#64748b":"#94a3b8",u=l?"arrow-selected":i?"arrow-denied":a?"arrow-granted":"arrow-default";return t.jsxs("g",{className:"cursor-pointer",onClick:y=>{y.stopPropagation(),j(e.id)},children:[t.jsx("path",{d:r,stroke:b,strokeWidth:l?4:2,fill:"none",className:"transition-all",markerEnd:`url(#${u})`}),t.jsx("path",{d:r,stroke:"transparent",strokeWidth:"12",fill:"none"}),e.label&&t.jsx("text",{x:s,y:o,textAnchor:"middle",dy:"-5",className:n("text-[10px] font-bold fill-current",i?"text-red-500":a?"text-green-500":"text-slate-500"),children:e.label})]},e.id)}),(()=>{if(!m)return null;const{x1:e,y1:r,x2:s,y2:o}=m,l=Math.abs(s-e),i=Math.max(l*.5,50),a=`M ${e} ${r} C ${e+i} ${r}, ${s-i} ${o}, ${s} ${o}`,b=X?"#2563eb":"#ef4444",u=X?"url(#arrow-selected)":"url(#arrow-denied)";return t.jsx("path",{d:a,stroke:b,strokeWidth:"2",strokeDasharray:"5,5",fill:"none",markerEnd:u})})()]}),h.map(e=>{const r=c===e.id,{h:s}=Y(e.type);let o;switch(e.type){case"Task":o=t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:n("flex items-center gap-2 px-3 py-1.5 border-b rounded-t-lg",N.border.default),children:[W(e.type),t.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400",children:e.type})]}),t.jsx("div",{className:"p-3 text-center flex-1 flex items-center justify-center",children:t.jsx("p",{className:"text-sm font-medium text-slate-800 dark:text-slate-100 break-words",children:e.label})})]});break;case"Decision":case"Milestone":o=t.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center -rotate-45 pointer-events-none text-center p-2",children:[t.jsx("div",{className:n("p-2 mb-1 rounded-full bg-white/30 dark:bg-black/20 backdrop-blur-sm"),children:W(e.type)}),t.jsx("p",{className:n("text-xs font-bold leading-tight",N.text.primary),children:e.label})]});break;case"Phase":o=t.jsx("div",{className:n("h-10 px-4 flex items-center border-b rounded-t-2xl backdrop-blur-sm",N.surface.default,N.border.default,"bg-opacity-80 dark:bg-opacity-60"),children:t.jsx("span",{className:n("font-bold text-xs uppercase tracking-wider",N.text.secondary),children:e.label})});break;default:o=t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"mb-1 pointer-events-none",children:W(e.type)}),t.jsx("p",{className:n("text-sm font-bold text-center leading-tight w-full px-2 pointer-events-none",N.text.primary),children:e.label})]})}return t.jsxs("div",{"data-drag-id":e.id,onMouseDown:l=>A(l,e.id),className:ke(e.type,r,N),style:{transform:`translate(${e.x}px, ${e.y}px)`},children:[o,e.type!=="Start"&&e.type!=="Phase"&&t.jsx("div",{className:n("absolute -left-3 top-1/2 -translate-y-1/2 w-6 h-6 border-2 rounded-full transition-all bg-white dark:bg-slate-800 shadow-sm group-hover:scale-110 hover:!border-blue-500 dark:border-slate-600 dark:hover:!border-blue-400 flex items-center justify-center z-10",$?.nodeId===e.id&&$?.portId==="input"&&(X?"!border-green-500 !scale-125":"!border-red-500 !scale-125")),"data-port-id":"input",onMouseUp:l=>ee(l,e.id),onMouseEnter:()=>te(e.id,"input"),onMouseLeave:re,children:t.jsx("div",{className:n("w-2 h-2 rounded-full bg-transparent group-hover:bg-blue-500 transition-colors",$?.nodeId===e.id&&$?.portId==="input"&&(X?"bg-green-500":"bg-red-500"))})}),e.ports&&e.ports.map((l,i,a)=>{const b=s/(a.length+1)*(i+1);return t.jsx("div",{className:n("absolute -right-3 w-6 h-6 border-2 rounded-full transition-all bg-white dark:bg-slate-800 shadow-sm hover:scale-110 hover:border-blue-500 dark:border-slate-600 dark:hover:border-blue-400 cursor-crosshair flex items-center justify-center z-10"),style:{top:b-12},onMouseDown:u=>F(u,e.id,l.id),children:t.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-400 group-hover:bg-blue-500 transition-colors"})},l.id)}),e.type!=="End"&&!e.ports&&e.type!=="Phase"&&t.jsx("div",{className:n("absolute -right-3 top-1/2 -translate-y-1/2 w-6 h-6 border-2 rounded-full transition-all bg-white dark:bg-slate-800 shadow-sm hover:scale-110 hover:border-blue-500 dark:border-slate-600 dark:hover:border-blue-400 cursor-crosshair flex items-center justify-center z-10"),onMouseDown:l=>F(l,e.id,"default"),children:t.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-400 group-hover:bg-blue-500 transition-colors"})})]},e.id)})]})]})},Ce=({scale:h,setScale:w,onToggleSidebar:c})=>{const{theme:f}=Z();return t.jsxs("div",{className:n("h-12 border-b px-4 flex justify-between items-center z-20 shrink-0 shadow-sm",f.surface.default,f.border.default),children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:c,className:n("p-2 rounded-md",`hover:${f.surface.highlight}`),children:t.jsx(he,{className:n("h-5 w-5",f.text.secondary)})}),t.jsx("span",{className:n("text-xs font-bold uppercase tracking-wider",f.text.tertiary),children:"Visual Designer"})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("div",{className:n("flex rounded-lg p-1 mr-2 border",f.surface.highlight,f.border.default),children:[t.jsx("button",{onClick:()=>w(j=>Math.max(.5,j-.1)),className:n("p-1.5 rounded",f.text.secondary,`hover:${f.surface.default}`),children:t.jsx(me,{className:"h-4 w-4"})}),t.jsxs("span",{className:n("px-2 text-xs flex items-center font-mono w-12 justify-center",f.text.secondary),children:[Math.round(h*100),"%"]}),t.jsx("button",{onClick:()=>w(j=>Math.min(2,j+.1)),className:n("p-1.5 rounded",f.text.secondary,`hover:${f.surface.default}`),children:t.jsx(pe,{className:"h-4 w-4"})})]})})]})};export{Ce as B,$e as L,Me as a,W as g};
