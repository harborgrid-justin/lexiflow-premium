import{j as e,aj as K,a8 as z,a0 as F,t as G,A as Y,b6 as O}from"./vendor-core-V-oW58GW.js";import{u as m,c as l}from"./useQueryHooks-Oyt-TMLP.js";import{D as u}from"./dataService-BWLMkXM4.js";import"./case-detail-q84K17Pa.js";import{u as P}from"./ThemeContext-OPG61qw5.js";import{C as x}from"./Card-CDOiP5UM.js";import{M as y}from"./MetricCard-BH_9X7pi.js";import{ChartColorService as V}from"./chartColorService-Dq1XQNFk.js";import{g as X}from"./chartConfig-DG5fYqz9.js";import{R as C,A as q,X as w,Y as B,C as E,T as S,d as Q,B as W,a as H,b as J}from"./vendor-charts-KZIdMATq.js";import"./vendor-misc-Dwkhvdtg.js";import"./preload-helper-BXl3LOEh.js";import"./type-mappings-DEPYyX4d.js";import"./Button-CDQlLg6j.js";import"./Badge-bF-hTHJZ.js";import"./schemas-B2_dy3tf.js";import"./SyncContext-B5_p5hCg.js";import"./VirtualList-r2WXvtCD.js";import"./AppShell-Cug-APl3.js";import"./tabs.config-D59pmwVC.js";import"./PageHeader-C4TFe3Td.js";import"./formatters-stMuSkc6.js";import"./Table-C_bcd1kC.js";import"./EmptyState-7A4cJUVU.js";import"./useNotify-DdRjm5G5.js";import"./queryKeys-BBVgMz36.js";import"./useSessionStorage-D_292xEY.js";import"./ErrorState-WL3az5ve.js";import"./ConfirmDialog--jvbqDAw.js";import"./Modal-Rns91qFF.js";import"./Kanban-BI78PbzY.js";import"./dateUtils-rLIRMrtk.js";import"./FilterPanel-BteidCPx.js";import"./AdaptiveLoader-D5wOoiN1.js";import"./UserAvatar-BPVf-Spq.js";import"./Tabs-7xONCRTX.js";import"./Input-Dmln04Yk.js";import"./TextArea-DrtcCAyn.js";import"./geminiService-_CYFbtO8.js";import"./TaskCreationModal-D5xiqN6m.js";import"./search.config-B6mvIgDA.js";import"./useToggle-CjLp2PQ4.js";import"./sanitize-k_Tw3ej1.js";import"./useModalState-Cst_3NmK.js";import"./scheduler-BERajRBE.js";import"./RouteErrorBoundary-Nha8Il06.js";import"./meta-utils-lVs9HXG9.js";function Xt(){const{theme:i,mode:f}=P(),c=V.getPalette(f),d=X(f),{data:s}=m(["crm","analytics"],()=>u.crm.getAnalytics(f)),k=typeof s=="object"&&s!==null&&"growth"in s&&Array.isArray(s.growth)?s.growth:[],T=typeof s=="object"&&s!==null&&"industry"in s&&Array.isArray(s.industry)?s.industry:[];typeof s=="object"&&s!==null&&"revenue"in s&&Array.isArray(s.revenue)&&s.revenue,typeof s=="object"&&s!==null&&"sources"in s&&Array.isArray(s.sources)&&s.sources;const h={growth:k,industry:T},{data:b=[]}=m(["clients","all"],()=>u.clients.getAll()),{data:v=[]}=m(["cases","all"],()=>u.cases.getAll()),{data:A=[]}=m(["crm","leads"],()=>u.crm.getLeads()),p=Array.isArray(b)?b:[],j=Array.isArray(v)?v:[],N=Array.isArray(A)?A:[],D=p.filter(t=>{const r=typeof t=="object"&&t!==null&&"status"in t?String(t.status):"";return r==="Active"||r==="active"}).length,R=p.reduce((t,r)=>{if(typeof r=="object"&&r!==null&&"totalBilled"in r){const o=typeof r.totalBilled=="number"?r.totalBilled:0;return t+o}return t},0),L=j.filter(t=>{const r=typeof t=="object"&&t!==null&&"status"in t?String(t.status):"";return r!=="Closed"&&r!=="closed"}).length,U=N.reduce((t,r)=>{if(typeof r=="object"&&r!==null&&"value"in r){const o=typeof r.value=="string"?r.value:"",a=parseFloat(o.replace(/[^0-9.]/g,"")||"0");return t+a}return t},0);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(y,{label:"Total Active Clients",value:D.toString(),icon:K,trend:"+12% YTD",trendUp:!0,className:"border-l-4 border-l-blue-600"}),e.jsx(y,{label:"Lifetime Revenue",value:`$${(R/1e6).toFixed(1)}M`,icon:z,trend:"+8% vs Last Year",trendUp:!0,className:"border-l-4 border-l-emerald-600"}),e.jsx(y,{label:"Active Matters",value:L.toString(),icon:F,className:"border-l-4 border-l-purple-600"}),e.jsx(y,{label:"Pipeline Value",value:`$${(U/1e3).toFixed(0)}k`,icon:G,trend:`${N.length} Deals`,className:"border-l-4 border-l-amber-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(x,{title:"Client Acquisition Growth",className:"lg:col-span-2",children:e.jsx("div",{className:"h-72 w-full",children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(q,{data:h.growth,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorClients",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:c[0],stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:c[0],stopOpacity:0})]})}),e.jsx(w,{dataKey:"month",axisLine:!1,tickLine:!1,tick:{fill:d.text,fontSize:12}}),e.jsx(B,{axisLine:!1,tickLine:!1,tick:{fill:d.text,fontSize:12}}),e.jsx(E,{strokeDasharray:"3 3",vertical:!1,stroke:d.grid}),e.jsx(S,{cursor:{stroke:c[0],strokeWidth:1},contentStyle:d.tooltipStyle}),e.jsx(Q,{type:"monotone",dataKey:"clients",stroke:c[0],fillOpacity:1,fill:"url(#colorClients)"})]})})})}),e.jsx(x,{title:"Portfolio by Industry",children:e.jsx("div",{className:"h-72 w-full",children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(W,{data:h.industry,layout:"vertical",margin:{left:0,right:20},children:[e.jsx(w,{type:"number",hide:!0}),e.jsx(B,{dataKey:"name",type:"category",width:80,tick:{fontSize:11,fill:"#64748b"}}),e.jsx(S,{cursor:{fill:"transparent"}}),e.jsx(H,{dataKey:"value",radius:[0,4,4,0],barSize:20,children:h.industry.map((t,r)=>{const o=typeof t=="object"&&t!==null&&"color"in t&&typeof t.color=="string"?t.color:"#3b82f6";return e.jsx(J,{fill:o},`cell-${r}`)})})]})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(x,{title:"Recent Client Interactions",children:e.jsxs("div",{className:"space-y-4",children:[j.slice(0,3).map((t,r)=>{if(typeof t!="object"||t===null)return null;const o="client"in t&&typeof t.client=="string"?t.client:"Unknown Client",a="status"in t&&typeof t.status=="string"?t.status:"",g="title"in t&&typeof t.title=="string"?t.title:"",$="updatedAt"in t?t.updatedAt:null,M="createdAt"in t?t.createdAt:null,n=$||M;return e.jsxs("div",{className:l("flex justify-between items-center p-3 border-b last:border-0",i.border.default),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:l("p-2 rounded-full",i.surface.highlight),children:e.jsx(Y,{className:l("h-4 w-4",i.text.secondary)})}),e.jsxs("div",{children:[e.jsx("p",{className:l("text-sm font-bold",i.text.primary),children:o}),e.jsxs("p",{className:l("text-xs",i.text.secondary),children:[a," â€¢ ",g]})]})]}),e.jsx("span",{className:l("text-xs font-mono",i.text.tertiary),children:n&&(typeof n=="string"||typeof n=="number"||n instanceof Date)?new Date(n).toLocaleDateString():"N/A"})]},r)}),j.length===0&&e.jsx("p",{className:l("text-sm text-center py-8",i.text.secondary),children:"No recent interactions"})]})}),e.jsx(x,{title:"Key Accounts (Top Revenue)",children:e.jsxs("div",{className:"space-y-4",children:[p.sort((t,r)=>{const o=typeof t=="object"&&t!==null&&"totalBilled"in t&&typeof t.totalBilled=="number"?t.totalBilled:0;return(typeof r=="object"&&r!==null&&"totalBilled"in r&&typeof r.totalBilled=="number"?r.totalBilled:0)-o}).slice(0,3).map((t,r)=>{if(typeof t!="object"||t===null)return null;const o="name"in t&&typeof t.name=="string"?t.name:"Unknown",a="status"in t&&typeof t.status=="string"?t.status:"Active",g="totalBilled"in t&&typeof t.totalBilled=="number"?t.totalBilled:0;return e.jsxs("div",{className:l("flex justify-between items-center p-3 rounded-lg border hover:shadow-sm transition-all",i.surface.default,i.border.default),children:[e.jsxs("div",{children:[e.jsx("p",{className:l("font-bold text-sm",i.text.primary),children:o}),e.jsx("p",{className:l("text-xs",i.text.secondary),children:a})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:l("font-mono font-bold text-sm",i.text.primary),children:["$",(g/1e3).toFixed(0),"k"]}),e.jsx(O,{className:l("h-4 w-4",i.text.tertiary)})]})]},r)}),p.length===0&&e.jsx("p",{className:l("text-sm text-center py-8",i.text.secondary),children:"No clients yet"})]})})]})]})}export{Xt as CRMDashboard};
