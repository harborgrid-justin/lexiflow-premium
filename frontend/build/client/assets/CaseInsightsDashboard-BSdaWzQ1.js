import{r as f,j as e,ae as w,bU as M,T as A,bf as S}from"./vendor-core-V-oW58GW.js";import{u as N,b as y,c as s}from"./useQueryHooks-Oyt-TMLP.js";import{B as T}from"./Badge-bF-hTHJZ.js";import{B as R}from"./Button-CDQlLg6j.js";import{C as b}from"./Card-CDOiP5UM.js";import{u as I}from"./ThemeContext-OPG61qw5.js";import{C as u}from"./type-mappings-DEPYyX4d.js";import"./vendor-misc-Dwkhvdtg.js";import"./vendor-charts-KZIdMATq.js";const K=()=>{const{isDark:l}=I(),[n,o]=f.useState("30d"),{data:i}=N(["matters","all"],()=>y.cases.getAll()),{data:c}=N(["billing","time-entries"],()=>y.billing.getTimeEntries()),d={budgetAccuracy:85},h=f.useMemo(()=>{if(!i)return{probability:0,riskScore:0,budgetAccuracy:0};const t=i.filter(r=>r.status===u.Active||r.status===u.Open),a=i.filter(r=>r.status===u.Closed||r.status===u.Settled);return{probability:a.length>0?Math.round(t.length/(t.length+a.length)*100*10)/10:0,riskScore:t.length,budgetAccuracy:d?.budgetAccuracy||0}},[i,d]);return e.jsxs("div",{className:s("h-full flex flex-col",l?"bg-slate-900":"bg-slate-50"),children:[e.jsx("div",{className:s("border-b px-6 py-4",l?"bg-slate-800 border-slate-700":"bg-white border-slate-200"),children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("select",{value:n,onChange:t=>o(t.target.value),className:s("px-4 py-2 rounded-lg border text-sm",l?"bg-slate-700 border-slate-600 text-slate-100":"bg-white border-slate-300 text-slate-900"),children:[e.jsx("option",{value:"30d",children:"Last 30 Days"}),e.jsx("option",{value:"90d",children:"Last 90 Days"}),e.jsx("option",{value:"ytd",children:"Year to Date"}),e.jsx("option",{value:"all",children:"All Time"})]}),e.jsxs(R,{variant:"outline",size:"sm",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Export"]})]})})}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[e.jsx(j,{icon:M,title:"AI Success Probability",value:`${h.probability}%`,subtitle:"Based on historical data",isDark:l,color:"blue"}),e.jsx(j,{icon:A,title:"Risk Score",value:h.riskScore>5?"High":h.riskScore>2?"Medium":"Low",subtitle:`${h.riskScore} matters need attention`,isDark:l,color:"amber"}),e.jsx(j,{icon:S,title:"Budget Accuracy",value:`${h.budgetAccuracy}%`,subtitle:"Variance analysis",isDark:l,color:"emerald"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(b,{className:"p-6",children:[e.jsx("h3",{className:s("text-lg font-semibold mb-4",l?"text-slate-100":"text-slate-900"),children:"Risk Assessment"}),e.jsx("div",{className:"space-y-3",children:i?.filter(t=>t.status===u.Active||t.status===u.Open).slice(0,5).map(t=>{const a=t.value&&t.value>1e5,r=t.trialDate&&new Date(t.trialDate)<new Date(Date.now()+720*60*60*1e3),x=a||r?"high":"medium",g=a&&r?7.5:a||r?5:2.5,m=[];return a&&m.push("High value case"),r&&m.push("Trial approaching"),t.closeDate&&m.push("Close date set"),m.length===0&&m.push("On track"),e.jsx(B,{title:t.title,level:x,score:g,reasons:m,isDark:l},t.id)})})]}),e.jsxs(b,{className:"p-6",children:[e.jsx("h3",{className:s("text-lg font-semibold mb-4",l?"text-slate-100":"text-slate-900"),children:"Budget Variance Analysis"}),e.jsx("div",{className:"space-y-4",children:i?.filter(t=>t.value&&t.value>0).slice(0,5).map(t=>{const a=t.value||0,x=(c?.filter(m=>String(m.caseId)===String(t.id))||[]).reduce((m,v)=>m+(v.duration||0)*(v.rate||150),0),g=a>0?(x-a)/a*100:0;return e.jsx(C,{matter:t.title,budget:a,actual:x,variance:Math.round(g*10)/10,isDark:l},t.id)})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(b,{className:"lg:col-span-2 p-6",children:[e.jsx("h3",{className:s("text-lg font-semibold mb-4",l?"text-slate-100":"text-slate-900"),children:"Team Performance Insights"}),e.jsx("div",{className:"space-y-3",children:i&&(()=>{const t=new Map;return i.forEach(a=>{const r=a.leadAttorneyId||a.ownerId;if(!r)return;const x=t.get(r)||{id:r,name:`Attorney ${r.substring(0,8)}`,activeMatters:0,completedMatters:0,totalDays:0};if((a.status===u.Active||a.status===u.Open)&&x.activeMatters++,(a.status===u.Closed||a.status===u.Settled)&&(x.completedMatters++,a.createdAt)){const g=(new Date().getTime()-new Date(a.createdAt).getTime())/864e5;x.totalDays+=g}t.set(r,x)}),Array.from(t.values()).slice(0,5).map(a=>e.jsx(E,{name:a.name,matters:a.activeMatters,successRate:a.completedMatters>0?Math.round(a.completedMatters/(a.activeMatters+a.completedMatters)*100):0,avgResolution:a.completedMatters>0?Math.round(a.totalDays/a.completedMatters):0,clientSat:4.5,isDark:l},a.id))})()})]}),e.jsxs(b,{className:"p-6",children:[e.jsx("h3",{className:s("text-lg font-semibold mb-4",l?"text-slate-100":"text-slate-900"),children:"Recommendations"}),e.jsxs("div",{className:"space-y-4",children:[h.riskScore>3&&e.jsx(p,{title:"Review High-Risk Matters",description:`${h.riskScore} matters require immediate attention`,isDark:l}),i?.some(t=>(c?.filter(x=>String(x.caseId)===String(t.id))||[]).reduce((x,g)=>x+(g.duration||0)*(g.rate||150),0)>(t.value||0)*1.1)&&e.jsx(p,{title:"Budget Adjustments Needed",description:"Some matters are exceeding budget thresholds",isDark:l}),i?.some(t=>t.trialDate&&new Date(t.trialDate)<new Date(Date.now()+10080*60*1e3))&&e.jsx(p,{title:"Urgent Trial Dates",description:"Multiple trials approaching within 7 days",isDark:l})]})]})]})]})]})},j=({icon:l,title:n,value:o,subtitle:i,isDark:c,color:d})=>e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:s("text-sm font-medium mb-1",c?"text-slate-400":"text-slate-600"),children:n}),e.jsx("div",{className:s("text-2xl font-bold mb-1",c?"text-slate-100":"text-slate-900"),children:o}),e.jsx("div",{className:s("text-xs","text-slate-500"),children:i})]}),e.jsx("div",{className:s("p-3 rounded-lg",c?"bg-slate-700":"bg-slate-100"),children:e.jsx(l,{className:s("w-5 h-5",`text-${d}-500`)})})]})}),B=({title:l,level:n,score:o,reasons:i,isDark:c})=>e.jsxs("div",{className:s("p-4 rounded-lg border",c?"border-slate-700 bg-slate-800/50":"border-slate-200 bg-white"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:s("font-medium",c?"text-slate-100":"text-slate-900"),children:l}),e.jsxs(T,{variant:n==="high"?"error":n==="medium"?"warning":"success",children:[n," Risk"]})]}),e.jsxs("div",{className:s("text-sm mb-2",c?"text-slate-400":"text-slate-600"),children:["Risk Score: ",o,"/10"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:i.map((d,h)=>e.jsx("span",{className:s("text-xs px-2 py-1 rounded",c?"bg-slate-700 text-slate-300":"bg-slate-100 text-slate-700"),children:d},h))})]}),C=({matter:l,budget:n,actual:o,variance:i,isDark:c})=>e.jsxs("div",{className:s("p-4 rounded-lg border",c?"border-slate-700 bg-slate-800/50":"border-slate-200 bg-white"),children:[e.jsx("div",{className:s("font-medium mb-2",c?"text-slate-100":"text-slate-900"),children:l}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsxs("div",{className:s(c?"text-slate-400":"text-slate-600"),children:["Budget: $",(n/1e3).toFixed(0),"K"]}),e.jsxs("div",{className:s(c?"text-slate-400":"text-slate-600"),children:["Actual: $",(o/1e3).toFixed(0),"K"]})]}),e.jsxs("div",{className:s("text-lg font-semibold",i>0?"text-red-500":"text-emerald-500"),children:[i>0?"+":"",i,"%"]})]})]}),E=({name:l,matters:n,successRate:o,avgResolution:i,clientSat:c,isDark:d})=>e.jsxs("div",{className:s("p-4 rounded-lg border",d?"border-slate-700 bg-slate-800/50":"border-slate-200 bg-white"),children:[e.jsx("div",{className:s("font-medium mb-3",d?"text-slate-100":"text-slate-900"),children:l}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-center text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:s("text-xs mb-1","text-slate-500"),children:"Matters"}),e.jsx("div",{className:s("font-semibold",d?"text-slate-300":"text-slate-700"),children:n})]}),e.jsxs("div",{children:[e.jsx("div",{className:s("text-xs mb-1","text-slate-500"),children:"Success"}),e.jsxs("div",{className:s("font-semibold",d?"text-slate-300":"text-slate-700"),children:[o,"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:s("text-xs mb-1","text-slate-500"),children:"Avg Days"}),e.jsx("div",{className:s("font-semibold",d?"text-slate-300":"text-slate-700"),children:i})]}),e.jsxs("div",{children:[e.jsx("div",{className:s("text-xs mb-1","text-slate-500"),children:"Client"}),e.jsx("div",{className:s("font-semibold",d?"text-slate-300":"text-slate-700"),children:c})]})]})]}),p=({title:l,description:n,isDark:o})=>e.jsxs("div",{className:s("p-4 rounded-lg border",o?"border-slate-700 bg-slate-800/50":"border-slate-200 bg-slate-50"),children:[e.jsx("div",{className:s("font-medium mb-1",o?"text-slate-100":"text-slate-900"),children:l}),e.jsx("div",{className:s("text-sm",o?"text-slate-400":"text-slate-600"),children:n})]});export{K as CaseInsightsDashboard};
