import{r as g,j as a,a8 as q,aa as B,al as Q}from"./vendor-core-V-oW58GW.js";import{K,a as F,b as U}from"./Kanban-BbECSZhC.js";import{M as V}from"./Modal-BlJFylOy.js";import{I as d}from"./Input-JNgj1Ekc.js";import{T as J}from"./TextArea-BMpffac7.js";import{B as v}from"./Button-PaGqeZoR.js";import{A as R}from"./AdaptiveLoader-gvY3s3Bs.js";import{u as z}from"./ThemeContext-OPG61qw5.js";import{u as G,d as b,c as o,q as p}from"./useQueryHooks-BdeOvP9e.js";import{u as H}from"./useNotify-Bhb3OIEg.js";import{u as W}from"./useModalState-Cst_3NmK.js";import{D as x}from"./dataService-75QCl8KS.js";import"./vendor-misc-Dwkhvdtg.js";import"./vendor-charts-KZIdMATq.js";import"./SyncContext-DYD5yPAv.js";import"./preload-helper-BXl3LOEh.js";import"./type-mappings-DEPYyX4d.js";const pe=()=>{const{theme:r}=z(),{success:h,error:m}=H(),[f,y]=g.useState(null),[N,S]=g.useState(null),c=W(),[e,l]=g.useState({}),{data:j=[],isLoading:C}=G(["crm","leads"],x.crm.getLeads),{mutate:L}=b(async({id:t,stage:s})=>(await x.crm.updateLead(t,{stage:s,updatedAt:new Date().toISOString()}),(p.getQueryState(["crm","leads"])?.data||[]).map(i=>i.id===t?{...i,stage:s,updatedAt:new Date().toISOString()}:i)),{onSuccess:t=>{p.setQueryData(["crm","leads"],t),h("Lead stage updated")},onError:t=>{m(`Failed to update stage: ${t.message}`)}}),{mutate:w}=b(async t=>{const s={...t&&typeof t=="object"?t:{},id:crypto.randomUUID(),stage:"New Lead",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await x.crm.addLead(s),s},{onSuccess:t=>{const s=p.getQueryState(["crm","leads"])?.data||[];p.setQueryData(["crm","leads"],[...s,t]),h("Lead added successfully"),c.close(),l({})},onError:t=>{m(`Failed to add lead: ${t.message}`)}}),D=(t,s)=>{y(s),t.dataTransfer.effectAllowed="move"},E=t=>{f!==null&&L({id:f,stage:t}),y(null),S(null)},I=()=>{c.open()},A=()=>{if(typeof e!="object"||e===null){m("Invalid lead data");return}const t="name"in e&&e.name,s="contactEmail"in e&&e.contactEmail;if(!t||!s){m("Name and email are required");return}w(e)},$=["New Lead","Conflict Check","Engagement","Matter Created"];return C?a.jsx(R,{contentType:"dashboard",itemCount:6,shimmer:!0}):a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsx("div",{className:"flex justify-between items-center mb-4 px-2",children:a.jsx("h3",{className:o("font-bold",r.text.primary),children:"Pipeline Board"})}),a.jsx(K,{children:$.map((t,s)=>{const u=(Array.isArray(j)?j:[]).filter(n=>typeof n=="object"&&n!==null&&"stage"in n&&n.stage===t);return a.jsx(F,{title:t,count:u.length,isDragOver:N===t,onDrop:()=>E(t),action:s===0?a.jsxs("button",{onClick:I,className:o("mt-3 w-full py-2 border-2 border-dashed rounded-lg text-xs font-bold transition-all flex items-center justify-center",r.border.default,r.text.secondary,`hover:${r.surface.default}`,`hover:${r.primary.text}`,`hover:${r.primary.border}`),children:[a.jsx(Q,{className:"h-3 w-3 mr-1"})," Add Lead"]}):void 0,children:u.length===0?a.jsx("div",{className:o("text-center py-8 text-xs",r.text.tertiary),children:"No leads in this stage"}):u.map(n=>{if(typeof n!="object"||n===null)return null;const i="id"in n?String(n.id):"",O="client"in n&&typeof n.client=="string"?n.client:"",M="title"in n&&typeof n.title=="string"?n.title:"",P="value"in n&&typeof n.value=="string"?n.value:"$0",T="date"in n&&typeof n.date=="string"?n.date:"";return a.jsxs(U,{onDragStart:k=>D(k,i),isDragging:f===i,children:[a.jsx("div",{className:"flex justify-between items-start mb-1",children:a.jsx("h4",{className:o("font-bold text-sm line-clamp-1 transition-colors",r.text.primary,`group-hover:${r.primary.text}`),children:O})}),a.jsx("p",{className:o("text-xs mb-3 line-clamp-1",r.text.secondary),children:M}),a.jsxs("div",{className:o("flex justify-between items-center text-xs pt-2 border-t",r.border.default),children:[a.jsxs("span",{className:o("font-mono font-medium flex items-center",r.status.success.text),children:[a.jsx(q,{className:"h-3 w-3 mr-0.5"}),P.replace("$","")]}),a.jsxs("span",{className:o("flex items-center gap-1",r.text.tertiary),children:[a.jsx(B,{className:"h-3 w-3"})," ",T]})]})]},i)})},t)})}),a.jsx(V,{isOpen:c.isOpen,onClose:c.close,title:"New Lead Intake",children:a.jsxs("div",{className:"p-6 space-y-4",children:[a.jsx(d,{label:"Client Name",placeholder:"e.g., John Doe",value:typeof e=="object"&&e!==null&&"name"in e&&typeof e.name=="string"?e.name:"",onChange:t=>l({...e,name:t.target.value,client:t.target.value}),required:!0}),a.jsx(d,{label:"Contact Email",type:"email",placeholder:"client@example.com",value:typeof e=="object"&&e!==null&&"contactEmail"in e&&typeof e.contactEmail=="string"?e.contactEmail:"",onChange:t=>l({...e,contactEmail:t.target.value}),required:!0}),a.jsx(d,{label:"Phone",type:"tel",placeholder:"(555) 123-4567",value:typeof e=="object"&&e!==null&&"contactPhone"in e&&typeof e.contactPhone=="string"?e.contactPhone:"",onChange:t=>l({...e,contactPhone:t.target.value})}),a.jsx(d,{label:"Matter Title",placeholder:"Brief description of matter",value:typeof e=="object"&&e!==null&&"title"in e&&typeof e.title=="string"?e.title:"",onChange:t=>l({...e,title:t.target.value})}),a.jsx(d,{label:"Estimated Value",type:"number",placeholder:"50000",value:typeof e=="object"&&e!==null&&"value"in e&&typeof e.value=="string"?e.value.replace(/[^0-9]/g,""):"",onChange:t=>l({...e,value:`$${t.target.value}`})}),a.jsx(J,{label:"Notes",rows:4,placeholder:"Initial consultation notes...",value:typeof e=="object"&&e!==null&&"notes"in e&&typeof e.notes=="string"?e.notes:"",onChange:t=>l({...e,notes:t.target.value})}),a.jsxs("div",{className:o("flex justify-end gap-2 pt-4 border-t",r.border.default),children:[a.jsx(v,{variant:"ghost",onClick:c.close,children:"Cancel"}),a.jsx(v,{variant:"primary",onClick:A,children:"Add Lead"})]})]})})]})};export{pe as CaseListIntake};
