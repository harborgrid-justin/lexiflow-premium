import{j as e,a2 as N,bh as v,aC as w,V as C,F as M,al as A,r as L}from"./vendor-core-V-oW58GW.js";import{T as D}from"./TaskCreationModal-D5xiqN6m.js";import{V as P}from"./VirtualList-r2WXvtCD.js";import{L as E}from"./useSessionStorage-D_292xEY.js";import{u as j}from"./ThemeContext-OPG61qw5.js";import{c as r,u as O,d as y,q as T}from"./useQueryHooks-Oyt-TMLP.js";import{B as S}from"./Badge-bF-hTHJZ.js";import"./type-mappings-DEPYyX4d.js";import{T as o,D as m}from"./dataService-BWLMkXM4.js";import"./SyncContext-B5_p5hCg.js";import{q as b}from"./queryKeys-BBVgMz36.js";import{u as I}from"./useModalState-Cst_3NmK.js";import"./vendor-misc-Dwkhvdtg.js";import"./vendor-charts-KZIdMATq.js";import"./useNotify-DdRjm5G5.js";import"./Modal-Rns91qFF.js";import"./Input-Dmln04Yk.js";import"./TextArea-DrtcCAyn.js";import"./Button-CDQlLg6j.js";import"./search.config-B6mvIgDA.js";import"./UserAvatar-BPVf-Spq.js";import"./preload-helper-BXl3LOEh.js";const F=(s,i)=>{switch(s){case"Documents":return e.jsx(M,{className:r("h-3 w-3 mr-1",i?.text.tertiary)});case"Discovery":return e.jsx(C,{className:"h-3 w-3 mr-1 text-purple-500"});case"Evidence":return e.jsx(w,{className:"h-3 w-3 mr-1 text-amber-500"});case"Motions":return e.jsx(v,{className:"h-3 w-3 mr-1 text-blue-500"});default:return null}},H=({task:s,onToggle:i,onTaskClick:l})=>{const{theme:t}=j(),n=s.status===o.COMPLETED;return e.jsxs("div",{className:r("p-4 flex items-start transition-colors group h-[90px] border-b",t.border.default,`hover:${t.surface.highlight}`),children:[e.jsx("div",{className:"pt-0.5 mr-4",children:e.jsx("input",{type:"checkbox",className:"h-5 w-5 text-blue-600 rounded border-slate-300 cursor-pointer",checked:n,onChange:()=>i(s.id),"aria-label":`Mark ${s.title} as ${n?"incomplete":"complete"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:r("text-sm font-bold truncate pr-2",n?"text-slate-400 line-through":t.text.primary),children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx(S,{variant:s.priority==="High"?"error":s.priority==="Medium"?"warning":"neutral",children:s.priority}),s.caseId&&e.jsxs("button",{onClick:()=>l(s),className:"flex items-center px-2 py-1 rounded text-[10px] font-medium transition-colors text-blue-600 bg-blue-50 hover:bg-blue-100 hover:border-blue-200 border border-transparent",title:"Go to Case",children:["Case ",e.jsx(N,{className:"h-3 w-3 ml-1"})]})]})]}),e.jsxs("p",{className:r("text-xs mt-1 flex items-center",t.text.secondary),children:[s.relatedModule&&e.jsxs("span",{className:r("flex items-center mr-3 px-1.5 py-0.5 rounded",t.surface.highlight),children:[F(s.relatedModule,t)," ",s.relatedModule]}),e.jsxs("span",{className:"mr-3",children:["Due: ",s.dueDate]}),e.jsxs("span",{children:["Assignee: ",s.assignee]})]}),s.relatedItemTitle&&e.jsxs("p",{className:r("text-xs mt-1 pl-2 border-l-2 truncate opacity-80",t.primary.text,t.primary.border),children:["Linked: ",s.relatedItemTitle]})]})]})},B=({filter:s,onFilterChange:i,onAddTask:l})=>{const{theme:t}=j();return e.jsxs("div",{className:r("flex flex-col sm:flex-row justify-between items-center gap-4 p-4 rounded-lg border shadow-sm",t.surface.default,t.border.default),children:[e.jsxs("div",{children:[e.jsx("h3",{className:r("font-bold",t.text.primary),children:"Task Manager"}),e.jsx("p",{className:r("text-sm",t.text.secondary),children:"Cross-module workflow & assignments"})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("select",{className:r("border text-sm rounded-md px-3 py-1.5 outline-none",t.surface.default,t.border.default,t.text.primary),value:s,onChange:n=>i(n.target.value),"aria-label":"Filter Tasks",children:[e.jsx("option",{value:"All",children:"All Tasks"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"High Priority",children:"High Priority"})]}),e.jsxs("button",{onClick:l,className:r("flex items-center justify-center px-4 py-2 rounded-md text-sm font-medium transition-colors",t.primary.DEFAULT,t.text.inverse,t.primary.hover),children:[e.jsx(A,{className:"h-4 w-4 mr-2"})," Add Task"]})]})]})};function R(s){const i=I(),[l,t]=L.useState("All"),{data:n=[],isLoading:u,error:x}=O(["tasks","all"],()=>m.tasks.getAll()),{mutate:h}=y(m.tasks.add,{onSuccess:()=>T.invalidate(b.tasks.all())}),{mutate:p}=y(a=>m.tasks.update(a.id,a.updates),{onSuccess:()=>T.invalidate(b.tasks.all())}),c=Array.isArray(n)?n:[],f=c.filter(a=>l==="All"?!0:l==="Pending"?a.status===o.TODO||a.status===o.IN_PROGRESS:l==="High Priority"?a.priority==="High":!0);return{taskModal:i,filter:l,setFilter:t,filteredTasks:f,isLoading:u,error:x,handleAddTask:async a=>{await h(a)},handleToggle:async a=>{const d=c.find(g=>g.id===a);if(d){const g=d.status===o.COMPLETED?o.TODO:o.COMPLETED;await p({id:a,updates:{status:g}})}},handleTaskClick:async a=>{if(a.caseId&&s){const d=await m.cases.getById(a.caseId);d&&s(d)}}}}const ce=({onSelectCase:s})=>{const{theme:i}=j(),{taskModal:l,filter:t,setFilter:n,filteredTasks:u,isLoading:x,error:h,handleAddTask:p,handleToggle:c,handleTaskClick:f}=R(s);return e.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[l.isOpen&&e.jsx(D,{isOpen:!0,onClose:l.close,onSave:p}),e.jsx(B,{filter:t,onFilterChange:n,onAddTask:l.open}),e.jsx("div",{className:r("rounded-lg border shadow-sm flex-1 overflow-hidden",i.surface.default,i.border.default),children:x?e.jsx(E,{}):h?e.jsx("div",{className:"flex items-center justify-center h-full p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:r("text-sm mb-2",i.text.secondary),children:"Unable to load tasks. Please ensure the backend is running."}),e.jsx("p",{className:r("text-xs",i.text.tertiary),children:"Working in offline mode with cached data."})]})}):e.jsx(P,{items:u,height:"100%",itemHeight:90,renderItem:k=>e.jsx(H,{task:k,onToggle:c,onTaskClick:f},k.id),emptyMessage:"No tasks found."})})]})};export{ce as CaseListTasks};
