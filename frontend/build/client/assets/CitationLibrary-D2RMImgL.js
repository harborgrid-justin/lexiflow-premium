import{r as h,j as e,X as I,v as L,T as D,ab as j,a$ as y,aV as w,ax as B,by as $}from"./vendor-core-V-oW58GW.js";import{u as E,h as H}from"./case-detail-q84K17Pa.js";import{V as b}from"./VirtualList-r2WXvtCD.js";import{B as v}from"./Badge-bF-hTHJZ.js";import{B as p}from"./Button-CDQlLg6j.js";import{E as R}from"./EmptyState-7A4cJUVU.js";import{u as C}from"./ThemeContext-OPG61qw5.js";import{u as S,c as t}from"./useQueryHooks-Oyt-TMLP.js";import{D as k}from"./dataService-BWLMkXM4.js";import{G as W}from"./geminiService-_CYFbtO8.js";import{s as M}from"./sanitize-k_Tw3ej1.js";import{a as P}from"./SyncContext-B5_p5hCg.js";import{g as N,a as F}from"./utils-BtPdWbql.js";import"./vendor-misc-Dwkhvdtg.js";import"./vendor-charts-KZIdMATq.js";import"./schemas-B2_dy3tf.js";import"./AppShell-Cug-APl3.js";import"./preload-helper-BXl3LOEh.js";import"./tabs.config-D59pmwVC.js";import"./PageHeader-C4TFe3Td.js";import"./formatters-stMuSkc6.js";import"./Table-C_bcd1kC.js";import"./useNotify-DdRjm5G5.js";import"./Card-CDOiP5UM.js";import"./MetricCard-BH_9X7pi.js";import"./queryKeys-BBVgMz36.js";import"./useSessionStorage-D_292xEY.js";import"./ErrorState-WL3az5ve.js";import"./ConfirmDialog--jvbqDAw.js";import"./Modal-Rns91qFF.js";import"./Kanban-BI78PbzY.js";import"./dateUtils-rLIRMrtk.js";import"./FilterPanel-BteidCPx.js";import"./AdaptiveLoader-D5wOoiN1.js";import"./type-mappings-DEPYyX4d.js";import"./UserAvatar-BPVf-Spq.js";import"./Tabs-7xONCRTX.js";import"./Input-Dmln04Yk.js";import"./TextArea-DrtcCAyn.js";import"./TaskCreationModal-D5xiqN6m.js";import"./search.config-B6mvIgDA.js";import"./useToggle-CjLp2PQ4.js";import"./useModalState-Cst_3NmK.js";import"./scheduler-BERajRBE.js";import"./RouteErrorBoundary-Nha8Il06.js";import"./meta-utils-lVs9HXG9.js";const O=({citation:i,onClose:r})=>{const{theme:a}=C(),[c,m]=h.useState(null),[x,o]=h.useState(!1),{data:f=[],isLoading:u}=S(["cases","citation_link",i.id],async()=>(await k.cases.getAll()).slice(0,2)),d=async()=>{o(!0);try{const l=await W.generateDraft(`Summarize the legal significance of ${i.title} (${i.citation}). Explain its relevance to modern ${i.type} litigation.`,"Legal Summary");m(l)}finally{o(!1)}};return e.jsxs("div",{className:t("h-full flex flex-col border-l shadow-xl animate-in slide-in-from-right duration-300 z-10",a.surface.default,a.border.default),children:[e.jsxs("div",{className:t("p-4 border-b flex justify-between items-center",a.surface.highlight,a.border.default),children:[e.jsx("h4",{className:t("font-bold text-sm uppercase tracking-wide",a.text.secondary),children:"Authority Detail"}),e.jsx("button",{title:"Close panel",onClick:r,className:t("p-1 rounded hover:bg-slate-200",a.text.tertiary),children:e.jsx(I,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:t("text-xs font-mono px-2 py-1 rounded border font-bold",a.surface.highlight,a.border.default,a.text.secondary),children:i.citation}),e.jsxs("div",{className:t("flex items-center text-xs font-bold px-2 py-1 rounded border",i.shepardsSignal==="Positive"?"bg-green-50 text-green-700 border-green-200":"bg-amber-50 text-amber-700 border-amber-200"),children:[i.shepardsSignal==="Positive"?e.jsx(L,{className:"h-3 w-3 mr-1"}):e.jsx(D,{className:"h-3 w-3 mr-1"}),i.shepardsSignal]})]}),e.jsx("h3",{className:t("text-lg font-bold leading-snug",a.text.primary),children:i.title}),e.jsx("p",{className:t("text-sm mt-2 leading-relaxed",a.text.secondary),children:i.description})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:t("text-xs font-bold uppercase border-b pb-2",a.text.tertiary,a.border.default),children:"Referencing Cases"}),u?e.jsx("div",{className:"text-center py-4",children:e.jsx(j,{className:"animate-spin h-5 w-5 mx-auto text-slate-400"})}):f.map(l=>e.jsxs("div",{className:t("p-3 rounded border flex items-center justify-between group cursor-pointer transition-colors",a.surface.default,a.border.default,`hover:${a.surface.highlight}`),children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"bg-blue-100 p-1.5 rounded text-blue-600 shrink-0",children:e.jsx(y,{className:"h-4 w-4"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:t("text-sm font-bold truncate",a.text.primary),children:l.title}),e.jsx("p",{className:t("text-xs truncate",a.text.secondary),children:l.id})]})]}),e.jsx(w,{className:"h-3 w-3 text-slate-400 opacity-0 group-hover:opacity-100"})]},l.id))]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:t("flex justify-between items-center border-b pb-2",a.border.default),children:[e.jsx("h4",{className:t("text-xs font-bold uppercase",a.text.tertiary),children:"AI Analysis"}),e.jsx("button",{onClick:d,disabled:x,className:"text-xs flex items-center text-purple-600 hover:bg-purple-50 px-2 py-1 rounded transition-colors",children:x?"Thinking...":e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-3 w-3 mr-1"})," Summarize"]})})]}),c?e.jsx("div",{className:t("text-sm p-3 bg-purple-50 border border-purple-100 rounded text-slate-800 leading-relaxed"),children:e.jsx("div",{dangerouslySetInnerHTML:{__html:M(c)}})}):e.jsx("div",{className:t("text-center py-6 text-xs italic",a.text.tertiary),children:"Click Summarize to generate an AI brief of this authority."})]})]}),e.jsxs("div",{className:t("p-4 border-t flex gap-2",a.surface.highlight,a.border.default),children:[e.jsx(p,{variant:"outline",className:"flex-1",icon:$,children:"Copy Cite"}),e.jsx(p,{variant:"primary",className:"flex-1",children:"Add to Brief"})]})]})},Ee=({onSelect:i})=>{const{theme:r}=C(),{openWindow:a,closeWindow:c}=P(),[m,x]=h.useState(""),{data:o,isLoading:f}=S(["citations","all"],k.citations.getAll),u=h.useMemo(()=>o??[],[o]),{filteredItems:d,isSearching:l}=E({items:u,query:m,fields:["citation","title","description","type"]}),g=s=>{const n=`citation-${s.id}`;a(n,`Authority: ${s.citation}`,e.jsx(O,{citation:s,onClose:()=>c(n)}))},A=s=>e.jsxs("div",{onClick:()=>i(s),className:t("flex items-center border-b h-[64px] px-6 cursor-pointer hover:bg-slate-50 transition-colors group",r.border.default),children:[e.jsx("div",{className:"w-16 flex justify-center",title:s.shepardsSignal,children:N(s.shepardsSignal)}),e.jsx("div",{className:"w-48",children:e.jsx("span",{className:t("font-bold font-mono text-xs",r.primary.text),children:s.citation})}),e.jsx("div",{className:"flex-1 min-w-0 pr-4",children:e.jsx("div",{className:t("font-medium text-sm truncate",r.text.primary),title:s.title,children:s.title})}),e.jsxs("div",{className:"w-32 flex items-center gap-2",children:[F(s.type||"",r),e.jsx("span",{className:"text-xs",children:s.type||"Unknown"})]}),e.jsx("div",{className:"w-24",children:e.jsx(v,{variant:s.relevance==="High"?"success":s.relevance==="Medium"?"info":"neutral",children:s.relevance})}),e.jsx("div",{className:"w-20 text-right",children:e.jsx(p,{size:"sm",variant:"ghost",className:"opacity-0 group-hover:opacity-100",onClick:n=>{n.stopPropagation(),g(s)},title:"Open Details",children:e.jsx(w,{className:"h-4 w-4"})})})]},s.id),T=s=>e.jsx("div",{className:"px-2 py-1.5 h-[110px]",children:e.jsxs("div",{onClick:()=>i(s),className:t("p-4 rounded-lg shadow-sm border h-full flex flex-col justify-between",r.surface.default,r.border.default),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[N(s.shepardsSignal),e.jsx("span",{className:t("font-bold font-mono text-xs",r.primary.text),children:s.citation})]}),e.jsx(v,{variant:"neutral",children:s.type})]}),e.jsx("h4",{className:t("font-medium text-sm line-clamp-2",r.text.primary),children:s.title}),e.jsxs("div",{className:"flex justify-between items-center text-xs mt-1",children:[e.jsxs("span",{className:t("font-medium",s.relevance==="High"?"text-green-600":"text-slate-500"),children:[s.relevance," Relevance"]}),e.jsx(p,{size:"sm",variant:"ghost",onClick:n=>{n.stopPropagation(),g(s)},children:"Details"})]})]},s.id)}),z=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden md:flex flex-col h-full",children:[e.jsxs("div",{className:t("flex items-center px-6 py-3 border-b font-bold text-xs uppercase tracking-wider bg-slate-50",r.border.default,r.text.secondary),children:[e.jsx("div",{className:"w-16 text-center",children:"Signal"}),e.jsx("div",{className:"w-48",children:"Citation"}),e.jsx("div",{className:"flex-1",children:"Title"}),e.jsx("div",{className:"w-32",children:"Type"}),e.jsx("div",{className:"w-24",children:"Relevance"}),e.jsx("div",{className:"w-20 text-right",children:"Action"})]}),e.jsx("div",{className:"flex-1 relative",children:e.jsx(b,{items:d,height:"100%",itemHeight:64,renderItem:A})})]}),e.jsx("div",{className:"md:hidden flex-1 relative",children:e.jsx(b,{items:d,height:"100%",itemHeight:110,renderItem:T})})]});return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:t("p-4 border-b shrink-0 flex items-center gap-4",r.border.default),children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(H,{value:m,onChange:x,placeholder:"Search citation, title, or description...",className:"border-none shadow-none p-0 w-full"}),l&&e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2",children:e.jsx(j,{className:"h-4 w-4 animate-spin text-blue-500"})})]})}),e.jsx("div",{className:t("flex-1 min-h-0 flex flex-col bg-white border-t",r.border.default),children:f?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(j,{className:"h-6 w-6 animate-spin text-blue-600"})}):d.length>0?z:e.jsx("div",{className:"pt-10",children:e.jsx(R,{icon:y,title:"No Citations Found",description:l?"Searching...":"Your firm's citation library is empty or your search returned no results."})})})]})};export{Ee as CitationLibrary,Ee as default};
