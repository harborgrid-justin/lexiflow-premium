import{l as b,j as e,D as f,ah as C,ab as N,bZ as w,v as S,al as E,J as P,G as I,a5 as D}from"./vendor-core-V-oW58GW.js";import{B as L}from"./Badge-bF-hTHJZ.js";import{B as g}from"./Button-CDQlLg6j.js";import{P as R}from"./ProgressBar-DehhQOGX.js";import{C as k}from"./Card-CDOiP5UM.js";import{u as B}from"./ThemeContext-OPG61qw5.js";import{D as h}from"./dataService-BWLMkXM4.js";import{d as y,u as Q,c as i}from"./useQueryHooks-Oyt-TMLP.js";import{u as T}from"./useNotify-DdRjm5G5.js";import{a as q}from"./SyncContext-B5_p5hCg.js";import{n as M}from"./case-detail-q84K17Pa.js";import{d as x}from"./queryKeys-Dex4MaB7.js";import{E as p}from"./type-mappings-DEPYyX4d.js";import{EvidenceCustodyLog as _}from"./EvidenceCustodyLog-D6UjOCoT.js";import"./MetricCard-BH_9X7pi.js";import"./vendor-misc-Dwkhvdtg.js";import"./schemas-B2_dy3tf.js";import"./vendor-charts-KZIdMATq.js";import"./preload-helper-BXl3LOEh.js";import"./VirtualList-r2WXvtCD.js";import"./AppShell-Cug-APl3.js";import"./tabs.config-D59pmwVC.js";import"./PageHeader-C4TFe3Td.js";import"./formatters-stMuSkc6.js";import"./Table-C_bcd1kC.js";import"./EmptyState-7A4cJUVU.js";import"./queryKeys-BBVgMz36.js";import"./useSessionStorage-D_292xEY.js";import"./ErrorState-WL3az5ve.js";import"./ConfirmDialog--jvbqDAw.js";import"./Modal-Rns91qFF.js";import"./Kanban-BI78PbzY.js";import"./dateUtils-rLIRMrtk.js";import"./FilterPanel-BteidCPx.js";import"./AdaptiveLoader-D5wOoiN1.js";import"./UserAvatar-BPVf-Spq.js";import"./Tabs-7xONCRTX.js";import"./Input-Dmln04Yk.js";import"./TextArea-DrtcCAyn.js";import"./geminiService-_CYFbtO8.js";import"./TaskCreationModal-D5xiqN6m.js";import"./search.config-B6mvIgDA.js";import"./useToggle-CjLp2PQ4.js";import"./sanitize-k_Tw3ej1.js";import"./useModalState-Cst_3NmK.js";import"./scheduler-BERajRBE.js";import"./RouteErrorBoundary-Nha8Il06.js";import"./meta-utils-lVs9HXG9.js";class ${queue=[];running=0;maxConcurrent;onProgress;constructor(r=3,a){this.maxConcurrent=r,this.onProgress=a}async add(r,a){return new Promise((c,o)=>{this.queue.push({id:r,source:a}),this.processQueue();let d=0;const m=120,n=setInterval(()=>{d++,!this.queue.find(u=>u.id===r)&&this.running<this.maxConcurrent?(clearInterval(n),c()):d>=m&&(clearInterval(n),o(new Error(`Collection timeout for source: ${r}`)))},500)})}async processQueue(){for(;this.queue.length>0&&this.running<this.maxConcurrent;){const r=this.queue.shift();r&&(this.running++,this.collectSource(r.id).finally(()=>{this.running--,this.processQueue()}))}}async collectSource(r){try{this.onProgress?.(r,p.COLLECTING),await new Promise(a=>setTimeout(a,M*2)),this.onProgress?.(r,p.COLLECTED)}catch(a){throw this.onProgress?.(r,p.ERROR),a}}getQueueLength(){return this.queue.length}getRunningCount(){return this.running}}const Qe=()=>{const{theme:t}=B(),r=T(),{openWindow:a}=q(),c=b.useRef(null);c.current||(c.current=new $(3,(s,l)=>{d({status:l})}));const{data:o=[]}=Q(x.discovery.esi.all,()=>h.discovery.getESISources()),{mutate:d}=y(async s=>h.discovery.updateESISourceStatus(s.status),{invalidateKeys:[x.discovery.esi.all]}),{mutate:m,isLoading:n}=y(async s=>{const l=o.find(j=>j.id===s);if(!l)throw new Error("Source not found");return await c.current?.add(s,l),h.discovery.startCollection(s)},{onSuccess:()=>{r.success("ESI Collection Job completed successfully.")},onError:()=>{r.error("Collection failed. Please try again.")},invalidateKeys:[x.discovery.esi.all]}),u=s=>{switch(s){case"Email":return e.jsx(D,{className:i("h-5 w-5",t.primary.text)});case"Slack":return e.jsx(f,{className:"h-5 w-5 text-purple-500"});case"Device":return e.jsx(I,{className:i("h-5 w-5",t.text.tertiary)});default:return e.jsx(P,{className:"h-5 w-5 text-indigo-500"})}},v=s=>{const l=`custody-${s.id}`;a(l,`Custody Chain: ${s.name}`,e.jsx(_,{}))};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:i("p-6 rounded-lg shadow-sm flex justify-between items-center border",t.surface.overlay,t.border.default,t.text.inverse),children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(f,{className:"h-6 w-6 text-blue-400"})," ESI Data Map"]}),e.jsx("p",{className:"text-sm mt-1 opacity-80",children:"Track electronic sources, custodians, and preservation status."})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold font-mono text-green-400",children:[o.filter(s=>s.status==="Collected"||s.status==="Processed").length," / ",o.length]}),e.jsx("p",{className:"text-xs uppercase font-bold opacity-60",children:"Sources Collected"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[o.map(s=>e.jsxs(k,{noPadding:!0,className:"flex flex-col h-full hover:border-blue-300 transition-colors",children:[e.jsxs("div",{className:i("p-4 border-b flex justify-between items-start",t.border.default,t.surface.highlight),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:i("p-2 rounded border shadow-sm",t.surface.default,t.border.default),children:u(s.type)}),e.jsxs("div",{children:[e.jsx("h4",{className:i("font-bold text-sm",t.text.primary),children:s.name}),e.jsx("p",{className:i("text-xs",t.text.secondary),children:s.custodian})]})]}),e.jsx(L,{variant:s.status==="Collected"?"success":s.status==="Preserved"?"warning":"neutral",children:s.status})]}),e.jsxs("div",{className:"p-4 flex-1 space-y-4",children:[e.jsxs("div",{className:i("flex justify-between text-xs",t.text.secondary),children:[e.jsx("span",{children:"Size Estimate"}),e.jsx("span",{className:i("font-mono font-bold",t.text.primary),children:s.size||"TBD"})]}),s.status==="Identified"&&e.jsxs("div",{className:i("p-3 rounded border text-xs flex items-start gap-2",t.status.warning.bg,t.status.warning.border,t.status.warning.text),children:[e.jsx(C,{className:"h-4 w-4 shrink-0"}),"Legal Hold pending. Ensure custodian notification."]}),s.status==="Preserved"&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:i("text-xs font-bold",t.text.secondary),children:"Collection Progress"}),e.jsx(R,{label:"",value:0,showValue:!1,colorClass:"bg-blue-500"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(g,{size:"sm",variant:"primary",icon:n?N:w,onClick:()=>m(s.id),disabled:n,children:n?"Collecting...":"Start Collection"})})]}),s.status==="Collected"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-green-600 text-xs font-bold",children:[e.jsx(S,{className:"h-4 w-4 mr-1"})," Collection Verified"]}),e.jsx(g,{size:"sm",variant:"outline",className:"w-full",onClick:()=>d({status:"Processed"}),children:"Process to Review"})]}),s.status==="Processed"&&e.jsx("div",{className:i("p-3 rounded text-xs text-center font-medium",t.status.info.bg,t.status.info.text,t.status.info.border,"border"),children:"Ready for Review"})]}),e.jsxs("div",{className:i("p-3 border-t flex justify-between items-center text-xs",t.border.default,t.surface.highlight,t.text.tertiary),children:[e.jsxs("span",{children:["ID: ",s.id]}),e.jsx("button",{className:"text-blue-600 hover:underline",onClick:()=>v(s),children:"View Chain of Custody"})]})]},s.id)),e.jsxs("button",{className:i("border-2 border-dashed rounded-lg flex flex-col items-center justify-center p-8 transition-all",t.border.default,t.text.tertiary,`hover:${t.primary.border}`,`hover:${t.primary.text}`,`hover:${t.surface.highlight}`),children:[e.jsx(E,{className:"h-10 w-10 mb-2"}),e.jsx("span",{className:"font-bold",children:"Add Data Source"})]})]})]})};export{Qe as DiscoveryESI,Qe as default};
