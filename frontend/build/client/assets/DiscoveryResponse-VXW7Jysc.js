import{r as o,j as e,bd as b,q as y,an as N,ax as S}from"./vendor-core-V-oW58GW.js";import{B as D}from"./Badge-bF-hTHJZ.js";import{B as u}from"./Button-CDQlLg6j.js";import{c as r}from"./useQueryHooks-Oyt-TMLP.js";import"./dataService-BWLMkXM4.js";import{u as w}from"./ThemeContext-OPG61qw5.js";import"./SyncContext-B5_p5hCg.js";import{i as R,g as k}from"./case-detail-q84K17Pa.js";import{u as I}from"./useNotify-DdRjm5G5.js";import"./vendor-misc-Dwkhvdtg.js";import"./type-mappings-DEPYyX4d.js";import{G as C}from"./geminiService-_CYFbtO8.js";import"./schemas-B2_dy3tf.js";import{v as P}from"./discoverySchemas-nx9p4LOg.js";import"./vendor-charts-KZIdMATq.js";import"./preload-helper-BXl3LOEh.js";import"./VirtualList-r2WXvtCD.js";import"./AppShell-Cug-APl3.js";import"./tabs.config-D59pmwVC.js";import"./PageHeader-C4TFe3Td.js";import"./formatters-stMuSkc6.js";import"./Table-C_bcd1kC.js";import"./EmptyState-7A4cJUVU.js";import"./Card-CDOiP5UM.js";import"./MetricCard-BH_9X7pi.js";import"./queryKeys-BBVgMz36.js";import"./useSessionStorage-D_292xEY.js";import"./ErrorState-WL3az5ve.js";import"./ConfirmDialog--jvbqDAw.js";import"./Modal-Rns91qFF.js";import"./Kanban-BI78PbzY.js";import"./dateUtils-rLIRMrtk.js";import"./FilterPanel-BteidCPx.js";import"./AdaptiveLoader-D5wOoiN1.js";import"./UserAvatar-BPVf-Spq.js";import"./Tabs-7xONCRTX.js";import"./Input-Dmln04Yk.js";import"./TextArea-DrtcCAyn.js";import"./TaskCreationModal-D5xiqN6m.js";import"./search.config-B6mvIgDA.js";import"./useToggle-CjLp2PQ4.js";import"./sanitize-k_Tw3ej1.js";import"./useModalState-Cst_3NmK.js";import"./scheduler-BERajRBE.js";import"./RouteErrorBoundary-Nha8Il06.js";import"./meta-utils-lVs9HXG9.js";const Se=({request:t,onBack:c,onSave:v})=>{const{theme:s}=w(),n=I(),[l,d]=o.useState(""),[m,p]=o.useState(!1),[f,g]=o.useState(null),[,j]=o.useState([]),i=o.useCallback(async()=>{if(!t)return;p(!0);const a=await C.generateDraft(`Draft a legal response to this discovery request pursuant to FRCP 34/33: "${t.title}: ${t.description}".
      Include standard objections (overly broad, undue burden, vague/ambiguous).
      Format as a formal legal pleading.`,"Discovery Response");d(a),p(!1)},[t]),{isSaving:x}=R({data:l,onSave:async a=>{t&&(localStorage.setItem(`discovery-response-draft-${t.id}`,a),g(new Date))},delay:2e3,enabled:!!t});o.useEffect(()=>{if(t)try{const a=localStorage.getItem(`discovery-response-draft-${t.id}`);a?(d(a),n.info("Draft restored from auto-save")):i()}catch(a){console.error("Failed to restore draft:",a),i()}},[i,n,t]),k({"mod+s":()=>{t&&h()},"mod+g":()=>{i()},escape:()=>{c()}});const h=()=>{if(!t)return;const a=P(t);if(!a.success){j(a.error.errors),n.error("Validation failed. Please check the form.");return}v(t.id,l),localStorage.removeItem(`discovery-response-draft-${t.id}`),n.success("Response saved successfully")};return t?e.jsxs("div",{className:r("flex flex-col h-full rounded-lg shadow-sm border animate-fade-in",s.surface.default,s.border.default),children:[e.jsxs("div",{className:r("p-4 border-b flex justify-between items-center",s.border.default,s.surface.highlight),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:c,className:r("mr-3 p-2 rounded-full transition-colors",s.text.secondary,`hover:${s.surface.default}`),children:e.jsx(b,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:r("text-lg font-bold",s.text.primary),children:"Drafting Response"}),e.jsxs("p",{className:r("text-xs",s.text.secondary),children:["Ref: ",t.id," â€¢ ",t.title]})]})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[x&&e.jsxs("span",{className:r("text-xs flex items-center gap-1",s.text.secondary),children:[e.jsx(y,{className:"h-3 w-3 animate-spin"})," Saving..."]}),f&&!x&&e.jsxs("span",{className:r("text-xs",s.text.tertiary),children:["Saved ",new Date(f).toLocaleTimeString()]}),e.jsx(u,{size:"sm",variant:"ghost",onClick:i,disabled:m,children:m?"AI Generating...":"Re-Generate AI Draft"}),e.jsx(u,{size:"sm",variant:"primary",icon:N,onClick:h,children:"Save & Mark Responded"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row flex-1 overflow-hidden",children:[e.jsxs("div",{className:r("w-full md:w-1/3 border-r p-6 overflow-y-auto",s.border.default,s.surface.highlight),children:[e.jsx("div",{className:"mb-4",children:e.jsx(D,{variant:"neutral",children:t.type})}),e.jsx("h3",{className:r("font-bold mb-2",s.text.primary),children:t.title}),e.jsx("p",{className:r("text-sm leading-relaxed mb-6 p-4 rounded border",s.surface.default,s.border.default,s.text.secondary),children:t.description}),e.jsxs("div",{className:r("space-y-4 text-xs",s.text.secondary),children:[e.jsxs("div",{children:[e.jsx("span",{className:r("font-bold block",s.text.primary),children:"Propounding Party"}),t.propoundingParty]}),e.jsxs("div",{children:[e.jsx("span",{className:r("font-bold block",s.text.primary),children:"Responding Party"}),t.respondingParty]}),e.jsxs("div",{children:[e.jsx("span",{className:r("font-bold block",s.text.primary),children:"Deadline"}),t.dueDate]})]}),e.jsxs("div",{className:r("mt-8 p-4 rounded border",s.status.info.bg,s.status.info.border),children:[e.jsxs("h4",{className:r("text-sm font-bold mb-2 flex items-center",s.status.info.text),children:[e.jsx(S,{className:"h-3 w-3 mr-2"})," AI Insight"]}),e.jsx("p",{className:r("text-xs",s.status.info.text),children:'This request matches patterns often deemed "overly broad" in this jurisdiction. Consider objecting to the timeframe scope.'})]})]}),e.jsx("div",{className:"flex-1 flex flex-col relative",children:e.jsx("textarea",{className:r("flex-1 w-full p-8 font-serif text-base leading-relaxed outline-none resize-none",s.surface.default,s.text.primary),value:l,onChange:a=>d(a.target.value),placeholder:"Draft your legal response here..."})})]})]}):e.jsx("div",{children:"No request selected."})};export{Se as DiscoveryResponse,Se as default};
