import{l as $,j as e,ab as T,p as z,al as D,F as H,v as V,u as G,cL as X}from"./vendor-core-V-oW58GW.js";import{T as J,a as W,d as P,b as d,c as Y,e as c}from"./Table-C8OsWLsz.js";import{B as Z}from"./Badge-B08w10nz.js";import{B as l}from"./Button-PaGqeZoR.js";import{I as y}from"./Input-JNgj1Ekc.js";import{T as ee}from"./TextArea-BMpffac7.js";import{M as te}from"./Modal-BlJFylOy.js";import{u as se,d as A,c as a}from"./useQueryHooks-BdeOvP9e.js";import{D as f,h as ae}from"./dataService-75QCl8KS.js";import{u as re}from"./ThemeContext-OPG61qw5.js";import"./SyncContext-DYD5yPAv.js";import{u as ie}from"./useModalState-Cst_3NmK.js";import{u as ne}from"./useNotify-Bhb3OIEg.js";import"./vendor-misc-Dwkhvdtg.js";import"./vendor-charts-KZIdMATq.js";import"./preload-helper-BXl3LOEh.js";import"./type-mappings-DEPYyX4d.js";const le=[{value:"Pending",label:"Pending",variant:"warning"},{value:"Approved",label:"Approved",variant:"success"},{value:"Rejected",label:"Rejected",variant:"error"}],q={status:"Pending",title:"",requestingParty:"",proposedDate:"",reason:""},we=({caseId:u})=>{const{theme:t}=re(),o=ne(),{isOpen:k,open:F,close:g}=ie(),[r,v]=$.useState(q),p=u?["stipulations","case",u]:["stipulations","all"],{data:x=[],isLoading:L,status:E,error:b,refetch:M}=se(p,()=>f.discovery.getStipulations(u)),I=E==="error",{mutate:O,isLoading:h}=A(f.discovery.addStipulation,{invalidateKeys:[p],onSuccess:()=>{g(),j(),o.success("Stipulation requested successfully.")},onError:s=>{o.error(`Failed to create stipulation: ${s.message}`)}}),{mutate:R,isLoading:S}=A(async({id:s,status:i})=>{const n=x.find(U=>U.id===s);if(!n)throw new Error("Stipulation not found");return f.discovery.addStipulation({...n,status:i})},{invalidateKeys:[p],onSuccess:(s,i)=>{const n=i.status.toLowerCase();o.success(`Stipulation ${n} successfully.`)},onError:s=>{o.error(`Failed to update stipulation: ${s.message}`)}}),j=()=>{v(q)},N=()=>{j(),F()},C=()=>{j(),g()},B=()=>{if(!r.title?.trim()||!r.requestingParty?.trim()){o.warning("Please fill in all required fields.");return}const s={id:ae.stipulation(),title:r.title.trim(),requestingParty:r.requestingParty.trim(),proposedDate:r.proposedDate||new Date().toISOString().split("T")[0],status:"Pending",reason:r.reason?.trim()||"",caseId:u,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};O(s)},w=(s,i)=>{R({id:s,status:i})},m=s=>i=>{v(n=>({...n,[s]:i.target.value}))},_=s=>le.find(n=>n.value===s)?.variant||"neutral",K=!!(r.title?.trim()&&r.requestingParty?.trim());if(L)return e.jsxs("div",{className:a("flex flex-col items-center justify-center py-16",t.surface.default),children:[e.jsx(T,{className:a("h-8 w-8 animate-spin mb-4",t.text.tertiary)}),e.jsx("p",{className:t.text.secondary,children:"Loading stipulations..."})]});if(I)return e.jsxs("div",{className:a("flex flex-col items-center justify-center py-16 rounded-lg border",t.surface.default,t.border.default),children:[e.jsx(z,{className:a("h-12 w-12 mb-4",t.status.error.text)}),e.jsx("h3",{className:a("text-lg font-semibold mb-2",t.text.primary),children:"Failed to Load Stipulations"}),e.jsx("p",{className:a("text-sm mb-4",t.text.secondary),children:b instanceof Error?b.message:"An unexpected error occurred"}),e.jsx(l,{variant:"secondary",onClick:()=>M(),children:"Try Again"})]});const Q=()=>e.jsxs("div",{className:a("flex flex-col items-center justify-center py-16 rounded-lg border border-dashed",t.surface.default,t.border.default),children:[e.jsx(X,{className:a("h-12 w-12 mb-4",t.text.tertiary)}),e.jsx("h3",{className:a("text-lg font-semibold mb-2",t.text.primary),children:"No Stipulations Found"}),e.jsx("p",{className:a("text-sm mb-4 text-center max-w-md",t.text.secondary),children:"Discovery stipulations help manage joint agreements between parties. Create your first stipulation to get started."}),e.jsx(l,{variant:"primary",icon:D,onClick:N,children:"Create First Stipulation"})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:a("text-xl font-semibold",t.text.primary),children:"Discovery Stipulations"}),e.jsx("p",{className:t.text.secondary,children:"Manage joint discovery agreements and stipulations"})]}),e.jsx(l,{variant:"primary",icon:D,onClick:N,children:"New Stipulation"})]}),x.length===0?Q():e.jsxs(J,{children:[e.jsx(W,{children:e.jsxs(P,{children:[e.jsx(d,{children:"Title"}),e.jsx(d,{children:"Requesting Party"}),e.jsx(d,{children:"Proposed Date"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(Y,{children:x.map(s=>e.jsxs(P,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:a("h-4 w-4",t.text.secondary)}),e.jsx("span",{className:a("font-medium",t.text.primary),children:s.title})]})}),e.jsx(c,{className:t.text.secondary,children:s.requestingParty}),e.jsx(c,{className:t.text.secondary,children:s.proposedDate?new Date(s.proposedDate).toLocaleDateString():"Not set"}),e.jsx(c,{children:e.jsx(Z,{variant:_(s.status),children:s.status})}),e.jsx(c,{children:e.jsx("div",{className:"flex gap-2",children:s.status==="Pending"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{size:"sm",variant:"primary",icon:V,onClick:()=>w(s.id,"Approved"),disabled:S,children:"Approve"}),e.jsx(l,{size:"sm",variant:"danger",icon:G,onClick:()=>w(s.id,"Rejected"),disabled:S,children:"Reject"})]})})})]},s.id))})]}),e.jsx(te,{isOpen:k,onClose:C,title:"New Discovery Stipulation",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:a("block text-sm font-medium mb-1",t.text.primary),children:["Title ",e.jsx("span",{className:t.status.error.text,children:"*"})]}),e.jsx(y,{value:r.title||"",onChange:m("title"),placeholder:"Enter stipulation title",required:!0,autoFocus:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:a("block text-sm font-medium mb-1",t.text.primary),children:["Requesting Party ",e.jsx("span",{className:t.status.error.text,children:"*"})]}),e.jsx(y,{value:r.requestingParty||"",onChange:m("requestingParty"),placeholder:"Enter requesting party",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:a("block text-sm font-medium mb-1",t.text.primary),children:"Proposed Date"}),e.jsx(y,{type:"date",value:r.proposedDate||"",onChange:m("proposedDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:a("block text-sm font-medium mb-1",t.text.primary),children:"Reason"}),e.jsx(ee,{value:r.reason||"",onChange:m("reason"),placeholder:"Enter reason for stipulation",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(l,{variant:"secondary",onClick:C,disabled:h,children:"Cancel"}),e.jsx(l,{variant:"primary",onClick:B,disabled:!K||h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 animate-spin mr-2"}),"Creating..."]}):"Create Stipulation"})]})]})})]})};export{we as DiscoveryStipulations,we as default};
