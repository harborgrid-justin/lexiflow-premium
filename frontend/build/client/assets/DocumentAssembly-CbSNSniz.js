import{bh as B,F as D,a5 as q,aM as U,a$ as z,V as O,cd as W,aj as V,j as e,ab as y,b4 as H,aa as J,m as N,r as p,l as K,v as C,b0 as Q,ae as X,an as Y,ax as _,ce as Z,X as ee}from"./vendor-core-V-oW58GW.js";import{G as te}from"./geminiService-DjDdWyh4.js";import{a as se}from"./SyncContext-DYD5yPAv.js";import{D as ae}from"./dataService-75QCl8KS.js";import{u as re,c as s,d as ne,q as oe}from"./useQueryHooks-BdeOvP9e.js";import"./case-detail-CN_DMmR8.js";import{q as S}from"./queryKeys-BBVgMz36.js";import{u as b}from"./ThemeContext-OPG61qw5.js";import{u as le}from"./useNotify-Bhb3OIEg.js";import{getTodayString as v}from"./dateUtils-rLIRMrtk.js";import"./vendor-misc-Dwkhvdtg.js";import"./vendor-charts-KZIdMATq.js";import"./schemas-B2_dy3tf.js";import"./preload-helper-BXl3LOEh.js";import"./type-mappings-DEPYyX4d.js";import"./Button-PaGqeZoR.js";import"./Badge-B08w10nz.js";import"./VirtualList-B1zORm91.js";import"./AppShell-Z1zGEOCG.js";import"./tabs.config-F85gN5xx.js";import"./PageHeader-os9pD5mt.js";import"./formatters-stMuSkc6.js";import"./Table-C8OsWLsz.js";import"./EmptyState-BwtZeBY5.js";import"./Card-D56KNEnI.js";import"./MetricCard-CDV5joW_.js";import"./useSessionStorage-HC9RvMcM.js";import"./ErrorState-BA0dmAVI.js";import"./ConfirmDialog-CTAXMvML.js";import"./Modal-BlJFylOy.js";import"./Kanban-BbECSZhC.js";import"./FilterPanel-C0WYx6xs.js";import"./AdaptiveLoader-gvY3s3Bs.js";import"./UserAvatar-lVqVFNPb.js";import"./Tabs-BTz8yyZK.js";import"./Input-JNgj1Ekc.js";import"./TextArea-BMpffac7.js";import"./TaskCreationModal-B2VECu1_.js";import"./search.config-B6mvIgDA.js";import"./useToggle-CjLp2PQ4.js";import"./sanitize-k_Tw3ej1.js";import"./useModalState-Cst_3NmK.js";import"./scheduler-BERajRBE.js";import"./RouteErrorBoundary-Nha8Il06.js";import"./meta-utils-lVs9HXG9.js";const j=[{name:"Motion to Dismiss",description:"Standard motion to dismiss with legal grounds and supporting arguments",icon:B,category:"Motions"},{name:"Discovery Request",description:"Interrogatories, requests for production, or requests for admission",icon:D,category:"Discovery"},{name:"Demand Letter",description:"Formal demand letter outlining claims and settlement demands",icon:q,category:"Correspondence"},{name:"Contract Review Memo",description:"Analysis and recommendations for contract terms and conditions",icon:U,category:"Contracts"},{name:"Legal Brief",description:"Comprehensive legal brief with case law and statutory analysis",icon:z,category:"Litigation"},{name:"Settlement Agreement",description:"Mutual settlement and release agreement template",icon:O,category:"Settlement"},{name:"Corporate Resolution",description:"Board resolution or shareholder consent document",icon:W,category:"Corporate"},{name:"Witness Statement",description:"Structured witness affidavit or declaration template",icon:V,category:"Evidence"}],ie=({onSelectTemplate:n})=>{const{theme:a}=b(),{data:o,isLoading:l}=re(S.documents.templates(),async()=>{try{return j}catch(r){return console.warn("Failed to fetch templates from backend, using local templates:",r),j}},{staleTime:600*1e3}),t=o||j;return l?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(y,{className:s("w-8 h-8 animate-spin",a.text.secondary)}),e.jsx("span",{className:s("ml-3",a.text.secondary),children:"Loading templates..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:s("text-2xl font-bold mb-2",a.text.primary),children:"Select Document Template"}),e.jsx("p",{className:a.text.secondary,children:"Choose a template to start generating your legal document. Each template includes structure and legal language."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map(r=>{const i=r.icon;return e.jsx("button",{onClick:()=>n(r.name),className:s("p-4 rounded-lg border text-left transition-all hover:shadow-md",a.border.default,a.surface.raised,"hover:border-blue-500 dark:hover:border-blue-400"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:s("p-2 rounded-lg","bg-blue-100 dark:bg-blue-900/30"),children:e.jsx(i,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:s("font-semibold",a.text.primary),children:r.name}),e.jsx("span",{className:s("text-xs px-2 py-1 rounded-full","bg-slate-100 dark:bg-slate-800",a.text.tertiary),children:r.category})]}),e.jsx("p",{className:s("text-sm",a.text.secondary),children:r.description})]})]})},r.name)})}),e.jsx("div",{className:s("p-4 rounded-lg border","bg-blue-50 dark:bg-blue-950/20","border-blue-200 dark:border-blue-800"),children:e.jsxs("p",{className:s("text-sm",a.text.secondary),children:[e.jsx("strong",{className:a.text.primary,children:"Tip:"})," After selecting a template, you'll configure specific details and our AI will generate a customized draft based on your case information."]})})]})},ce=({template:n,formData:a,onFormDataChange:o,onGenerate:l})=>{const{theme:t}=b(),r=c=>x=>{o({...a,[c]:x.target.value})},i=a.recipient&&a.mainPoint;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:s("text-2xl font-bold mb-2",t.text.primary),children:["Configure: ",n]}),e.jsx("p",{className:t.text.secondary,children:"Provide the details needed to generate your customized document."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:s("block text-sm font-medium mb-2",t.text.primary),children:[e.jsx(H,{className:"inline-block w-4 h-4 mr-1"}),"Recipient / Opposing Party",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"text",value:a.recipient,onChange:r("recipient"),placeholder:"e.g., John Smith, ABC Corporation, Court of Appeals",className:s("w-full px-4 py-2 rounded-lg border",t.border.default,t.surface.input,t.text.primary,"focus:ring-2 focus:ring-blue-500 focus:border-transparent","placeholder:text-slate-400 dark:placeholder:text-slate-500")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:s("block text-sm font-medium mb-2",t.text.primary),children:[e.jsx(J,{className:"inline-block w-4 h-4 mr-1"}),"Document Date"]}),e.jsx("input",{type:"date",value:a.date||v(),onChange:r("date"),placeholder:"Select date",className:s("w-full px-4 py-2 rounded-lg border",t.border.default,t.surface.input,t.text.primary,"focus:ring-2 focus:ring-blue-500 focus:border-transparent")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:s("block text-sm font-medium mb-2",t.text.primary),children:[e.jsx(D,{className:"inline-block w-4 h-4 mr-1"}),"Main Point / Purpose",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("textarea",{value:a.mainPoint,onChange:r("mainPoint"),placeholder:"Describe the key arguments, facts, or objectives for this document...",rows:6,className:s("w-full px-4 py-2 rounded-lg border",t.border.default,t.surface.input,t.text.primary,"focus:ring-2 focus:ring-blue-500 focus:border-transparent","placeholder:text-slate-400 dark:placeholder:text-slate-500","resize-none")}),e.jsx("p",{className:s("text-xs mt-1",t.text.tertiary),children:"Be specific about legal issues, facts, and desired outcomes. More detail = better results."})]})]}),e.jsxs("div",{className:s("p-4 rounded-lg border","bg-purple-50 dark:bg-purple-950/20","border-purple-200 dark:border-purple-800"),children:[e.jsxs("h4",{className:s("font-semibold mb-2 flex items-center",t.text.primary),children:[e.jsx(N,{className:"w-4 h-4 mr-2 text-purple-600 dark:text-purple-400"}),"AI Enhancement Tips"]}),e.jsxs("ul",{className:s("text-sm space-y-1",t.text.secondary),children:[e.jsx("li",{children:"• Include relevant case law citations if known"}),e.jsx("li",{children:"• Mention specific statutes or regulations"}),e.jsx("li",{children:"• Provide key facts and timeline information"}),e.jsx("li",{children:"• State your legal position clearly"})]})]}),e.jsx("div",{className:"flex gap-3 pt-4 border-t",style:{borderColor:t.border.default},children:e.jsxs("button",{onClick:l,disabled:!i,className:s("flex-1 px-6 py-3 rounded-lg font-semibold transition-all","flex items-center justify-center gap-2",i?"bg-blue-600 hover:bg-blue-700 text-white shadow-md hover:shadow-lg":"bg-slate-300 dark:bg-slate-700 text-slate-500 dark:text-slate-400 cursor-not-allowed"),children:[e.jsx(N,{className:"w-5 h-5"}),"Generate Draft with AI"]})})]})},de=({result:n,isStreaming:a,isSaving:o,onSave:l})=>{const{theme:t}=b(),r=p.useRef(null),[i,c]=K.useState(!1);p.useEffect(()=>{r.current&&a&&(r.current.scrollTop=r.current.scrollHeight)},[n,a]);const x=async()=>{n&&(await navigator.clipboard.writeText(n),c(!0),setTimeout(()=>c(!1),2e3))},h=()=>{const f=new Blob([n],{type:"text/plain"}),u=URL.createObjectURL(f),m=document.createElement("a");m.href=u,m.download=`draft-${Date.now()}.txt`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(u)};return e.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[e.jsxs("div",{children:[e.jsx("h2",{className:s("text-2xl font-bold mb-2",t.text.primary),children:a?"Generating Draft...":"Review Generated Draft"}),e.jsx("p",{className:t.text.secondary,children:a?"AI is composing your document in real-time. This may take a moment.":"Review and edit the generated draft. You can save it to your case files when ready."})]}),a&&e.jsxs("div",{className:s("p-3 rounded-lg border flex items-center gap-3","bg-blue-50 dark:bg-blue-950/20","border-blue-200 dark:border-blue-800"),children:[e.jsx(y,{className:"w-5 h-5 animate-spin text-blue-600 dark:text-blue-400"}),e.jsxs("span",{className:s("text-sm font-medium",t.text.primary),children:["AI is writing... ",n.length," characters generated"]})]}),e.jsx("div",{className:"flex-1 min-h-[400px]",children:e.jsx("textarea",{ref:r,value:n,readOnly:a,onChange:f=>{r.current&&(r.current.value=f.target.value)},placeholder:a?"Generating content...":"Draft content will appear here",className:s("w-full h-full px-4 py-3 rounded-lg border font-mono text-sm",t.border.default,t.surface.input,t.text.primary,"focus:ring-2 focus:ring-blue-500 focus:border-transparent","placeholder:text-slate-400 dark:placeholder:text-slate-500",a&&"animate-pulse")})}),!a&&n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:s("p-3 rounded-lg border","bg-green-50 dark:bg-green-950/20","border-green-200 dark:border-green-800"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsxs("span",{className:s("text-sm font-medium",t.text.primary),children:["Draft complete! ",n.length," characters generated."]})]})}),e.jsxs("div",{className:s("flex gap-3 pt-4 border-t",t.border.default),children:[e.jsx("button",{onClick:x,className:s("px-4 py-2 rounded-lg border transition-colors",t.border.default,t.surface.raised,"hover:bg-slate-100 dark:hover:bg-slate-800","flex items-center gap-2"),children:i?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:t.text.primary,children:"Copied!"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{className:t.text.primary,children:"Copy"})]})}),e.jsxs("button",{onClick:h,className:s("px-4 py-2 rounded-lg border transition-colors",t.border.default,t.surface.raised,"hover:bg-slate-100 dark:hover:bg-slate-800","flex items-center gap-2"),children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:t.text.primary,children:"Download"})]}),e.jsx("button",{onClick:l,disabled:o,className:s("flex-1 px-6 py-2 rounded-lg font-semibold transition-all","flex items-center justify-center gap-2",o?"bg-slate-400 dark:bg-slate-600 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white shadow-md hover:shadow-lg"),children:o?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-5 h-5 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-5 h-5"}),"Save to Case Files"]})})]})]}),!a&&!n&&e.jsx("div",{className:s("flex-1 flex items-center justify-center","border-2 border-dashed rounded-lg",t.border.default),children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:s("w-12 h-12 mx-auto mb-4",t.text.tertiary)}),e.jsx("p",{className:s("text-lg font-medium",t.text.secondary),children:"Waiting for content generation..."})]})})]})};function st({onClose:n,caseTitle:a,onSave:o,windowId:l}){const{theme:t}=b(),[r,i]=p.useState(1),[c,x]=p.useState(""),[h,f]=p.useState({recipient:"",date:"",mainPoint:""}),[u,m]=p.useState(""),[T,w]=p.useState(!1),{minimizeWindow:F}=se(),k=le(),M=async()=>{i(3),w(!0),m("");const d=`Template: ${c}. Case: ${a}. Recipient: ${h.recipient}. Point: ${h.mainPoint}.`,g=te.streamDraft(d,"Document");for await(const G of g)m(I=>I+G);w(!1)},{mutate:R,isLoading:A}=ne(ae.documents.add,{onSuccess:d=>{const g=d;k.success(`Draft saved to case file: ${g.title}`),o&&o(g),oe.invalidate(S.documents.all()),n()},onError:()=>k.error("Failed to save document.")}),L=()=>{if(u){const d={id:`gen-${Date.now()}`,caseId:"current",title:`${c} - ${new Date().toLocaleDateString()}`,type:"Generated",content:u,uploadDate:v(),lastModified:v(),tags:["AI Generated",c],versions:[],sourceModule:"Drafting"};R(d)}},P=()=>{l&&F(l)},$=d=>{x(d),i(2)},E=d=>{f(d)};return e.jsxs("div",{className:s("flex flex-col h-full",t.surface.default,t.text.primary),children:[e.jsxs("div",{className:s("p-4 border-b flex justify-between items-center drag-handle cursor-move",t.border.default,t.surface.highlight),children:[e.jsxs("h3",{className:s("text-lg font-bold flex items-center",t.text.primary),children:[e.jsx(_,{className:"mr-2 h-5 w-5 text-purple-600 dark:text-purple-400"})," Document Ghostwriter"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l&&e.jsx("button",{title:"Minimize window",onClick:P,className:s("p-1 rounded transition-colors",t.text.tertiary,`hover:${t.surface.default}`),children:e.jsx(Z,{className:"h-5 w-5"})}),e.jsx("button",{title:"Close window",onClick:n,className:s("p-1 rounded transition-colors",t.text.tertiary,`hover:${t.surface.default}`),children:e.jsx(ee,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"p-6 flex-1 overflow-y-auto",children:[r===1&&e.jsx(ie,{onSelectTemplate:$}),r===2&&e.jsx(ce,{template:c,formData:h,onFormDataChange:E,onGenerate:M}),r===3&&e.jsx(de,{result:u,isStreaming:T,isSaving:A,onSave:L})]})]})}export{st as DocumentAssembly};
