import{r as o,j as e,ba as ue,q as me,cf as xe,cg as fe,F as he,az as pe,bD as ge,aU as be,ch as ye,ab as je,bx as ve,bl as Ne,x as De,ci as we,ax as Se,c1 as ke,a_ as Ce,aw as Me,cj as Te,b3 as $e,c9 as Fe,b1 as Ie,X as te,T as Ae,ay as ze,bR as Pe,bS as Re,al as Ve}from"./vendor-core-V-oW58GW.js";import{D as W}from"./dataService-75QCl8KS.js";import{u as Ee,D as Be,a as Le,b as Ue,F as He,V as Oe,c as Ge}from"./case-detail-CN_DMmR8.js";import{q as H}from"./queryKeys-BBVgMz36.js";import{c as s,u as se,d as re,q as Y}from"./useQueryHooks-BdeOvP9e.js";import{u as ae}from"./useNotify-Bhb3OIEg.js";import{u as A}from"./ThemeContext-OPG61qw5.js";import{a as qe}from"./SyncContext-DYD5yPAv.js";import{V as We}from"./VirtualList-B1zORm91.js";import{B as Ke}from"./Button-PaGqeZoR.js";import{M as Qe}from"./Modal-BlJFylOy.js";import{B as _e}from"./Badge-B08w10nz.js";import"./vendor-misc-Dwkhvdtg.js";import"./vendor-charts-KZIdMATq.js";import"./preload-helper-BXl3LOEh.js";import"./type-mappings-DEPYyX4d.js";import"./schemas-B2_dy3tf.js";import"./AppShell-Z1zGEOCG.js";import"./tabs.config-F85gN5xx.js";import"./PageHeader-os9pD5mt.js";import"./formatters-stMuSkc6.js";import"./Table-C8OsWLsz.js";import"./EmptyState-BwtZeBY5.js";import"./dateUtils-rLIRMrtk.js";import"./Card-D56KNEnI.js";import"./MetricCard-CDV5joW_.js";import"./useSessionStorage-HC9RvMcM.js";import"./ErrorState-BA0dmAVI.js";import"./ConfirmDialog-CTAXMvML.js";import"./Kanban-BbECSZhC.js";import"./FilterPanel-C0WYx6xs.js";import"./AdaptiveLoader-gvY3s3Bs.js";import"./UserAvatar-lVqVFNPb.js";import"./Tabs-BTz8yyZK.js";import"./Input-JNgj1Ekc.js";import"./TextArea-BMpffac7.js";import"./geminiService-DjDdWyh4.js";import"./TaskCreationModal-B2VECu1_.js";import"./search.config-B6mvIgDA.js";import"./useToggle-CjLp2PQ4.js";import"./sanitize-k_Tw3ej1.js";import"./useModalState-Cst_3NmK.js";import"./scheduler-BERajRBE.js";import"./RouteErrorBoundary-Nha8Il06.js";import"./meta-utils-lVs9HXG9.js";function Xe(l,i="id"){const[r,m]=o.useState([]),[x,a]=o.useState(null),p=o.useCallback((y,g)=>{const $=r.includes(y);if(g&&"shiftKey"in g&&g.shiftKey&&x){const N=l.findIndex(j=>String(j[i])===x),D=l.findIndex(j=>String(j[i])===y);if(N!==-1&&D!==-1){const j=Math.min(N,D),T=Math.max(N,D),w=l.slice(j,T+1).map(C=>String(C[i]));m(C=>Array.from(new Set([...C,...w])));return}}a(y),m(N=>$?N.filter(D=>D!==y):[...N,y])},[l,i,x,r]),u=o.useCallback(()=>{const y=l.map(g=>String(g[i]));m(g=>g.length===y.length?[]:y)},[l,i]),f=o.useCallback(()=>{m([]),a(null)},[]),d=o.useCallback(y=>r.includes(y),[r]),n=l.length>0&&r.length===l.length,k=r.length>0&&r.length<l.length;return{selectedIds:r,setSelectedIds:m,toggleSelection:p,selectAll:u,clearSelection:f,isSelected:d,isAllSelected:n,isIndeterminate:k}}function Je({onDrop:l,onDragLeave:i}){const{theme:r}=A();return e.jsxs("div",{className:s("absolute inset-0 z-50 flex flex-col items-center justify-center backdrop-blur-md transition-all duration-200 animate-in fade-in zoom-in-95","bg-blue-500/10 border-4 border-blue-500 border-dashed m-4 rounded-xl cursor-copy"),onDrop:l,onDragLeave:i,onDragOver:m=>{m.preventDefault(),m.stopPropagation()},children:[e.jsx("div",{className:"bg-white dark:bg-slate-900 p-8 rounded-full shadow-2xl mb-4 animate-bounce pointer-events-none",children:e.jsx(ue,{className:"h-16 w-16 text-blue-600"})}),e.jsx("h3",{className:s("text-3xl font-bold drop-shadow-sm pointer-events-none",r.text.primary),children:"Drop files to upload"}),e.jsx("p",{className:s("mt-2 text-lg font-medium pointer-events-none",r.text.secondary),children:"Secure Ingestion Pipeline Ready"})]})}function Ye(l={}){const{enableDragDrop:i=!1}=l,r=ae();o.useEffect(()=>{console.log(`[useDocumentManager] Initialized with ${i?"drag-drop enabled":"drag-drop disabled"}`)},[i]);const[m,x]=o.useState(""),[a,p]=o.useState("All"),[u,f]=o.useState([]),[d,n]=o.useState(null),[k,y]=o.useState(!1),[g,$]=o.useState("root"),[N,D]=o.useState(!0),[j,T]=o.useState(null),[w,C]=o.useState(!1),[z,I]=o.useState(!1),R=o.useRef(0),M=o.useCallback((t,c)=>!t||t.trim()===""?(console.error(`[useDocumentManager.${c}] Invalid docId parameter:`,t),!1):!0,[]),O=o.useCallback(t=>t?t.replace(/<[^>]*>/g,"").trim().slice(0,50):"",[]),E=o.useCallback(t=>{if(!t||!t.name)return console.error("[useDocumentManager] Invalid file:",t),!1;const c=50*1024*1024;return t.size>c?(r.error(`File ${t.name} exceeds 50MB limit`),!1):!0},[r]),{data:V=[],isLoading:B}=se(H.documents.all(),async()=>{try{return await W.documents.getAll()}catch(t){throw console.error("[useDocumentManager] Error fetching documents:",t),t}}),b=o.useMemo(()=>Array.isArray(V)?V:[],[V]),K=o.useMemo(()=>{try{return b.filter(t=>{const c=g==="root"?!0:t.folderId===g;return(a==="All"||t.sourceModule===a)&&(m?!0:c)})}catch(t){return console.error("[useDocumentManager] Context filtering error:",t),b}},[b,g,a,m]),{filteredItems:G,isSearching:L}=Ee({items:K,query:m,fields:["title","content","tags","type"]}),{mutate:q}=re(async t=>{try{return await W.documents.update(t.id,t.updates)}catch(c){throw console.error("[useDocumentManager] Update mutation error:",c),c}},{invalidateKeys:[H.documents.all()]}),F=o.useCallback((t,c)=>{if(M(t,"updateDocument")){if(!c||typeof c!="object"){console.error("[useDocumentManager.updateDocument] Invalid updates:",c);return}try{j&&j.id===t&&T(h=>h?{...h,...c}:null),q({id:t,updates:c}),console.log(`[useDocumentManager] Document updated: ${t}`)}catch(h){console.error("[useDocumentManager.updateDocument] Error:",h),r.error("Failed to update document")}}},[j,q,M,r]),Q=o.useCallback(t=>{try{Y.setQueryData(H.documents.all(),c=>typeof t=="function"?t(c||[]):t)}catch(c){console.error("[useDocumentManager.setDocuments] Error:",c)}},[]),U=o.useCallback(async t=>{if(!d){console.error("[useDocumentManager.handleRestore] No document selected for history");return}if(!t||!t.contentSnapshot){console.error("[useDocumentManager.handleRestore] Invalid version:",t),r.error("Invalid version data");return}try{const c={content:t.contentSnapshot,lastModified:new Date().toISOString().split("T")[0]};F(d.id,c),n(null),r.success("Document restored successfully"),console.log(`[useDocumentManager] Version restored for: ${d.id}`)}catch(c){console.error("[useDocumentManager.handleRestore] Error:",c),r.error("Failed to restore version")}},[d,F,r]),P=o.useCallback(async()=>{if(u.length===0){r.info("No documents selected for summarization");return}try{y(!0),console.log(`[useDocumentManager] Starting bulk summarization for ${u.length} documents`),await new Promise(t=>setTimeout(t,1500)),r.success(`AI Summary generated for ${u.length} documents. Report saved to case file.`),f([]),console.log("[useDocumentManager] Bulk summarization completed")}catch(t){console.error("[useDocumentManager.handleBulkSummarize] Error:",t),r.error("Failed to generate summaries")}finally{y(!1)}},[u,r]),Z=o.useCallback(t=>{if(M(t,"toggleSelection"))try{if(u.includes(t))f(u.filter(c=>c!==t)),j?.id===t&&T(null),console.log(`[useDocumentManager] Document deselected: ${t}`);else{f([...u,t]);const c=b.find(h=>h.id===t);c&&(T(c),console.log(`[useDocumentManager] Document selected: ${t}`))}}catch(c){console.error("[useDocumentManager.toggleSelection] Error:",c)}},[u,j,b,M]),_=o.useCallback(async(t,c)=>{if(!M(t,"addTag"))return;const h=O(c);if(!h){console.error("[useDocumentManager.addTag] Invalid tag after sanitization:",c);return}try{const v=b.find(J=>J.id===t);if(!v){console.error("[useDocumentManager.addTag] Document not found:",t);return}if(v.tags.includes(h)){r.info(`Tag "${h}" already exists`);return}const S=[...v.tags,h];F(t,{tags:S}),console.log(`[useDocumentManager] Tag added to ${t}: ${h}`)}catch(v){console.error("[useDocumentManager.addTag] Error:",v),r.error("Failed to add tag")}},[b,M,O,F,r]),X=o.useCallback(async(t,c)=>{if(M(t,"removeTag"))try{const h=b.find(S=>S.id===t);if(!h){console.error("[useDocumentManager.removeTag] Document not found:",t);return}const v=h.tags.filter(S=>S!==c);F(t,{tags:v}),console.log(`[useDocumentManager] Tag removed from ${t}: ${c}`)}catch(h){console.error("[useDocumentManager.removeTag] Error:",h),r.error("Failed to remove tag")}},[b,M,F,r]),oe=o.useMemo(()=>{try{return Array.from(new Set(b.flatMap(t=>t.tags||[])))}catch(t){return console.error("[useDocumentManager] Error computing allTags:",t),[]}},[b]),ne=o.useMemo(()=>{try{return{total:b.length,evidence:b.filter(t=>t.sourceModule==="Evidence").length,discovery:b.filter(t=>t.sourceModule==="Discovery").length,signed:b.filter(t=>t.status==="Signed").length}}catch(t){return console.error("[useDocumentManager] Error computing stats:",t),{total:0,evidence:0,discovery:0,signed:0}}},[b]),le=o.useCallback(t=>{i&&(t.preventDefault(),t.stopPropagation(),R.current++,t.dataTransfer.items&&t.dataTransfer.items.length>0&&C(!0))},[i]),ie=o.useCallback(t=>{i&&(t.preventDefault(),t.stopPropagation(),R.current--,R.current===0&&C(!1))},[i]),ce=o.useCallback(t=>{i&&(t.preventDefault(),t.stopPropagation())},[i]),de=o.useCallback(async t=>{if(!i||(t.preventDefault(),t.stopPropagation(),C(!1),R.current=0,!t.dataTransfer.files||t.dataTransfer.files.length===0))return;I(!0);const c=Array.from(t.dataTransfer.files);let h=0,v=0;try{console.log(`[useDocumentManager] Processing ${c.length} dropped files`);for(const S of c){if(!E(S)){v++;continue}try{await Be.uploadDocument(S,{sourceModule:g==="root"?"General":g,caseId:"General"}),h++}catch(J){console.error(`[useDocumentManager] Failed to upload ${S.name}:`,J),v++}}Y.invalidate(H.documents.all()),h>0&&r.success(`Uploaded ${h} document${h>1?"s":""}`),v>0&&r.error(`Failed to upload ${v} document${v>1?"s":""}`),console.log(`[useDocumentManager] Upload completed: ${h} success, ${v} failed`)}catch(S){console.error("[useDocumentManager.handleDrop] Unexpected error:",S),r.error("Failed to process dropped files")}finally{I(!1)}},[i,g,E,r]),ee={searchTerm:m,setSearchTerm:x,activeModuleFilter:a,setActiveModuleFilter:p,selectedDocs:u,setSelectedDocs:f,toggleSelection:Z,clearSelection:o.useCallback(()=>f([]),[]),selectedDocForHistory:d,setSelectedDocForHistory:n,showVersionHistory:o.useCallback(t=>n(t),[]),closeVersionHistory:o.useCallback(()=>n(null),[]),isProcessingAI:k,bulkSummarize:P,currentFolder:g,navigateToFolder:o.useCallback(t=>$(t),[]),isDetailsOpen:N,toggleDetails:o.useCallback(()=>D(t=>!t),[]),stats:ne,addTag:_,removeTag:X,isSearching:L,restoreVersion:o.useCallback(async(t,c)=>{const v=b.find(S=>S.id===t)?.versions?.find(S=>S.id===c);v&&await U(v)},[b,U]),documents:b,setDocuments:Q,isLoading:B||L,handleRestore:U,handleBulkSummarize:P,allTags:oe,filtered:G,setCurrentFolder:$,setIsDetailsOpen:D,previewDoc:j,setPreviewDoc:T,updateDocument:F};return i?{...ee,isDragging:w,isUploading:z,handleDragEnter:le,handleDragLeave:ie,handleDragOver:ce,handleDrop:de}:ee}function Ze({currentFolder:l,setCurrentFolder:i}){const{theme:r}=A(),{data:m=[],isLoading:x}=se(["documents","folders"],()=>W.documents.getFolders()),a=[{id:"recent",label:"Recent Files",icon:me},{id:"favorites",label:"Favorites",icon:xe},{id:"missing_meta",label:"Missing Metadata",icon:fe,count:3,color:"text-amber-600"}],p=[{label:"File Type",items:[{id:"pdf",label:"PDF Documents",icon:he,count:124},{id:"img",label:"Images",icon:pe,count:45},{id:"media",label:"Audio/Video",icon:ge,count:12}]},{label:"Status",items:[{id:"final",label:"Finalized",icon:be,count:89},{id:"draft",label:"Drafts",icon:ye,count:32}]}];return e.jsxs("div",{className:"w-full flex flex-col h-full shrink-0",children:[e.jsxs("div",{className:s("p-4 border-b",r.border.default),children:[e.jsx("h3",{className:s("font-bold text-xs uppercase tracking-wide mb-3 px-2",r.text.tertiary),children:"Smart Views"}),e.jsx("div",{className:"space-y-0.5",children:a.map(u=>e.jsxs("button",{className:s("w-full flex items-center justify-between px-3 py-2 text-sm font-medium rounded-md transition-colors group",r.text.secondary,`hover:${r.surface.default}`,`hover:${r.primary.text}`),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(u.icon,{className:s("h-4 w-4 mr-3 opacity-70 group-hover:opacity-100",u.color||"")}),u.label]}),u.count&&e.jsx("span",{className:s("text-[10px] px-1.5 py-0.5 rounded-full font-bold",r.surface.default,r.text.secondary),children:u.count})]},u.id))})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:[e.jsx("h3",{className:s("font-bold text-xs uppercase tracking-wide mb-3 px-2",r.text.tertiary),children:"Library Folders"}),e.jsx("div",{className:"space-y-0.5 mb-6",children:x?e.jsx("div",{className:"p-4 flex justify-center",children:e.jsx(je,{className:"animate-spin h-4 w-4 text-slate-400"})}):(Array.isArray(m)?m:[]).map(u=>{const f=l===u.id,d=f?ve:Ne;return e.jsxs("button",{onClick:()=>i(u.id),className:s("w-full flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors",f?s(r.primary.light,r.primary.text,"font-semibold"):s(r.text.secondary,`hover:${r.surface.default}`,`hover:${r.primary.text}`)),children:[e.jsx(d,{className:s("h-4 w-4 mr-3",f?"fill-current opacity-20":"opacity-50")}),u.label]},u.id)})}),p.map((u,f)=>e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:s("font-bold text-xs uppercase tracking-wide mb-2 px-2",r.text.tertiary),children:u.label}),e.jsx("div",{className:"space-y-0.5",children:u.items.map(d=>e.jsxs("div",{className:s("flex items-center justify-between px-3 py-1.5 rounded cursor-pointer group",`hover:${r.surface.default}`),children:[e.jsxs("div",{className:s("flex items-center text-sm",r.text.secondary),children:[e.jsx("input",{type:"checkbox",className:s("mr-3 rounded",r.border.default,r.primary.text)}),d.label]}),e.jsx("span",{className:s("text-xs opacity-60 group-hover:opacity-100",r.text.tertiary),children:d.count})]},d.id))})]},f))]}),e.jsxs("div",{className:s("p-4 border-t",r.surface.highlight,r.border.default),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(De,{className:s("h-4 w-4",r.primary.text)}),e.jsx("span",{className:s("text-xs font-bold",r.text.secondary),children:"Storage Quota"})]}),e.jsx("div",{className:s("w-full rounded-full h-1.5 mb-1 overflow-hidden",r.border.default,"bg-slate-200 dark:bg-slate-700"),children:e.jsx("div",{className:s("h-1.5 rounded-full",r.primary.DEFAULT),style:{width:"65%"}})}),e.jsxs("div",{className:s("flex justify-between text-[10px] font-medium",r.text.tertiary),children:[e.jsx("span",{children:"65 GB Used"}),e.jsx("span",{children:"100 GB Total"})]})]})]})}function et({selectedDocsCount:l,searchTerm:i,setSearchTerm:r,viewMode:m,setViewMode:x,isDetailsOpen:a,setIsDetailsOpen:p,isProcessingAI:u,onBulkSummarize:f,onClearSelection:d}){const{theme:n}=A(),{openWindow:k}=qe(),y=()=>{const g=`compare-${Date.now()}`;k(g,"Document Comparison",e.jsx("div",{className:"p-6 h-full bg-white",children:e.jsx(Le,{oldText:"Please select two documents to compare.",newText:"Comparison engine requires source selection."})}))};return e.jsxs("div",{className:s("h-14 px-4 border-b flex justify-between items-center shrink-0",n.surface.default,n.border.default),children:[e.jsx("div",{className:"flex items-center gap-2 flex-1",children:l>0?e.jsxs("div",{className:s("flex items-center px-3 py-1.5 rounded-md border animate-fade-in w-full",n.primary.light,n.primary.border),children:[e.jsxs("span",{className:s("text-sm font-bold mr-4",n.primary.text),children:[l," Selected"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:s("p-1 rounded",n.primary.text,`hover:${n.surface.default}`),title:"Compare",onClick:y,children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx("button",{className:s("p-1 rounded",n.primary.text,`hover:${n.surface.default}`),title:"Summarize",onClick:f,children:u?e.jsx("span",{className:"animate-spin",children:"..."}):e.jsx(Se,{className:"h-4 w-4"})}),e.jsx("button",{className:s("p-1 rounded",n.primary.text,`hover:${n.surface.default}`),title:"Tag",children:e.jsx(ke,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{onClick:d,className:s("text-xs hover:underline",n.primary.text),children:"Clear"})]}):e.jsxs("div",{className:"relative w-full max-w-md group",children:[e.jsx(Ce,{className:s("absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 transition-colors group-focus-within:text-blue-500",n.text.tertiary)}),e.jsx("input",{value:i,onChange:g=>r(g.target.value),placeholder:"Search by name, tag, or content...",className:s("w-full pl-10 pr-4 py-2 border rounded-md text-sm outline-none transition-all",n.surface.highlight,n.border.default,n.text.primary,"focus:ring-2 focus:ring-blue-500 focus:bg-white")})]})}),e.jsxs("div",{className:s("flex gap-2 items-center ml-4 border-l pl-4",n.border.default),children:[e.jsxs("div",{className:s("flex p-0.5 rounded-lg border",n.surface.highlight,n.border.default),children:[e.jsx("button",{onClick:()=>x("list"),className:s("p-1.5 rounded-md transition-all",m==="list"?s(n.surface.default,"shadow",n.primary.text):s(n.text.secondary,`hover:${n.text.primary}`)),children:e.jsx(Me,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>x("grid"),className:s("p-1.5 rounded-md transition-all",m==="grid"?s(n.surface.default,"shadow",n.primary.text):s(n.text.secondary,`hover:${n.text.primary}`)),children:e.jsx(Te,{className:"h-4 w-4"})})]}),e.jsx("button",{className:s("p-2 rounded transition-colors",n.text.secondary,`hover:${n.text.primary}`,`hover:${n.surface.highlight}`),children:e.jsx($e,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>p(!a),className:s("p-2 rounded transition-colors",a?s(n.primary.text,n.primary.light):s(n.text.secondary,`hover:${n.text.primary}`,`hover:${n.surface.highlight}`)),title:"Toggle Inspector",children:e.jsx(Fe,{className:"h-4 w-4"})})]})]})}function tt({document:l,userRole:i,onRestore:r,onClose:m}){const x=i==="Senior Partner"||i==="Administrator",{theme:a}=A();return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm",children:e.jsxs("div",{className:s("rounded-lg shadow-xl w-full max-w-2xl overflow-hidden",a.surface.default),children:[e.jsxs("div",{className:s("p-4 border-b flex justify-between items-center",a.border.default,a.surface.highlight),children:[e.jsxs("div",{children:[e.jsxs("h3",{className:s("text-lg font-bold flex items-center",a.text.primary),children:[e.jsx(Ie,{className:s("mr-2 h-5 w-5",a.primary.text)}),"Version History"]}),e.jsx("p",{className:s("text-sm",a.text.secondary),children:l.title})]}),e.jsx("button",{onClick:m,className:s("p-1 rounded-full transition-colors",a.text.tertiary,`hover:${a.surface.highlight}`,`hover:${a.text.primary}`),children:e.jsx(te,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto p-4 space-y-4",children:[!x&&e.jsxs("div",{className:s("p-3 rounded-md flex items-center text-sm",a.status.warning.bg,a.status.warning.text),children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Only Partners and Admins can restore versions."]}),e.jsxs("div",{className:s("border rounded-lg p-4 relative",a.status.success.border,a.status.success.bg),children:[e.jsx("span",{className:s("absolute top-3 right-3 text-xs font-bold px-2 py-0.5 rounded",a.status.success.text,"bg-white/50"),children:"CURRENT"}),e.jsx("h4",{className:s("text-sm font-bold",a.text.primary),children:"Current Version"}),e.jsxs("p",{className:s("text-xs mt-1",a.text.secondary),children:["Last modified: ",l.lastModified]})]}),l.versions.length===0&&e.jsx("p",{className:s("text-center py-8 italic",a.text.tertiary),children:"No previous versions available."}),l.versions.map(p=>e.jsxs("div",{className:s("border rounded-lg p-4 transition-colors flex justify-between items-center",a.border.default,`hover:${a.surface.highlight}`),children:[e.jsxs("div",{children:[e.jsxs("h4",{className:s("text-sm font-bold",a.text.primary),children:["Version ",p.versionNumber]}),e.jsxs("div",{className:s("flex items-center space-x-2 text-xs mt-1",a.text.secondary),children:[e.jsx("span",{children:p.uploadDate}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["by ",p.uploadedBy]})]})]}),x&&e.jsxs("button",{onClick:()=>r(p),className:s("flex items-center px-3 py-1.5 text-xs font-medium rounded-md transition-colors",a.primary.light,a.primary.text,`hover:${a.surface.default}`),children:[e.jsx(ze,{className:"h-3 w-3 mr-1.5"}),"Restore"]})]},p.id))]})]})})}const st=({documents:l,toggleSelection:i,selectAll:r,isAllSelected:m,isSelected:x,setSelectedDocForHistory:a,setTaggingDoc:p,onRowClick:u})=>{const{theme:f}=A(),[d,n]=o.useState("lastModified"),[k,y]=o.useState("desc"),[g,$]=o.useTransition(),N=o.useCallback(w=>{$(()=>{y(C=>d===w&&C==="asc"?"desc":"asc"),d!==w&&n(w)})},[d]),D=({field:w})=>d!==w?null:k==="asc"?e.jsx(Pe,{className:"h-3 w-3 ml-1"}):e.jsx(Re,{className:"h-3 w-3 ml-1"}),j=o.useMemo(()=>[...l].sort((w,C)=>{const z=w[d],I=C[d];return z===void 0||I===void 0?0:z<I?k==="asc"?-1:1:z>I?k==="asc"?1:-1:0}),[l,d,k]),T=w=>e.jsx(Ue,{doc:w,isSelected:x(w.id),toggleSelection:i,setSelectedDocForHistory:a,setTaggingDoc:p,onRowClick:u,theme:f});return e.jsxs("div",{className:s("flex-1 overflow-hidden flex flex-col",f.surface.default,g?"opacity-70 transition-opacity":""),children:[e.jsxs("div",{className:s("flex items-center px-4 py-3 border-b font-bold text-xs uppercase tracking-wider shrink-0",f.surface.highlight,f.border.default,f.text.secondary),children:[e.jsx("div",{className:"w-10 flex-shrink-0 flex justify-center",children:e.jsx("input",{type:"checkbox",onChange:r,checked:m,className:"rounded text-blue-600 focus:ring-blue-500 cursor-pointer"})}),e.jsxs("div",{className:"flex-1 cursor-pointer flex items-center",onClick:()=>N("title"),children:["Document Name ",e.jsx(D,{field:"title"})]}),e.jsxs("div",{className:"w-28 flex-shrink-0 cursor-pointer flex items-center",onClick:()=>N("sourceModule"),children:["Source ",e.jsx(D,{field:"sourceModule"})]}),e.jsxs("div",{className:"w-28 flex-shrink-0 cursor-pointer flex items-center",onClick:()=>N("status"),children:["Status ",e.jsx(D,{field:"status"})]}),e.jsx("div",{className:"w-48 flex-shrink-0",children:"Tags & Rules"}),e.jsxs("div",{className:"w-32 flex-shrink-0 cursor-pointer flex items-center",onClick:()=>N("lastModified"),children:["Modified ",e.jsx(D,{field:"lastModified"})]}),e.jsx("div",{className:"w-24 flex-shrink-0 text-right"})]}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(We,{items:j,height:"100%",itemHeight:73,renderItem:T,emptyMessage:"No documents found."})})]})};function rt({document:l,onClose:i,onAddTag:r,onRemoveTag:m,allTags:x}){const{theme:a}=A(),[p,u]=o.useState(""),f=()=>{p&&(r(l.id,p),u(""))};return e.jsx(Qe,{isOpen:!0,onClose:i,title:"Manage Document Tags",size:"sm",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:s("block text-xs font-semibold uppercase mb-2",a.text.secondary),children:"Current Tags"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[l.tags.length===0&&e.jsx("span",{className:s("text-sm italic",a.text.tertiary),children:"No tags assigned."}),l.tags.map(d=>e.jsxs("span",{className:s("inline-flex items-center px-2 py-1 rounded text-sm border",a.primary.light,a.primary.text,a.primary.border),children:[d,e.jsx("button",{onClick:()=>m(l.id,d),className:s("ml-2 hover:opacity-75",a.primary.text),children:e.jsx(te,{className:"h-3 w-3"})})]},d))]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:s("block text-xs font-semibold uppercase mb-2",a.text.secondary),children:"Add New Tag"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:s("flex-1 px-3 py-2 border rounded-md text-sm outline-none transition-all",a.border.default,a.surface.default,"focus:ring-2 focus:ring-blue-500"),placeholder:"Type new tag name...",value:p,onChange:d=>u(d.target.value),onKeyDown:d=>{d.key==="Enter"&&f()}}),e.jsx(Ke,{size:"sm",onClick:f,disabled:!p.trim(),children:"Add"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:s("block text-xs font-semibold uppercase mb-2",a.text.secondary),children:"Suggested / Recent"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:x.filter(d=>!l.tags.includes(d)).slice(0,8).map(d=>e.jsxs("button",{onClick:()=>r(l.id,d),className:s("text-xs px-2 py-1 border rounded flex items-center transition-colors",a.border.default,a.text.secondary,`hover:${a.surface.highlight}`),children:[e.jsx(Ve,{className:"h-3 w-3 mr-1"})," ",d]},d))})]})]})})}function at({doc:l,isSelected:i,onToggleSelection:r,onPreview:m}){const{theme:x}=A();return e.jsxs("div",{onClick:a=>{a.ctrlKey||a.metaKey?r(l.id,a):m(l)},className:s("h-full w-full border rounded-lg p-4 flex flex-col items-center justify-between cursor-pointer transition-all hover:shadow-md relative group",x.surface.default,x.border.default,i?s("ring-2 ring-blue-500",x.primary.light):`hover:${x.surface.highlight}`),children:[e.jsx("div",{className:"absolute top-2 left-2 z-10",onClick:a=>a.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:i,onChange:a=>r(l.id,a),className:"rounded text-blue-600 cursor-pointer w-4 h-4"})}),e.jsx("div",{className:"flex-1 flex items-center justify-center w-full",children:e.jsx(He,{type:l.type,className:"h-16 w-16 opacity-80"})}),e.jsxs("div",{className:"w-full text-center mt-3",children:[e.jsx("h4",{className:s("text-xs font-bold truncate px-1",x.text.primary),title:l.title,children:l.title}),e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-1",children:[e.jsx("span",{className:s("text-[10px]",x.text.secondary),children:l.fileSize||"24KB"}),e.jsx(_e,{variant:"neutral",className:"text-[9px] px-1 py-0",children:l.status||"Active"})]})]})]})}const Xt=({currentUserRole:l="Associate"})=>{const{theme:i}=A(),r=ae(),{searchTerm:m,setSearchTerm:x,selectedDocForHistory:a,setSelectedDocForHistory:p,handleRestore:u,addTag:f,removeTag:d,allTags:n,filtered:k,currentFolder:y,setCurrentFolder:g,isDetailsOpen:$,setIsDetailsOpen:N,previewDoc:D,setPreviewDoc:j,updateDocument:T,isLoading:w,isDragging:C,handleDragEnter:z,handleDragLeave:I,handleDrop:R}=Ye({enableDragDrop:!0}),[M,O]=o.useState("list"),[E,V]=o.useState(null),{selectedIds:B,toggleSelection:b,selectAll:K,clearSelection:G,isSelected:L,isAllSelected:q}=Xe(k),{mutate:F,isLoading:Q}=re(W.documents.summarizeBatch,{onSuccess:P=>{r.success(`AI Summary generated for ${P} documents.`),G(),Y.invalidate(H.documents.all())}}),U=(P,Z)=>e.jsx(at,{doc:P,isSelected:L(P.id),onToggleSelection:(_,X)=>b(_,X),onPreview:j});return e.jsxs("div",{className:"flex-1 flex h-full relative",onDragEnter:z,children:[C&&e.jsx(Je,{onDrop:R,onDragLeave:I}),e.jsx("div",{className:s("w-64 border-r flex-shrink-0 hidden md:flex",i.border.default,i.surface.highlight),children:e.jsx(Ze,{currentFolder:y,setCurrentFolder:g})}),e.jsxs("div",{className:s("flex-1 flex flex-col min-w-0 relative",i.surface.default),children:[e.jsx(et,{selectedDocsCount:B.length,searchTerm:m,setSearchTerm:x,viewMode:M,setViewMode:O,isDetailsOpen:$,setIsDetailsOpen:N,isProcessingAI:Q,onBulkSummarize:()=>F(B),onClearSelection:G}),e.jsx("div",{className:"flex-1 overflow-hidden relative",children:M==="list"?e.jsx(st,{documents:k,viewMode:M,selectedDocs:B,toggleSelection:b,selectAll:K,isAllSelected:q,isSelected:L,setSelectedDocForHistory:p,setTaggingDoc:V,onRowClick:j}):e.jsx("div",{className:s("h-full p-4",i.surface.highlight),children:e.jsx(Oe,{items:k,height:"100%",itemHeight:200,itemWidth:180,renderItem:U,gap:16,emptyMessage:w?"Searching documents...":"No documents found"})})})]}),$&&D&&e.jsx("div",{className:s("w-96 border-l flex-shrink-0 shadow-xl z-20 absolute right-0 top-0 bottom-0 md:static",i.surface.default,i.border.default),children:e.jsx(Ge,{document:D,onViewHistory:p,onUpdate:T,userRole:l,onCloseMobile:()=>N(!1)})}),a&&e.jsx(tt,{document:a,userRole:l,onRestore:u,onClose:()=>p(null)}),E&&e.jsx(rt,{document:E,allTags:n,onClose:()=>V(null),onAddTag:f,onRemoveTag:d})]})};export{Xt as DocumentExplorer};
