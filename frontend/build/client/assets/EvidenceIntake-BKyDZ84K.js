import{r as n,j as e,bd as O,an as z,ab as G,v as M,by as R,ad as H,ba as V}from"./vendor-core-V-oW58GW.js";import{B as u}from"./Button-PaGqeZoR.js";import{C as $}from"./Card-D56KNEnI.js";import{i as J,o as W,D as C,T as X}from"./case-detail-CN_DMmR8.js";import{u as q}from"./useNotify-Bhb3OIEg.js";import{u as K}from"./useWizard-C5deA0UI.js";import{u as Q}from"./ThemeContext-OPG61qw5.js";import{c as a}from"./useQueryHooks-BdeOvP9e.js";import{a as Y}from"./evidenceSchemas-BfC4WNg8.js";import{A as Z}from"./type-mappings-DEPYyX4d.js";import"./vendor-misc-Dwkhvdtg.js";import"./vendor-charts-KZIdMATq.js";import"./Badge-B08w10nz.js";import"./schemas-B2_dy3tf.js";import"./SyncContext-DYD5yPAv.js";import"./dataService-75QCl8KS.js";import"./preload-helper-BXl3LOEh.js";import"./VirtualList-B1zORm91.js";import"./AppShell-Z1zGEOCG.js";import"./tabs.config-F85gN5xx.js";import"./PageHeader-os9pD5mt.js";import"./formatters-stMuSkc6.js";import"./Table-C8OsWLsz.js";import"./EmptyState-BwtZeBY5.js";import"./dateUtils-rLIRMrtk.js";import"./MetricCard-CDV5joW_.js";import"./queryKeys-BBVgMz36.js";import"./useSessionStorage-HC9RvMcM.js";import"./ErrorState-BA0dmAVI.js";import"./ConfirmDialog-CTAXMvML.js";import"./Modal-BlJFylOy.js";import"./Kanban-BbECSZhC.js";import"./FilterPanel-C0WYx6xs.js";import"./AdaptiveLoader-gvY3s3Bs.js";import"./UserAvatar-lVqVFNPb.js";import"./Tabs-BTz8yyZK.js";import"./Input-JNgj1Ekc.js";import"./TextArea-BMpffac7.js";import"./geminiService-DjDdWyh4.js";import"./TaskCreationModal-B2VECu1_.js";import"./search.config-B6mvIgDA.js";import"./useToggle-CjLp2PQ4.js";import"./sanitize-k_Tw3ej1.js";import"./useModalState-Cst_3NmK.js";import"./scheduler-BERajRBE.js";import"./RouteErrorBoundary-Nha8Il06.js";import"./meta-utils-lVs9HXG9.js";const We=({handleBack:I,onComplete:E})=>{const o=K(2),x=q(),{theme:t}=Q(),[d,P]=n.useState(null),[N,S]=n.useState(!1),[T,l]=n.useState(""),[w,F]=n.useState([]),[f,h]=n.useState(""),[g,D]=n.useState(""),[b,j]=n.useState(""),[v,k]=n.useState("Document"),[i,m]=n.useState({}),y=n.useRef(null),U={title:f,custodian:g,description:b,type:v,generatedData:i,currentStep:o.currentStep},{isSaving:B}=J({data:U,onSave:async s=>{localStorage.setItem("evidence-intake-draft",JSON.stringify(s))},delay:2e3});n.useEffect(()=>{const s=localStorage.getItem("evidence-intake-draft");if(s)try{const r=JSON.parse(s);h(r.title||""),D(r.custodian||""),j(r.description||""),k(r.type||"Document"),m(r.generatedData||{}),x.info("Draft restored from previous session")}catch(r){console.error("Failed to restore draft",r)}},[]);const A=async s=>{if(s.target.files&&s.target.files[0]){const r=s.target.files[0];P(r),h(r.name),S(!0),l("Scanning for Malware..."),await new Promise(c=>setTimeout(c,800)),l("OCR & Text Extraction..."),await new Promise(c=>setTimeout(c,800)),l("Splitting Documents..."),await new Promise(c=>setTimeout(c,600)),l("Generating Blockchain Hash...");const p=await C.processFile(r);m(p),j(p.summary),S(!1),l("Complete"),x.success("File processed and hashed"),o.next()}},L=()=>{const s={id:`EV-${Date.now()}`,trackingUuid:i.uuid||crypto.randomUUID(),caseId:"Pending Assignment",title:f,type:v,description:b,collectionDate:new Date().toISOString().split("T")[0],collectedBy:"Current User",custodian:g||"Unknown",location:"Evidence Locker / Digital S3",admissibility:Z.PENDING,tags:i.tags||[],blockchainHash:i.hash,chainOfCustody:[{id:`cc-${Date.now()}`,date:new Date().toISOString(),action:"Initial Collection",actor:"Current User",notes:"Intake via Digital Wizard"}]},r=Y(s);if(!r.success){F(r.error.errors.map(p=>p.message)),x.error("Validation failed. Please check the form.");return}localStorage.removeItem("evidence-intake-draft"),E(s)};return e.jsxs("div",{className:"max-w-3xl mx-auto py-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:I,className:a("mr-4 transition-colors",t.text.tertiary,`hover:${t.text.primary}`),children:e.jsx(O,{className:"h-6 w-6"})}),e.jsx("h2",{className:a("text-2xl font-bold",t.text.primary),children:"Evidence Intake Wizard"})]}),B&&e.jsxs("div",{className:"flex items-center text-xs text-blue-600",children:[e.jsx(z,{className:"h-3 w-3 mr-1 animate-pulse"})," Saving draft..."]})]}),e.jsx($,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(W,{steps:["Upload & Hash","Metadata & Tagging"],currentStep:o.currentStep}),w.length>0&&e.jsxs("div",{className:a("p-4 rounded-lg border",t.status.error.bg,t.status.error.border),children:[e.jsx("h4",{className:a("font-bold text-sm mb-2",t.status.error.text),children:"Validation Errors:"}),e.jsx("ul",{className:a("text-xs list-disc list-inside",t.status.error.text),children:w.map((s,r)=>e.jsx("li",{children:s},r))})]}),o.currentStep===1&&e.jsx("div",{className:"animate-in fade-in slide-in-from-right-4",children:e.jsxs("div",{className:a("border-2 border-dashed rounded-lg p-10 text-center cursor-pointer transition-colors relative overflow-hidden",t.border.default,`hover:${t.surface.highlight}`),onClick:()=>y.current?.click(),children:[e.jsx("input",{type:"file",ref:y,className:"hidden",onChange:A}),N?e.jsxs("div",{className:"flex flex-col items-center justify-center text-blue-600",children:[e.jsx(G,{className:"h-10 w-10 animate-spin mb-4"}),e.jsx("p",{className:"font-bold text-lg",children:T}),e.jsx("p",{className:"text-sm text-slate-400 mt-2",children:"Do not close window"})]}):d?e.jsxs("div",{className:"flex flex-col items-center text-green-600",children:[e.jsx(M,{className:"h-12 w-12 mb-4"}),e.jsx("p",{className:"font-bold text-lg",children:d.name}),e.jsxs("p",{className:"text-sm text-slate-500",children:[C.formatBytes(d.size)," â€¢ processed"]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsxs("span",{className:"bg-slate-100 text-slate-600 px-2 py-1 rounded text-xs border border-slate-200 font-mono",children:[e.jsx(R,{className:"h-3 w-3 inline mr-1"}),i.hash?.substring(0,12),"..."]}),e.jsxs("span",{className:"bg-green-100 text-green-700 px-2 py-1 rounded text-xs border border-green-200 font-medium",children:[e.jsx(H,{className:"h-3 w-3 inline mr-1"}),"Secured"]})]}),e.jsx(u,{variant:"primary",className:"mt-6",onClick:s=>{s.stopPropagation(),o.next()},children:"Continue"})]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:a("h-12 w-12 mx-auto mb-4",t.text.tertiary)}),e.jsx("p",{className:a("text-lg font-medium",t.text.primary),children:"Drop files here to upload"}),e.jsx("p",{className:a("text-sm mt-2",t.text.secondary),children:"Supports PDF, DOCX, MSG, JPG (Max 500MB)"}),e.jsx(u,{variant:"secondary",className:"mt-6",onClick:s=>{s.stopPropagation(),y.current?.click()},children:"Select Files"})]})]})}),o.currentStep===2&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 animate-in fade-in slide-in-from-right-4",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:a("block text-sm font-medium mb-1",t.text.primary),children:"Evidence Title"}),e.jsx("input",{type:"text",className:a("w-full border rounded-md px-3 py-2 outline-none focus:ring-2 focus:ring-blue-500",t.border.default,t.surface.default),placeholder:"e.g. Hard Drive S/N 12345",value:f,onChange:s=>h(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:a("block text-sm font-medium mb-1",t.text.primary),children:"Evidence Type"}),e.jsxs("select",{className:a("w-full border rounded-md px-3 py-2 outline-none focus:ring-2 focus:ring-blue-500",t.border.default,t.surface.default),value:v,onChange:s=>k(s.target.value),children:[e.jsx("option",{value:"Document",children:"Document"}),e.jsx("option",{value:"Digital",children:"Digital"}),e.jsx("option",{value:"Physical",children:"Physical"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:a("block text-sm font-medium mb-1",t.text.primary),children:"Lifecycle ID (UUID)"}),e.jsx("input",{type:"text",disabled:!0,className:a("w-full border rounded-md px-3 py-2 font-mono text-xs",t.border.default,t.surface.highlight,t.text.tertiary),value:i.uuid||"Pending generation..."})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:a("block text-sm font-medium mb-1",t.text.primary),children:"Description & Context"}),e.jsx("textarea",{className:a("w-full border rounded-md px-3 py-2 outline-none focus:ring-2 focus:ring-blue-500",t.border.default,t.surface.default),rows:4,value:b,onChange:s=>j(s.target.value),placeholder:"Describe the item..."})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:a("block text-sm font-medium mb-1",t.text.primary),children:"Custodian"}),e.jsx("input",{type:"text",className:a("w-full border rounded-md px-3 py-2 outline-none focus:ring-2 focus:ring-blue-500",t.border.default,t.surface.default),placeholder:"Person/Entity in possession",value:g,onChange:s=>D(s.target.value)})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:a("block text-sm font-medium mb-1",t.text.primary),children:"Auto-Tags"}),e.jsx(X,{tags:i.tags||[],onAdd:s=>m({...i,tags:[...i.tags||[],s]}),onRemove:s=>m({...i,tags:i.tags?.filter(r=>r!==s)})})]}),e.jsxs("div",{className:"sm:col-span-2 pt-4 flex justify-end gap-3",children:[e.jsx(u,{variant:"secondary",onClick:o.back,children:"Back"}),e.jsx(u,{variant:"primary",disabled:!d||N,onClick:L,children:"Log Item & Print Label"})]})]})]})})]})};export{We as EvidenceIntake};
