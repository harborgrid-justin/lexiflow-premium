import{r as K,j as e,l as Z,ab as q,p as J,al as C,b4 as W,cz as Q,t as V,c1 as X,a7 as ee,aj as ae}from"./vendor-core-V-oW58GW.js";import{B as re}from"./Badge-B08w10nz.js";import{B as f}from"./Button-PaGqeZoR.js";import{U as te}from"./UserAvatar-lVqVFNPb.js";import{C as se}from"./ConfirmDialog-CTAXMvML.js";import{M as g}from"./MetricCard-CDV5joW_.js";import{T as le,a as ie,b as u,c as ne,d as oe,e as x}from"./Table-C8OsWLsz.js";import{c as t,d as M}from"./useQueryHooks-BdeOvP9e.js";import{u as L}from"./ThemeContext-OPG61qw5.js";import{D as ce,h as R}from"./dataService-75QCl8KS.js";import{I as h}from"./Input-JNgj1Ekc.js";import{M as de}from"./Modal-BlJFylOy.js";import"./SyncContext-DYD5yPAv.js";import{b as me}from"./useDomainData-DVGIWLUf.js";import{u as U}from"./useModalState-Cst_3NmK.js";import{u as ue}from"./useNotify-Bhb3OIEg.js";import{getTodayString as xe}from"./dateUtils-rLIRMrtk.js";import"./vendor-misc-Dwkhvdtg.js";import"./vendor-charts-KZIdMATq.js";import"./preload-helper-BXl3LOEh.js";import"./type-mappings-DEPYyX4d.js";import"./queryKeys-BBVgMz36.js";const he=({isOpen:r,onClose:o,onAdd:c})=>{const{theme:i}=L(),[s,n]=K.useState({}),b=()=>{!s.name||!s.email||(c(s),n({}))};return e.jsx(de,{isOpen:r,onClose:o,title:"Add Staff Member",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx(h,{label:"Full Name",value:s.name||"",onChange:l=>n({...s,name:l.target.value}),placeholder:"e.g. John Doe"}),e.jsx(h,{label:"Email",value:s.email||"",onChange:l=>n({...s,email:l.target.value}),placeholder:"email@firm.com"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:t("block text-xs font-semibold uppercase mb-1.5",i.text.secondary),children:"Role"}),e.jsxs("select",{className:t("w-full px-3 py-2 border rounded-md text-sm",i.surface.default,i.border.default,i.text.primary),value:s.role,onChange:l=>n({...s,role:l.target.value}),children:[e.jsx("option",{value:"Associate",children:"Associate"}),e.jsx("option",{value:"Paralegal",children:"Paralegal"}),e.jsx("option",{value:"Senior Partner",children:"Senior Partner"}),e.jsx("option",{value:"Administrator",children:"Administrator"})]})]}),e.jsx(h,{label:"Phone",value:s.phone||"",onChange:l=>n({...s,phone:l.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(h,{label:"Billable Target (Hrs)",type:"number",value:s.billableTarget||"",onChange:l=>n({...s,billableTarget:Number(l.target.value)})}),e.jsx(h,{label:"Salary",type:"number",value:s.salary||"",onChange:l=>n({...s,salary:Number(l.target.value)})})]}),e.jsxs("div",{className:t("pt-4 flex justify-end gap-2 border-t mt-4",i.border.default),children:[e.jsx(f,{variant:"secondary",onClick:o,children:"Cancel"}),e.jsx(f,{variant:"primary",onClick:b,children:"Create Profile"})]})]})})},D=1800,fe=15e4,be=75,j=85,pe=r=>{if(r.length===0)return 0;const o=r.reduce((c,i)=>c+(i.utilizationRate||0),0);return Math.round(o/r.length)},ge=r=>r>=j?"text-green-600":r>=be?"text-amber-600":"text-red-500",Fe=()=>{const{theme:r}=L(),o=ue(),c=U(),i=U(),[s,n]=Z.useState(null),{data:b=[],isLoading:l,status:w,error:v,refetch:z}=me(),d=Array.isArray(b)?b:[],E=w==="error",y=ce.hr,{mutate:B}=M(y.addStaff,{invalidateKeys:[["staff","all"],["users","all"]],onSuccess:()=>{c.close(),o.success("Staff member added successfully.")},onError:a=>{o.error(`Failed to add staff member: ${a.message}`)}}),{mutate:k,isLoading:N}=M(y.deleteStaff,{invalidateKeys:[["staff","all"]],onSuccess:()=>{i.close(),n(null),o.success("Staff member removed successfully.")},onError:a=>{o.error(`Failed to remove staff member: ${a.message}`)}}),I=a=>{if(!a.name?.trim()||!a.email?.trim()){o.warning("Please fill in all required fields.");return}const m={id:R.staff(),userId:R.user(),name:a.name.trim(),email:a.email.trim().toLowerCase(),role:a.role||"Associate",phone:a.phone?.trim()||"",billableTarget:Number(a.billableTarget)||D,currentBillable:0,utilizationRate:0,salary:Number(a.salary)||fe,status:"Active",startDate:xe()};B(m)},H=a=>{n(a),i.open()},O=()=>{s&&k(s)},$=()=>{i.close(),n(null)},p=d.reduce((a,m)=>a+(m.currentBillable||0),0),T=pe(d),F=T>=j,P=s&&d.find(a=>a.id===s)?.name||"this staff member";if(l)return e.jsxs("div",{className:t("flex flex-col items-center justify-center py-16",r.surface.default),children:[e.jsx(q,{className:t("h-8 w-8 animate-spin mb-4",r.text.tertiary)}),e.jsx("p",{className:r.text.secondary,children:"Loading staff directory..."})]});if(E)return e.jsxs("div",{className:t("flex flex-col items-center justify-center py-16 rounded-lg border",r.surface.default,r.border.default),children:[e.jsx(J,{className:t("h-12 w-12 mb-4",r.status.error.text)}),e.jsx("h3",{className:t("text-lg font-semibold mb-2",r.text.primary),children:"Failed to Load Staff Directory"}),e.jsx("p",{className:t("text-sm mb-4",r.text.secondary),children:v instanceof Error?v.message:"An unexpected error occurred"}),e.jsx(f,{variant:"secondary",onClick:()=>z(),children:"Try Again"})]});const _=()=>e.jsxs("div",{className:t("flex flex-col items-center justify-center py-16 rounded-lg border border-dashed",r.surface.default,r.border.default),children:[e.jsx(ae,{className:t("h-12 w-12 mb-4",r.text.tertiary)}),e.jsx("h3",{className:t("text-lg font-semibold mb-2",r.text.primary),children:"No Staff Members Found"}),e.jsx("p",{className:t("text-sm mb-4 text-center max-w-md",r.text.secondary),children:"Your staff directory is empty. Add your first staff member to start tracking attorney profiles, utilization targets, and performance metrics."}),e.jsx(f,{variant:"primary",icon:C,onClick:c.open,children:"Add First Staff Member"})]});return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:t("flex justify-between items-center p-4 rounded-lg border shadow-sm",r.surface.default,r.border.default),children:[e.jsxs("div",{children:[e.jsx("h3",{className:t("font-bold text-lg",r.text.primary),children:"Staff Directory"}),e.jsx("p",{className:t("text-sm",r.text.secondary),children:"Manage attorney profiles, utilization targets, and performance."})]}),e.jsx(f,{variant:"primary",icon:C,onClick:c.open,children:"Add Staff"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(g,{label:"Total Headcount",value:d.length,icon:W,trend:d.length>0?`${d.filter(a=>a.status==="Active").length} active`:"No staff yet",trendUp:d.length>0,className:"border-l-4 border-l-blue-600"}),e.jsx(g,{label:"Avg Utilization",value:`${T}%`,icon:Q,trend:`Target: ${j}%`,trendUp:F,className:"border-l-4 border-l-purple-600"}),e.jsx(g,{label:"Billable Hours YTD",value:Math.round(p).toLocaleString(),icon:V,trend:p>0?"On track":"No hours logged",trendUp:p>0,className:"border-l-4 border-l-emerald-600"})]}),d.length===0?_():e.jsxs(le,{responsive:"card",children:[e.jsxs(ie,{children:[e.jsx(u,{children:"Employee"}),e.jsx(u,{children:"Role"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Utilization"}),e.jsx(u,{children:"Billable Target (Annual)"}),e.jsx(u,{className:"text-right",children:"Action"})]}),e.jsx(ne,{children:d.map(a=>{const m=a.billableTarget||D,A=a.currentBillable||0,G=m>0?A/m*100:0,S=a.utilizationRate||0,Y=ge(S);return e.jsxs(oe,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{name:a.name,size:"sm"}),e.jsxs("div",{children:[e.jsx("p",{className:t("font-bold text-sm",r.text.primary),children:a.name}),e.jsx("p",{className:t("text-xs",r.text.secondary),children:a.email})]})]})}),e.jsx(x,{children:a.role}),e.jsx(x,{children:e.jsx(re,{variant:a.status==="Active"?"success":"warning",children:a.status})}),e.jsx(x,{children:e.jsxs("span",{className:t("font-bold",Y),children:[S,"%"]})}),e.jsx(x,{children:e.jsxs("div",{className:"w-full max-w-[140px]",children:[e.jsxs("div",{className:t("flex justify-between text-xs mb-1",r.text.secondary),children:[e.jsxs("span",{children:[Math.round(A).toLocaleString()," hrs"]}),e.jsxs("span",{className:r.text.tertiary,children:["/ ",m.toLocaleString()]})]}),e.jsx("div",{className:t("w-full rounded-full h-1.5",r.surface.highlight),children:e.jsx("div",{className:"bg-blue-600 h-1.5 rounded-full transition-all duration-300",style:{width:`${Math.min(G,100)}%`}})})]})}),e.jsx(x,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:t("p-1.5 rounded transition-colors",r.text.tertiary,"hover:bg-slate-100 dark:hover:bg-slate-800"),"aria-label":`More options for ${a.name}`,children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>H(a.id),className:t("p-1.5 rounded transition-colors","text-slate-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950"),"aria-label":`Remove ${a.name}`,disabled:N,children:e.jsx(ee,{className:"h-4 w-4"})})]})})]},a.id)})})]}),e.jsx(se,{isOpen:i.isOpen,onClose:$,onConfirm:O,title:"Remove Staff Member",message:`Are you sure you want to remove ${P}? This will affect HR records and billing.`,variant:"danger",confirmText:N?"Removing...":"Remove Staff"}),e.jsx(he,{isOpen:c.isOpen,onClose:c.close,onAdd:I})]})};export{Fe as HRManager};
