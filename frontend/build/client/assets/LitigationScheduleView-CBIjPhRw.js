import{r as y,j as i,t as F}from"./vendor-core-V-oW58GW.js";import{B as z}from"./Badge-B08w10nz.js";import{u as U}from"./ThemeContext-OPG61qw5.js";import{a as $}from"./SyncContext-DYD5yPAv.js";import{V as C,c as D}from"./useQueryHooks-BdeOvP9e.js";import"./type-mappings-DEPYyX4d.js";import{f as X,T as W}from"./dataService-75QCl8KS.js";import{C as g,k as B,l as H}from"./case-detail-CN_DMmR8.js";import{ag as S,ah as I,ai as V,aj as b,ak as k,al as P}from"./vendor-misc-Dwkhvdtg.js";import"./vendor-charts-KZIdMATq.js";import"./preload-helper-BXl3LOEh.js";import"./Button-PaGqeZoR.js";import"./schemas-B2_dy3tf.js";import"./VirtualList-B1zORm91.js";import"./AppShell-Z1zGEOCG.js";import"./tabs.config-F85gN5xx.js";import"./PageHeader-os9pD5mt.js";import"./formatters-stMuSkc6.js";import"./Table-C8OsWLsz.js";import"./EmptyState-BwtZeBY5.js";import"./useNotify-Bhb3OIEg.js";import"./dateUtils-rLIRMrtk.js";import"./Card-D56KNEnI.js";import"./MetricCard-CDV5joW_.js";import"./queryKeys-BBVgMz36.js";import"./useSessionStorage-HC9RvMcM.js";import"./ErrorState-BA0dmAVI.js";import"./ConfirmDialog-CTAXMvML.js";import"./Modal-BlJFylOy.js";import"./Kanban-BbECSZhC.js";import"./FilterPanel-C0WYx6xs.js";import"./AdaptiveLoader-gvY3s3Bs.js";import"./UserAvatar-lVqVFNPb.js";import"./Tabs-BTz8yyZK.js";import"./Input-JNgj1Ekc.js";import"./TextArea-BMpffac7.js";import"./geminiService-DjDdWyh4.js";import"./TaskCreationModal-B2VECu1_.js";import"./search.config-B6mvIgDA.js";import"./useToggle-CjLp2PQ4.js";import"./sanitize-k_Tw3ej1.js";import"./useModalState-Cst_3NmK.js";import"./scheduler-BERajRBE.js";import"./RouteErrorBoundary-Nha8Il06.js";import"./meta-utils-lVs9HXG9.js";function K({pixelsPerDay:u,tasks:e,onTaskUpdate:a}){const s=y.useRef(null),t=y.useRef({move:null,up:null});y.useEffect(()=>()=>{t.current.move&&window.removeEventListener("mousemove",t.current.move),t.current.up&&window.removeEventListener("mouseup",t.current.up)},[]);const r=y.useCallback(c=>{if(!s.current)return;const{startX:l,initialWidth:f,element:h,mode:m}=s.current,v=c.clientX-l;requestAnimationFrame(()=>{if(m==="move")h.style.transform=`translate3d(${v}px, 0, 0)`,h.style.zIndex="50";else if(m==="resize-right")h.style.width=`${Math.max(20,f+v)}px`;else if(m==="resize-left"){const p=Math.max(20,f-v);p>20&&(h.style.transform=`translate3d(${v}px, 0, 0)`,h.style.width=`${p}px`)}})},[]),o=y.useCallback(c=>{if(!s.current)return;const{taskId:l,mode:f,startX:h,element:m}=s.current,v=c.clientX-h;window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",o),t.current={move:null,up:null},document.body.style.cursor="",m.style.transform="",m.style.width="",m.style.zIndex="",s.current=null;const p=Math.round(v/u);if(p!==0){const d=e.find(x=>x.id===l);if(d&&d.dueDate){const x=new Date(d.dueDate),E=d.startDate?new Date(d.startDate):new Date(x.getTime()-7200*60*1e3),T=new Date(E),N=new Date(x);if(f==="move"?(T.setDate(T.getDate()+p),N.setDate(N.getDate()+p)):f==="resize-right"?N.setDate(N.getDate()+p):f==="resize-left"&&T.setDate(T.getDate()+p),T.getTime()>N.getTime())return;a(l,T.toISOString().split("T")[0],N.toISOString().split("T")[0])}}},[e,u,a,r]),n=y.useCallback((c,l,f)=>{if(c.button!==0)return;c.preventDefault(),c.stopPropagation();const h=c.currentTarget,m=f==="move"?h:h.parentElement;if(!m)return;const v=m.getBoundingClientRect();s.current={taskId:l,mode:f,startX:c.clientX,initialWidth:v.width,element:m},document.body.style.cursor=f==="move"?"grabbing":"col-resize",t.current={move:r,up:o},window.addEventListener("mousemove",r),window.addEventListener("mouseup",o)},[r,o]);return{initDrag:n,onMouseDown:n}}class M{static validateDate(e,a){if(!(e instanceof Date)||isNaN(e.getTime()))throw new C(`[DateCalculationService] Invalid ${a} parameter`)}static validateNumber(e,a){if(typeof e!="number"||isNaN(e))throw new C(`[DateCalculationService] Invalid ${a} parameter`)}static calculateStartDateFromPosition(e,a,s,t=new Date){try{this.validateNumber(e,"xPosition"),this.validateNumber(a,"pixelsPerDay"),this.validateNumber(s,"minX"),this.validateDate(t,"referenceDate");const r=Math.max(0,Math.floor((e-s)/a));return S(t,r)}catch(r){throw console.error("[DateCalculationService.calculateStartDateFromPosition] Error:",r),r}}static calculatePositionFromDate(e,a,s,t){try{this.validateDate(e,"date"),this.validateDate(a,"referenceDate"),this.validateNumber(s,"pixelsPerDay"),this.validateNumber(t,"minX");const r=I(e,a);return t+r*s}catch(r){throw console.error("[DateCalculationService.calculatePositionFromDate] Error:",r),r}}static calculateDueDate(e,a,s={excludeWeekends:!1}){try{if(this.validateDate(e,"startDate"),this.validateNumber(a,"durationDays"),a<0)throw new C("[DateCalculationService.calculateDueDate] durationDays must be positive");return s.excludeWeekends?V(e,a):S(e,a)}catch(t){throw console.error("[DateCalculationService.calculateDueDate] Error:",t),t}}static calculateWorkingDays(e,a,s={excludeWeekends:!0,excludeHolidays:!1}){let t=0,r=new Date(e);const o=new Set(s.holidays?.map(n=>b(n,"yyyy-MM-dd"))||[]);for(;r<=a;){const n=o.has(b(r,"yyyy-MM-dd")),c=k(r);!n&&!(s.excludeWeekends&&c)&&t++,r=S(r,1)}return t}static calculateDuration(e,a){const s=typeof e=="string"?P(e):e,t=typeof a=="string"?P(a):a;return Math.max(0,I(t,s))}static formatToISO(e){return b(e,"yyyy-MM-dd")}static parseFromISO(e){return P(e)}static getBusinessDaysArray(e,a,s={excludeWeekends:!0}){const t=[];let r=new Date(e);const o=new Set(s.holidays?.map(n=>b(n,"yyyy-MM-dd"))||[]);for(;r<=a;){const n=o.has(b(r,"yyyy-MM-dd")),c=k(r);!n&&!(s.excludeWeekends&&c)&&t.push(new Date(r)),r=S(r,1)}return t}static calculatePhaseDuration(e){if(e.length===0)return null;const a=e.map(t=>t.start),s=e.map(t=>t.end);return{start:new Date(Math.min(...a.map(t=>t.getTime()))),end:new Date(Math.max(...s.map(t=>t.getTime())))}}static addBufferDays(e,a,s={excludeWeekends:!1}){return this.calculateDueDate(e,a,s)}static isWeekend(e){return k(e)}static isHoliday(e,a){const s=b(e,"yyyy-MM-dd");return a.some(t=>b(t,"yyyy-MM-dd")===s)}static getNextBusinessDay(e,a={}){let s=S(e,1);const t=new Set(a.holidays?.map(r=>b(r,"yyyy-MM-dd"))||[]);for(;a.excludeWeekends&&k(s)||a.excludeHolidays&&t.has(b(s,"yyyy-MM-dd"));)s=S(s,1);return s}static calculateCriticalPathEndDate(e){const a=new Map(e.map(o=>[o.id,o])),s=new Map,t=o=>{if(s.has(o))return s.get(o);const n=a.get(o);if(!n)return new Date;let c=n.startDate;for(const f of n.dependencies){const h=t(f);h>c&&(c=h)}const l=S(c,n.durationDays);return s.set(o,l),l};let r=new Date(0);for(const o of e){const n=t(o.id);n>r&&(r=n)}return r}}const O={Day:60,Week:20,Month:5,Quarter:2},G={Decision:g.DECISION_DURATION,Event:g.EVENT_DURATION,Milestone:g.EVENT_DURATION,Task:g.DEFAULT_TASK_DURATION,Phase:g.DEFAULT_TASK_DURATION,Delay:g.DEFAULT_TASK_DURATION,Start:0,End:0,Parallel:g.DEFAULT_TASK_DURATION,Comment:0},Q=u=>O[u]||O.Month,Y=u=>G[u]||g.DEFAULT_TASK_DURATION,Z=(u,e)=>{const a=[],s=[];if(u.length===0)return{phases:[],tasks:[]};const t=[...u].sort((n,c)=>n.x-c.x),r=t.length>0?Math.min(...t.map(n=>n.x)):0,o=new Date;return t.forEach(n=>{if(n.type==="Phase")a.push({id:n.id,caseId:"strategy-plan",name:n.label,startDate:"",duration:0,status:"Active",color:"bg-indigo-500"});else if(n.type!=="Comment"&&n.type!=="Start"&&n.type!=="End"){const c=M.calculateStartDateFromPosition(n.x-r,g.PIXELS_PER_DAY,o.getTime()),l=Y(n.type),f=M.calculateDueDate(c,l),h=e.filter(m=>m.to===n.id).map(m=>m.from);s.push({id:n.id,caseId:"strategy-plan",title:n.label,startDate:M.formatToISO(c),dueDate:M.formatToISO(f),status:W.TODO,assignee:String(n.config.assignee||"Unassigned"),priority:X.MEDIUM,dependencies:h})}}),{phases:a,tasks:s}},q=(u,e=new Date)=>{const a=M.parseFromISO(u);return M.calculatePositionFromDate(a,e,g.PIXELS_PER_DAY,0)},_={getTaskStyle:(u,e,a)=>{if(!u.dueDate)return{left:"0px",width:"20px",display:"none"};const s=new Date(u.dueDate).getTime();let t;u.startDate?t=new Date(u.startDate).getTime():t=s-7200*60*1e3;const r=e.getTime(),o=s-t,n=Math.max(1,o/(1e3*60*60*24)),c=(t-r)/(1e3*60*60*24)*a,l=n*a;return{left:`${Math.max(-100,c)}px`,width:`${Math.max(20,l)}px`,display:c+l<0?"none":"flex"}},generateTimeScale:(u,e,a)=>{const s=[],t=new Date(u);for(let r=0;r<e;r++){const o=new Date(t);o.setDate(o.getDate()+r*a),s.push({date:o,label:o.toLocaleDateString(void 0,{month:"short",day:"numeric"})})}return s}},J=({phases:u,tasks:e,collapsedPhases:a,zoom:s,viewStartDate:t,activeTaskId:r,onHoverTask:o,pixelsPerDay:n,onUpdateTask:c})=>{const{theme:l}=U(),{openWindow:f}=$(),h=y.useRef(null),{onMouseDown:m}=K({pixelsPerDay:n,tasks:e,onTaskUpdate:c}),v=()=>{const p=s==="Month"?30:7,d=_.generateTimeScale(t,90,p);return i.jsx("div",{className:D("flex h-8 border-b",l.border.default),children:d.map((x,E)=>i.jsx("div",{className:D("border-r text-[10px] font-bold uppercase p-2 flex-shrink-0 select-none",l.border.default,l.text.tertiary),style:{width:n*p},children:x.label},E))})};return i.jsx("div",{className:D("flex-1 flex flex-col overflow-hidden relative",l.surface.highlight),ref:h,children:i.jsxs("div",{className:"flex-1 overflow-auto custom-scrollbar relative",children:[i.jsx("div",{className:D("sticky top-0 z-20 border-b shadow-sm min-w-max",l.surface.highlight,l.border.default),children:v()}),i.jsxs("div",{className:"relative min-w-max pb-20",children:[i.jsxs("div",{className:"absolute inset-0 pointer-events-none z-0 flex",children:[Array.from({length:90}).map((p,d)=>i.jsx("div",{className:D("border-r h-full",l.border.default),style:{width:n*(s==="Month"?30:7)}},d)),i.jsx("div",{className:"absolute top-0 bottom-0 w-px bg-red-500 z-10",style:{left:`${(new Date().getTime()-t.getTime())/(1e3*60*60*24)*n}px`},children:i.jsx("div",{className:"bg-red-500 text-white text-[9px] px-1 rounded absolute -top-1 -translate-x-1/2",children:"Today"})})]}),u.map(p=>a.has(p.id)?null:i.jsxs("div",{className:"relative mt-2",children:[i.jsx("div",{className:"h-10 sticky left-0 right-0"}),e.filter(()=>!0).slice(0,10).map(d=>i.jsx("div",{className:D("h-10 relative flex items-center transition-colors",r===d.id?D(l.primary.light,"bg-opacity-50"):"hover:bg-black/5 dark:hover:bg-white/5"),children:i.jsxs("div",{className:D("absolute h-6 rounded-full border shadow-sm flex items-center px-2 text-xs font-bold text-white cursor-pointer select-none group overflow-hidden",d.status===W.COMPLETED?"bg-slate-400 border-slate-500":d.priority==="High"?"bg-red-500 border-red-600":D(l.action.primary.bg,l.action.primary.border)),style:_.getTaskStyle(d,t,n),onMouseDown:x=>m(x,d.id,"move"),onMouseEnter:()=>o(d.id),onMouseLeave:()=>o(null),onClick:x=>{x.defaultPrevented||f(`task-${d.id}`,`Task: ${d.title}`,i.jsxs("div",{className:D("p-6 h-full",l.surface.default),children:[i.jsx("h2",{className:D("text-xl font-bold mb-2",l.text.primary),children:d.title}),i.jsx("p",{className:D("mb-4",l.text.secondary),children:d.description}),i.jsx(z,{variant:"neutral",children:d.status})]}))},children:[i.jsx("span",{className:"truncate drop-shadow-md z-10 pr-2",children:d.title}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-white/30 to-transparent pointer-events-none"}),i.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-3 cursor-w-resize hover:bg-black/20 z-20",onMouseDown:x=>m(x,d.id,"resize-left")}),i.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-3 cursor-e-resize hover:bg-black/20 z-20",onMouseDown:x=>m(x,d.id,"resize-right")})]})},d.id))]},p.id))]})]})})},He=({nodes:u,connections:e,updateNode:a,addNode:s})=>{const{theme:t}=U(),[r,o]=y.useState("Month"),[n,c]=y.useState(null),[l,f]=y.useState(new Set),[h]=y.useState(new Date(new Date().setMonth(new Date().getMonth()-1))),[m,v]=y.useState(!0),{phases:p,tasks:d}=y.useMemo(()=>Z(u,e),[u,e]),x=y.useMemo(()=>Q(r),[r]),E=y.useMemo(()=>m?new Set(B.findCriticalPath(d)):new Set,[d,m]),T=y.useCallback((w,A,j)=>{const R=q(A);a(w,{x:R})},[a]),N=w=>{f(A=>{const j=new Set(A);return j.has(w)?j.delete(w):j.add(w),j})},L=()=>{s("Task",100,100,"New Task")};return i.jsxs("div",{className:"h-full flex flex-col overflow-hidden",children:[i.jsxs("div",{className:D("p-4 border-b shrink-0 flex items-center justify-between",t.surface.default,t.border.default),children:[i.jsx("h3",{className:"text-lg font-bold",children:"Gantt Timeline View"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("button",{onClick:()=>v(!m),className:D("flex items-center px-3 py-1.5 text-xs font-bold rounded-md border transition-all",m?"bg-red-50 text-red-600 border-red-200":D(t.surface.default,"text-slate-500")),children:[i.jsx(F,{className:"h-3 w-3 mr-1"})," Critical Path"]}),i.jsx("div",{className:D("flex items-center bg-slate-100 p-1 rounded-lg border",t.border.default),children:["Quarter","Month","Week","Day"].map(w=>i.jsx("button",{onClick:()=>o(w),className:D("px-3 py-1.5 text-xs font-bold rounded-md transition-all",r===w?"bg-white shadow text-slate-900":"text-slate-500 hover:text-slate-700"),children:w},w))})]})]}),i.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[i.jsx("div",{className:"shrink-0",children:i.jsx(H,{phases:p,tasks:d,collapsedPhases:l,activeTaskId:n,onTogglePhase:N,onHoverTask:c,onAddTask:L})}),i.jsx("div",{className:"flex-1",children:i.jsx(J,{phases:p,tasks:d.map(w=>({...w,isCritical:E.has(w.id)})),collapsedPhases:l,zoom:r,viewStartDate:h,activeTaskId:n,onHoverTask:c,pixelsPerDay:x,onUpdateTask:T})})]})]})};export{He as LitigationScheduleView,He as default};
