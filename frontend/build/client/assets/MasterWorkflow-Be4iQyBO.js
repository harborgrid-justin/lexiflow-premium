import{r as u,j as e,X as ke,bp as Ve,l as ne,N as F,a7 as Ye,aS as qe,bZ as B,b_ as ie,b$ as Qe,ac as Ce,a_ as oe,bF as Te,aj as Ze,a1 as Je,v as ce,q as z,ab as O,b1 as es,k as re,a6 as ss,p as ts,b4 as de,bw as as,c0 as rs,c1 as Ae,aT as ls,c2 as ns,ah as Se,u as is,bd as xe,an as os,c3 as cs,c4 as ds,c5 as xs,T as De,ad as ms,c6 as us,a2 as hs,al as Le,c7 as pe,a0 as fs,bg as ps,A as ge,c8 as gs}from"./vendor-core-V-oW58GW.js";import{E as $e}from"./ErrorBoundary-DFdq5NsB.js";import{P as Ee}from"./PageHeader-C4TFe3Td.js";import{B as v}from"./Button-CDQlLg6j.js";import{E as ee}from"./EmptyState-7A4cJUVU.js";import{D as A,T as W,W as js}from"./dataService-BWLMkXM4.js";import"./type-mappings-DEPYyX4d.js";import{B as Y}from"./Badge-bF-hTHJZ.js";import{u as C}from"./ThemeContext-OPG61qw5.js";import{u as E,c as t,q as Pe,d as le}from"./useQueryHooks-Oyt-TMLP.js";import{q as R}from"./queryKeys-BBVgMz36.js";import{u as bs}from"./useInterval-C7tD4i7N.js";import{V as ys}from"./VirtualList-r2WXvtCD.js";import{A as me}from"./AdaptiveLoader-D5wOoiN1.js";import{u as q}from"./useNotify-DdRjm5G5.js";import{C as I}from"./Card-CDOiP5UM.js";import{T as ue}from"./Tabs-7xONCRTX.js";import{L as je,g as Ie,B as vs,a as Ns}from"./BuilderToolbar-BNkl1R59.js";import{I as be}from"./Input-Dmln04Yk.js";import{T as ws}from"./TextArea-DrtcCAyn.js";import{C as ks}from"./ConfirmDialog--jvbqDAw.js";import"./SyncContext-B5_p5hCg.js";import{u as Cs}from"./useModalState-Cst_3NmK.js";import{u as ye}from"./useToggle-CjLp2PQ4.js";import{g as Ts,D as As,a as Ss,b as Ds,c as Ls}from"./chartConfig-DG5fYqz9.js";import{R as ve,B as $s,C as Es,X as Ps,Y as Is,T as Ne,a as Ms,P as Rs,c as Ws,b as Bs,L as Os}from"./vendor-charts-KZIdMATq.js";import{E as he}from"./ErrorState-WL3az5ve.js";import{M as Z}from"./MetricCard-BH_9X7pi.js";import{u as Fs}from"./useFilterAndSearch-B2zKLOlA.js";import{getTodayString as zs}from"./dateUtils-rLIRMrtk.js";import"./vendor-misc-Dwkhvdtg.js";import"./preload-helper-BXl3LOEh.js";import"./Modal-Rns91qFF.js";import"./chartColorService-Dq1XQNFk.js";function _s(r){const[l,s]=u.useState(()=>{if(r){const c=[{id:"start",type:"Start",label:"Start",x:50,y:300,config:{}}];return r.stages.forEach((x,m)=>{c.push({id:`n-${m}`,type:"Task",label:x,x:50+(m+1)*220,y:300,config:{description:`Execute stage: ${x}`,assignee:""}})}),c.push({id:"end",type:"End",label:"End",x:50+(r.stages.length+1)*220,y:300,config:{}}),c}return[{id:"start",type:"Start",label:"Start",x:50,y:200,config:{}},{id:"end",type:"End",label:"End",x:550,y:200,config:{}}]}),[a,o]=u.useState(()=>{if(r){const c=[{id:"start"},...r.stages.map((x,m)=>({id:`n-${m}`})),{id:"end"}];return c.slice(0,-1).map((x,m)=>({id:`c-${m}`,from:x.id,to:c[m+1].id}))}return[{id:"c1",from:"start",to:"end"}]}),n=u.useCallback((c,x,m,N)=>{const S=`node-${Date.now()}`,w=N||c,T={id:S,type:c,label:w,x,y:m,config:{}};return c==="Decision"&&(T.ports=je[w]||je.Default),s(y=>[...y,T]),S},[]),i=u.useCallback((c,x)=>{s(m=>m.map(N=>N.id===c?{...N,...x}:N))},[]),d=u.useCallback(c=>{s(x=>x.filter(m=>m.id!==c)),o(x=>x.filter(m=>m.from!==c&&m.to!==c))},[]),p=u.useCallback((c,x,m)=>{if(c===x){console.warn("Cannot connect a node to itself.");return}if(a.some(y=>y.from===c&&y.to===x&&y.fromPort===m)){console.warn("Connection already exists.");return}const w={id:`conn-${Date.now()}`,from:c,to:x,fromPort:m,toPort:"input"},T=l.find(y=>y.id===c);if(T&&m){const y=T.ports?.find(f=>f.id===m);y&&(w.label=y.label)}o(y=>[...y,w])},[l,a]),h=u.useCallback((c,x)=>{o(m=>m.map(N=>N.id===c?{...N,...x}:N))},[]),g=u.useCallback(c=>{o(x=>x.filter(m=>m.id!==c))},[]);return{nodes:l,connections:a,addNode:n,updateNode:i,deleteNode:d,addConnection:p,updateConnection:h,deleteConnection:g}}const ae=60,we=450,Gs=1e3;function Us(r={}){const{caseId:l="General",userId:s="current-user",rate:a=we}=r,o=q(),[n,i]=u.useState(!1),[d,p]=u.useState(0),h=u.useCallback(f=>isNaN(f)||f<0?(console.error("[useTimeTracker] Invalid rate:",f),!1):(f>1e4&&console.warn("[useTimeTracker] Unusually high rate detected:",f),!0),[]),g=u.useCallback(f=>!f||f.trim()===""?(console.error("[useTimeTracker] Invalid caseId:",f),!1):!0,[]),c=u.useCallback(f=>!f||f.trim()===""?(console.error("[useTimeTracker] Invalid userId:",f),!1):!0,[]);u.useEffect(()=>{h(a)||o.warning(`Invalid rate: ${a}. Using default rate: ${we}`),g(l)||o.warning("Invalid case ID. Time entries may not be properly attributed."),c(s)||o.warning("Invalid user ID. Time entries may not be properly attributed."),console.log(`[useTimeTracker] Initialized with caseId: ${l}, userId: ${s}, rate: ${a}`)},[l,s,a,h,g,c,o]),u.useEffect(()=>{let f=null;return n&&(f=setInterval(()=>{p(P=>P+1)},Gs)),()=>{f&&clearInterval(f)}},[n]);const x=u.useCallback(f=>{try{if(isNaN(f)||f<0)return console.error("[useTimeTracker.formatTime] Invalid totalSeconds:",f),"00:00:00";const P=Math.floor(f/3600),$=Math.floor(f%3600/60),_=f%60;return`${P.toString().padStart(2,"0")}:${$.toString().padStart(2,"0")}:${_.toString().padStart(2,"0")}`}catch(P){return console.error("[useTimeTracker.formatTime] Error:",P),"00:00:00"}},[]),m=u.useMemo(()=>x(d),[d,x]),N=u.useMemo(()=>Math.ceil(d/60)/60*a,[d,a]),S=u.useCallback(()=>{if(n){console.log("[useTimeTracker] Timer already active");return}i(!0),console.log("[useTimeTracker] Timer started")},[n]),w=u.useCallback(()=>{if(!n){console.log("[useTimeTracker] Timer already paused");return}i(!1),console.log(`[useTimeTracker] Timer paused at ${x(d)}`)},[n,d,x]),T=u.useCallback(async()=>{try{if(d<ae){p(0),i(!1),o.info(`Time entry ignored (less than ${ae/60} minute).`),console.log(`[useTimeTracker] Entry ignored: ${d}s < ${ae}s`);return}const f=Math.ceil(d/60),P=f/60*a;if(!g(l)||!c(s)||!h(a)){o.error("Invalid configuration. Please check case ID, user ID, and rate.");return}const $={id:`t-${Date.now()}`,caseId:l,userId:s,date:new Date().toISOString().split("T")[0],duration:f,description:"General Administrative Task (Auto-Logged)",rate:a,total:P,status:"Unbilled",billable:!0};console.log("[useTimeTracker] Creating time entry:",$),await A.billing.addTimeEntry($),p(0),i(!1),o.success(`Logged ${f} minutes to Billing.`),console.log(`[useTimeTracker] Time entry created successfully: ${$.id}`)}catch(f){console.error("[useTimeTracker.stop] Error creating time entry:",f),o.error("Failed to log time entry. Please try again.")}},[d,l,s,a,g,c,h,o]),y=u.useCallback(()=>{p(0),i(!1),console.log("[useTimeTracker] Timer reset")},[]);return{isActive:n,seconds:d,formattedTime:m,billableAmount:N,caseId:l,userId:s,rate:a,start:S,pause:w,stop:T,reset:y}}function Hs(r={}){const{maxItems:l=10,updateInterval:s=1e3,slaWindowDays:a=5}=r,[o,n]=u.useState([]),{data:i=[],isLoading:d}=E(R.tasks.all(),()=>A.tasks.getAll()),p=u.useCallback(g=>{const c=Date.now(),x=a*24*60*60*1e3,m=g-x,N=c-m,S=Math.min(100,Math.max(0,N/x*100)),w=g-c,T=w/(1e3*60*60);let y="On Track";return w<0?y="Breached":T<24&&(y="At Risk"),{status:y,progress:S}},[a]);u.useEffect(()=>{const g=i||[];if(g.length>0){const c=g.filter(x=>x.dueDate&&x.status!=="Completed").map(x=>{const m=new Date(x.dueDate).getTime(),{status:N,progress:S}=p(m);return{id:x.id,task:x.title,dueTime:m,status:N,progress:S}}).slice(0,l);n(c)}},[i,l,p]),bs(()=>{n(g=>g.map(c=>({...c,...p(c.dueTime)})))},s);const h=u.useCallback(g=>{const c=Date.now(),x=g-c;if(x<0)return`${Math.floor(Math.abs(x)/36e5)}h ago`;const m=Math.floor(x/(1e3*60*60)),N=Math.floor(x%(1e3*60*60)/(1e3*60));return m<24?`${m}h ${N}m`:`${Math.floor(m/24)}d ${m%24}h`},[]);return{slas:o,isLoading:d,formatDeadline:h}}const Xs=({isOpen:r,onClose:l,onAddNode:s})=>{const{theme:a}=C(),o=(n,i)=>{n.dataTransfer.setData("application/reactflow",i),n.dataTransfer.effectAllowed="move"};return e.jsx("div",{className:t("absolute md:static inset-y-0 left-0 w-64 border-r z-10 transition-transform duration-300 shadow-xl md:shadow-none flex flex-col",a.surface.default,a.border.default,r?"translate-x-0":"-translate-x-full md:translate-x-0 md:w-16 lg:w-64"),children:e.jsxs("div",{className:"p-4 h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 md:hidden lg:flex",children:[e.jsx("h4",{className:t("font-bold text-xs uppercase tracking-wider",a.text.tertiary),children:"Components"}),e.jsx("button",{onClick:l,className:"md:hidden",children:e.jsx(ke,{className:t("h-4 w-4",a.text.tertiary)})})]}),e.jsx("div",{className:"space-y-3 flex-1 overflow-y-auto",children:[{type:"Task",desc:"Action or Assignment"},{type:"Decision",desc:"Conditional Branch"},{type:"Delay",desc:"Time-based Wait"},{type:"Parallel",desc:"Split Execution"},{type:"End",desc:"Terminate Flow"}].map(n=>e.jsxs("div",{draggable:!0,onDragStart:i=>o(i,n.type),onClick:()=>s(n.type),className:t("w-full flex items-center gap-3 p-3 border rounded-lg transition-all group cursor-grab active:cursor-grabbing hover:shadow-md hover:-translate-y-0.5",a.surface.default,a.border.default,`hover:${a.primary.border}`),children:[e.jsx("div",{className:t("group-hover:text-slate-400",a.text.tertiary),children:e.jsx(Ve,{className:"h-4 w-4"})}),e.jsx("div",{className:t("p-2 rounded-md shadow-sm border",a.surface.default,a.border.default),children:Ie(n.type)}),e.jsxs("div",{className:"md:hidden lg:block",children:[e.jsx("span",{className:t("text-sm font-bold block",a.text.primary),children:n.type}),e.jsx("span",{className:t("text-[10px] block",a.text.secondary),children:n.desc})]})]},n.type))}),e.jsx("div",{className:t("mt-4 pt-4 border-t md:hidden lg:block",a.border.default),children:e.jsxs("div",{className:t("p-3 rounded-lg text-xs border",a.status.info.bg,a.status.info.border,a.status.info.text),children:[e.jsx("strong",{children:"Designer Tip:"})," Drag components onto the grid. Hold ",e.jsx("strong",{children:"Space"})," to pan."]})})]})})},Ks=({isOpen:r,onClose:l,selectedNode:s,onUpdateNode:a,onDeleteNode:o})=>{const{theme:n}=C(),i=Cs(),[d,p]=ne.useState(null),h=()=>{s&&(p(s.id),i.open())},g=()=>{d&&(o(d),p(null),l())};return e.jsxs("div",{className:t("absolute md:static inset-y-0 right-0 w-80 border-l z-30 shadow-2xl md:shadow-none transition-transform duration-300",n.surface.default,n.border.default,r?"translate-x-0":"translate-x-full md:hidden"),children:[e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:t("p-4 border-b flex justify-between items-center",n.border.default,n.surface.highlight),children:[e.jsxs("h4",{className:t("font-bold text-sm flex items-center",n.text.primary),children:[e.jsx(F,{className:"h-4 w-4 mr-2"})," Configuration"]}),e.jsx("button",{onClick:l,className:t(n.text.tertiary,`hover:${n.text.primary}`),children:e.jsx(ke,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:t("block text-xs font-semibold uppercase mb-1.5",n.text.secondary),children:"Label / Name"}),e.jsx(be,{value:s.label,onChange:c=>a(s.id,{label:c.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:t("block text-xs font-semibold uppercase mb-1.5",n.text.secondary),children:"Component Type"}),e.jsxs("div",{className:t("flex items-center gap-2 p-2 rounded border text-sm",n.surface.highlight,n.border.default,n.text.secondary),children:[Ie(s.type),s.type]})]}),s.type==="Task"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:t("block text-xs font-semibold uppercase mb-1.5",n.text.secondary),children:"Assignee Role"}),e.jsxs("select",{className:t("w-full px-3 py-2 border rounded-md text-sm outline-none",n.surface.default,n.border.default,n.text.primary,"focus:ring-2 focus:ring-blue-500"),value:String(s.config.assignee||""),onChange:c=>a(s.id,{config:{...s.config,assignee:c.target.value}}),children:[e.jsx("option",{value:"",children:"Select Role..."}),e.jsx("option",{value:"Senior Partner",children:"Senior Partner"}),e.jsx("option",{value:"Associate",children:"Associate"}),e.jsx("option",{value:"Paralegal",children:"Paralegal"}),e.jsx("option",{value:"Finance",children:"Finance"}),e.jsx("option",{value:"System",children:"System (Automated)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:t("block text-xs font-semibold uppercase mb-1.5",n.text.secondary),children:"SLA (Hours)"}),e.jsx(be,{type:"number",value:String(s.config.sla||""),onChange:c=>a(s.id,{config:{...s.config,sla:c.target.value}})})]})]}),e.jsx(ws,{label:"Description / Logic Instructions",rows:4,placeholder:"Describe what needs to happen in this step...",value:String(s.config.description||""),onChange:c=>a(s.id,{config:{...s.config,description:c.target.value}})}),e.jsx("div",{className:t("pt-4 border-t",n.border.default),children:e.jsx(v,{variant:"danger",size:"sm",icon:Ye,onClick:h,className:"w-full",children:"Delete Node"})})]}):e.jsxs("div",{className:t("text-center py-10",n.text.tertiary),children:[e.jsx(qe,{className:"h-12 w-12 mx-auto mb-2 opacity-20"}),e.jsx("p",{className:"text-sm",children:"Select a node on the canvas to configure it."})]})})]}),e.jsx(ks,{isOpen:i.isOpen,onClose:i.close,onConfirm:g,title:"Delete Workflow Node",message:`Are you sure you want to delete the node "${s?.label||"Untitled"}"? This will also remove any connections to this node.`,variant:"danger",confirmText:"Delete Node"})]})},Vs=({caseId:r,onAction:l})=>e.jsxs("div",{className:"flex gap-1",onClick:s=>s.stopPropagation(),children:[e.jsx(v,{size:"sm",variant:"ghost",className:"h-8 px-2 text-slate-500 hover:text-green-600",title:"Start Next Task",onClick:()=>l("start"),children:e.jsx(B,{className:"h-4 w-4"})}),e.jsx(v,{size:"sm",variant:"ghost",className:"h-8 px-2 text-slate-500 hover:text-amber-600",title:"Pause Workflow",onClick:()=>l("pause"),children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(v,{size:"sm",variant:"ghost",className:"h-8 px-2 text-slate-500 hover:text-blue-600",title:"Skip Step",onClick:()=>l("skip"),children:e.jsx(Qe,{className:"h-4 w-4"})}),e.jsx(v,{size:"sm",variant:"ghost",className:"h-8 px-2 text-slate-500 hover:text-purple-600",title:"Log Completion",onClick:()=>l("log"),children:e.jsx(Ce,{className:"h-4 w-4"})})]}),Ys=()=>(console.warn("getProcessIcon is deprecated. Use <ProcessIcon processName={...} /> instead."),null),qs=(r,l)=>{const s=l.filter(o=>o.caseId===r);if(s.length===0)return 0;const a=s.filter(o=>o.status===W.COMPLETED).length;return Math.round(a/s.length*100)},Qs=(r,l)=>{const s=l.filter(a=>a.caseId===r&&a.status!==W.COMPLETED&&a.status!==W.CANCELLED);return s.length===0?"All tasks completed":(s.sort((a,o)=>{const n=a.dueDate?new Date(a.dueDate).getTime():0,i=o.dueDate?new Date(o.dueDate).getTime():0;return n-i}),s[0].title)},Zs=({cases:r,tasks:l,onSelectCase:s,onManageWorkflow:a})=>{const{theme:o}=C();return!r||r.length===0?e.jsx(ee,{title:"No Active Case Workflows",description:"There are no cases with active workflows at the moment. Start a new case to see it here.",icon:oe}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:r.map(n=>{const i=qs(n.id,l);return e.jsxs("div",{className:t("rounded-lg border shadow-sm p-5 transition-all group relative",o.surface.default,o.border.default,`hover:shadow-md hover:${o.primary.border}`),children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4 cursor-pointer",onClick:()=>s(n.id),children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:t("p-2 rounded-lg",i===100?"bg-green-100 text-green-600":"bg-blue-100 text-blue-600"),children:e.jsx(Te,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h4",{className:t("font-bold text-lg transition-colors",o.text.primary,`group-hover:${o.primary.text}`),children:n.title}),e.jsxs("div",{className:t("flex items-center gap-3 text-xs mt-1",o.text.secondary),children:[e.jsx("span",{className:t("font-mono px-1 rounded",o.surface.highlight),children:n.id}),e.jsx(Y,{variant:"neutral",children:n.matterType}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(Ze,{className:"h-3 w-3 mr-1"})," ",n.client]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{variant:i===100?"success":"info",children:n.status}),e.jsx(Je,{className:t("h-5 w-5",o.text.tertiary,`group-hover:${o.text.secondary}`)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:t("flex justify-between text-xs mb-1",o.text.secondary),children:[e.jsx("span",{className:"font-medium",children:"Stage Progress"}),e.jsxs("span",{className:t("font-bold",o.text.primary),children:[i,"%"]})]}),e.jsx("div",{className:t("w-full rounded-full h-2",o.surface.highlight),children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-1000 ${i===100?"bg-green-500":o.primary.DEFAULT}`,style:{"--progress-width":`${i}%`}})})]}),e.jsxs("div",{className:t("p-3 rounded border flex items-center justify-between",o.surface.highlight,o.border.default),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[i===100?e.jsx(ce,{className:"h-5 w-5 text-green-500"}):e.jsx(z,{className:"h-5 w-5 text-amber-500"}),e.jsxs("div",{children:[e.jsx("p",{className:t("text-xs font-bold uppercase",o.text.secondary),children:"Current Step"}),e.jsx("p",{className:t("text-sm font-semibold",o.text.primary),children:Qs(n.id,l)})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Vs,{caseId:n.id,onAction:d=>console.log(d,n.id)}),a&&e.jsx("button",{onClick:d=>{d.stopPropagation(),a(n.id)},className:t("p-1 rounded transition-colors ml-1",o.text.tertiary,`hover:${o.primary.text}`,`hover:${o.surface.default}`),title:"Manage Workflow Engine",children:e.jsx(F,{className:"h-4 w-4"})})]})]})]})]},n.id)})})},Js=({theme:r})=>e.jsxs("h3",{className:t("font-bold mb-4 flex items-center justify-between",r.text.primary),children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(z,{className:"h-5 w-5 mr-2 text-blue-600"})," SLA Live Monitor"]}),e.jsx("span",{className:"flex h-2 w-2 rounded-full bg-green-500 animate-pulse",title:"Live Tracking"})]}),et=({sla:r,formatDeadline:l,theme:s})=>{const a={Breached:`${s.status.error.bg} ${s.status.error.text}`,"At Risk":`${s.status.warning.bg} ${s.status.warning.text}`,"On Track":`${s.status.success.bg} ${s.status.success.text}`},o={Breached:"bg-red-500","At Risk":"bg-amber-500","On Track":"bg-green-500"};return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:t("font-medium truncate max-w-[200px]",s.text.primary),children:r.task}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded uppercase ${a[r.status]}`,children:r.status}),e.jsx("span",{className:t("text-xs font-mono w-20 text-right font-bold",r.status==="Breached"?"text-red-600":s.text.secondary),children:l(r.dueTime)})]})]}),e.jsx("div",{className:t("w-full rounded-full h-1.5 overflow-hidden",s.surface.highlight),children:e.jsx("div",{className:`h-full rounded-full transition-all duration-1000 ${o[r.status]}`,style:{width:`${r.progress}%`}})})]})},st=({slas:r,formatDeadline:l,theme:s})=>r.length===0?e.jsx("div",{className:"text-center text-xs text-slate-400 py-4",children:"No active SLAs being tracked."}):e.jsx("div",{className:"space-y-4",children:r.map(a=>e.jsx(et,{sla:a,formatDeadline:l,theme:s},a.id))}),Me=()=>{const{theme:r}=C(),{slas:l,isLoading:s,formatDeadline:a}=Hs();return s?e.jsx("div",{className:"flex justify-center p-6",children:e.jsx(O,{className:"animate-spin text-blue-600"})}):e.jsxs("div",{className:t("rounded-lg border p-4 shadow-sm",r.surface.default,r.border.default),children:[e.jsx(Js,{theme:r}),e.jsx(st,{slas:l,formatDeadline:a,theme:r})]})},Re=()=>{const{theme:r}=C(),{data:l=[],isLoading:s}=E(R.logs.all(),A.admin.getLogs),a=ne.useMemo(()=>l.map(i=>({id:i.id,timestamp:new Date(i.timestamp).toLocaleString(),user:i.user,action:i.action,detail:i.resource,type:i.action.includes("DELETE")?"warning":"info"})),[l]),o=()=>Pe.invalidate(R.logs.all()),n=i=>e.jsxs("div",{className:t("relative pl-6 pb-2 border-l-2 last:border-0 last:pb-0 h-16 pr-4",r.border.default),children:[e.jsx("div",{className:t("absolute -left-[9px] top-2 h-4 w-4 rounded-full border-2 border-white flex items-center justify-center",i.type==="success"?"bg-green-500":i.type==="warning"?"bg-amber-500":"bg-blue-500"),children:i.type==="success"?e.jsx(ss,{className:"h-2 w-2 text-white"}):i.type==="warning"?e.jsx(ts,{className:"h-2 w-2 text-white"}):e.jsx(de,{className:"h-2 w-2 text-white"})}),e.jsxs("div",{className:"flex justify-between items-start pt-1",children:[e.jsxs("div",{children:[e.jsx("p",{className:t("text-sm font-semibold",r.text.primary),children:i.action}),e.jsx("p",{className:t("text-xs",r.text.secondary),children:i.detail})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:t("text-[10px] font-mono",r.text.tertiary),children:i.timestamp}),e.jsx("p",{className:t("text-[10px] font-medium",r.text.secondary),children:i.user})]})]})]},i.id);return e.jsxs("div",{className:t("rounded-lg border overflow-hidden flex flex-col h-full",r.surface.default,r.border.default),children:[e.jsxs("div",{className:t("p-4 border-b flex justify-between items-center shrink-0",r.surface.highlight,r.border.default),children:[e.jsxs("h3",{className:t("font-bold flex items-center",r.text.primary),children:[e.jsx(es,{className:t("h-4 w-4 mr-2",r.text.tertiary)})," Workflow Audit Trail"]}),e.jsxs("button",{onClick:o,className:t("text-xs hover:underline flex items-center",r.primary.text),children:[e.jsx(re,{className:"h-3 w-3 mr-1"})," Refresh"]})]}),e.jsx("div",{className:"flex-1 relative min-h-[300px]",children:s?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(O,{className:"animate-spin text-blue-600"})}):e.jsx(ys,{items:a,height:"100%",itemHeight:64,renderItem:n,emptyMessage:"No audit logs available."})})]})},tt=({status:r})=>{const{theme:l}=C();let s=t(l.status.neutral.bg,l.status.neutral.text,l.status.neutral.border);switch(r){case"In Progress":s=t(l.status.info.bg,l.status.info.text,l.status.info.border);break;case"Review":s=t(l.status.warning.bg,l.status.warning.text,l.status.warning.border);break;case"Done":s=t(l.status.success.bg,l.status.success.text,l.status.success.border);break;case"Pending":s=t(l.surface.highlight,l.text.tertiary,l.border.default);break}return e.jsx("span",{className:t("text-[10px] uppercase font-bold px-2 py-0.5 rounded border",s),children:r})},We=()=>{const{theme:r}=C(),{data:l=[],isLoading:s}=E(R.tasks.all(),()=>A.tasks.getAll()),o=(Array.isArray(l)?l:[]).filter(n=>n.status===W.IN_PROGRESS||n.status===W.TODO).slice(0,4);return s?e.jsx(me,{contentType:"list",shimmer:!0,itemCount:4}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:t("font-bold flex items-center",r.text.primary),children:[e.jsx(as,{className:"h-5 w-5 mr-2 text-indigo-600"})," Parallel Execution Tracks"]}),e.jsxs("span",{className:"text-xs bg-indigo-50 text-indigo-700 px-2 py-1 rounded border border-indigo-100 font-medium",children:[o.length," Active Tracks"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:o.length===0?e.jsx("div",{className:"col-span-3",children:e.jsx(ee,{icon:rs,title:"No parallel tasks",description:"No parallel execution tracks are currently active."})}):o.map(n=>e.jsxs("div",{className:t("p-4 rounded-lg border shadow-sm relative overflow-hidden group hover:shadow-md transition-all",r.surface.default,r.border.default),children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-indigo-500"}),e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("span",{className:t("text-[10px] uppercase font-bold tracking-wider truncate max-w-[100px]",r.text.tertiary),children:[n.relatedModule||"General"," Track"]}),e.jsx("button",{type:"button","aria-label":"Task options",className:t(r.text.tertiary,`hover:${r.text.primary}`),children:e.jsx(Ae,{className:"h-4 w-4"})})]}),e.jsx("h4",{className:t("font-bold text-sm mb-3",r.text.primary),children:n.title}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:t("flex items-center text-xs",r.text.secondary),children:[e.jsx(de,{className:"h-3 w-3 mr-1"})," ",n.assignee]}),e.jsx(tt,{status:n.status})]})]},n.id))})]})},Be=()=>{const{theme:r}=C(),{data:l=[],isLoading:s}=E(R.tasks.all(),()=>A.tasks.getAll()),a=Array.isArray(l)?l:[],o=ne.useMemo(()=>{const n=a.filter(d=>d.dependencies&&d.dependencies.length>0);return n.length>0?n.slice(0,5).map(d=>{const p=d.status==="Done"||d.status==="Completed",h=d.status==="In Progress";return{...d,type:p?"completed":h?"active":"locked"}}):[...a].filter(d=>d.status!=="Done"&&d.status!=="Completed").sort((d,p)=>new Date(d.dueDate).getTime()-new Date(p.dueDate).getTime()).slice(0,5).map((d,p)=>{const h=d.status==="Done"||d.status==="Completed";return{...d,type:h?"completed":p===0?"active":"locked"}})},[a]);return s?e.jsx(me,{contentType:"list",shimmer:!0,itemCount:4}):e.jsxs("div",{className:"space-y-4 max-w-lg mx-auto py-4",children:[e.jsx("h3",{className:t("font-bold text-center mb-6",r.text.primary),children:"Task Dependency Chain"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:t("absolute left-6 top-8 bottom-8 w-0.5 -z-10",r.border.default)}),o.map((n,i)=>e.jsxs("div",{className:"flex items-center gap-4 mb-6 last:mb-0",children:[e.jsxs("div",{className:t("w-12 h-12 rounded-full border-2 flex items-center justify-center shrink-0 z-10",n.type==="completed"?"bg-green-100 border-green-500":n.type==="active"?"bg-blue-100 border-blue-500":"bg-slate-50 border-slate-300"),children:[n.type==="completed"&&e.jsx(Ce,{className:"h-6 w-6 text-green-600"}),n.type==="active"&&e.jsx("span",{className:"font-bold text-blue-700",children:i+1}),n.type==="locked"&&e.jsx(ls,{className:"h-5 w-5 text-slate-400"})]}),e.jsxs("div",{className:t("p-3 rounded-lg border shadow-sm flex-1",r.surface.default,r.border.default,n.type==="active"?"ring-2 ring-blue-100":n.type==="locked"?"opacity-75":""),children:[e.jsx("p",{className:t("font-bold text-sm",n.type==="completed"?"line-through opacity-50":r.text.primary),children:n.title}),e.jsx("p",{className:t("text-xs font-medium",n.type==="completed"?"text-green-600":n.type==="active"?"text-blue-600":r.text.tertiary),children:n.type==="completed"?"Completed":n.type==="active"?"In Progress":`Blocked by Task ${i}`})]})]},n.id))]})]})},at=({isActive:r,formattedTime:l,theme:s})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:t("p-2 rounded-full",r?"animate-pulse bg-green-100 text-green-600":s.primary.light),children:e.jsx(z,{className:t("h-5 w-5",r?"text-green-600":s.primary.text)})}),e.jsxs("div",{children:[e.jsx("p",{className:t("text-xs font-bold uppercase",s.text.secondary),children:"Active Task Timer"}),e.jsx("p",{className:t("text-xl font-mono font-bold tracking-wider",s.text.primary),children:l})]})]}),rt=({isActive:r,seconds:l,onStart:s,onPause:a,onStop:o})=>e.jsxs("div",{className:"flex gap-2",children:[r?e.jsx("button",{onClick:a,className:"p-2 bg-amber-600 hover:bg-amber-700 rounded-full transition-colors text-white","aria-label":"Pause timer",children:e.jsx(ie,{className:"h-5 w-5 fill-current"})}):e.jsx("button",{onClick:s,className:"p-2 bg-green-600 hover:bg-green-700 rounded-full transition-colors text-white","aria-label":"Start timer",children:e.jsx(B,{className:"h-5 w-5 fill-current"})}),l>0&&!r&&e.jsx("button",{onClick:o,className:"p-2 bg-red-600 hover:bg-red-700 rounded-full transition-colors text-white","aria-label":"Stop and save",children:e.jsx(ns,{className:"h-5 w-5 fill-current"})})]}),lt=()=>{const{theme:r}=C(),{isActive:l,seconds:s,formattedTime:a,start:o,pause:n,stop:i}=Us();return e.jsxs("div",{className:t("rounded-lg p-4 shadow-md flex items-center justify-between border",r.surface.default,r.border.default),children:[e.jsx(at,{isActive:l,formattedTime:a,theme:r}),e.jsx(rt,{isActive:l,seconds:s,onStart:o,onPause:n,onStop:i})]})},nt=({requests:r,onApprove:l,onReject:s})=>{const{theme:a}=C(),{data:o=[]}=E(R.workflowsExtended.approvals(),()=>A.workflow.getApprovals(),{enabled:!r}),n=r||o;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:t("font-bold flex items-center",a.text.primary),children:[e.jsx(Se,{className:"h-5 w-5 mr-2 text-purple-600"})," Pending Approvals"]}),n.length===0?e.jsx("div",{className:t("text-center p-6 rounded-lg border",a.surface.highlight,a.border.default,a.text.secondary),children:"No pending approvals required."}):n.map(i=>e.jsx(I,{noPadding:!0,className:"border-l-4 border-l-purple-500",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:t("font-bold",a.text.primary),children:i.title}),e.jsxs("div",{className:t("flex items-center text-xs mt-1",a.text.secondary),children:[e.jsx(de,{className:"h-3 w-3 mr-1"})," ",i.requester,e.jsx("span",{className:"mx-2",children:"•"}),e.jsx(z,{className:"h-3 w-3 mr-1"})," ",i.date]})]}),e.jsx("span",{className:t("text-xs px-2 py-1 rounded font-bold",i.priority==="High"?`${a.status.error.bg} ${a.status.error.text}`:`${a.status.info.bg} ${a.status.info.text}`),children:i.priority})]}),e.jsx("p",{className:t("text-sm p-3 rounded border mb-4",a.surface.highlight,a.border.default,a.text.primary),children:i.description}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsxs(v,{size:"sm",variant:"ghost",className:"text-red-600 hover:bg-red-50",onClick:()=>s(i.id),children:[e.jsx(is,{className:"h-4 w-4 mr-1"})," Reject"]}),e.jsxs(v,{size:"sm",variant:"primary",className:"bg-purple-600 hover:bg-purple-700 border-transparent",onClick:()=>l(i.id),children:[e.jsx(ce,{className:"h-4 w-4 mr-1"})," Approve"]})]})]})},i.id))]})},it=["tasks","dependencies","approvals","history"],ot={tasks:We,dependencies:Be,approvals:nt,history:Re},ct=()=>e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(Me,{})}),e.jsx("div",{children:e.jsx(lt,{})})]}),dt=({activeTab:r,onApprove:l,onReject:s})=>{const a=ot[r];return r==="approvals"?e.jsx(a,{onApprove:l,onReject:s}):e.jsx(a,{})},xt=()=>{const{theme:r}=C(),[l,s]=u.useState("tasks"),a=i=>alert(`Approved ${i}`),o=i=>alert(`Rejected ${i}`),n=i=>s(i);return e.jsxs("div",{className:"h-full flex flex-col space-y-6",children:[e.jsx(ct,{}),e.jsxs("div",{className:t("rounded-lg border shadow-sm flex flex-col flex-1 overflow-hidden",r.surface.default,r.border.default),children:[e.jsx("div",{className:t("p-4 border-b",r.border.default),children:e.jsx(ue,{tabs:it,activeTab:l,onChange:n})}),e.jsx("div",{className:t("p-6 overflow-y-auto flex-1",r.surface.highlight),children:e.jsx(dt,{activeTab:l,onApprove:a,onReject:o})})]})]})},Oe=({initialTemplate:r,onBack:l})=>{const{theme:s}=C(),a=q(),{nodes:o,connections:n,addNode:i,updateNode:d,deleteNode:p}=_s(r),[h,g]=u.useState(null),[c,x]=u.useState(1),[m,N]=u.useState({x:0,y:0}),S=ye(!0),w=ye(!0),[T,y]=u.useState(!1),[f,P]=u.useState(null),[$,_]=u.useState({x:0,y:0}),M=u.useRef(null),se=u.useCallback(b=>{b.preventDefault();const k=b.dataTransfer.getData("application/reactflow");if(!k||!M.current)return;const L=M.current.getBoundingClientRect(),D=(b.clientX-L.left-m.x)/c-75,X=(b.clientY-L.top-m.y)/c-40,K=i(k,D,X);g(K),w.open()},[m.x,m.y,c,i,w]),G=u.useCallback(b=>{if(f&&M.current){const k=M.current.getBoundingClientRect(),L=(b.clientX-k.left-m.x)/c-$.x,D=(b.clientY-k.top-m.y)/c-$.y;d(f,{x:L,y:D})}},[f,$,c,m,d]),Q=(b,k)=>{b.stopPropagation();const L=o.find(D=>D.id===k);if(L&&M.current){const D=M.current.getBoundingClientRect(),X=(b.clientX-D.left-m.x)/c,K=(b.clientY-D.top-m.y)/c;_({x:X-L.x,y:K-L.y}),P(k),g(k),w.open()}},U=async()=>{y(!0);try{const b={id:r?.id||`wt-${Date.now()}`,title:r?.title||"New Workflow Draft",category:"Custom",complexity:"Medium",duration:"2 Weeks",tags:["Draft"],auditReady:!1,stages:o.filter(k=>k.type==="Task").map(k=>k.label)};await A.workflow.saveTemplate(b),a.success("Workflow template saved.")}catch(b){console.error(b),a.error("Failed to save template.")}finally{y(!1)}},H=async()=>{if(!r?.id){a.error("Please save the template first.");return}y(!0);try{await A.workflow.deploy(r.id),a.success("Workflow deployed successfully.")}catch(b){console.error(b),a.error("Failed to deploy workflow.")}finally{y(!1)}};return e.jsx($e,{scope:"WorkflowTemplateBuilder",children:e.jsxs("div",{className:t("h-full flex flex-col animate-fade-in",s.background),children:[e.jsx("div",{className:"px-6 pt-6 shrink-0",children:e.jsx(Ee,{title:r?"Editing Template":"New Workflow Draft",actions:e.jsxs("div",{className:"flex gap-2",children:[l&&e.jsx(v,{variant:"ghost",onClick:l,icon:xe,children:"Back"}),e.jsx(v,{variant:"secondary",icon:T?O:os,onClick:U,disabled:T,children:T?"Saving...":"Save Draft"}),e.jsx(v,{variant:"primary",icon:cs,onClick:H,disabled:T,children:"Deploy"})]})})}),e.jsx("div",{className:"flex-1 overflow-hidden pb-6 min-h-0",children:e.jsxs("div",{className:t("h-full border-t flex flex-col relative",s.border.default),children:[e.jsx(vs,{scale:c,setScale:x,onToggleSidebar:S.toggle}),e.jsxs("div",{className:"flex-1 flex overflow-hidden relative",onDrop:se,onDragOver:b=>b.preventDefault(),onMouseMove:G,onMouseUp:()=>P(null),children:[e.jsx(Xs,{isOpen:S.isOpen,onClose:S.close,onAddNode:b=>{const k=(M.current?.clientWidth||800)/2/c-m.x/c-75,L=(M.current?.clientHeight||600)/2/c-m.y/c-40,D=i(b,k,L);g(D)}}),e.jsx(Ns,{nodes:o,connections:n,selectedNodeId:h,scale:c,pan:m,setPan:N,canvasRef:M,onMouseDownNode:Q,onBackgroundClick:()=>g(null),selectedConnectionId:null,onSelectConnection:()=>{},onAddConnection:()=>{}}),e.jsx(Ks,{isOpen:w.isOpen,onClose:w.close,selectedNode:o.find(b=>b.id===h)||null,onUpdateNode:d,onDeleteNode:p})]})]})})]})})},mt={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"},ut=({message:r,size:l="md",centered:s=!0,className:a})=>e.jsxs("div",{className:t("flex flex-col items-center gap-3",s&&"justify-center p-10",a),children:[e.jsx(O,{className:t("animate-spin text-blue-600",mt[l])}),r&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:r})]}),Fe=()=>{const{mode:r}=C(),{data:l={completion:[],status:[]},isLoading:s}=E(R.workflowsExtended.analytics(),()=>A.workflow.getAnalytics()),a=Ts(r),o=Ds(a),n=Ss(a),i=Ls(a);return s?e.jsx(ut,{message:"Loading analytics..."}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(I,{title:"Task Completion Velocity",children:e.jsx(ve,{width:"100%",height:256,children:e.jsxs($s,{data:l.completion,margin:As,children:[e.jsx(Es,{...n}),e.jsx(Ps,{dataKey:"name",...o}),e.jsx(Is,{...o}),e.jsx(Ne,{...i}),e.jsx(Ms,{dataKey:"completed",fill:a.colors.primary,radius:[4,4,0,0]})]})})}),e.jsx(I,{title:"SLA Health Status",children:e.jsx(ve,{width:"100%",height:256,children:e.jsxs(Rs,{children:[e.jsx(Ws,{data:l.status,innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:l.status.map((d,p)=>e.jsx(Bs,{fill:d.color},`cell-${p}`))}),e.jsx(Ne,{...i}),e.jsx(Os,{verticalAlign:"bottom",height:36,iconType:"circle"})]})})})]})},ht=({processId:r,onBack:l})=>{const{theme:s}=C(),[a,o]=u.useState("overview"),{data:n,isLoading:i,isError:d,refetch:p}=E(["process",r],()=>A.workflow.getProcessDetails(r));return i?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(O,{className:"h-8 w-8 animate-spin text-blue-600"})}):d||!n?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[e.jsx(he,{title:"Process Not Found",message:"Could not load process details.",onRetry:p}),e.jsx(v,{variant:"ghost",onClick:l,className:"mt-4",children:"Go Back"})]}):e.jsxs("div",{className:"flex flex-col h-full space-y-4 md:space-y-6 animate-fade-in min-h-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:l,className:t("p-2 rounded-full transition-colors border border-transparent",s.text.secondary,`hover:${s.surface.highlight}`,`hover:${s.border.default}`),children:e.jsx(xe,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:t("text-xl md:text-2xl font-bold",s.text.primary),children:n.name}),e.jsxs("p",{className:t("text-sm",s.text.secondary),children:["Process ID: ",r," • Owner: ",n.owner]})]})]}),e.jsx("div",{className:"flex gap-2 w-full md:w-auto",children:e.jsx(v,{variant:"primary",icon:B,className:"flex-1 md:flex-none",children:"Run Manual Instance"})})]}),e.jsx(ue,{tabs:["overview","designer","instances","analytics"],activeTab:a,onChange:h=>o(h)}),e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col min-h-0",children:[a==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 overflow-y-auto pb-6 h-full",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(I,{title:"Process Definition",children:e.jsxs("div",{className:t("prose prose-sm max-w-none",s.text.secondary),children:[e.jsx("p",{children:n.description||"No description available."}),e.jsx("h4",{className:t("font-bold mt-4",s.text.primary),children:"Triggers"}),e.jsx("ul",{className:"list-disc pl-5",children:e.jsx("li",{children:n.triggers||"Manual Trigger"})})]})}),e.jsx(I,{title:"Recent Executions",children:e.jsx("div",{className:"space-y-2",children:[1,2,3].map(h=>e.jsxs("div",{className:t("flex justify-between items-center p-3 border rounded-lg",s.border.default,`hover:${s.surface.highlight}`),children:[e.jsxs("div",{children:[e.jsxs("p",{className:t("font-bold text-sm",s.text.primary),children:["Instance #",2040+h," - ",n.name," Run"]}),e.jsxs("p",{className:t("text-xs",s.text.secondary),children:["Started: ",h*2," hours ago"]})]}),e.jsx("span",{className:t("px-2 py-1 text-xs rounded-full font-bold",s.status.info.bg,s.status.info.text),children:"Running"})]},h))})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(I,{title:"Owner & Roles",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:t("h-10 w-10 rounded-full flex items-center justify-center font-bold",s.surface.highlight,s.text.secondary),children:n.owner.substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:t("font-bold text-sm",s.text.primary),children:n.owner}),e.jsx("p",{className:t("text-xs",s.text.secondary),children:"Process Owner"})]})]}),e.jsxs("div",{className:t("text-sm space-y-2 border-t pt-3",s.text.secondary,s.border.default),children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Approvers:"})," ",e.jsx("span",{className:"font-medium",children:"Partners"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Executors:"})," ",e.jsx("span",{className:"font-medium",children:"Paralegals"})]})]})]}),e.jsx(I,{title:"SLA Config",children:e.jsxs("div",{className:"text-sm space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Target Duration:"})," ",e.jsx("span",{className:"font-bold",children:n.sla||"48 Hours"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Critical Step:"})," ",e.jsx("span",{className:"font-bold",children:"Conflict Check"})]})]})})]})]}),a==="designer"&&e.jsx("div",{className:"flex-1 h-full min-h-[500px]",children:e.jsx(Oe,{})}),a==="instances"&&e.jsx("div",{className:t("rounded-lg border shadow-sm flex-1 overflow-auto",s.surface.default,s.border.default),children:e.jsxs("table",{className:t("min-w-full divide-y",s.border.default),children:[e.jsx("thead",{className:t("sticky top-0",s.surface.highlight),children:e.jsxs("tr",{children:[e.jsx("th",{className:t("px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",s.text.secondary),children:"Instance ID"}),e.jsx("th",{className:t("px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",s.text.secondary),children:"Subject"}),e.jsx("th",{className:t("px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",s.text.secondary),children:"Start Date"}),e.jsx("th",{className:t("px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",s.text.secondary),children:"Status"}),e.jsx("th",{className:t("px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",s.text.secondary),children:"Current Step"})]})}),e.jsx("tbody",{className:t("divide-y",s.surface.default,s.border.default),children:[1,2,3,4,5].map(h=>e.jsxs("tr",{children:[e.jsxs("td",{className:t("px-6 py-4 whitespace-nowrap text-sm font-mono",s.text.secondary),children:["BP-",2040+h]}),e.jsx("td",{className:t("px-6 py-4 whitespace-nowrap text-sm font-medium",s.text.primary),children:"Client Onboarding: Acme Corp"}),e.jsxs("td",{className:t("px-6 py-4 whitespace-nowrap text-sm",s.text.secondary),children:["2024-03-",10+h]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:t("px-2 inline-flex text-xs leading-5 font-semibold rounded-full",h===2?s.status.error.bg+" "+s.status.error.text:s.status.success.bg+" "+s.status.success.text),children:h===2?"Stalled":"Active"})}),e.jsx("td",{className:t("px-6 py-4 whitespace-nowrap text-sm",s.text.secondary),children:h===2?"Conflict Resolution":"Engagement Letter"})]},h))})]})}),a==="analytics"&&e.jsx(Fe,{})]})]})},ft=({processes:r,onSelectProcess:l})=>{const{theme:s}=C();return!r||r.length===0?e.jsx(ee,{title:"No Firm Processes",description:"There are no active firm processes defined. Create a new process template to get started.",icon:oe}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[r.map(a=>e.jsxs(I,{noPadding:!0,className:t("flex flex-col h-full transition-colors group cursor-pointer",`hover:${s.primary.border}`),children:[e.jsxs("div",{className:t("p-5 border-b flex justify-between items-start",s.border.default,s.surface.highlight),onClick:()=>l&&l(a.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:t("p-2 rounded border shadow-sm transition-all",s.surface.default,s.border.default,"group-hover:shadow-md"),children:Ys()}),e.jsxs("div",{children:[e.jsx("h4",{className:t("font-bold text-sm transition-colors",s.text.primary,`group-hover:${s.primary.text}`),children:a.name}),e.jsx("p",{className:t("text-xs",s.text.secondary),children:a.owner})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{variant:a.status==="Active"?"success":a.status==="Idle"?"neutral":"warning",children:a.status}),e.jsx("button",{className:t(s.text.tertiary,`hover:${s.text.secondary}`),onClick:o=>o.stopPropagation(),"aria-label":"Process options",children:e.jsx(Ae,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"p-5 flex-1 space-y-4",onClick:()=>l&&l(a.id),children:[e.jsxs("div",{className:t("flex justify-between text-xs pb-2 border-b",s.text.secondary,s.border.default),children:[e.jsxs("span",{children:["Trigger: ",e.jsx("strong",{className:s.text.primary,children:a.triggers})]}),e.jsxs("span",{children:["Tasks: ",e.jsx("strong",{children:a.tasks})]})]}),a.status==="Active"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs font-medium",children:[e.jsx("span",{className:s.primary.text,children:"Processing..."}),e.jsxs("span",{children:[Math.round(a.completed/a.tasks*100),"%"]})]}),e.jsx("div",{className:t("w-full rounded-full h-1.5 overflow-hidden",s.surface.highlight),children:e.jsx("div",{className:t("h-1.5 rounded-full transition-all",s.primary.DEFAULT),style:{width:`${a.completed/a.tasks*100}%`}})})]}),a.status==="Idle"&&e.jsx("div",{className:t("flex items-center justify-center h-12 rounded border border-dashed text-xs italic",s.surface.highlight,s.border.default,s.text.tertiary),children:"Waiting for automated trigger..."})]}),e.jsxs("div",{className:t("p-3 border-t flex gap-2",s.border.default),onClick:o=>o.stopPropagation(),children:[e.jsx(v,{variant:"ghost",size:"sm",className:t("flex-1 text-xs",s.text.secondary),onClick:()=>l&&l(a.id),children:"Logs"}),e.jsx(v,{variant:"outline",size:"sm",className:"flex-1 text-xs",onClick:()=>l&&l(a.id),children:"Config"}),a.status!=="Active"&&e.jsx(v,{variant:"primary",size:"sm",className:"flex-1 text-xs",icon:B,children:"Start"})]})]},a.id)),e.jsxs("div",{className:t("border-2 border-dashed rounded-lg flex flex-col items-center justify-center p-8 transition-all cursor-pointer min-h-[200px]",s.border.default,s.text.tertiary,`hover:${s.primary.border}`,`hover:${s.primary.text}`,`hover:${s.surface.highlight}`),children:[e.jsx("div",{className:t("p-4 rounded-full shadow-sm mb-3",s.surface.default),children:e.jsx(B,{className:"h-6 w-6"})}),e.jsx("span",{className:"font-bold text-sm",children:"Design New Workflow"}),e.jsx("span",{className:"text-xs mt-1",children:"Drag & Drop BPMN Builder"})]})]})},pt=()=>{const{theme:r}=C(),l=q(),{data:s=[],isLoading:a}=E(R.workflowsExtended.settings(),async()=>await A.workflow.getSettings()),{mutate:o}=le(async i=>A.workflow.updateSettings(i),{onSuccess:(i,d)=>{Pe.invalidate(R.workflowsExtended.settings());const p=d.find((h,g)=>h.enabled!==s[g]?.enabled);p&&l.success(`Updated ${p.label}`)},onError:()=>l.error("Failed to save settings")}),n=i=>{const d=[...s];d[i].enabled=!d[i].enabled,o(d)};return a?e.jsx(I,{title:"Workflow Automation Settings",children:e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(O,{className:"h-6 w-6 animate-spin text-blue-600"})})}):e.jsx(I,{title:"Workflow Automation Settings",children:e.jsxs("div",{className:"space-y-4",children:[s.map((i,d)=>e.jsxs("div",{className:t("flex items-center justify-between p-3 border-b last:border-0",r.border.default),children:[e.jsx("span",{className:t("text-sm font-medium",r.text.primary),children:i.label}),e.jsx("button",{onClick:()=>n(d),className:t("text-2xl transition-colors",i.enabled?r.primary.text:r.text.tertiary),children:i.enabled?e.jsx(ds,{className:"h-8 w-8"}):e.jsx(xs,{className:"h-8 w-8"})})]},d)),e.jsx("div",{className:t("pt-4 mt-4 border-t",r.border.default),children:e.jsxs("button",{className:t("flex items-center text-sm font-medium",r.text.secondary,`hover:${r.primary.text}`),children:[e.jsx(F,{className:"h-4 w-4 mr-2"})," Advanced Configuration"]})})]})})},gt=({id:r,type:l,onBack:s})=>{const{theme:a}=C(),o=q(),[n,i]=u.useState("visualizer"),{data:d,isLoading:p,isError:h,refetch:g}=E(R.workflows.engineDetail(r),()=>A.workflow.getEngineDetails(r,l)),[c,x]=u.useState("Active"),m=()=>{o.info("Running resource optimization algorithm..."),setTimeout(()=>{o.success("Resources rebalanced. Bottleneck resolved.")},1500)};return p?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(O,{className:"h-8 w-8 animate-spin text-blue-600"})}):h||!d?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[e.jsx(he,{title:"Workflow Engine Error",message:"Could not load workflow engine details.",onRetry:g}),e.jsx(v,{variant:"ghost",onClick:s,className:"mt-4",children:"Go Back"})]}):e.jsxs("div",{className:"flex flex-col h-full space-y-6 animate-fade-in min-h-0",children:[e.jsxs("div",{className:t("flex flex-col md:flex-row md:items-center justify-between gap-4 shrink-0 p-4 rounded-lg border shadow-sm",a.surface.default,a.border.default),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:s,className:t("p-2 rounded-full transition-colors border border-transparent",a.text.secondary,`hover:${a.surface.highlight}`,`hover:${a.border.default}`),children:e.jsx(xe,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:t("text-xl font-bold",a.text.primary),children:l==="case"?`Case Workflow: ${r}`:`Process: ${r}`}),e.jsx(Y,{variant:c==="Active"?"success":"warning",children:c})]}),e.jsxs("div",{className:t("flex items-center gap-3 mt-1 text-xs",a.text.secondary),children:[e.jsxs("span",{className:t("font-mono px-1.5 py-0.5 rounded",a.surface.highlight),children:["ID: ",r]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"Engine v2.5"})]})]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[c==="Active"?e.jsx(v,{variant:"secondary",icon:ie,onClick:()=>x("Paused"),children:"Pause"}):e.jsx(v,{variant:"primary",icon:B,onClick:()=>x("Active"),children:"Resume"}),e.jsx(v,{variant:"outline",icon:F,children:"Configure"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 shrink-0",children:[e.jsx(Z,{label:"Current Stage",value:"In Progress",icon:Te,className:"border-l-4 border-l-blue-500"}),e.jsx(Z,{label:"Next Deadline",value:d.nextDeadline,icon:z,className:"border-l-4 border-l-amber-500",trend:"Critical Path"}),e.jsx(Z,{label:"Tasks Complete",value:`${d.tasksCompleted} / ${d.tasksTotal}`,icon:ce,className:"border-l-4 border-l-green-500",trend:`${d.progress}%`}),e.jsx(Z,{label:"Automation Rate",value:d.automationRate,icon:F,className:"border-l-4 border-l-purple-500",trendUp:!0,trend:"+5%"})]}),e.jsxs("div",{className:t("flex-1 rounded-lg shadow-sm border flex flex-col overflow-hidden min-h-0",a.surface.default,a.border.default),children:[e.jsx("div",{className:t("border-b px-4 pt-2",a.border.default),children:e.jsx(ue,{tabs:["visualizer","tasks","audit","settings"],activeTab:n,onChange:N=>i(N),variant:"underline",className:"border-none"})}),e.jsxs("div",{className:t("flex-1 overflow-y-auto p-6",a.surface.highlight),children:[n==="visualizer"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:t("p-6 rounded-lg border shadow-sm",a.surface.default,a.border.default),children:[e.jsx("h3",{className:t("font-bold mb-4",a.text.primary),children:"Dependency Graph"}),e.jsx(Be,{})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Me,{}),e.jsx(I,{title:"Bottleneck Analysis",children:e.jsxs("div",{className:t("p-4 text-sm",a.text.secondary),children:[e.jsxs("div",{className:t("flex items-center gap-2 mb-2 font-bold p-2 rounded border",a.status.warning.text,a.status.warning.bg,a.status.warning.border),children:[e.jsx(De,{className:"h-4 w-4"})," Potential Bottleneck Detected"]}),e.jsxs("p",{className:"leading-relaxed",children:["Stage ",e.jsx("strong",{children:'"Document Review"'})," is taking ",e.jsx("span",{className:"text-red-600 font-bold",children:"40% longer"}),' than average. Consider reallocating resources from "Intake Team".']}),e.jsx(v,{size:"sm",variant:"outline",className:"mt-4 w-full",onClick:m,children:"Auto-Rebalance Resources"})]})})]})]}),n==="tasks"&&e.jsx(We,{}),n==="audit"&&e.jsx(Re,{}),n==="settings"&&e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsx(I,{title:"Workflow Configuration",children:e.jsxs("div",{className:t("divide-y",a.border.default),children:[e.jsxs("div",{className:t("flex items-center justify-between p-4 transition-colors",`hover:${a.surface.highlight}`),children:[e.jsxs("div",{children:[e.jsx("p",{className:t("font-bold text-sm",a.text.primary),children:"Strict Dependency Enforcement"}),e.jsx("p",{className:t("text-xs",a.text.secondary),children:"Prevents starting tasks before prerequisites are met."})]}),e.jsx("div",{className:"h-6 w-11 bg-blue-600 rounded-full relative cursor-pointer",children:e.jsx("div",{className:"absolute right-1 top-1 h-4 w-4 bg-white rounded-full shadow-sm"})})]}),e.jsxs("div",{className:t("flex items-center justify-between p-4 transition-colors",`hover:${a.surface.highlight}`),children:[e.jsxs("div",{children:[e.jsx("p",{className:t("font-bold text-sm",a.text.primary),children:"Auto-Assign Reviewers"}),e.jsx("p",{className:t("text-xs",a.text.secondary),children:"Based on current team load balancing algorithm."})]}),e.jsx("div",{className:"h-6 w-11 bg-blue-600 rounded-full relative cursor-pointer",children:e.jsx("div",{className:"absolute right-1 top-1 h-4 w-4 bg-white rounded-full shadow-sm"})})]}),e.jsxs("div",{className:t("flex items-center justify-between p-4 transition-colors",`hover:${a.surface.highlight}`),children:[e.jsxs("div",{children:[e.jsx("p",{className:t("font-bold text-sm",a.text.primary),children:"SLA Breach Notifications"}),e.jsx("p",{className:t("text-xs",a.text.secondary),children:"Email partners immediately when critical path is delayed."})]}),e.jsx("div",{className:t("h-6 w-11 rounded-full relative cursor-pointer",a.border.default,a.surface.highlight),children:e.jsx("div",{className:t("absolute left-1 top-1 h-4 w-4 rounded-full shadow-sm",a.surface.default)})})]})]})}),e.jsxs("div",{className:t("flex justify-end p-4 rounded-lg border items-center justify-between",a.status.error.bg,a.status.error.border),children:[e.jsx("span",{className:t("text-xs font-bold uppercase",a.status.error.text),children:"Danger Zone"}),e.jsx(v,{variant:"danger",size:"sm",children:"Terminate Workflow"})]})]})]})]})]})},jt=({data:r,onClick:l})=>{const{theme:s}=C(),a=o=>{switch(o){case"Low":return t(s.status.success.text,s.status.success.bg,s.status.success.border);case"Medium":return t(s.status.info.text,s.status.info.bg,s.status.info.border);case"High":return t(s.status.warning.text,s.status.warning.bg,s.status.warning.border);default:return s.text.secondary}};return e.jsxs("div",{className:t("rounded-xl border shadow-sm transition-all cursor-pointer group overflow-hidden flex flex-col h-full",s.surface.default,s.border.default,`hover:shadow-md hover:${s.primary.border}`),onClick:l,children:[e.jsxs("div",{className:t("p-5 border-b",s.border.default,s.surface.highlight),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx(Y,{variant:"neutral",className:s.surface.default,children:r.category}),r.auditReady&&e.jsxs("div",{className:t("flex items-center text-[10px] font-bold px-2 py-0.5 rounded-full border",s.status.success.text,s.status.success.bg,s.status.success.border),title:"Full Audit Trail Enabled",children:[e.jsx(ms,{className:"h-3 w-3 mr-1"})," Audited"]})]}),e.jsx("h4",{className:t("font-bold text-lg transition-colors leading-tight",s.text.primary,`group-hover:${s.primary.text}`),children:r.title}),e.jsxs("div",{className:t("flex items-center gap-4 mt-3 text-xs",s.text.secondary),children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(z,{className:"h-3 w-3 mr-1"})," ",r.duration]}),e.jsxs("span",{className:t("flex items-center px-1.5 py-0.5 rounded border",a(r.complexity)),children:[e.jsx(us,{className:"h-3 w-3 mr-1"})," ",r.complexity]})]})]}),e.jsx("div",{className:t("p-5 flex-1 flex flex-col justify-center",s.surface.highlight),children:e.jsxs("div",{className:"space-y-3 relative",children:[e.jsx("div",{className:t("absolute left-3 top-2 bottom-2 w-0.5 -z-10",s.border.default)}),r.stages.slice(0,4).map((o,n)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:t("w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold z-10 border-2",s.surface.default,n===0?t(s.primary.DEFAULT,s.text.inverse,"shadow-sm border-transparent"):t(s.border.default,s.text.tertiary)),children:n+1}),e.jsx("div",{className:t("text-xs font-medium px-2 py-1 rounded border shadow-sm flex-1 truncate",s.surface.default,s.border.default,s.text.secondary),children:o})]},n)),r.stages.length>4&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:t("w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold z-10 border-2",s.surface.default,s.border.default),children:"+"}),e.jsxs("span",{className:t("text-[10px] italic",s.text.tertiary),children:[r.stages.length-4," more stages"]})]})]})}),e.jsxs("div",{className:t("p-3 border-t flex justify-between items-center text-xs",s.surface.default,s.border.default,s.text.secondary),children:[e.jsx("div",{className:"flex gap-1",children:r.tags.slice(0,2).map(o=>e.jsx("span",{className:t("px-1.5 py-0.5 rounded text-[10px]",s.surface.highlight),children:o},o))}),e.jsxs("span",{className:t("flex items-center font-medium transition-colors",`group-hover:${s.primary.text}`),children:["Use Template ",e.jsx(hs,{className:"h-3 w-3 ml-1"})]})]})]})},bt=({onCreate:r})=>{const{theme:l}=C(),{data:s=[],isLoading:a,isError:o,refetch:n}=E(R.workflows.templates(),()=>A.workflow.getTemplates()),i=Array.isArray(s)?s:[],{filteredItems:d,searchQuery:p,setSearchQuery:h,category:g,setCategory:c,categories:x}=Fs({items:i,config:{categoryField:"category",searchFields:["title"],arrayFields:["tags"]},initialCategory:"All"});return a?e.jsx(me,{contentType:"dashboard",itemCount:8,shimmer:!0}):o?e.jsx(he,{message:"Failed to load workflow templates",onRetry:n}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:t("border rounded-lg p-4 flex items-start gap-4",l.status.info.bg,l.status.info.border),children:[e.jsx(Se,{className:t("h-6 w-6 mt-1",l.status.info.text)}),e.jsxs("div",{children:[e.jsx("h4",{className:t("font-bold",l.text.primary),children:"Audit-Ready Process Architecture"}),e.jsx("p",{className:t("text-sm",l.text.secondary),children:"Templates are pre-configured to log activity to the immutable Audit Log."})]})]}),e.jsxs("div",{className:t("flex flex-col md:flex-row justify-between items-center gap-4 p-4 rounded-lg border shadow-sm sticky top-0 z-10",l.surface.default,l.border.default),children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto w-full md:w-auto pb-2 md:pb-0",children:x.map(m=>e.jsx("button",{onClick:()=>c(m),className:t("px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-colors",g===m?t(l.primary.DEFAULT,l.text.inverse):t(l.surface.highlight,l.text.secondary,`hover:${l.border.default}`)),children:m},m))}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(oe,{className:t("absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4",l.text.tertiary)}),e.jsx("input",{className:t("w-full pl-9 pr-4 py-2 border rounded-lg text-sm outline-none transition-all",l.surface.highlight,l.border.default,l.text.primary,"focus:ring-2 focus:ring-blue-500"),placeholder:"Search templates...",value:p,onChange:m=>h(m.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[d.map(m=>e.jsx(jt,{data:m,onClick:()=>r(m)},m.id)),e.jsxs("button",{onClick:()=>r(),className:t("border-2 border-dashed rounded-xl flex flex-col items-center justify-center p-8 transition-all h-full min-h-[280px]",l.border.default,l.text.tertiary,`hover:${l.primary.border}`,`hover:${l.primary.text}`,`hover:${l.surface.highlight}`),children:[e.jsx("div",{className:t("p-4 rounded-full shadow-sm mb-4",l.surface.default),children:e.jsx(Le,{className:"h-8 w-8"})}),e.jsx("span",{className:"font-bold",children:"Design New Workflow"}),e.jsx("span",{className:"text-xs mt-2",children:"Start from scratch"})]})]})]})},J=[{id:"design",label:"Design",icon:pe,subTabs:[{id:"templates",label:"Template Library",icon:pe}]},{id:"execution",label:"Execution",icon:B,subTabs:[{id:"cases",label:"Case Workflows",icon:fs},{id:"firm",label:"Firm Processes",icon:ps}]},{id:"ops",label:"Operations",icon:ge,subTabs:[{id:"ops_center",label:"Ops Center",icon:ge},{id:"analytics",label:"Performance",icon:gs}]},{id:"admin",label:"Admin",icon:F,subTabs:[{id:"settings",label:"Configuration",icon:F}]}],yt=(r,l,s)=>{const a=zs(),o=r.length+l.filter(x=>x.status==="Active").length,n=s.filter(x=>x.dueDate===a&&x.status!==W.COMPLETED&&x.status!==W.CANCELLED).length,i=new Date;i.setDate(i.getDate()-30);const d=s.filter(x=>{if(x.status!==W.COMPLETED)return!1;const m=x.updatedAt||x.createdAt;return m?new Date(m)>=i:!1}).length,h=s.filter(x=>x.status===W.COMPLETED).filter(x=>x.dueDate),g=h.filter(x=>!x.updatedAt||!x.dueDate?!0:new Date(x.updatedAt)<=new Date(x.dueDate)),c=h.length>0?Math.round(g.length/h.length*100)-78:0;return{activeWorkflows:o,tasksDueToday:n,automationsRan:d,efficiencyGain:Math.max(0,c)}},sa=({onSelectCase:r,initialTab:l})=>{const{theme:s}=C(),a=q(),[o,n]=u.useTransition(),[i,d]=u.useState("templates"),[p,h]=u.useState("list"),[g,c]=u.useState(null),[x,m]=u.useState("case"),[N,S]=u.useState(null),w=u.useCallback(j=>{n(()=>{d(j)})},[]),{data:T=[],isLoading:y,status:f,refetch:P}=E(["cases","all"],A.cases.getAll),{data:$=[],isLoading:_,status:M,refetch:se}=E(["processes","all"],async()=>await js.getProcesses()),{data:G=[],refetch:Q}=E(["tasks","all"],()=>A.tasks.getAll()),U=u.useMemo(()=>Array.isArray(T)?T:[],[T]),H=u.useMemo(()=>Array.isArray(G)?G:[],[G]),b=u.useMemo(()=>Array.isArray($)?$:[],[$]),k=u.useMemo(()=>yt(U,b,H),[U,b,H]),L=u.useMemo(()=>J.find(j=>j.subTabs.some(V=>V.id===i))||J[0],[i]),D=y||_,X=f==="error"||M==="error";u.useEffect(()=>{l&&w(l)},[l,w]);const{mutate:K,isLoading:ze}=le(A.workflow.runAutomation,{onSuccess:()=>{a.success("Automation sequence initiated successfully."),Q()},onError:j=>{a.error(`Failed to run automation: ${j.message}`)}}),{mutate:_e,isLoading:Ge}=le(A.workflow.syncEngine,{onSuccess:()=>{a.info("Workflow engine state synchronized."),P(),se(),Q()},onError:j=>{a.error(`Failed to sync engine: ${j.message}`)}}),Ue=u.useCallback(j=>{const V=J.find(Ke=>Ke.id===j);V&&V.subTabs.length>0&&w(V.subTabs[0].id)},[w]),He=u.useCallback(j=>{c(j),m("case"),h("detail")},[]),Xe=u.useCallback(j=>{c(j),m("process"),h("detail")},[]),fe=u.useCallback(j=>{c(null),S(j||null),h("builder")},[]),te=u.useCallback(()=>{h("list"),c(null),S(null)},[]);return p==="detail"&&g?x==="case"?e.jsx(gt,{id:g,type:"case",onBack:te}):e.jsx(ht,{processId:g,onBack:te}):p==="builder"?e.jsx(Oe,{initialTemplate:N,onBack:te}):X?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(ee,{title:"Unable to load workflow data",description:"There was a problem connecting to the database. Please try refreshing.",icon:De,action:e.jsx(v,{onClick:()=>window.location.reload(),icon:re,children:"Reload Application"})})}):e.jsx($e,{scope:"MasterWorkflow",children:e.jsxs("div",{className:t("h-full flex flex-col animate-fade-in",s.background),children:[e.jsxs("div",{className:"px-6 pt-6 shrink-0",children:[e.jsx(Ee,{title:"Case Workflows",subtitle:"Orchestrate case lifecycles, automate tasks, and manage firm-wide business process automation.",actions:e.jsxs("div",{className:"flex gap-2",children:[i==="templates"&&e.jsx(v,{variant:"primary",icon:Le,onClick:()=>fe(),children:"New Template"}),i==="cases"&&e.jsx(v,{variant:"primary",icon:B,onClick:()=>K("all"),isLoading:ze,children:"Run Automation"}),e.jsx(v,{variant:"outline",icon:re,onClick:()=>_e(void 0),isLoading:Ge,children:"Sync Engine"})]})}),["cases","firm"].includes(i)&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:t("p-4 rounded-lg shadow-sm border",s.surface.default,s.border.default),children:[e.jsx("p",{className:t("text-xs font-bold uppercase",s.text.secondary),children:"Active Workflows"}),e.jsx("p",{className:t("text-2xl font-bold",s.primary.text),children:k.activeWorkflows})]}),e.jsxs("div",{className:t("p-4 rounded-lg shadow-sm border",s.surface.default,s.border.default),children:[e.jsx("p",{className:t("text-xs font-bold uppercase",s.text.secondary),children:"Tasks Due Today"}),e.jsx("p",{className:t("text-2xl font-bold",s.status.warning.text),children:k.tasksDueToday})]}),e.jsxs("div",{className:t("p-4 rounded-lg shadow-sm border",s.surface.default,s.border.default),children:[e.jsx("p",{className:t("text-xs font-bold uppercase",s.text.secondary),children:"Automations Ran"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:k.automationsRan.toLocaleString()})]}),e.jsxs("div",{className:t("p-4 rounded-lg shadow-sm border",s.surface.default,s.border.default),children:[e.jsx("p",{className:t("text-xs font-bold uppercase",s.text.secondary),children:"Efficiency Gain"}),e.jsxs("p",{className:t("text-2xl font-bold",s.status.success.text),children:[k.efficiencyGain>0?"+":"",k.efficiencyGain,"%"]})]})]}),e.jsx("div",{className:t("hidden md:flex space-x-6 border-b mb-4",s.border.default),children:J.map(j=>e.jsxs("button",{onClick:()=>Ue(j.id),className:t("flex items-center pb-3 px-1 text-sm font-medium transition-all border-b-2",L.id===j.id?t("border-current",s.primary.text):t("border-transparent",s.text.secondary,`hover:${s.text.primary}`)),children:[e.jsx(j.icon,{className:t("h-4 w-4 mr-2",L.id===j.id?s.primary.text:s.text.tertiary)}),j.label]},j.id))}),e.jsx("div",{className:t("flex space-x-2 overflow-x-auto no-scrollbar py-3 px-4 md:px-6 rounded-lg border mb-4",s.surface.highlight,s.border.default),children:L.subTabs.map(j=>e.jsxs("button",{onClick:()=>w(j.id),className:t("flex-shrink-0 px-3 py-1.5 rounded-full font-medium text-xs md:text-sm transition-all duration-200 whitespace-nowrap flex items-center gap-2 border",i===j.id?t(s.surface.default,s.primary.text,"shadow-sm border-transparent ring-1",s.primary.border):t("bg-transparent",s.text.secondary,"border-transparent",`hover:${s.surface.default}`)),children:[e.jsx(j.icon,{className:t("h-3.5 w-3.5",i===j.id?s.primary.text:s.text.tertiary)}),j.label]},j.id))})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto px-6 pb-6 custom-scrollbar",children:e.jsxs("div",{className:t(o&&"opacity-60 transition-opacity"),children:[D&&e.jsx("div",{className:"flex justify-center p-10",children:e.jsx(O,{className:"animate-spin text-blue-600 h-8 w-8"})}),!D&&i==="templates"&&e.jsx(bt,{onCreate:fe}),!D&&i==="cases"&&e.jsx(Zs,{cases:U,tasks:H,onSelectCase:r,onManageWorkflow:He}),!D&&i==="firm"&&e.jsx(ft,{processes:b,onSelectProcess:Xe}),i==="ops_center"&&e.jsx(xt,{}),i==="analytics"&&e.jsx(Fe,{}),i==="settings"&&e.jsx(pt,{})]})})]})})};export{sa as MasterWorkflow,sa as default};
