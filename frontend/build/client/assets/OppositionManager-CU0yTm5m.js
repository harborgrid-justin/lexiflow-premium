import{j as e,X as B,ab as z,F as S,bh as F,V as U,A as I,a5 as J,bz as K,cJ as Q,t as q,c1 as V,aj as W,a0 as G,cH as X,T as _,r as y,l as $,b3 as Y,c9 as Z,al as ee}from"./vendor-core-V-oW58GW.js";import{u as A,c as s}from"./useQueryHooks-Oyt-TMLP.js";import{D as R}from"./dataService-BWLMkXM4.js";import{q as se}from"./queryKeys-BBVgMz36.js";import{u as te}from"./useFilterAndSearch-B2zKLOlA.js";import{d as re,h as ae}from"./case-detail-q84K17Pa.js";import{u as C}from"./useToggle-CjLp2PQ4.js";import{u as j}from"./ThemeContext-OPG61qw5.js";import{B as x}from"./Button-CDQlLg6j.js";import{A as le}from"./AdaptiveLoader-D5wOoiN1.js";import{E as ie}from"./ErrorState-WL3az5ve.js";import{M as oe}from"./Modal-Rns91qFF.js";import"./SyncContext-B5_p5hCg.js";import{E as ne}from"./EmptyState-7A4cJUVU.js";import{T as ce,a as de,b as u,c as xe,d as me,e as f}from"./Table-C_bcd1kC.js";import{U as pe}from"./UserAvatar-BPVf-Spq.js";import"./vendor-misc-Dwkhvdtg.js";import"./vendor-charts-KZIdMATq.js";import"./preload-helper-BXl3LOEh.js";import"./type-mappings-DEPYyX4d.js";import"./Badge-bF-hTHJZ.js";import"./schemas-B2_dy3tf.js";import"./VirtualList-r2WXvtCD.js";import"./AppShell-Cug-APl3.js";import"./tabs.config-D59pmwVC.js";import"./PageHeader-C4TFe3Td.js";import"./formatters-stMuSkc6.js";import"./useNotify-DdRjm5G5.js";import"./Card-CDOiP5UM.js";import"./MetricCard-BH_9X7pi.js";import"./useSessionStorage-D_292xEY.js";import"./ConfirmDialog--jvbqDAw.js";import"./Kanban-BI78PbzY.js";import"./dateUtils-rLIRMrtk.js";import"./FilterPanel-BteidCPx.js";import"./Tabs-7xONCRTX.js";import"./Input-Dmln04Yk.js";import"./TextArea-DrtcCAyn.js";import"./geminiService-_CYFbtO8.js";import"./TaskCreationModal-D5xiqN6m.js";import"./search.config-B6mvIgDA.js";import"./sanitize-k_Tw3ej1.js";import"./useModalState-Cst_3NmK.js";import"./scheduler-BERajRBE.js";import"./RouteErrorBoundary-Nha8Il06.js";import"./meta-utils-lVs9HXG9.js";const N=({title:l,className:a})=>{const{theme:t}=j();return e.jsx("h4",{className:s("text-xs font-bold uppercase border-b pb-2",t.text.tertiary,t.border.default,a),children:l})},he=({caseItem:l})=>{const{theme:a}=j();return e.jsxs("div",{className:s("p-3 rounded border transition-colors hover:border-blue-300 cursor-pointer group",a.surface.default,a.border.default),children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-blue-600",children:l.title}),e.jsx("span",{className:s("text-[10px]",a.text.tertiary),children:l.year})]}),e.jsx("p",{className:s("text-xs mb-1",a.text.secondary),children:l.description}),e.jsxs("p",{className:s("text-xs font-medium",a.text.primary),children:["Result: ",l.result]})]})},ue=[{icon:S,label:"Publications"},{icon:F,label:"Rulings"},{icon:U,label:"Ethics"},{icon:I,label:"Social"}],T=l=>({High:5,Medium:3,Low:1})[l],fe=l=>{const a=T(l.aggression),t=50,r=(a-3)*10,c=(l.winRate-50)*.2;return Math.max(0,Math.min(100,Math.round(t-r+c)))},je=({entity:l,onClose:a})=>{const{theme:t}=j(),{data:r=[],isLoading:c}=A(["opposition","caseHistory",l.id],async()=>{try{return await R.warRoom.getOppositionCaseHistory?.(l.id)||[]}catch(n){return console.warn("Case history unavailable:",n),[]}},{enabled:!!l.id,staleTime:300*1e3}),i=()=>{const n=T(l.aggression);return e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(p=>e.jsx("div",{className:s("w-2 h-4 rounded-sm transition-colors",p<=n?"bg-red-500":"bg-slate-200")},p))})},m=fe(l);return e.jsxs("div",{className:s("w-96 border-l flex flex-col shadow-xl animate-in slide-in-from-right duration-300 z-10",t.surface.default,t.border.default),children:[e.jsxs("div",{className:s("p-4 border-b flex justify-between items-center",t.surface.highlight,t.border.default),children:[e.jsx("h4",{className:s("font-bold text-sm uppercase tracking-wide",t.text.secondary),children:"Entity Dossier"}),e.jsx("button",{onClick:a,className:s("p-1 rounded hover:bg-slate-200 transition-colors",t.text.tertiary),"aria-label":"Close dossier",children:e.jsx(B,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:s("w-20 h-20 rounded-full mx-auto mb-3 flex items-center justify-center text-2xl font-bold border-2 shadow-md text-white bg-slate-800",t.border.default),children:l.name.charAt(0).toUpperCase()}),e.jsx("h3",{className:s("text-xl font-bold",t.text.primary),children:l.name}),e.jsxs("p",{className:s("text-sm",t.text.secondary),children:[l.role," at ",l.firm]}),e.jsx("div",{className:"flex justify-center gap-2 mt-3",children:e.jsx("span",{className:s("text-xs px-2 py-1 rounded font-medium border",t.surface.highlight,t.text.secondary,t.border.default),children:l.status})})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx(N,{title:"Strategic Analysis"}),e.jsxs("div",{className:s("p-4 rounded-lg border space-y-3",t.surface.highlight,t.border.default),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:s("text-xs font-medium",t.text.secondary),children:"Aggression Index"}),i()]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:s("text-xs font-medium",t.text.secondary),children:"Settlement Probability"}),e.jsxs("span",{className:s("text-sm font-bold",t.text.primary),children:[m,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:s("text-xs font-medium",t.text.secondary),children:"Win Rate vs Firm"}),e.jsxs("span",{className:s("text-sm font-bold",t.text.primary),children:[l.winRate,"%"]})]})]}),l.notes&&e.jsxs("p",{className:s("text-sm leading-relaxed italic px-1",t.text.secondary),children:['"',l.notes,'"']})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx(N,{title:"Case History"}),c?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx(z,{className:"h-6 w-6 animate-spin text-blue-600"})}):r.length===0?e.jsx(ne,{icon:S,title:"No case history",description:"No prior cases found for this entity.",className:"py-6"}):e.jsx("div",{className:"space-y-3",children:r.map(n=>e.jsx(he,{caseItem:n},n.id))})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx(N,{title:"Intel"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:ue.map(({icon:n,label:p})=>e.jsxs(x,{variant:"outline",size:"sm",className:"text-xs",children:[e.jsx(n,{className:"h-3 w-3 mr-1"}),p]},p))})]})]}),e.jsxs("div",{className:s("p-4 border-t flex gap-2",t.surface.highlight,t.border.default),children:[e.jsx(x,{variant:"outline",className:"flex-1",children:"Flag Risk"}),e.jsx(x,{variant:"primary",className:"flex-1",children:"View Full Profile"})]})]})},be=({entities:l,onSelect:a,selectedId:t})=>{const{theme:r}=j(),c=i=>{switch(i){case"High":return"text-rose-600 bg-rose-50 border-rose-200";case"Medium":return"text-amber-600 bg-amber-50 border-amber-200";default:return"text-emerald-600 bg-emerald-50 border-emerald-200"}};return e.jsx("div",{className:s("flex-1 overflow-auto custom-scrollbar p-6",r.surface.default),children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(u,{children:"Entity Name"}),e.jsx(u,{children:"Role & Firm"}),e.jsx(u,{children:"Strategic Profile"}),e.jsx(u,{children:"Aggression"}),e.jsx(u,{children:"Win Rate (vs Firm)"}),e.jsx(u,{className:"text-right",children:"Actions"})]}),e.jsx(xe,{children:l.map(i=>e.jsxs(me,{onClick:()=>a(i),className:s("cursor-pointer",t===i.id?r.surface.highlight:""),children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(pe,{name:i.name,size:"md",className:i.role.includes("Counsel")?"bg-slate-800 text-white":""}),e.jsxs("div",{children:[e.jsx("p",{className:s("font-bold text-sm",r.text.primary),children:i.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[i.email&&e.jsx("button",{className:s("p-1 rounded hover:bg-slate-200",r.text.tertiary),onClick:m=>{m.stopPropagation(),window.location.href=`mailto:${i.email}`},children:e.jsx(J,{className:"h-3 w-3"})}),i.phone&&e.jsx("button",{className:s("p-1 rounded hover:bg-slate-200",r.text.tertiary),onClick:m=>{m.stopPropagation()},children:e.jsx(K,{className:"h-3 w-3"})})]})]})]})}),e.jsx(f,{children:e.jsxs("div",{className:s("flex flex-col"),children:[e.jsx("span",{className:s("font-medium text-sm",r.text.primary),children:i.role}),e.jsx("span",{className:s("text-xs",r.text.secondary),children:i.firm})]})}),e.jsx(f,{children:e.jsx("span",{className:s("text-xs px-2 py-1 rounded border",r.surface.highlight,r.border.default,r.text.secondary),children:i.tendency})}),e.jsx(f,{children:e.jsxs("div",{className:s("flex items-center gap-1.5 px-2 py-1 rounded w-fit border text-xs font-bold",c(i.aggression)),children:[e.jsx(Q,{className:"h-3 w-3 fill-current"}),i.aggression]})}),e.jsx(f,{children:e.jsxs("div",{className:s("flex items-center gap-2 font-mono text-sm",r.text.primary),children:[e.jsx(q,{className:s("h-4 w-4",r.text.tertiary)}),i.winRate,"%"]})}),e.jsx(f,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(x,{size:"sm",variant:"ghost",children:"Profile"}),e.jsx("button",{className:s("p-1.5 rounded hover:bg-slate-100",r.text.secondary),children:e.jsx(V,{className:"h-4 w-4"})})]})})]},i.id))})]})})},ge=({activeCategory:l,onSelectCategory:a,counts:t})=>{const{theme:r}=j(),c=[{id:"All",label:"All Entities",icon:W,count:t.all},{id:"Counsel",label:"Opposing Counsel",icon:F,count:t.counsel},{id:"Parties",label:"Parties",icon:G,count:t.parties},{id:"Experts",label:"Experts",icon:X,count:t.experts}];return e.jsxs("div",{className:s("w-64 border-r flex flex-col shrink-0 hidden md:flex",r.surface.highlight,r.border.default),children:[e.jsxs("div",{className:s("p-4 border-b",r.border.default),children:[e.jsx("h4",{className:s("text-xs font-bold uppercase tracking-wide mb-3",r.text.tertiary),children:"Categories"}),e.jsx("div",{className:"space-y-1",children:c.map(i=>e.jsxs("button",{onClick:()=>a(i.id),className:s("w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors flex justify-between items-center",l===i.id?s(r.surface.highlight,r.text.primary,"shadow-sm border",r.border.default):s(r.text.secondary,"hover:bg-slate-100 dark:hover:bg-slate-800")),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(i.icon,{className:s("h-4 w-4 mr-3 opacity-70")}),i.label]}),e.jsx("span",{className:s("text-xs px-2 py-0.5 rounded-full",r.surface.default,r.text.secondary),children:i.count})]},i.id))})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:s("p-3 rounded-lg border bg-red-50 border-red-100 text-red-800"),children:[e.jsxs("h4",{className:"text-xs font-bold uppercase mb-2 flex items-center",children:[e.jsx(_,{className:"h-3 w-3 mr-1"})," Intelligence"]}),e.jsx("p",{className:"text-xs leading-relaxed",children:"Opposing counsel has a high settlement rate (85%) when faced with aggressive discovery motions."})]})})]})},ms=({caseId:l})=>{const{theme:a}=j(),t=re(null,(o,d)=>o.id===d.id),r=C(),c=C(),[i,m]=y.useState("all"),[n,p]=y.useState("all"),[g,v]=y.useState("all"),{data:b=[],isLoading:E,error:O,refetch:P}=A(se.warRoom.opposition(l||""),()=>R.warRoom.getOpposition(l||"")),{filteredItems:w,searchQuery:k,setSearchQuery:M,category:h,setCategory:L}=te({items:b,config:{categoryField:"role",searchFields:["name","firm"],arrayFields:[]},initialCategory:"All"}),D=$.useMemo(()=>{let o=w;return h!=="All"&&(o=o.filter(d=>h==="Counsel"?d.role.includes("Counsel"):h==="Parties"?d.role==="Defendant":h==="Experts"?d.role==="Opposing Expert":!0)),i!=="all"&&(o=o.filter(d=>d.role===i)),n!=="all"&&(o=o.filter(d=>d.firm===n)),g!=="all"&&(o=o.filter(d=>d.status===g)),o},[w,h,i,n,g]),H=o=>{t.select(o),r.open()};return E?e.jsx(le,{contentType:"list",itemCount:6,shimmer:!0}):O?e.jsx(ie,{message:"Failed to load opposition entities",onRetry:P}):e.jsxs("div",{className:s("flex flex-col h-full rounded-lg shadow-sm border overflow-hidden",a.surface.default,a.border.default),children:[e.jsxs("div",{className:s("p-4 border-b flex justify-between items-center gap-4",a.surface.highlight,a.border.default),children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("h3",{className:s("font-bold text-lg whitespace-nowrap",a.text.primary),children:"Opposition Intel"}),e.jsx("div",{className:s("h-6 w-px",a.border.default)}),e.jsx(ae,{value:k,onChange:M,placeholder:"Search counsel, parties, experts...",className:"w-full max-w-md border-none shadow-none p-0 bg-transparent"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:c.isOpen?"primary":"secondary",icon:Y,onClick:c.toggle,className:"hidden sm:flex",children:"Filter"}),e.jsx(x,{variant:r.isOpen?"primary":"secondary",icon:Z,onClick:r.toggle,className:"hidden sm:flex",children:"Inspector"}),e.jsx(x,{variant:"primary",icon:ee,children:"Add Profile"})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx(ge,{activeCategory:h,onSelectCategory:L,counts:{all:b.length,counsel:b.filter(o=>o.role.includes("Counsel")).length,parties:b.filter(o=>o.role==="Defendant").length,experts:b.filter(o=>o.role==="Opposing Expert").length}}),e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col relative",children:e.jsx(be,{entities:D,onSelect:H,selectedId:t.selected?.id})}),r.isOpen&&t.selected&&e.jsx(je,{entity:t.selected,onClose:r.close})]}),e.jsx(oe,{isOpen:c.isOpen,onClose:c.close,title:"Filter Opposition",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s("block text-xs font-semibold uppercase mb-1.5",a.text.secondary),children:"Role"}),e.jsxs("select",{title:"Filter by role",className:s("w-full px-3 py-2 border rounded-md text-sm",a.surface.default,a.border.default),value:i,onChange:o=>m(o.target.value),children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"Lead Counsel",children:"Lead Counsel"}),e.jsx("option",{value:"Associate Counsel",children:"Associate Counsel"}),e.jsx("option",{value:"Defendant",children:"Defendant"}),e.jsx("option",{value:"Opposing Expert",children:"Opposing Expert"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:s("block text-xs font-semibold uppercase mb-1.5",a.text.secondary),children:"Firm"}),e.jsxs("select",{title:"Filter by firm",className:s("w-full px-3 py-2 border rounded-md text-sm",a.surface.default,a.border.default),value:n,onChange:o=>p(o.target.value),children:[e.jsx("option",{value:"all",children:"All Firms"}),e.jsx("option",{value:"Morrison & Foerster LLP",children:"Morrison & Foerster LLP"}),e.jsx("option",{value:"Baker McKenzie",children:"Baker McKenzie"}),e.jsx("option",{value:"Jones Day",children:"Jones Day"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:s("block text-xs font-semibold uppercase mb-1.5",a.text.secondary),children:"Status"}),e.jsxs("select",{title:"Filter by status",className:s("w-full px-3 py-2 border rounded-md text-sm",a.surface.default,a.border.default),value:g,onChange:o=>v(o.target.value),children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Retained",children:"Retained"}),e.jsx("option",{value:"Monitoring",children:"Monitoring"})]})]}),e.jsxs("div",{className:s("flex justify-end gap-2 pt-4 border-t",a.border.default),children:[e.jsx(x,{variant:"ghost",onClick:()=>{m("all"),p("all"),v("all")},children:"Clear Filters"}),e.jsx(x,{variant:"primary",onClick:c.close,children:"Apply"})]})]})})]})};export{ms as OppositionManager};
