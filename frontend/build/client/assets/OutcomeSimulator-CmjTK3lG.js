import{r as n,j as t,b2 as k,k as D,t as E}from"./vendor-core-V-oW58GW.js";import{j as P}from"./case-detail-q84K17Pa.js";import{B as $}from"./Button-CDQlLg6j.js";import{I as L}from"./Input-Dmln04Yk.js";import{C as M}from"./Card-CDOiP5UM.js";import{u as A}from"./ThemeContext-OPG61qw5.js";import{c as a}from"./useQueryHooks-Oyt-TMLP.js";import{S as T}from"./scheduler-BERajRBE.js";import{R as V,A as F,X as R,Y as I,C as O,T as z,d as H,e as B}from"./vendor-charts-KZIdMATq.js";import"./vendor-misc-Dwkhvdtg.js";import"./Badge-bF-hTHJZ.js";import"./schemas-B2_dy3tf.js";import"./SyncContext-B5_p5hCg.js";import"./dataService-BWLMkXM4.js";import"./preload-helper-BXl3LOEh.js";import"./type-mappings-DEPYyX4d.js";import"./VirtualList-r2WXvtCD.js";import"./AppShell-Cug-APl3.js";import"./tabs.config-D59pmwVC.js";import"./PageHeader-C4TFe3Td.js";import"./formatters-stMuSkc6.js";import"./Table-C_bcd1kC.js";import"./EmptyState-7A4cJUVU.js";import"./useNotify-DdRjm5G5.js";import"./MetricCard-BH_9X7pi.js";import"./queryKeys-BBVgMz36.js";import"./useSessionStorage-D_292xEY.js";import"./ErrorState-WL3az5ve.js";import"./ConfirmDialog--jvbqDAw.js";import"./Modal-Rns91qFF.js";import"./Kanban-BI78PbzY.js";import"./dateUtils-rLIRMrtk.js";import"./FilterPanel-BteidCPx.js";import"./AdaptiveLoader-D5wOoiN1.js";import"./UserAvatar-BPVf-Spq.js";import"./Tabs-7xONCRTX.js";import"./TextArea-DrtcCAyn.js";import"./geminiService-_CYFbtO8.js";import"./TaskCreationModal-D5xiqN6m.js";import"./search.config-B6mvIgDA.js";import"./useToggle-CjLp2PQ4.js";import"./sanitize-k_Tw3ej1.js";import"./useModalState-Cst_3NmK.js";import"./RouteErrorBoundary-Nha8Il06.js";import"./meta-utils-lVs9HXG9.js";const G={runSettlementSimulation:s=>{const{low:r,high:c,liabilityProb:j,iterations:m}=s,i=[];for(let o=0;o<m;o++)if(Math.random()*100<j){const x=1-Math.random(),y=Math.random(),N=Math.sqrt(-2*Math.log(x))*Math.cos(2*Math.PI*y),g=(c+r)/2,w=(c-r)/4;let S=g+N*w;S=Math.max(r*.8,Math.min(c*1.2,S)),i.push(S)}else i.push(0);i.sort((o,e)=>o-e);const b=i.reduce((o,e)=>o+e,0)/m,f=i[Math.floor(m*.25)],d=i[Math.floor(m*.75)],u=20,p=0,l=(c*1.2-p)/u,v=Array.from({length:u},(o,e)=>{const x=p+e*l,y=x+l,N=i.filter(g=>g>=x&&g<y).length;return{range:`$${(x/1e3).toFixed(0)}k`,count:N,value:x}});return{ev:b,p25:f,p75:d,results:v}}},Vt=()=>{const{theme:s}=A(),r=P(),[c,j]=n.useState(5e5),[m,i]=n.useState(15e5),[h,b]=n.useState(75),[f]=n.useState(1e3),[d,u]=n.useState(!1),[p,C]=n.useState([]),[l,v]=n.useState({ev:0,p25:0,p75:0}),o=()=>{u(!0),T.scheduleTask(()=>G.runSettlementSimulation({low:c,high:m,liabilityProb:h,iterations:f})).then(e=>{C(e.results),v({ev:e.ev,p25:e.p25,p75:e.p75}),u(!1)})};return n.useMemo(()=>{p.length===0&&o()},[]),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-full",children:[t.jsxs(M,{className:"flex flex-col h-full",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4 text-blue-600",children:[t.jsx(k,{className:"h-5 w-5"}),t.jsx("h3",{className:"font-bold",children:"Simulation Parameters"})]}),t.jsxs("div",{className:"space-y-4 flex-1",children:[t.jsx(L,{label:"Low Estimate ($)",type:"number",value:c,onChange:e=>j(Number(e.target.value))}),t.jsx(L,{label:"High Estimate ($)",type:"number",value:m,onChange:e=>i(Number(e.target.value))}),t.jsxs("div",{children:[t.jsxs("label",{className:a("block text-xs font-semibold uppercase mb-1.5",s.text.secondary),children:["Liability Probability (",h,"%)"]}),t.jsx("input",{type:"range",min:"0",max:"100",value:h,onChange:e=>b(Number(e.target.value)),className:"w-full"})]}),t.jsx("div",{className:"pt-4",children:t.jsx($,{variant:"primary",className:"w-full",icon:d?D:k,onClick:o,isLoading:d,children:d?"Running Monte Carlo...":"Run Simulation"})})]})]}),t.jsxs(M,{className:"lg:col-span-2 flex flex-col",children:[t.jsxs("div",{className:"flex justify-between items-start mb-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:a("text-lg font-bold",s.text.primary),children:"Settlement Value Forecast"}),t.jsxs("p",{className:a("text-sm",s.text.secondary),children:["Distribution of ",f," potential trial outcomes."]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:a("text-xs font-bold uppercase",s.text.tertiary),children:"Expected Value (EV)"}),t.jsxs("p",{className:a("text-2xl font-mono font-bold text-emerald-600"),children:["$",l.ev.toLocaleString(void 0,{maximumFractionDigits:0})]})]})]}),t.jsx("div",{className:"flex-1",style:{minHeight:"300px"},children:t.jsx(V,{width:"100%",height:"100%",children:t.jsxs(F,{data:p,margin:{top:10,right:30,left:0,bottom:0},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"colorCount",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:r.colors.success,stopOpacity:.8}),t.jsx("stop",{offset:"95%",stopColor:r.colors.success,stopOpacity:0})]})}),t.jsx(R,{dataKey:"range",fontSize:10,tickLine:!1,axisLine:!1,stroke:r.text}),t.jsx(I,{hide:!0}),t.jsx(O,{strokeDasharray:"3 3",vertical:!1,stroke:r.grid}),t.jsx(z,{cursor:{stroke:r.colors.success,strokeWidth:1},contentStyle:r.tooltipStyle}),t.jsx(H,{type:"monotone",dataKey:"count",stroke:r.colors.success,fillOpacity:1,fill:"url(#colorCount)"}),t.jsx(B,{x:p.find(e=>e.value>=l.ev)?.range,stroke:r.colors.danger,strokeDasharray:"3 3",label:"EV"})]})})}),t.jsxs("div",{className:a("grid grid-cols-3 gap-4 mt-6 pt-4 border-t",s.border.default),children:[t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:a("text-xs uppercase",s.text.secondary),children:"Conservative (P25)"}),t.jsxs("p",{className:a("font-bold",s.text.primary),children:["$",l.p25.toLocaleString(void 0,{maximumFractionDigits:0})]})]}),t.jsxs("div",{className:a("text-center border-x",s.border.default),children:[t.jsx("p",{className:a("text-xs uppercase",s.text.secondary),children:"Aggressive (P75)"}),t.jsxs("p",{className:a("font-bold",s.text.primary),children:["$",l.p75.toLocaleString(void 0,{maximumFractionDigits:0})]})]}),t.jsxs("div",{className:"text-center flex flex-col items-center justify-center",children:[t.jsxs("div",{className:"flex items-center text-green-600 text-xs font-bold",children:[t.jsx(E,{className:"h-3 w-3 mr-1"})," Recommendation"]}),t.jsxs("p",{className:a("font-bold text-sm",s.text.primary),children:["Settle $",((l.ev+l.p75)/2).toLocaleString(void 0,{maximumFractionDigits:0})]})]})]})]})]})};export{Vt as OutcomeSimulator,Vt as default};
