import{r,l as R,j as e,ab as L}from"./vendor-core-V-oW58GW.js";import{d as O,e as T,A as B,P as I,I as q,S as z}from"./case-detail-CN_DMmR8.js";import{B as V}from"./Button-PaGqeZoR.js";import{E as K}from"./ErrorState-BA0dmAVI.js";import{M as Q}from"./Modal-BlJFylOy.js";import{u as W,c as o}from"./useQueryHooks-BdeOvP9e.js";import{u as $}from"./ThemeContext-OPG61qw5.js";import{D as v}from"./dataService-75QCl8KS.js";import{q as G}from"./queryKeys-BBVgMz36.js";import"./vendor-misc-Dwkhvdtg.js";import"./vendor-charts-KZIdMATq.js";import"./Badge-B08w10nz.js";import"./schemas-B2_dy3tf.js";import"./SyncContext-DYD5yPAv.js";import"./VirtualList-B1zORm91.js";import"./AppShell-Z1zGEOCG.js";import"./preload-helper-BXl3LOEh.js";import"./tabs.config-F85gN5xx.js";import"./PageHeader-os9pD5mt.js";import"./formatters-stMuSkc6.js";import"./Table-C8OsWLsz.js";import"./EmptyState-BwtZeBY5.js";import"./useNotify-Bhb3OIEg.js";import"./dateUtils-rLIRMrtk.js";import"./Card-D56KNEnI.js";import"./MetricCard-CDV5joW_.js";import"./useSessionStorage-HC9RvMcM.js";import"./ConfirmDialog-CTAXMvML.js";import"./Kanban-BbECSZhC.js";import"./FilterPanel-C0WYx6xs.js";import"./AdaptiveLoader-gvY3s3Bs.js";import"./type-mappings-DEPYyX4d.js";import"./UserAvatar-lVqVFNPb.js";import"./Tabs-BTz8yyZK.js";import"./Input-JNgj1Ekc.js";import"./TextArea-BMpffac7.js";import"./geminiService-DjDdWyh4.js";import"./TaskCreationModal-B2VECu1_.js";import"./search.config-B6mvIgDA.js";import"./useToggle-CjLp2PQ4.js";import"./sanitize-k_Tw3ej1.js";import"./useModalState-Cst_3NmK.js";import"./scheduler-BERajRBE.js";import"./RouteErrorBoundary-Nha8Il06.js";import"./meta-utils-lVs9HXG9.js";function Ie(){const{theme:s}=$(),i=O(null,(t,h)=>t.id===h.id),[j,n]=r.useState(null),{register:m}=T(),{data:c=[],isLoading:y,error:S,refetch:b}=W(G.documents.all(),()=>v.documents.getAll()),l=R.useMemo(()=>Array.isArray(c)?c.filter(t=>t.type.toUpperCase().includes("PDF")||t.title.toLowerCase().endsWith(".pdf")):[],[c]),[d,N]=r.useState("select"),[u,w]=r.useState(1),[p,D]=r.useState(0),[F,P]=r.useState(1),[C,A]=r.useState({width:0,height:0}),[E,a]=r.useState(!1),[f,x]=r.useState(null);r.useEffect(()=>{l.length>0&&!i.selected&&i.select(l[0])},[l,i.selected]),r.useEffect(()=>{let t=!0;return i.selected?(async()=>{const g=await v.documents.getFile(i.selected.id);if(t&&g){const k=m(g);n(k)}else t&&n(null)})():n(null),()=>{t=!1}},[i.selected,m]);const M=t=>{(t.type==="signature"||t.type==="initials")&&(x(t),a(!0))},U=t=>{t&&f&&(f.value="Signed by User",a(!1),x(null))};return S?e.jsx(K,{message:"Failed to load documents",onRetry:b}):e.jsxs("div",{className:"flex h-full",children:[e.jsxs("div",{className:o("w-72 border-r flex flex-col shrink-0",s.border.default,s.surface.highlight),children:[e.jsx("div",{className:o("p-4 border-b font-bold",s.text.primary),children:"PDF Documents"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:y?e.jsx(L,{className:"animate-spin m-4"}):l.map(t=>e.jsxs("button",{onClick:()=>i.select(t),className:o("w-full text-left p-3 border-b text-sm transition-colors",s.border.default,i.selected?.id===t.id?o(s.primary.light,s.primary.text):`hover:${s.surface.default}`),children:[e.jsx("div",{className:"font-medium truncate",children:t.title}),e.jsx("div",{className:o("text-xs opacity-70",i.selected?.id===t.id?"":s.text.secondary),children:t.fileSize})]},t.id))})]}),e.jsx("div",{className:o("flex-1 flex flex-col",s.surface.default),children:i.selected?e.jsxs(e.Fragment,{children:[e.jsx(B,{activeTool:d,setActiveTool:N,scale:u,setScale:w,rotation:p,setRotation:D,pageNum:F,setPageNum:P,totalPages:10}),e.jsx("div",{className:o("flex-1 relative overflow-auto",s.surface.highlight),children:e.jsx(I,{url:j,scale:u,rotation:p,onPageLoad:A,children:e.jsx(q,{activeTool:d,dimensions:C,onFieldClick:M})})})]}):e.jsx("div",{className:o("flex-1 flex items-center justify-center",s.text.tertiary),children:"Select a document to begin."})}),e.jsx(Q,{isOpen:E,onClose:()=>a(!1),title:"Sign Document",size:"sm",children:e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:o("text-sm mb-4",s.text.secondary),children:"Draw your signature below to sign this field."}),e.jsx(z,{value:!1,onChange:U,label:"Draw Signature",subtext:"I certify this signature is valid."}),e.jsxs("div",{className:"mt-4 flex justify-end",children:[" ",e.jsx(V,{variant:"secondary",onClick:()=>a(!1),children:"Cancel"})," "]})]})})]})}export{Ie as PDFEditorView};
