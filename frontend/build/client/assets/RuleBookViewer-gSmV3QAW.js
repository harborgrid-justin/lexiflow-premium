import{r as j,j as e,b1 as R,K as L,a1 as A,ab as B,a_ as D,bK as H,cp as z,aV as M,V as P,F,a$ as V}from"./vendor-core-V-oW58GW.js";import{A as q}from"./AdaptiveLoader-D5wOoiN1.js";import{c as t,u as J}from"./useQueryHooks-Oyt-TMLP.js";import{D as T}from"./dataService-BWLMkXM4.js";import{q as W}from"./queryKeys-BBVgMz36.js";import{B as _}from"./Button-CDQlLg6j.js";import{T as Q}from"./Tabs-7xONCRTX.js";import{u as U,a as G}from"./search.config-B6mvIgDA.js";import{u as X}from"./ThemeContext-OPG61qw5.js";import{a as Y}from"./SyncContext-B5_p5hCg.js";import"./vendor-misc-Dwkhvdtg.js";import"./vendor-charts-KZIdMATq.js";import"./preload-helper-BXl3LOEh.js";import"./type-mappings-DEPYyX4d.js";function Z(x){const[u,s]=j.useState(""),[h,f]=j.useState(null),[l,a]=j.useState(new Set),[r,d]=j.useTransition(),c=U(u,G),p=j.useMemo(()=>{const o=[],i=new Map,m=JSON.parse(JSON.stringify(x));return m.forEach(n=>{n.children=[],i.set(n.id,n)}),m.forEach(n=>{n.parentId&&i.has(n.parentId)?i.get(n.parentId).children.push(n):o.push(n)}),o},[x]),{displayHierarchy:b,searchExpandedIds:N}=j.useMemo(()=>{if(!c.trim())return{displayHierarchy:p,searchExpandedIds:null};const o=c.toLowerCase().split(" ").filter(Boolean),i=new Set,m=C=>C.map(y=>{const I=`${y.code} ${y.name} ${y.type} ${y.summary||""} ${y.text||""}`.toLowerCase(),O=o.every($=>I.includes($)),E=m(y.children||[]);return O||E.length>0?(E.length>0&&i.add(y.id),{...y,children:E}):null}).filter(Boolean);return{displayHierarchy:m(p),searchExpandedIds:i}},[p,c]),g=c?N:l;j.useEffect(()=>{!c&&p.length>0&&l.size===0&&a(new Set([p[0].id]))},[p,c,l]);const v=o=>{a(i=>{const m=new Set(i);return m.has(o)?m.delete(o):m.add(o),m})},w=o=>{d(()=>{s(o)})},S=x.find(o=>o.id===h);return{searchTerm:u,setSearchTerm:w,selectedRuleId:h,setSelectedRuleId:f,expandedIds:l,toggleExpand:v,displayHierarchy:b,currentExpandedIds:g,isLoadingSearch:r,selectedRule:S}}const K=({selectedRule:x,activeTab:u,theme:s})=>{const h=f=>{if(!f)return null;const l=f;return e.jsxs("div",{className:"space-y-8",children:[u==="text"&&l.text&&e.jsx("div",{className:"space-y-6 animate-fade-in",children:Object.entries(l.text).map(([a,r])=>e.jsxs("div",{className:t("pl-4 border-l-2",s.border.default),children:[e.jsxs("h4",{className:t("text-sm font-bold mb-2 flex items-center",s.text.primary),children:[e.jsxs("span",{className:t("px-1.5 py-0.5 rounded mr-2 text-xs font-mono",s.surface.highlight,s.text.secondary),children:["(",a,")"]}),r.title]}),typeof r.content=="string"?e.jsx("p",{className:t("text-sm leading-relaxed mb-2",s.text.secondary),children:r.content}):r.content&&Object.entries(r.content).map(([d,c])=>e.jsxs("div",{className:t("ml-4 mt-2 text-sm",s.text.secondary),children:[e.jsxs("span",{className:"font-semibold capitalize",children:[d,": "]})," ",c]},d)),r.subsections&&e.jsx("ul",{className:t("ml-6 space-y-2 mt-2 list-disc text-sm",s.text.secondary),children:Object.entries(r.subsections).map(([d,c])=>e.jsxs("li",{children:[e.jsxs("span",{className:t("font-mono text-xs mr-1",s.text.tertiary),children:["(",d,")"]})," ",c]},d))})]},a))}),u==="history"&&l.statutory_notes&&e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:t("p-4 rounded-lg border",s.surface.highlight,s.border.default),children:[e.jsxs("h4",{className:t("text-sm font-bold mb-2 flex items-center",s.text.primary),children:[e.jsx(R,{className:"h-4 w-4 mr-2"})," Enactment"]}),e.jsxs("div",{className:t("text-xs grid grid-cols-2 gap-4",s.text.secondary),children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Public Law:"})," ",l.statutory_notes.enactment.public_law]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date:"})," ",l.statutory_notes.enactment.date]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Statute:"})," ",l.statutory_notes.enactment.stat]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:t("text-sm font-bold mb-3",s.text.primary),children:"Amendments"}),e.jsx("ul",{className:"space-y-2",children:l.statutory_notes.amendments.map((a,r)=>e.jsxs("li",{className:t("text-xs flex items-center p-2 border rounded hover:opacity-80",s.surface.highlight,s.border.default),children:[e.jsx("span",{className:t("font-medium mr-2",s.text.primary),children:a.date}),e.jsxs("span",{className:s.text.secondary,children:["Effective: ",a.effective_date]})]},`amendment-${a.date}-${a.effective_date}`))})]})]}),u==="notes"&&l.advisory_committee_notes&&e.jsx("div",{className:"space-y-8 animate-fade-in",children:Object.entries(l.advisory_committee_notes).map(([a,r])=>e.jsxs("div",{children:[e.jsx("h3",{className:t("text-sm font-bold uppercase tracking-wider border-b pb-2 mb-4",s.text.primary,s.border.default),children:a.replace(/_/g," ")}),e.jsx("div",{className:"space-y-6",children:Object.entries(r).map(([d,c])=>e.jsxs("div",{className:t("pl-4 border-l-2",s.primary.border),children:[e.jsx("h4",{className:t("text-xs font-bold mb-1 uppercase",s.primary.text),children:d.replace(/_/g," ")}),c.topic&&e.jsx("p",{className:t("text-xs font-medium mb-1 italic",s.text.secondary),children:c.topic}),e.jsx("p",{className:t("text-xs leading-relaxed text-justify",s.text.secondary),children:c.summary})]},d))})]},a))})]})};return x.structuredContent?h(x.structuredContent):null},k=({nodes:x,currentExpandedIds:u,selectedRuleId:s,toggleExpand:h,setSelectedRuleId:f,searchTerm:l,theme:a})=>x.length===0&&l.trim()?e.jsxs("div",{className:t("p-4 text-xs italic text-center",a.text.tertiary),children:['No rules found matching "',l,'"']}):x.length===0?e.jsx("div",{className:t("p-4 text-xs italic text-center",a.text.tertiary),children:"No rules available."}):e.jsx("ul",{className:"pl-2 space-y-1",children:x.map(r=>{const d=r.children&&r.children.length>0,c=u.has(r.id),p=s===r.id;return e.jsxs("li",{children:[e.jsxs("button",{onClick:()=>{d?h(r.id):f(r.id)},className:t("w-full flex items-center py-1.5 px-2 rounded cursor-pointer transition-colors text-sm text-left",p?t(a.primary.light,a.primary.text,"font-medium"):t(a.text.secondary,`hover:${a.surface.highlight}`)),children:[d&&e.jsx("span",{className:"mr-1 text-slate-400 shrink-0",children:c?e.jsx(L,{className:"h-3 w-3"}):e.jsx(A,{className:"h-3 w-3"})}),!d&&e.jsx("span",{className:"w-4 shrink-0"})," ",e.jsxs("span",{className:"truncate flex-1",children:[e.jsx("span",{className:"font-bold mr-2",children:r.code}),r.name]})]}),d&&c&&e.jsx(k,{nodes:r.children,currentExpandedIds:u,selectedRuleId:s,toggleExpand:h,setSelectedRuleId:f,searchTerm:l,theme:a})]},r.id)})}),pe=({type:x,isOrbital:u})=>{const{theme:s,mode:h}=X(),{openWindow:f}=Y(),[l,a]=j.useState("text"),{data:r=[],isLoading:d}=J(W.rules.all(),()=>T.rules?T.rules.getAll():Promise.resolve([])),c=j.useMemo(()=>r.filter(n=>n.type===x),[r,x]),{searchTerm:p,setSearchTerm:b,selectedRuleId:N,setSelectedRuleId:g,toggleExpand:v,displayHierarchy:w,currentExpandedIds:S,isLoadingSearch:o,selectedRule:i}=Z(c),m=n=>{const C=`rule-${n.id}`;f(C,`${n.code} - ${n.name}`,e.jsxs("div",{className:t("h-full flex flex-col p-6 overflow-y-auto",s.surface.default),children:[e.jsx("h2",{className:t("text-2xl font-bold mb-4",s.text.primary),children:n.name}),e.jsx("div",{className:t("prose max-w-none",s.text.secondary),children:n.text})]}))};return d?e.jsx(q,{contentType:"document",shimmer:!0}):e.jsxs("div",{className:t("flex h-full rounded-lg border shadow-sm overflow-hidden",s.surface.default,s.border.default),children:[e.jsxs("div",{className:t("w-80 border-r flex flex-col bg-slate-50/50",s.border.default),children:[e.jsxs("div",{className:t("p-4 border-b",s.border.default),children:[e.jsx("h3",{className:t("font-bold text-sm uppercase tracking-wide mb-3",s.text.secondary),children:"Table of Contents"}),e.jsxs("div",{className:"relative",children:[o?e.jsx(B,{className:t("absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 animate-spin",s.text.tertiary)}):e.jsx(D,{className:t("absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5",s.text.tertiary)}),e.jsx("input",{className:t("w-full pl-8 pr-3 py-1.5 text-xs border rounded-md outline-none focus:ring-1 focus:ring-blue-500",s.surface.default,s.border.default,s.text.primary),placeholder:"Search rules (e.g. '201')...",onChange:n=>b(n.target.value)})]})]}),e.jsx("div",{className:t("flex-1 overflow-y-auto p-2",o?"opacity-50":""),children:e.jsx(k,{nodes:w,currentExpandedIds:S,selectedRuleId:N,toggleExpand:v,setSelectedRuleId:g,searchTerm:p,theme:s})})]}),e.jsx("div",{className:t("flex-1 flex flex-col relative overflow-hidden",s.surface.default),children:i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:t("p-6 border-b flex justify-between items-start shrink-0",s.border.default),children:[e.jsxs("div",{children:[e.jsxs("span",{className:t("text-xs font-bold uppercase tracking-wider px-2 py-1 rounded",s.surface.highlight,s.text.secondary),children:[x," ",i.code]}),e.jsx("h2",{className:t("text-2xl font-bold mt-3 leading-tight",s.text.primary),children:i.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{variant:"ghost",size:"sm",icon:H}),e.jsx(_,{variant:"ghost",size:"sm",icon:z}),!u&&e.jsx(_,{variant:"outline",size:"sm",icon:M,onClick:()=>m(i),children:"Pop Out"})]})]}),i.structuredContent?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:t("px-6 pt-4 border-b",s.border.default),children:e.jsx(Q,{tabs:[{id:"text",label:"Rule Text",icon:P},{id:"history",label:"History & Statutory Notes",icon:R},{id:"notes",label:"Advisory Committee Notes",icon:F}],activeTab:l,onChange:n=>a(n)})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-8",children:e.jsx(K,{selectedRule:i,activeTab:l,theme:s})})]}):e.jsxs("div",{className:"flex-1 overflow-y-auto p-8 max-w-4xl mx-auto w-full",children:[e.jsx("div",{className:t("prose max-w-none leading-loose font-serif text-base",h==="dark"?"prose-invert":"prose-slate"),children:e.jsx("p",{children:i.text||i.summary})}),i.summary&&i.text&&e.jsxs("div",{className:t("mt-8 p-4 border-l-4 rounded-r-lg",s.primary.light,s.primary.border),children:[e.jsx("h4",{className:t("text-sm font-bold mb-1",s.primary.text),children:"Official Commentary / Summary"}),e.jsx("p",{className:t("text-sm leading-relaxed",s.primary.text),children:i.summary})]})]})]}):e.jsxs("div",{className:t("flex flex-col items-center justify-center h-full",s.text.tertiary),children:[e.jsx(V,{className:"h-16 w-16 mb-4 opacity-20"}),e.jsx("p",{children:"Select a rule from the Table of Contents to view."})]})})]})};export{pe as RuleBookViewer};
