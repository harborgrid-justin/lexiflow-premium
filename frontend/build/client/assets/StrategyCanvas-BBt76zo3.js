import{bA as ne,b0 as ie,a7 as oe,c9 as re,bF as le,cb as ce,F as T,a_ as de,V as F,bh as A,ca as M,T as L,ck as V,bs as G,cl as pe,bb as ue,aj as me,bm as xe,cm as fe,j as e,X,bp as be,N as ge,a$ as he,r as m}from"./vendor-core-V-oW58GW.js";import{u as _}from"./ThemeContext-OPG61qw5.js";import{a as ye}from"./AppShell-Z1zGEOCG.js";import{c as o}from"./useQueryHooks-BdeOvP9e.js";import{B as ve,a as De}from"./BuilderToolbar-BrBSlilU.js";import{B as R}from"./Button-PaGqeZoR.js";import"./ConfirmDialog-CTAXMvML.js";import"./dataService-75QCl8KS.js";import"./SyncContext-DYD5yPAv.js";import{u as J}from"./useToggle-CjLp2PQ4.js";import{I as W}from"./Input-JNgj1Ekc.js";import{T as je}from"./TextArea-BMpffac7.js";import"./type-mappings-DEPYyX4d.js";import{C as D}from"./case-detail-CN_DMmR8.js";import"./vendor-misc-Dwkhvdtg.js";import"./vendor-charts-KZIdMATq.js";import"./useNotify-Bhb3OIEg.js";import"./Modal-BlJFylOy.js";import"./preload-helper-BXl3LOEh.js";import"./Badge-B08w10nz.js";import"./schemas-B2_dy3tf.js";import"./VirtualList-B1zORm91.js";import"./tabs.config-F85gN5xx.js";import"./PageHeader-os9pD5mt.js";import"./formatters-stMuSkc6.js";import"./Table-C8OsWLsz.js";import"./EmptyState-BwtZeBY5.js";import"./dateUtils-rLIRMrtk.js";import"./Card-D56KNEnI.js";import"./MetricCard-CDV5joW_.js";import"./queryKeys-BBVgMz36.js";import"./useSessionStorage-HC9RvMcM.js";import"./ErrorState-BA0dmAVI.js";import"./Kanban-BbECSZhC.js";import"./FilterPanel-C0WYx6xs.js";import"./AdaptiveLoader-gvY3s3Bs.js";import"./UserAvatar-lVqVFNPb.js";import"./Tabs-BTz8yyZK.js";import"./geminiService-DjDdWyh4.js";import"./TaskCreationModal-B2VECu1_.js";import"./search.config-B6mvIgDA.js";import"./sanitize-k_Tw3ej1.js";import"./useModalState-Cst_3NmK.js";import"./scheduler-BERajRBE.js";import"./RouteErrorBoundary-Nha8Il06.js";import"./meta-utils-lVs9HXG9.js";const Te=(s,c,t,n)=>{const i=c.getBoundingClientRect(),d=(s.clientX-i.left-t.x)/n-D.NODE_WIDTH_HALF,r=(s.clientY-i.top-t.y)/n-D.NODE_HEIGHT_HALF;return{x:d,y:r}},O=(s,c,t,n)=>{const i=c.getBoundingClientRect(),d=(s.clientX-i.left-t.x)/n,r=(s.clientY-i.top-t.y)/n;return{x:d,y:r}},Ne=(s,c,t,n)=>[{label:"Edit Properties",icon:ne,action:()=>c(s)},{label:"Duplicate Node",icon:ie,action:()=>t(s)},{label:"Delete Node",icon:oe,danger:!0,action:()=>n(s)}],Se=(s,c)=>[{label:"Add Task Node",icon:re,action:()=>c("Task",s.x-D.NODE_WIDTH_HALF,s.y-D.NODE_HEIGHT_HALF)},{label:"Add Decision Node",icon:le,action:()=>c("Decision",s.x-D.DECISION_NODE_SIZE,s.y-D.DECISION_NODE_SIZE)},{label:"Add Phase Container",icon:ce,action:()=>c("Phase",s.x-D.PHASE_WIDTH,s.y-D.PHASE_HEIGHT)}],Ce=[{title:"Macro Phases (Boundaries)",items:[{label:"Pleading Phase",type:"Phase",icon:T,desc:"Complaint to Answer"},{label:"Discovery Phase",type:"Phase",icon:de,desc:"Fact & Expert Discovery"},{label:"Pre-Trial Phase",type:"Phase",icon:F,desc:"Dispositive Motions"},{label:"Trial Phase",type:"Phase",icon:A,desc:"Voir Dire to Verdict"}]},{title:"Case Milestones & Events",items:[{label:"Complaint Filed",type:"Start",icon:M,desc:"Initiation of Lawsuit"},{label:"Answer Due",type:"Event",icon:M,desc:"Deadline for Response"},{label:"Discovery Cutoff",type:"Event",icon:M,desc:"End of Discovery Period"},{label:"Trial Date",type:"Event",icon:A,desc:"Scheduled Trial Start"}]},{title:"Dispositive Motions",items:[{label:"Rule 12(b)(6)",type:"Decision",icon:F,desc:"Motion to Dismiss"},{label:"Rule 56",type:"Decision",icon:T,desc:"Summary Judgment"},{label:"Rule 12(c)",type:"Decision",icon:T,desc:"Judgment on Pleadings"},{label:"Rule 11",type:"Decision",icon:L,desc:"Sanctions Motion"}]},{title:"Discovery & Procedural Tools",items:[{label:"Rule 26(f) Conference",type:"Task",icon:V,desc:"Initial Discovery Plan"},{label:"Deposition",type:"Task",icon:G,desc:"Oral Testimony"},{label:"Interrogatories",type:"Task",icon:T,desc:"Written Questions"},{label:"Request for Admission",type:"Task",icon:V,desc:"Fact Admissions"},{label:"Subpoena",type:"Task",icon:pe,desc:"Third-Party Discovery"}]},{title:"ADR & Settlement",items:[{label:"Mediation",type:"Event",icon:ue,desc:"Third-party resolution"},{label:"Settlement Conf",type:"Event",icon:me,desc:"Judicial Conference"},{label:"Offer of Judgment",type:"Decision",icon:T,desc:"Rule 68 Offer"}]},{title:"Trial & Post-Trial",items:[{label:"Motion in Limine",type:"Decision",icon:A,desc:"Exclude Evidence"},{label:"Rule 50",type:"Decision",icon:L,desc:"Directed Verdict"},{label:"Rule 59",type:"Decision",icon:xe,desc:"Motion for New Trial"}]},{title:"Appellate Procedure",items:[{label:"Notice of Appeal",type:"End",icon:fe,desc:"Initiate Appeal"},{label:"Appellant's Brief",type:"Task",icon:T,desc:"Opening Brief"},{label:"Appellee's Brief",type:"Task",icon:T,desc:"Response Brief"},{label:"Oral Argument",type:"Event",icon:G,desc:"Appellate Hearing"}]}],we={"Rule 12(b)(6)":"Motion to Dismiss for failure to state a claim. Standard: Assuming all facts true, plaintiff cannot win.","Rule 56":"Summary Judgment. Standard: No genuine dispute of material fact.","Rule 50":"Directed Verdict / Judgment as a Matter of Law."},Pe=({isOpen:s,onClose:c})=>{const{theme:t}=_(),n=(i,d,r)=>{i.dataTransfer.setData("application/reactflow",d),i.dataTransfer.setData("application/litigation-node",r),i.dataTransfer.effectAllowed="move"};return e.jsxs("div",{className:o("absolute md:static inset-y-0 left-0 w-72 border-r z-10 transition-transform duration-300 shadow-xl md:shadow-none flex flex-col",t.surface.default,t.border.default,s?"translate-x-0":"-translate-x-full md:w-0 md:overflow-hidden"),children:[e.jsxs("div",{className:o("p-4 border-b flex justify-between items-center",t.border.default),children:[e.jsx("h4",{className:o("font-bold text-sm uppercase tracking-wider",t.text.primary),children:"Strategy Toolkit"}),e.jsx("button",{onClick:c,className:"md:hidden",children:e.jsx(X,{className:o("h-4 w-4",t.text.tertiary)})})]}),e.jsx("div",{className:"p-4 h-full flex flex-col overflow-y-auto custom-scrollbar",children:e.jsx("div",{className:"space-y-6",children:Ce.map((i,d)=>e.jsxs("div",{children:[e.jsx("h5",{className:o("text-[10px] font-bold uppercase tracking-wide mb-3 pl-1",t.text.tertiary),children:i.title}),e.jsx("div",{className:"space-y-2",children:i.items.map(r=>e.jsxs("div",{draggable:!0,onDragStart:x=>n(x,r.type,r.label),className:o("flex items-center gap-3 p-3 border rounded-lg cursor-grab active:cursor-grabbing hover:shadow-md transition-all group",t.surface.default,t.border.default,`hover:${t.primary.border}`),children:[e.jsx(be,{className:o("h-4 w-4 text-slate-300 group-hover:text-slate-400")}),e.jsx("div",{className:o("p-1.5 rounded-md",r.type==="Phase"?"bg-indigo-100 text-indigo-600":r.type==="Decision"?"bg-purple-100 text-purple-600":r.type==="End"?"bg-red-100 text-red-600":"bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300"),children:e.jsx(r.icon,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("span",{className:o("text-xs font-bold block",t.text.primary),children:r.label}),e.jsx("span",{className:o("text-[9px] block",t.text.tertiary),children:r.desc})]})]},r.label))})]},d))})})]})},ke=({isOpen:s,onClose:c,selectedNode:t,selectedConnection:n,onUpdateNode:i,onDeleteNode:d,onUpdateConnection:r,onDeleteConnection:x})=>{const{theme:l}=_();if(!s)return e.jsx("div",{className:"hidden","aria-hidden":"true"});const h=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(W,{label:"Stage / Motion Name",value:t.label,onChange:u=>i(t.id,{label:u.target.value})}),t.type==="Decision"&&e.jsxs("div",{children:[e.jsx("label",{className:o("block text-xs font-semibold uppercase mb-1.5",l.text.secondary),children:"Success Probability"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:Number(t.config.probability)||50,onChange:u=>i(t.id,{config:{...t.config,probability:parseInt(u.target.value)}}),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600"}),e.jsxs("span",{className:"font-mono text-sm font-bold w-12 text-right",children:[Number(t.config.probability)||50,"%"]})]})]}),e.jsx(je,{label:"Strategic Notes",rows:4,placeholder:"Why are we filing this? What is the probability of success?",value:String(t.config.description||""),onChange:u=>i(t.id,{config:{...t.config,description:u.target.value}})})]}),e.jsxs("div",{className:o("pt-4 mt-auto border-t flex flex-col gap-2",l.border.default),children:[e.jsx(R,{variant:"outline",icon:he,children:"View Applicable Rule"}),e.jsx(R,{variant:"danger",onClick:()=>d(t.id),children:"Remove Node"})]})]}),w=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(W,{label:"Condition / Label",value:n.label||"",onChange:u=>r(n.id,{label:u.target.value}),placeholder:"e.g., Granted, Default"}),e.jsxs("div",{className:o("text-xs p-2 rounded border",l.surface.highlight,l.border.default),children:[e.jsxs("p",{children:["From: ",e.jsx("span",{className:"font-mono",children:n.from})]}),e.jsxs("p",{children:["To: ",e.jsx("span",{className:"font-mono",children:n.to})]})]})]}),e.jsx("div",{className:o("pt-4 mt-auto border-t",l.border.default),children:e.jsx(R,{variant:"danger",onClick:()=>x(n.id),children:"Delete Connection"})})]});return e.jsxs("div",{className:o("absolute md:static inset-y-0 right-0 w-80 border-l z-30 shadow-2xl md:shadow-none transition-transform duration-300 flex flex-col",l.surface.default,l.border.default,s?"translate-x-0":"translate-x-full"),children:[e.jsxs("div",{className:o("p-4 border-b flex justify-between items-center",l.border.default,l.surface.highlight),children:[e.jsxs("h4",{className:o("font-bold text-sm flex items-center",l.text.primary),children:[e.jsx(ge,{className:"h-4 w-4 mr-2"})," ",n?"Connection":"Node"," Properties"]}),e.jsx("button",{onClick:c,className:o(l.text.tertiary,`hover:${l.text.primary}`),children:e.jsx(X,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 flex flex-col",children:t?h():n?w():e.jsx("div",{className:o("text-center py-10 text-sm",l.text.tertiary),children:"Select a node or connection to configure."})})]})},Ee=({x:s,y:c,items:t,onClose:n})=>{const{theme:i}=_(),d=m.useRef(null),r=m.useId();return ye(d,n),e.jsx("div",{ref:d,id:r,role:"menu","aria-label":"Context menu",className:o("fixed z-[9999] w-52 rounded-xl shadow-2xl p-2 animate-in fade-in zoom-in-95 duration-100 border backdrop-blur-sm bg-opacity-80",i.surface.default,i.border.default),style:{top:c,left:s},children:t.map(x=>{const l=x.icon;return e.jsxs("button",{onClick:()=>{x.action(),n()},className:o("w-full flex items-center gap-3 px-3 py-2 text-sm rounded-lg transition-colors",x.danger?o("text-red-600","hover:bg-red-50","dark:hover:bg-red-900/20"):o(i.text.primary,`hover:${i.surface.highlight}`)),children:[l&&e.jsx(l,{className:"h-4 w-4"}),e.jsx("span",{children:x.label})]},x.label)})})},Tt=({nodes:s,connections:c,addNode:t,updateNode:n,deleteNode:i,addConnection:d,updateConnection:r,deleteConnection:x})=>{const[l,h]=m.useState(null),[w,u]=m.useState(null),[y,q]=m.useState(1),[j,z]=m.useState({x:0,y:0}),k=J(!0),N=J(!0),[E,B]=m.useState(null),[I,Y]=m.useState({x:0,y:0}),b=m.useRef(null),[H,P]=m.useState(null),$=a=>we[a]||"Standard litigation event.",U=m.useCallback(a=>{a.preventDefault();const f=a.dataTransfer.getData("application/reactflow"),p=a.dataTransfer.getData("application/litigation-node");if(!f&&!p||!b.current)return;const{x:g,y:C}=Te(a,b.current,j,y),v=t(f||"Task",g,C,p);p&&n(v,{config:{litigationType:p,description:$(p)}}),h(v),u(null),N.open()},[j,y,t,n]),Z=m.useCallback(a=>{if(E&&b.current){const f=O(a,b.current,j,y);n(E,{x:f.x-I.x,y:f.y-I.y})}},[E,I,y,j,n]),Q=(a,f)=>{a.stopPropagation();const p=s.find(g=>g.id===f);if(p&&b.current){const g=O(a,b.current,j,y);Y({x:g.x-p.x,y:g.y-p.y}),B(f),h(f),u(null),N.open()}},K=a=>{h(null),u(a),N.open()},ee=()=>{h(null),u(null),P(null)},te=a=>{i(a),l===a&&h(null)},ae=a=>{a.preventDefault(),a.stopPropagation();const p=a.target.closest("[data-drag-id]")?.getAttribute("data-drag-id");if(p){if(!s.find(S=>S.id===p))return;const C=Ne(p,S=>{h(S),N.open()},S=>{const v=s.find(se=>se.id===S);v&&t(v.type,v.x+20,v.y+20,v.label)},i);P({x:a.clientX,y:a.clientY,items:C})}else{if(!b.current)return;const g=O(a,b.current,j,y),C=Se(g,t);P({x:a.clientX,y:a.clientY,items:C})}};return e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:"shrink-0",children:e.jsx(ve,{scale:y,setScale:q,onToggleSidebar:k.toggle})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden relative",onDrop:U,onDragOver:a=>a.preventDefault(),onMouseMove:Z,onMouseUp:()=>B(null),onContextMenu:ae,children:[e.jsx(Pe,{isOpen:k.isOpen,onClose:k.close}),e.jsx("div",{className:"flex-1",children:e.jsx(De,{nodes:s,connections:c,selectedNodeId:l,selectedConnectionId:w,onSelectConnection:K,scale:y,pan:j,setPan:z,canvasRef:b,onMouseDownNode:Q,onBackgroundClick:ee,onAddConnection:d})}),e.jsx(ke,{isOpen:N.isOpen,onClose:N.close,selectedNode:s.find(a=>a.id===l)||null,selectedConnection:c.find(a=>a.id===w)||null,onUpdateNode:n,onDeleteNode:te,onUpdateConnection:r,onDeleteConnection:x}),H&&e.jsx(Ee,{...H,onClose:()=>P(null)})]})]})};export{Tt as StrategyCanvas};
