import{r as y,j as e,aE as v,X as P,a_ as E,ab as S,K as T,l as A,by as I,aa as U,a0 as B,ac as L}from"./vendor-core-V-oW58GW.js";import{D as R,T as C,f as g}from"./dataService-75QCl8KS.js";import{u as w,c as o,q as F}from"./useQueryHooks-BdeOvP9e.js";import{q as b}from"./queryKeys-BBVgMz36.js";import{u as M}from"./useNotify-Bhb3OIEg.js";import{M as O}from"./Modal-BlJFylOy.js";import{I as H}from"./Input-JNgj1Ekc.js";import{T as $}from"./TextArea-BMpffac7.js";import{B as N}from"./Button-PaGqeZoR.js";import{u as q,a as G}from"./search.config-B6mvIgDA.js";import{u as D}from"./ThemeContext-OPG61qw5.js";import{U as J}from"./UserAvatar-lVqVFNPb.js";import"./type-mappings-DEPYyX4d.js";const x=[{id:"frcp-26f",code:"FRCP 26(f)",name:"Conference of the Parties; Planning for Discovery",type:"FRCP",jurisdiction:"Federal",category:"Discovery"},{id:"frcp-12b",code:"FRCP 12(b)",name:"How to Present Defenses",type:"FRCP",jurisdiction:"Federal",category:"Pleadings"},{id:"frcp-16",code:"FRCP 16",name:"Pretrial Conferences; Scheduling; Management",type:"FRCP",jurisdiction:"Federal",category:"Trial"},{id:"frcp-26a",code:"FRCP 26(a)",name:"Required Disclosures",type:"FRCP",jurisdiction:"Federal",category:"Discovery"},{id:"frcp-30",code:"FRCP 30",name:"Depositions by Oral Examination",type:"FRCP",jurisdiction:"Federal",category:"Discovery"},{id:"frcp-33",code:"FRCP 33",name:"Interrogatories to Parties",type:"FRCP",jurisdiction:"Federal",category:"Discovery"},{id:"frcp-34",code:"FRCP 34",name:"Producing Documents, Electronically Stored Information, and Tangible Things",type:"FRCP",jurisdiction:"Federal",category:"Discovery"},{id:"frcp-36",code:"FRCP 36",name:"Requests for Admission",type:"FRCP",jurisdiction:"Federal",category:"Discovery"},{id:"frcp-56",code:"FRCP 56",name:"Summary Judgment",type:"FRCP",jurisdiction:"Federal",category:"Motions"},{id:"fre-401",code:"FRE 401",name:"Test for Relevant Evidence",type:"FRE",jurisdiction:"Federal",category:"Evidence"},{id:"fre-402",code:"FRE 402",name:"General Admissibility of Relevant Evidence",type:"FRE",jurisdiction:"Federal",category:"Evidence"},{id:"fre-403",code:"FRE 403",name:"Excluding Relevant Evidence for Prejudice, Confusion, or Other Reasons",type:"FRE",jurisdiction:"Federal",category:"Evidence"},{id:"fre-801",code:"FRE 801",name:"Definitions That Apply to This Article; Exclusions from Hearsay",type:"FRE",jurisdiction:"Federal",category:"Evidence"},{id:"fre-802",code:"FRE 802",name:"The Rule Against Hearsay",type:"FRE",jurisdiction:"Federal",category:"Evidence"},{id:"frap-4",code:"FRAP 4",name:"Appeal as of Rightâ€”When Taken",type:"FRAP",jurisdiction:"Federal",category:"Appeals"},{id:"frap-28",code:"FRAP 28",name:"Appellant's Brief",type:"FRAP",jurisdiction:"Federal",category:"Appeals"}];class _{async search(s){if(!s||s.trim().length<2)return[];const r=s.toLowerCase();return x.filter(t=>t.code.toLowerCase().includes(r)||t.name.toLowerCase().includes(r)||t.category?.toLowerCase().includes(r)).slice(0,20)}async getByCode(s){return x.find(r=>r.code===s)||null}async getByJurisdiction(s){return x.filter(r=>r.jurisdiction===s)}async getByCategory(s){return x.filter(r=>r.category===s)}async getAll(){return[...x]}getCategories(){const s=new Set;return x.forEach(r=>{r.category&&s.add(r.category)}),Array.from(s).sort()}getJurisdictions(){const s=new Set;return x.forEach(r=>{r.jurisdiction&&s.add(r.jurisdiction)}),Array.from(s).sort()}}const W=new _,z=({selectedRules:d,onRulesChange:s,readOnly:r=!1})=>{const{theme:t}=D(),f=y.useId(),[c,m]=y.useState(""),[p,l]=y.useState(!1),h=q(c,G),{data:a=[],isLoading:u}=w(["rules","search",h],()=>W.search(h),{enabled:!!h}),j=n=>{s([...d,n]),m(""),l(!1)},i=n=>{r||s(d.filter(k=>k!==n))};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[d.map(n=>e.jsxs("div",{className:o("inline-flex items-center px-2 py-1 rounded border text-xs cursor-default group",t.surface.highlight,t.border.default,t.text.primary),children:[e.jsx(v,{className:o("h-3 w-3 mr-1",t.text.tertiary)}),e.jsx("span",{className:"font-medium mr-1",children:n}),!r&&e.jsx("button",{onClick:()=>i(n),className:o("ml-1 hover:text-red-500",t.text.tertiary),"aria-label":`Remove rule ${n}`,children:e.jsx(P,{className:"h-3 w-3"})})]},n)),d.length===0&&r&&e.jsx("span",{className:o("text-xs italic",t.text.tertiary),children:"No rules linked."})]}),!r&&e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:o("flex items-center border rounded-md transition-shadow focus-within:ring-1 focus-within:ring-blue-500",t.surface.default,t.border.default),children:[e.jsx(E,{className:o("h-4 w-4 ml-2",t.text.tertiary)}),e.jsx("input",{id:f,"aria-label":"Search legal rules",className:o("flex-1 px-2 py-2 text-sm outline-none bg-transparent placeholder:text-slate-400 dark:placeholder:text-slate-500",t.text.primary),placeholder:"Search rules (e.g. 'FRCP 12')...",value:c,onChange:n=>{m(n.target.value),l(!0)},onFocus:()=>l(!0),onBlur:()=>setTimeout(()=>l(!1),200)}),u&&e.jsx(S,{className:"h-4 w-4 mr-2 animate-spin text-blue-600"})]}),p&&c&&e.jsx("div",{className:o("absolute top-full left-0 right-0 mt-1 border rounded-md shadow-lg z-50 max-h-60 overflow-y-auto",t.surface.default,t.border.default),children:a.length>0?a.filter(n=>!d.includes(n.code)).map(n=>e.jsxs("div",{className:o("px-3 py-2 cursor-pointer border-b last:border-0 group transition-colors",t.border.default,`hover:${t.surface.highlight}`),onClick:()=>j(n.code),children:[e.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[e.jsxs("span",{className:o("font-bold text-sm flex items-center",t.text.primary),children:[e.jsx(v,{className:"h-3 w-3 mr-1.5 text-blue-500 opacity-0 group-hover:opacity-100 transition-opacity"}),n.code]}),e.jsx("span",{className:o("text-[10px] uppercase px-1.5 py-0.5 rounded border",t.surface.highlight,t.border.default,t.text.secondary),children:n.type})]}),e.jsx("p",{className:o("text-xs truncate pl-4",t.text.secondary),children:n.name}),n.summary&&e.jsx("p",{className:o("text-[10px] truncate pl-4 mt-0.5 italic",t.text.tertiary),children:n.summary})]},n.id)):e.jsxs("div",{className:o("p-3 text-center text-xs",t.text.tertiary),children:[u?"Searching...":"No matching rules found."," ",e.jsx("br",{}),!u&&e.jsx("span",{className:"text-[10px]",children:"Go to Jurisdiction Manager to add new rules."})]})})]})]})};function K({label:d,value:s,onChange:r,options:t,className:f=""}){const{theme:c}=D(),m=y.useId(),p=t.find(l=>l.name===s||l.id===s);return e.jsxs("div",{className:`relative ${f}`,children:[d&&e.jsx("label",{htmlFor:m,className:o("block text-xs font-semibold uppercase mb-1.5",c.text.secondary),children:d}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{id:m,value:s,onChange:l=>r(l.target.value),"aria-label":d||"Select user",className:o("w-full pl-10 pr-8 py-2.5 border rounded-md text-sm outline-none focus:ring-2 focus:ring-blue-500 appearance-none cursor-pointer",c.surface.default,c.border.default,c.text.primary),children:[e.jsx("option",{value:"",children:"Select User..."}),t.map(l=>e.jsxs("option",{value:l.name,children:[l.name," ",l.role?`(${l.role})`:""]},l.id))]}),e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none",children:p?e.jsx(J,{name:p.name,size:"sm"}):e.jsx("div",{className:o("w-6 h-6 rounded-full border",c.surface.highlight,c.border.default)})}),e.jsx(T,{className:o("absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 pointer-events-none",c.text.tertiary)})]})]})}const le=({isOpen:d,onClose:s,initialTitle:r,relatedModule:t,relatedItemId:f,relatedItemTitle:c,projects:m=[],onSave:p})=>{const l=M(),{data:h=[]}=w(b.users.all(),()=>R.users.getAll()),[a,u]=y.useState(()=>({title:r||"",priority:g.MEDIUM,status:C.TODO,assignee:"James Doe",dueDate:"",projectId:"",linkedRules:[]}));A.useEffect(()=>{if(!a.dueDate){const i=new Date(Date.now()+6048e5);u(n=>({...n,dueDate:i.toISOString().split("T")[0]}))}},[]);const j=async()=>{if(!a.title)return;const i={id:`t-${crypto.randomUUID?crypto.randomUUID():`temp-${Math.random()}`}`,title:a.title,status:C.TODO,assignee:a.assignee||"Unassigned",dueDate:a.dueDate||"",priority:a.priority||g.MEDIUM,description:a.description,relatedModule:t,relatedItemId:f,relatedItemTitle:c,actionLabel:`View ${t||"Item"}`,projectId:a.projectId,linkedRules:a.linkedRules,caseId:"General"};p?p(i):(await R.tasks.add(i),F.invalidate(b.tasks.all()),F.invalidate(b.dashboard.stats()),l.success("Task created. Completion will trigger billing prompt.")),s()};return e.jsx(O,{isOpen:d,onClose:s,title:"Create Workflow Task",children:e.jsxs("div",{className:"p-6 space-y-4",children:[c&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 text-xs text-blue-800 flex items-center mb-4",children:[e.jsx(I,{className:"h-3 w-3 mr-2"}),"Linked to ",t,": ",e.jsx("strong",{children:c})]}),e.jsx(H,{label:"Task Title",placeholder:"e.g. Review Document",value:a.title,onChange:i=>u({...a,title:i.target.value}),autoFocus:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(K,{label:"Assignee",value:a.assignee||"",onChange:i=>u({...a,assignee:i}),options:h})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-500 uppercase mb-1.5",children:"Due Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx("input",{type:"date",className:"w-full pl-9 pr-3 py-2 border rounded-md text-sm outline-none focus:ring-2 focus:ring-blue-500",value:a.dueDate,onChange:i=>u({...a,dueDate:i.target.value}),"aria-label":"Due Date"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-500 uppercase mb-1.5",children:"Priority"}),e.jsxs("select",{className:"w-full px-3 py-2 border rounded-md text-sm bg-white outline-none focus:ring-2 focus:ring-blue-500",value:a.priority,onChange:i=>u({...a,priority:i.target.value}),"aria-label":"Priority",children:[e.jsx("option",{value:g.LOW,children:"Low"}),e.jsx("option",{value:g.MEDIUM,children:"Medium"}),e.jsx("option",{value:g.HIGH,children:"High"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-500 uppercase mb-1.5",children:"Link to Project"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsxs("select",{className:"w-full pl-9 pr-3 py-2 border rounded-md text-sm bg-white outline-none focus:ring-2 focus:ring-blue-500",value:a.projectId,onChange:i=>u({...a,projectId:i.target.value}),"aria-label":"Link to Project",children:[e.jsx("option",{value:"",children:"-- No Project --"}),m.map(i=>e.jsx("option",{value:i.id,children:i.title},i.id))]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-500 uppercase mb-1.5",children:"Governing Rules"}),e.jsx(z,{selectedRules:a.linkedRules||[],onRulesChange:i=>u({...a,linkedRules:i})})]}),e.jsx($,{label:"Instructions",rows:3,placeholder:"Add specific instructions for the assignee...",value:a.description||"",onChange:i=>u({...a,description:i.target.value})}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3 border-t border-slate-100",children:[e.jsx(N,{variant:"secondary",onClick:s,children:"Cancel"}),e.jsx(N,{variant:"primary",icon:L,onClick:j,children:"Create Task"})]})]})})};export{z as R,le as T};
