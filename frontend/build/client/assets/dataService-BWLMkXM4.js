const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chartColorService-Dq1XQNFk.js","assets/ThemeContext-OPG61qw5.js","assets/vendor-core-V-oW58GW.js","assets/vendor-misc-Dwkhvdtg.js","assets/vendor-charts-KZIdMATq.js","assets/NotificationDomain-CboSxEPd.js","assets/useQueryHooks-Oyt-TMLP.js","assets/CollaborationDomain-BHMeC4HU.js","assets/preload-helper-BXl3LOEh.js","assets/type-mappings-DEPYyX4d.js","assets/WarRoomDomain-gMI7obYj.js","assets/SearchDomain-CBnrWQ7Z.js","assets/DashboardDomain-B4reiZxA.js","assets/StrategyDomain-ixp8fBvc.js","assets/ResearchDomain-D6KfW5Ej.js","assets/OrganizationDomain-DtXDtnda.js","assets/TransactionDomain-mxpB2Z22.js","assets/MessengerDomain-Bz44GAkg.js","assets/AssetDomain-CnE8szAw.js","assets/DataSourceDomain-Dcwsp64o.js"])))=>i.map(i=>d[i]);
import{_ as m}from"./preload-helper-BXl3LOEh.js";import{i as T,b as B,q as L,a as H,e as me,f as $,V as u,A as ke,h as Be,D as Pe,j as G,O as l,k as b,l as _e,m as de,B as Q,n as W,o as ve,P as Oe,C as Le,p as Fe,J as x,r as xe,E as U,s as Me,t as Ne,T as $e,M as Ue,v as A,w as He,x as Ve,L as ze,y as je,R as Ge}from"./useQueryHooks-Oyt-TMLP.js";import{C as Se,c as We}from"./type-mappings-DEPYyX4d.js";import"./vendor-core-V-oW58GW.js";class p{static shouldUseBackend(){return T()}static route(e,t){return this.shouldUseBackend()&&e?e:t}static routeLazy(e,t){if(this.shouldUseBackend()){const r=e();if(r)return r}return t()}static createPropertyDescriptor(e,t){return{get:()=>{if(this.shouldUseBackend()&&e){const r=B[e];if(r)return r}return t()},enumerable:!0,configurable:!0}}static createRouteMap(e){const t={};for(const[r,{api:i,fallback:s}]of Object.entries(e))t[r]=this.createPropertyDescriptor(i,s);return t}}var f=(a=>(a.CASE_CREATED="CASE_CREATED",a.MATTER_CREATED="MATTER_CREATED",a.LEAD_STAGE_CHANGED="LEAD_STAGE_CHANGED",a.DOCKET_INGESTED="DOCKET_INGESTED",a.TASK_COMPLETED="TASK_COMPLETED",a.DOCUMENT_UPLOADED="DOCUMENT_UPLOADED",a.INVOICE_STATUS_CHANGED="INVOICE_STATUS_CHANGED",a.EVIDENCE_STATUS_UPDATED="EVIDENCE_STATUS_UPDATED",a.CITATION_SAVED="CITATION_SAVED",a.WALL_ERECTED="WALL_ERECTED",a.ETHICAL_WALL_CREATED="ETHICAL_WALL_CREATED",a.CONFLICT_DETECTED="CONFLICT_DETECTED",a.SECURITY_THREAT_DETECTED="SECURITY_THREAT_DETECTED",a.STAFF_HIRED="STAFF_HIRED",a.SERVICE_COMPLETED="SERVICE_COMPLETED",a.DATA_SOURCE_CONNECTED="DATA_SOURCE_CONNECTED",a.CLOUD_SYNC_STARTED="CLOUD_SYNC_STARTED",a.CLOUD_SYNC_FAILED="CLOUD_SYNC_FAILED",a.RISK_ESCALATED="RISK_ESCALATED",a.TIME_LOGGED="TIME_LOGGED",a.ENTITY_CREATED="ENTITY_CREATED",a))(f||{});const se=Object.freeze(Object.defineProperty({__proto__:null,SystemEventType:f},Symbol.toStringTag,{value:"Module"}));class R{static listeners=new Map;static subscribe(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e)?.push(t)}static async publishCaseCreated(e){await this.publish(f.CASE_CREATED,{caseData:e})}static async publishDocketIngested(e){await this.publish(f.DOCKET_INGESTED,{entry:e,caseId:e.caseId})}static async publishDocumentUploaded(e){await this.publish(f.DOCUMENT_UPLOADED,{document:e})}static async publishTimeLogged(e){await this.publish(f.TIME_LOGGED,{entry:e})}static async publishDataSourceConnected(e,t,r){await this.publish(f.DATA_SOURCE_CONNECTED,{connectionId:e,provider:t,name:r})}static async publish(e,t){const r=this.listeners.get(e)||[];await Promise.all(r.map(i=>i(t)))}}function le(a,e,t,r){return class extends a{constructor(...s){super(...s)}async add(s){const o=await super.add(s);return e&&await e(o),o}async update(s,o){return await super.update(s,o)}async delete(s){return await super.delete(s)}}}let E=class{static instances=new Map;static getOrCreate(e,t){return this.instances.has(e)||this.instances.set(e,t()),this.instances.get(e)}static has(e){return this.instances.has(e)}static get(e){return this.instances.get(e)}static register(e,t){this.instances.set(e,t)}static remove(e){return this.instances.delete(e)}static clear(){this.instances.clear()}static keys(){return Array.from(this.instances.keys())}static size(){return this.instances.size}};const qe="LexiFlowDB",Je=31,Ke=1e3,Ye=500,Qe=5;class Xe{isAvailable;constructor(){this.isAvailable=typeof window<"u"}setInterval(e,t){if(!this.isAvailable)throw new j("setInterval not available in non-browser environment");return window.setInterval(e,t)}clearInterval(e){this.isAvailable&&window.clearInterval(e)}setTimeout(e,t){if(!this.isAvailable)throw new j("setTimeout not available in non-browser environment");return window.setTimeout(e,t)}clearTimeout(e){this.isAvailable&&window.clearTimeout(e)}addEventListener(e,t){this.isAvailable&&window.addEventListener(e,t)}removeEventListener(e,t){this.isAvailable&&window.removeEventListener(e,t)}now(){return this.isAvailable&&window.performance?performance.now():Date.now()}isBrowser(){return this.isAvailable}requestAnimationFrame(e){if(!this.isAvailable)throw new j("requestAnimationFrame not available in non-browser environment");return window.requestAnimationFrame(e)}cancelAnimationFrame(e){this.isAvailable&&window.cancelAnimationFrame(e)}}class Ze{setInterval(e,t){throw new j("setInterval not available in SSR environment")}clearInterval(e){}setTimeout(e,t){throw new j("setTimeout not available in SSR environment")}clearTimeout(e){}addEventListener(e,t){}removeEventListener(e,t){}now(){return Date.now()}isBrowser(){return!1}requestAnimationFrame(e){throw new j("requestAnimationFrame not available in SSR environment")}cancelAnimationFrame(e){}}class j extends Error{constructor(e){super(e),this.name="EnvironmentError"}}const oe=typeof window<"u"?new Xe:new Ze;class et{constructor(e){this.isLeaf=e}keys=[];values=[];children=[]}class tt{root;t;constructor(e){this.t=e,this.root=new et(!0)}search(e){return this._search(this.root,e)}_search(e,t){let r=0;for(;r<e.keys.length&&t>e.keys[r];)r++;return r<e.keys.length&&t===e.keys[r]?e.values[r]:e.isLeaf?null:this._search(e.children[r],t)}insert(e,t){if(this.root.keys.length<2*this.t-1){const r=this.root.keys.findIndex(i=>i>e);r===-1?(this.root.keys.push(e),this.root.values.push(t)):(this.root.keys.splice(r,0,e),this.root.values.splice(r,0,t))}else console.warn("B-Tree insert logic simplified: root is full.")}rangeSearch(e,t){const r=[];return this._rangeSearch(this.root,e,t,r),r}_rangeSearch(e,t,r,i){let s=0;for(;s<e.keys.length&&t>e.keys[s];)s++;for(e.isLeaf||this._rangeSearch(e.children[s],t,r,i);s<e.keys.length&&e.keys[s]<=r;)i.push(e.values[s]),e.isLeaf||this._rangeSearch(e.children[s+1],t,r,i),s++}}const rt=5*1024*1024;function O(){if(typeof window>"u")return!1;try{const a="__storage_test__";return window.localStorage.setItem(a,"test"),window.localStorage.removeItem(a),!0}catch(a){return console.warn("[StorageUtils] localStorage is not available:",a),!1}}const I={validateKey:(a,e)=>{if(!a||a.trim()==="")throw new Error(`[StorageUtils.${e}] Storage key is required and must be a non-empty string`)},get:(a,e)=>{try{if(I.validateKey(a,"get"),!O())return console.warn("[StorageUtils.get] localStorage not available, returning default"),e;const t=window.localStorage.getItem(a);if(!t)return e;try{return JSON.parse(t)}catch(r){return console.error(`[StorageUtils.get] JSON parse error for key "${a}":`,r),e}}catch(t){return console.error(`[StorageUtils.get] Error reading "${a}":`,t),e}},getString:(a,e="")=>{try{return I.validateKey(a,"getString"),O()?window.localStorage.getItem(a)??e:e}catch(t){return console.error(`[StorageUtils.getString] Error reading "${a}":`,t),e}},set:(a,e)=>{try{if(I.validateKey(a,"set"),!O())return console.warn("[StorageUtils.set] localStorage not available"),!1;const t=JSON.stringify(e);return window.localStorage.setItem(a,t),I.checkStorageSize(),!0}catch(t){return console.error(`[StorageUtils.set] Error saving "${a}":`,t),t instanceof DOMException&&t.name==="QuotaExceededError"&&console.warn("[StorageUtils] LocalStorage quota exceeded. Consider clearing old data."),t instanceof TypeError&&t.message.includes("circular")&&console.error("[StorageUtils] Cannot stringify circular structure"),!1}},setString:(a,e)=>{try{return I.validateKey(a,"setString"),O()?(window.localStorage.setItem(a,e),!0):!1}catch(t){return console.error(`[StorageUtils.setString] Error saving "${a}":`,t),!1}},remove:a=>{try{if(I.validateKey(a,"remove"),!O())return;window.localStorage.removeItem(a)}catch(e){console.error(`[StorageUtils.remove] Error removing "${a}":`,e)}},clearAll:()=>{try{if(!O())return;const a=[];for(let e=0;e<window.localStorage.length;e++){const t=window.localStorage.key(e);t&&t.startsWith("lexiflow_")&&a.push(t)}a.forEach(e=>{window.localStorage.removeItem(e)}),console.log(`[StorageUtils] Cleared ${a.length} items`),typeof window<"u"&&window.location.reload()}catch(a){console.error("[StorageUtils.clearAll] Error clearing storage:",a)}},has:a=>{try{return I.validateKey(a,"has"),O()?window.localStorage.getItem(a)!==null:!1}catch(e){return console.error(`[StorageUtils.has] Error checking "${a}":`,e),!1}},getAllKeys:()=>{try{if(!O())return[];const a=[];for(let e=0;e<window.localStorage.length;e++){const t=window.localStorage.key(e);t&&t.startsWith("lexiflow_")&&a.push(t)}return a}catch(a){return console.error("[StorageUtils.getAllKeys] Error:",a),[]}},getSize:()=>{try{if(!O())return 0;let a=0;for(let e=0;e<window.localStorage.length;e++){const t=window.localStorage.key(e);if(t){const r=window.localStorage.getItem(t);r&&(a+=t.length+r.length)}}return a}catch(a){return console.error("[StorageUtils.getSize] Error:",a),0}},checkStorageSize:()=>{try{const a=I.getSize();a>rt&&console.warn(`[StorageUtils] Storage size (${(a/1024/1024).toFixed(2)} MB) exceeds warning threshold`)}catch(a){console.error("[StorageUtils.checkStorageSize] Error:",a)}},getStatistics:()=>{try{if(!O())return{totalKeys:0,lexiflowKeys:0,totalSize:0,available:!1};const a=I.getAllKeys(),e=I.getSize();return{totalKeys:window.localStorage.length,lexiflowKeys:a.length,totalSize:e,available:!0}}catch(a){return console.error("[StorageUtils.getStatistics] Error:",a),{totalKeys:0,lexiflowKeys:0,totalSize:0,available:!1}}}},c={CASES:"cases",MATTERS:"matters",TASKS:"tasks",EVIDENCE:"evidence_items",DOCUMENTS:"documents",DOCKET:"docket_entries",MOTIONS:"motions",CLIENTS:"clients",USERS:"users",PARTIES:"parties",STAFF:"employees",TIME_OFF:"time_off_requests",EXPENSES:"expenses",INVOICES:"invoices",INVOICE_ITEMS:"invoice_items",TIME_ENTRIES:"time_entries",RATES:"rate_tables",TRUST:"trust_accounts",TRUST_TX:"trust_transactions",FEE_AGREEMENTS:"fee_agreements",BILLING:"billing",LEGAL_HOLDS:"legal_holds",PRIVILEGE_LOG:"privilege_log_entries",DISCOVERY_EXT_DEPO:"depositions",DISCOVERY_EXT_ESI:"esi_sources",DISCOVERY_EXT_PROD:"productions",DISCOVERY_EXT_INT:"custodian_interviews",CUSTODIANS:"custodians",REQUESTS:"discovery_requests",WITNESSES:"witnesses",CHAIN_OF_CUSTODY:"chain_of_custody_events",CONFERRALS:"conferral_sessions",JOINT_PLANS:"joint_plans",STIPULATIONS:"stipulation_requests",EXAMINATIONS:"discovery_examinations",VENDORS:"discovery_vendors",TRANSCRIPTS:"discovery_transcripts",SANCTIONS:"discovery_sanctions",PLEADINGS:"pleadings",EXHIBITS:"exhibits",TRIAL_EXHIBITS:"trial_exhibits",TRIAL_EVENTS:"trial_events",WITNESS_PREP:"witness_prep_sessions",CITATIONS:"citations",CLAUSES:"clauses",JURORS:"jurors",CONFLICTS:"conflicts",WALLS:"ethical_walls",LOGS:"audit_logs",COMPLIANCE_RULES:"compliance_rules",COMPLIANCE_CHECKS:"compliance_checks",ORGS:"organizations",GROUPS:"groups",PROJECTS:"projects",RISKS:"risks",PHASES:"case_phases",CASE_TEAMS:"case_team_members",DOCUMENT_VERSIONS:"document_versions",REVIEW_BATCHES:"review_batches",PRODUCTION_VOLS:"production_volumes",PROCESSING_JOBS:"processing_jobs",OCR_JOBS:"ocr_jobs",WIKI:"knowledge_articles",TEMPLATES:"workflow_templates",PLEADING_TEMPLATES:"pleading_templates",COMM_TEMPLATES:"templates",PRECEDENTS:"precedents",COMMUNICATIONS:"communications",CONVERSATIONS:"conversations",MESSAGES:"messages",NOTIFICATIONS:"notifications",SERVICE_JOBS:"service_jobs",SESSIONS:"sessions",REFRESH_TOKENS:"refresh_tokens",LOGIN_ATTEMPTS:"login_attempts",USER_PROFILES:"user_profiles",API_KEYS:"api_keys",INTEGRATIONS:"integrations",REPORTS:"reports",REPORT_TEMPLATES:"report_templates",DASHBOARDS:"dashboards",DASHBOARD_SNAPSHOTS:"dashboard_snapshots",ANALYTICS_EVENTS:"analytics_events",SEARCH_INDEX:"search_index",SEARCH_QUERIES:"search_queries",CALENDAR_EVENTS:"calendar_events",ADVISORS:"advisors",EXPERTS:"experts",CASE_STRATEGIES:"case_strategies",WORKFLOWS:"workflows",WORKFLOW_AUTOMATIONS:"workflow_automations",PROCESSES:"firm_processes",JUDGES:"judge_profiles",COUNSEL:"opposing_counsel",OPPOSITION:"opposition",POLICIES:"policies",MAP_NODES:"map_nodes",QA:"qa_items",RULES:"rules",ANALYSIS:"brief_analysis",ENTITIES:"legal_entities",RELATIONSHIPS:"entity_relationships",COUNSEL_PROFILES:"counsel_profiles",JUDGE_MOTION_STATS:"judge_motion_stats",OUTCOME_PREDICTIONS:"outcome_predictions",OKRS:"okrs",MALWARE_SIGNATURES:"malware_signatures",CLE_TRACKING:"cle_tracking",VENDOR_CONTRACTS:"vendor_contracts",RFPS:"rfps",MAINTENANCE_TICKETS:"maintenance_tickets",FACILITIES:"facilities",ASSETS:"firm_assets",VENDOR_DIRECTORY:"vendor_directory",REPORTERS:"reporters",JURISDICTIONS:"jurisdictions",LEADS:"leads",CRM_ANALYTICS:"crm_analytics",REALIZATION_STATS:"realization_stats",OPERATING_SUMMARY:"operating_summary",DISCOVERY_FUNNEL_STATS:"discovery_funnel_stats",DISCOVERY_CUSTODIAN_STATS:"custodian_main",SLAS:"sla_configs",RETENTION_POLICIES:"retention_policies",TRANSACTIONS:"transactions"};class at{dbName=qe;dbVersion=Je;db=null;mode="IndexedDB";initPromise=null;titleIndex=new tt(Qe);writeBuffer=[];flushTimer=null;MAX_BUFFER_SIZE=Ke;FORCE_FLUSH_THRESHOLD=Ye;constructor(){try{window.indexedDB||(this.mode="LocalStorage")}catch{this.mode="LocalStorage"}}getMode(){return this.mode}async switchMode(e){this.mode=e,this.initPromise=null,this.db=null,window.location.reload()}async init(){return this.mode==="LocalStorage"?Promise.resolve():this.initPromise?this.initPromise:(this.initPromise=new Promise(e=>{const t=indexedDB.open(this.dbName,this.dbVersion);t.onupgradeneeded=r=>{const i=r.target.result;Object.values(c).forEach(s=>{if(i.objectStoreNames.contains(s)){const o=r.target.transaction.objectStore(s);o.indexNames.contains("status")||o.createIndex("status","status",{unique:!1}),s===c.CASES&&!o.indexNames.contains("client")&&o.createIndex("client","client",{unique:!1})}else{const o=i.createObjectStore(s,{keyPath:"id"});o.indexNames.contains("caseId")||o.createIndex("caseId","caseId",{unique:!1}),o.indexNames.contains("status")||o.createIndex("status","status",{unique:!1}),s===c.TASKS&&!o.indexNames.contains("caseId_status")&&o.createIndex("caseId_status",["caseId","status"],{unique:!1})}}),i.objectStoreNames.contains("files")||i.createObjectStore("files")},t.onsuccess=r=>{this.db=r.target.result,this.db.onversionchange=()=>{console.warn("A new version of the database is available. Closing old connection to allow upgrade."),this.db&&this.db.close(),alert("A new version of the application is available. The page will now reload to apply updates."),window.location.reload()},this.db.onclose=()=>{console.error("Database connection was unexpectedly closed. Future operations will attempt to re-initialize."),this.initPromise=null,this.db=null},this.buildIndices(),e()},t.onerror=r=>{console.error("IDB Error:",r.target.error),this.mode="LocalStorage",e()}}),this.initPromise)}async buildIndices(){setTimeout(async()=>{(await this.getAll(c.CASES)).forEach(t=>{t&&typeof t=="object"&&"title"in t&&"id"in t&&this.titleIndex.insert(t.title.toLowerCase(),t.id)}),console.log("B-Tree index for case titles built.")},500)}async findCaseByTitle(e){const t=this.titleIndex.search(e.toLowerCase());return t?this.get(c.CASES,t):null}async count(e){return await this.init(),this.mode==="LocalStorage"||!this.db?I.get(e,[]).length:new Promise((t,r)=>{const o=this.db.transaction([e],"readonly").objectStore(e).count();o.onsuccess=()=>t(o.result),o.onerror=()=>r(o.error)})}async getAll(e){return await this.init(),this.mode==="LocalStorage"||!this.db?I.get(e,[]):new Promise((t,r)=>{const o=this.db.transaction([e],"readonly").objectStore(e).getAll();o.onsuccess=()=>t(o.result),o.onerror=()=>r(o.error)})}async get(e,t){return await this.init(),this.mode==="LocalStorage"||!this.db?I.get(e,[]).find(i=>i.id===t):new Promise((r,i)=>{const n=this.db.transaction([e],"readonly").objectStore(e).get(t);n.onsuccess=()=>r(n.result),n.onerror=()=>i(n.error)})}flushBuffer=()=>{if(!this.db||this.writeBuffer.length===0)return;const e=[...this.writeBuffer];this.writeBuffer=[],this.flushTimer=null;const t=Array.from(new Set(e.map(i=>i.store))),r=this.db.transaction(t,"readwrite");r.oncomplete=()=>{e.forEach(i=>i.resolve())},r.onerror=i=>{e.forEach(s=>s.reject(i))},e.forEach(i=>{const s=r.objectStore(i.store);try{i.type==="put"?s.put(i.item):i.type==="delete"&&s.delete(i.item)}catch(o){console.error("Coalesced Write Error",o)}})};async put(e,t){if(await this.init(),this.mode==="LocalStorage"||!this.db){const r=I.get(e,[]),i=r.findIndex(s=>s.id===t.id);return i>=0?r[i]=t:r.push(t),I.set(e,r),Promise.resolve()}return new Promise((r,i)=>{this.writeBuffer.length>=this.MAX_BUFFER_SIZE&&(console.warn(`[DB] Write buffer at maximum capacity (${this.MAX_BUFFER_SIZE}), forcing immediate flush`),this.flushBuffer()),this.writeBuffer.push({store:e,item:t,type:"put",resolve:r,reject:i}),this.writeBuffer.length>=this.FORCE_FLUSH_THRESHOLD?(this.flushTimer&&(clearTimeout(this.flushTimer),this.flushTimer=null),this.flushBuffer()):this.flushTimer||(this.flushTimer=oe.setTimeout(this.flushBuffer,16))})}async bulkPut(e,t){if(await this.init(),this.mode==="LocalStorage"||!this.db){const i=[...I.get(e,[])];return t.forEach(s=>{const o=i.findIndex(n=>n.id===s.id);o>=0?i[o]=s:i.push(s)}),I.set(e,i),Promise.resolve()}return new Promise((r,i)=>{const s=this.db.transaction([e],"readwrite"),o=s.objectStore(e);s.oncomplete=()=>r(),s.onerror=n=>i(n.target.error),t.forEach(n=>{o.put(n)})})}async delete(e,t){if(await this.init(),this.mode==="LocalStorage"||!this.db){const r=I.get(e,[]);return I.set(e,r.filter(i=>i.id!==t)),Promise.resolve()}return new Promise((r,i)=>{this.writeBuffer.length>=this.MAX_BUFFER_SIZE&&(console.warn(`[DB] Write buffer at maximum capacity (${this.MAX_BUFFER_SIZE}), forcing immediate flush`),this.flushBuffer()),this.writeBuffer.push({store:e,item:t,type:"delete",resolve:r,reject:i}),this.writeBuffer.length>=this.FORCE_FLUSH_THRESHOLD?(this.flushTimer&&(clearTimeout(this.flushTimer),this.flushTimer=null),this.flushBuffer()):this.flushTimer||(this.flushTimer=oe.setTimeout(this.flushBuffer,16))})}async getByIndex(e,t,r){if(await this.init(),this.mode==="LocalStorage"||!this.db){const i=I.get(e,[]),s=Array.isArray(r)?t.split("_")[0]:t,o=Array.isArray(r)?r[0]:r;return i.filter(n=>n[s]===o)}return new Promise((i,s)=>{const n=this.db.transaction([e],"readonly").objectStore(e);if(!n.indexNames.contains(t)){const S=n.getAll();S.onsuccess=()=>{const v=S.result;i(v.filter(_=>_[t]===r))};return}const g=n.index(t).getAll(r);g.onsuccess=()=>i(g.result),g.onerror=()=>s(g.error)})}async putFile(e,t){if(await this.init(),!(this.mode==="LocalStorage"||!this.db))return new Promise((r,i)=>{if(!this.db)return i("DB not ready");if(!this.db.objectStoreNames.contains("files"))return console.error("File store not found, cannot save file."),r();const s=this.db.transaction(["files"],"readwrite");s.objectStore("files").put(t,e),s.oncomplete=()=>r(),s.onerror=()=>i(s.error)})}async getFile(e){return await this.init(),this.mode==="LocalStorage"||!this.db?null:new Promise(t=>{if(!this.db||!this.db.objectStoreNames.contains("files"))return t(null);const i=this.db.transaction(["files"],"readonly").objectStore("files").get(e);i.onsuccess=()=>t(i.result),i.onerror=()=>t(null)})}getBufferStats(){return{bufferSize:this.writeBuffer.length,maxBufferSize:this.MAX_BUFFER_SIZE,forceFlushThreshold:this.FORCE_FLUSH_THRESHOLD,hasPendingFlush:this.flushTimer!==null}}}const d=new at;var D=(a=>(a.TODO="To Do",a.IN_PROGRESS="In Progress",a.BLOCKED="Blocked",a.COMPLETED="Completed",a.CANCELLED="Cancelled",a))(D||{}),M=(a=>(a.LOW="Low",a.MEDIUM="Medium",a.HIGH="High",a.CRITICAL="Critical",a))(M||{});const ue=1e3;class z{static instance;errorLogCache=new Map;AGGREGATION_WINDOW_MS=5e3;MAX_CACHE_SIZE=1e3;CLEANUP_INTERVAL_MS=6e4;constructor(){this.startCleanupInterval()}static getInstance(){return z.instance||(z.instance=new z,console.log("[ErrorHandler] Initialized singleton instance")),z.instance}startCleanupInterval(){typeof window<"u"&&setInterval(()=>{this.cleanupExpiredEntries()},this.CLEANUP_INTERVAL_MS)}cleanupExpiredEntries(){const e=Date.now(),t=[];this.errorLogCache.forEach((r,i)=>{e-r.timestamp>this.AGGREGATION_WINDOW_MS&&t.push(i)}),t.forEach(r=>this.errorLogCache.delete(r)),t.length>0&&console.log(`[ErrorHandler] Cleaned up ${t.length} expired error entries`)}validateError(e,t){if(!e)throw new Error(`[ErrorHandler.${t}] Error parameter is required`)}validateContext(e,t){}generateErrorKey(e,t){const r=t||"General",i=e.message||"Unknown error";return`${r}:${i}`}enforceCacheLimit(){if(this.errorLogCache.size>=this.MAX_CACHE_SIZE){console.warn(`[ErrorHandler] Cache size limit reached (${this.MAX_CACHE_SIZE}), clearing oldest entries`);const e=Math.floor(this.MAX_CACHE_SIZE*.2);Array.from(this.errorLogCache.entries()).sort((r,i)=>r[1].timestamp-i[1].timestamp).slice(0,e).forEach(([r])=>{this.errorLogCache.delete(r)})}}logError(e,t){try{this.validateError(e,"logError"),this.validateContext(t,"logError");const r=this.generateErrorKey(e,t),i=Date.now(),s=this.errorLogCache.get(r);if(s&&i-s.timestamp<this.AGGREGATION_WINDOW_MS){s.count++,s.timestamp=i;return}s&&s.count>1&&console.warn(`[ErrorHandler] Previous error repeated ${s.count} times: ${r}`),this.enforceCacheLimit(),this.errorLogCache.set(r,{timestamp:i,count:1});const o=new Date().toISOString(),n={message:e.message||"Unknown error",stack:this.sanitizeStackTrace(e.stack),context:t||"General",code:e.code,meta:this.sanitizeErrorContext(e.context)};console.error(`[${o}] [${t||"App"}] Error:`,n),this.sendToMonitoringService(n)}catch(r){console.error("[ErrorHandler] Failed to log error:",r)}}handleFatalError(e){try{this.validateError(e,"handleFatalError"),console.error("[ErrorHandler] FATAL ERROR:",e),this.logError(e,"FATAL");const t=Object.assign(e,{isFatal:!0}),r={message:t.message||"Fatal error",stack:this.sanitizeStackTrace(t.stack),context:"FATAL",code:t.code,meta:{...this.sanitizeErrorContext(t.context),isFatal:!0}};this.sendToMonitoringService(r)}catch(t){console.error("[ErrorHandler] Failed to handle fatal error:",t)}}formatErrorMessage(e){try{if(e instanceof Error)return e.message||"An unexpected error occurred.";if(typeof e=="string")return e||"An unexpected error occurred.";if(typeof e=="object"&&e!==null)try{return JSON.stringify(e)}catch(t){return console.warn("[ErrorHandler] Failed to stringify error object:",t),String(e)}return"An unexpected error occurred."}catch(t){return console.error("[ErrorHandler] Failed to format error message:",t),"An unexpected error occurred."}}getUserFriendlyMessage(e){try{const t={NetworkError:"Unable to connect to the server. Please check your internet connection.",AuthenticationError:"Your session has expired. Please log in again.",ValidationError:"The information provided is invalid. Please check your input.",NotFoundError:"The requested resource could not be found.",PermissionError:"You do not have permission to perform this action."},r=e.code;return r&&r in t?t[r]:this.formatErrorMessage(e)}catch(t){return console.error("[ErrorHandler] Failed to get user-friendly message:",t),"An unexpected error occurred."}}sanitizeStackTrace(e){if(e)return e.replace(/\(.*?:\d+:\d+\)/g,"(...)")}sanitizeErrorContext(e){if(!e)return;const t=["password","token","apiKey","secret","ssn","creditCard"],r={};return Object.keys(e).forEach(i=>{t.some(s=>i.toLowerCase().includes(s))?r[i]="[REDACTED]":r[i]=e[i]}),r}sendToMonitoringService(e){}getStatistics(){const e=Date.now(),t=Array.from(this.errorLogCache.values()).filter(r=>e-r.timestamp<this.AGGREGATION_WINDOW_MS).length;return{totalCached:this.errorLogCache.size,recentErrors:t,cacheSize:this.errorLogCache.size}}clearCache(){this.errorLogCache.clear(),console.log("[ErrorHandler] Error cache cleared")}}const it=z.getInstance();class st{capacity;cache;constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.capacity){const r=this.cache.keys().next().value;r!==void 0&&this.cache.delete(r)}this.cache.set(e,t)}delete(e){this.cache.delete(e)}clear(){this.cache.clear()}size(){return this.cache.size}getCapacity(){return this.capacity}has(e){return this.cache.has(e)}keys(){return this.cache.keys()}values(){return this.cache.values()}getMemoryEstimate(){let t=this.cache.size*100;for(const r of this.cache.values())if(typeof r=="string")t+=r.length*2;else if(typeof r=="object"&&r!==null)try{t+=JSON.stringify(r).length*2}catch{t+=1e3}else t+=8;return t}}class ot{constructor(e){this.storeName=e}async findById(e){return d.get(this.storeName,e)}async findAll(){return d.getAll(this.storeName)}async findBy(e,t){return d.getByIndex(this.storeName,e,t)}async save(e){return await d.put(this.storeName,e),e}async remove(e){await d.delete(this.storeName,e)}async count(){return d.count(this.storeName)}}const ye=1e3;class C{constructor(e){this.storeName=e,this.cache=new st(ue),this.orm=new ot(e),this.getAll=this.getAll.bind(this),this.getById=this.getById.bind(this),this.getByIndex=this.getByIndex.bind(this),this.getMany=this.getMany.bind(this),this.getByCaseId=this.getByCaseId.bind(this),this.add=this.add.bind(this),this.update=this.update.bind(this),this.delete=this.delete.bind(this),this.createMany=this.createMany.bind(this),this.updateMany=this.updateMany.bind(this)}cache;listeners=new Set;orm;listenerWarningLogged=!1;async safeExecute(e,t){try{return await e()}catch(r){throw it.logError(r instanceof Error?r:new Error(String(r)),`Repository:${this.storeName}.${t}`),new Error(`Database Error (${t}): ${r instanceof Error?r.message:"Unknown error"}`)}}subscribe(e){return this.listeners.add(e),this.listeners.size>ye&&!this.listenerWarningLogged&&(console.warn(`[Repository:${this.storeName}] Listener count exceeded ${ye}. Possible memory leak - ensure components unsubscribe on unmount.`),this.listenerWarningLogged=!0),()=>this.removeListener(e)}removeListener(e){this.listeners.delete(e)}clearAllListeners(){const e=this.listeners.size;this.listeners.clear(),this.listenerWarningLogged=!1,e>0&&console.log(`[Repository:${this.storeName}] Cleared ${e} listeners`)}getListenerCount(){return this.listeners.size}clearCache(){const e=this.cache.size();this.cache.clear(),e>0&&console.log(`[Repository:${this.storeName}] Cleared cache (${e} items)`)}getCacheStats(){return{size:this.cache.size(),maxSize:ue,hitRate:"0%"}}notify(e){this.listeners.forEach(t=>{try{t(e)}catch(r){console.error(`[Repository:${this.storeName}] Error in listener:`,r)}})}logAction=async(e,t,r,i,s)=>{};async getAll(e={}){return this.safeExecute(async()=>{const t=await this.orm.findAll();let r=e.includeDeleted?t:t.filter(i=>!i.deletedAt);return e.limit&&(r=r.slice(0,e.limit)),r},"getAll")}async getById(e,t={}){return this.safeExecute(async()=>{const r=this.cache.get(e);if(r&&(t.includeDeleted||!r.deletedAt))return r;const i=await this.orm.findById(e);if(i&&(t.includeDeleted||!i.deletedAt))return this.cache.put(e,i),i},"getById")}async getMany(e){return this.safeExecute(async()=>{const t=[],r=[];return e.forEach(o=>{const n=this.cache.get(o);n&&!n.deletedAt?t.push(n):r.push(o)}),r.length===0||(await this.orm.findAll()).filter(o=>r.includes(o.id)&&!o.deletedAt).forEach(o=>{this.cache.put(o.id,o),t.push(o)}),t},"getMany")}async getByIndex(e,t){return this.safeExecute(async()=>(await this.orm.findBy(e,t)).filter(i=>!i.deletedAt),"getByIndex")}async getByCaseId(e){return this.getByIndex("caseId",e)}async add(e){return this.safeExecute(async()=>{const t=new Date().toISOString(),r={...e,id:e.id||crypto.randomUUID(),createdAt:t,updatedAt:t,version:1,createdBy:"current-user"};return await this.orm.save(r),this.cache.put(r.id,r),this.notify(r),await this.logAction(`CREATE_${this.storeName.toUpperCase().slice(0,-1)}`,r.id,"Record Created",null,r),L.invalidate([this.storeName,"all"]),L.invalidate([this.storeName]),r},"add")}async createMany(e){return this.safeExecute(async()=>{const t=[];for(const r of e)t.push(await this.add(r));return t},"createMany")}async update(e,t){return this.safeExecute(async()=>{const r=await this.getById(e,{includeDeleted:!0});if(!r)throw new Error(`${this.storeName} record not found: ${e}`);if(t.version&&t.version!==r.version)throw new Error("Conflict: Record has been modified by another process.");const i={...r,...t,updatedAt:new Date().toISOString(),version:(r.version||1)+1,updatedBy:"current-user"};return await this.orm.save(i),this.cache.put(e,i),this.notify(i),await this.logAction(`UPDATE_${this.storeName.toUpperCase().slice(0,-1)}`,e,`Fields: ${Object.keys(t).join(", ")}`,r,i),L.invalidate([this.storeName,"all"]),L.invalidate([this.storeName,"detail",e]),L.invalidate([this.storeName]),i},"update")}async updateMany(e){return this.safeExecute(async()=>{const t=[];for(const r of e)t.push(await this.update(r.id,r.data));return t},"updateMany")}async delete(e){return this.safeExecute(async()=>{const t=await this.getById(e,{includeDeleted:!0});if(t&&!t.deletedAt){const r={...t,deletedAt:new Date().toISOString()};await this.orm.save(r),this.cache.delete(e),this.notify(r),await this.logAction(`DELETE_${this.storeName.toUpperCase().slice(0,-1)}`,e,"Soft Delete",t,r),L.invalidate([this.storeName,"all"]),L.invalidate([this.storeName,"detail",e]),L.invalidate([this.storeName])}},"delete")}}const nt=3e4,h=a=>new Promise(e=>setTimeout(e,a));class ct extends C{casesApi;constructor(){super(c.CASES),this.casesApi=new me}async getAll(){return this.casesApi.getAll()}async getById(e){try{return await this.casesApi.getById(e)}catch(t){console.error("[CaseRepository.getById] Backend error:",t);return}return super.getById(e)}async add(e){return this.casesApi.add(e)}async update(e,t){return this.casesApi.update(e,t)}async delete(e){{await this.casesApi.delete(e);return}}async getParties(e){return(await this.getById(e))?.parties||[]}async getArchived(){try{return await this.casesApi.getArchived()}catch(t){console.error("[CaseRepository.getArchived] Backend error:",t)}return(await this.getAll()).filter(t=>t.status==="Closed"||t.status==="Settled").map(t=>({id:t.id,date:t.dateTerminated||t.filingDate,title:t.title,client:t.client,outcome:t.status}))}async getByStatus(e){return this.casesApi.getAll({status:e})}async importDocket(e,t){return console.warn("[CaseRepository.importDocket] Backend endpoint not yet implemented"),await h(500),console.log(`[API] Imported docket data for ${e}`,t),!0}async archive(e){await h(300),await this.getById(e)&&await this.update(e,{status:Se.Closed})}async flag(e){console.warn("[CaseRepository.flag] Backend endpoint not yet implemented"),await h(300),console.log(`[API] Case ${e} flagged`)}}class lt extends C{constructor(){super(c.PHASES)}async getAll(){try{return await H.get("/case-phases")}catch(e){console.error("[PhaseRepository.getAll] Backend error:",e)}return super.getAll()}async getById(e){try{return await H.get(`/case-phases/${e}`)}catch(t){console.error("[PhaseRepository.getById] Backend error:",t);return}return super.getById(e)}async add(e){return H.post("/case-phases",e)}async update(e,t){return H.patch(`/case-phases/${e}`,t)}async delete(e){{await H.delete(`/case-phases/${e}`);return}}getByCaseId=async e=>{try{const r=await H.get(`/case-phases/case/${e}`);if(r&&r.length>0)return r}catch(r){console.error("[PhaseRepository.getByCaseId] Backend error:",r)}const t=await this.getByIndex("caseId",e);return t.length===0&&e==="1:24-cv-01442-LMB-IDD"?[{id:"p1",caseId:e,name:"Strategy & Pleadings",startDate:"2024-11-01",duration:30,status:"Completed",color:"bg-blue-500"},{id:"p2",caseId:e,name:"Discovery",startDate:"2024-12-01",duration:90,status:"Active",color:"bg-indigo-500"},{id:"p3",caseId:e,name:"Expert Witness",startDate:"2025-03-01",duration:30,status:"Pending",color:"bg-purple-500"},{id:"p4",caseId:e,name:"Pre-Trial Motions",startDate:"2025-04-01",duration:45,status:"Pending",color:"bg-amber-500"},{id:"p5",caseId:e,name:"Trial Prep",startDate:"2025-05-15",duration:15,status:"Pending",color:"bg-red-500"},{id:"p6",caseId:e,name:"Trial",startDate:"2025-06-01",duration:14,status:"Pending",color:"bg-slate-800"}]:t}}class P{async execute(e){const t=[],r=[];try{return console.log(`[${this.eventType}] Processing event`,e),await this.handle(e)}catch(i){const s=i instanceof Error?i.message:String(i);return console.error(`[${this.eventType}] Error:`,s),r.push(s),{success:!1,triggeredActions:t,errors:r}}}createSuccess(e){return{success:!0,triggeredActions:e,errors:[]}}createError(e,t=[]){return{success:!1,triggeredActions:t,errors:e}}}class dt extends P{eventType=f.LEAD_STAGE_CHANGED;async handle(e){const t=[];if(e.stage==="Engagement"||e.stage==="Conflict Check"){const{DataService:r}=await m(async()=>{const{DataService:i}=await Promise.resolve().then(()=>F);return{DataService:i}},void 0);await r.compliance.runConflictCheck(e.clientName),t.push("Triggered Automated Conflict Check")}return this.createSuccess(t)}}class ut extends P{eventType=f.DOCKET_INGESTED;async handle(e){const t=[],{entry:r}=e;return(r.title||"").toLowerCase().includes("motion")&&(await this.createResponseDeadline(r),t.push("Calculated Response Deadline per Local Rules")),(r.type==="Hearing"||(r.title||"").toLowerCase().includes("hearing"))&&(await this.createHearingEvent(r),t.push("Synced Hearing to Master Calendar")),this.createSuccess(t)}async createResponseDeadline(e){const t=new Date(new Date(e.date||e.entryDate||e.dateFiled).getTime()+12096e5),r={id:`cal-resp-${e.id}`,title:`Response Due: ${e.title}`,date:t.toISOString().split("T")[0],type:"deadline",priority:"High",description:`Derived from Docket Sequence #${e.sequenceNumber}`,location:"Court ECF"};await d.put("calendarEvents",r)}async createHearingEvent(e){const t={id:`cal-hear-${e.id}`,title:e.title||"Hearing",date:e.date||e.entryDate||e.dateFiled||new Date().toISOString().split("T")[0],type:"hearing",priority:"Critical",description:`Court Appearance Required. Docket #${e.sequenceNumber}`};await d.put("calendarEvents",t)}}class yt extends P{eventType=f.TASK_COMPLETED;async handle(e){const t=[],{task:r}=e;if(!this.isBillable(r))return this.createSuccess([]);const{DataService:i}=await m(async()=>{const{DataService:n}=await Promise.resolve().then(()=>F);return{DataService:n}},void 0),{getTodayString:s}=await m(async()=>{const{getTodayString:n}=await import("./dateUtils-rLIRMrtk.js");return{getTodayString:n}},[]),o={id:`time-auto-${Date.now()}`,caseId:r.caseId,userId:r.assigneeId,date:s(),duration:0,description:`Task Completion: ${r.title}`,rate:0,total:0,status:"Unbilled",billable:!0};return await i.billing.addTimeEntry(o),t.push("Created Draft Billable Entry from Task"),this.createSuccess(t)}isBillable(e){const t=["administrative","internal","training"],r=e.title.toLowerCase(),i=e.description?.toLowerCase()||"",s=!t.some(g=>r.includes(g)||i.includes(g)),o=!!(e.caseId&&e.caseId!=="General"),n=e.priority==="High"||e.priority==="Critical",y=!!(e.assigneeId||e.assignedTo);return o&&n&&s&&y}}class ht extends P{eventType=f.DOCUMENT_UPLOADED;async handle(e){const t=[],{document:r}=e;if(!this.shouldReplicateToEvidence(r))return this.createSuccess([]);const{DataService:i}=await m(async()=>{const{DataService:o}=await Promise.resolve().then(()=>F);return{DataService:o}},void 0),s={id:`ev-auto-${Date.now()}`,trackingUuid:crypto.randomUUID(),caseId:r.caseId,title:r.title,type:"Document",description:"Auto-ingested from Document Upload",collectionDate:new Date().toISOString().split("T")[0],collectedBy:"System Import",custodian:"DMS",location:"Digital Vault",admissibility:"Pending",chainOfCustody:[{id:`cc-${Date.now()}`,date:new Date().toISOString(),action:"Ingestion",actor:"IntegrationOrchestrator"}],tags:["Auto-Ingest"],fileSize:typeof r.fileSize=="number"?String(r.fileSize):r.fileSize};return await i.evidence.add(s),t.push("Replicated Document to Evidence Vault"),this.createSuccess(t)}shouldReplicateToEvidence(e){const t=e.tags.includes("Production")||e.title.includes("Prod_"),r=e.sourceModule==="Evidence";return t||r}}const X=async a=>{const e=new TextEncoder().encode(a),t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(i=>i.toString(16).padStart(2,"0")).join("")},Ie={generateHash:X,createEntry:async(a,e)=>{const t=`log-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,r=`${t}:${a.timestamp}:${a.user}:${a.action}:${a.resource}:${e}`,i=await X(r);return{...a,id:t,prevHash:e,hash:i}},verifyChain:async a=>{const e="0000000000000000000000000000000000000000000000000000000000000000";for(let t=0;t<a.length;t++){const r=a[t];if(!r)return{isValid:!1,brokenIndex:t,totalBlocks:a.length,verifiedAt:new Date().toISOString()};if(!r.hash)return{isValid:!1,brokenIndex:t,totalBlocks:a.length,verifiedAt:new Date().toISOString()};const i=a[t-1],s=t===0?e:i?.hash||"";if(r.prevHash!==s)return console.error(`Chain Broken at index ${t}: prevHash mismatch`),{isValid:!1,brokenIndex:t,totalBlocks:a.length,verifiedAt:new Date().toISOString()};const o=`${r.id}:${r.timestamp}:${r.user}:${r.action}:${r.resource}:${r.prevHash}`;if(await X(o)!==r.hash)return console.error(`Chain Broken at index ${t}: Data tampered`),{isValid:!1,brokenIndex:t,totalBlocks:a.length,verifiedAt:new Date().toISOString()}}return{isValid:!0,brokenIndex:-1,totalBlocks:a.length,verifiedAt:new Date().toISOString()}},exportLedger:a=>{const e=JSON.stringify(a,null,2),t=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(t),i=document.createElement("a");i.href=r,i.download=`lexiflow_ledger_export_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}};class pt extends P{eventType=f.INVOICE_STATUS_CHANGED;async handle(e){const t=[],r=[],{invoice:i}=e;return i.status==="Overdue"&&await this.handleOverdueInvoice(i,t,r),i.status==="Paid"&&await this.logPaymentToBlockchain(i,t),r.length>0?this.createError(r,t):this.createSuccess(t)}async handleOverdueInvoice(e,t,r){const{DataService:i}=await m(async()=>{const{DataService:s}=await Promise.resolve().then(()=>F);return{DataService:s}},void 0);if(!i.playbooks||!i.workflow||typeof i.workflow.deploy!="function"){console.warn("[InvoiceHandler] Workflow service not available"),t.push("Overdue invoice detected (workflow service unavailable)");return}try{const s=await i.playbooks.getByIndex("type","collection");s&&s.length>0?(await i.workflow.deploy(s[0].id,{caseId:e.caseId}),t.push("Deployed Collections Workflow")):(console.warn("[InvoiceHandler] No collection workflow template found"),t.push("Overdue invoice detected (no collection workflow available)"))}catch(s){console.error("[InvoiceHandler] Failed to deploy collection workflow:",s);const o=s instanceof Error?s.message:String(s);r.push(`Collection workflow deployment failed: ${o}`)}}async logPaymentToBlockchain(e,t){await Ie.createEntry({timestamp:new Date().toISOString(),user:$.getItem("userName")||"System",userId:$.getItem("userId")||"system",action:"INVOICE_PAID",resource:`Invoice/${e.id}`,ip:"internal",newValue:e.amount},"0000000000000000000000000000000000000000000000000000000000000000"),t.push("Logged INVOICE_PAID to immutable ledger")}}class gt extends P{eventType=f.EVIDENCE_STATUS_UPDATED;async handle(e){const t=[],{item:r,oldStatus:i,newStatus:s}=e;return await Ie.createEntry({timestamp:new Date().toISOString(),user:"System",userId:"sys-admin",action:`EVIDENCE_STATUS_${s.toUpperCase().replace(/\s/g,"_")}`,resource:`Evidence/${r.id}`,ip:"internal",previousValue:i,newValue:s},"0000000000000000000000000000000000000000000000000000000000000000"),t.push("Logged Evidence Status Change to Immutable Ledger"),this.createSuccess(t)}}class wt extends P{eventType=f.CITATION_SAVED;async handle(e){const t=[],{citation:r,queryContext:i}=e;if(await this.cacheResearchResult(r,i),t.push("Updated Pleading Builder Context Cache"),r.relevance&&Number(r.relevance)>=8){const s=await this.createPleadingSuggestions(r);s>0&&t.push(`Created citation suggestions for ${s} active pleading(s)`)}return this.createSuccess(t)}async cacheResearchResult(e,t){const r={id:`cache-${Date.now()}`,citationId:e.id,caseId:e.caseId,authority:e.authority,citationText:e.citation,context:t,relevanceScore:e.relevance||0,cachedAt:new Date().toISOString()};await d.put("researchCache",r)}async createPleadingSuggestions(e){const{DataService:t}=await m(async()=>{const{DataService:s}=await Promise.resolve().then(()=>F);return{DataService:s}},void 0),i=(await t.pleadings.getByIndex("status","Draft")).filter(s=>s.caseId===e.caseId);for(const s of i)await d.put("pleadingSuggestions",{id:`sugg-${Date.now()}-${s.id}`,pleadingId:s.id,citationId:e.id,suggestionType:"citation",priority:"High",createdAt:new Date().toISOString()});return i.length}}class ft extends P{eventType=f.WALL_ERECTED;async handle(e){const t=[],{wall:r}=e,{DataService:i}=await m(async()=>{const{DataService:o}=await Promise.resolve().then(()=>F);return{DataService:o}},void 0),s=`wall_enforce_${r.caseId}`;return await i.admin.saveRLSPolicy({name:s,table:"documents",cmd:"SELECT",roles:r.restrictedGroups,using:`case_id != '${r.caseId}'`,status:"Active"}),t.push(`Generated RLS Policy: ${s}`),this.createSuccess(t)}}class mt extends P{eventType=f.STAFF_HIRED;async handle(e){const t=[],r=[],{staff:i}=e,s=this.validateStaff(i);if(s)return r.push(s),this.createError(r);const{DataService:o}=await m(async()=>{const{DataService:y}=await Promise.resolve().then(()=>F);return{DataService:y}},void 0);if(!o.users||typeof o.users.add!="function")return r.push("User provisioning service not available"),this.createError(r);const n={id:i.userId,name:i.name,email:i.email,role:i.role,userType:"Internal",orgId:"org-1",status:"Active",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await o.users.add(n),t.push(`Provisioned User Account for ${i.name} (${i.email})`),this.createSuccess(t)}validateStaff(e){return!e.userId||!e.name||!e.email||!e.role?"Staff member missing required fields for user provisioning":/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)?null:"Invalid email format for user provisioning"}}class vt extends P{eventType=f.SERVICE_COMPLETED;async handle(e){const t=[],{job:r}=e;if(r.status!=="SERVED")return this.createSuccess([]);const{DataService:i}=await m(async()=>{const{DataService:n}=await Promise.resolve().then(()=>F);return{DataService:n}},void 0),s=new Date().toISOString().split("T")[0],o={id:`dk-proof-${Date.now()}`,sequenceNumber:999,caseId:r.caseId,dateFiled:s,entryDate:s,date:s,type:"Filing",title:`Proof of Service: ${r.documentTitle}`,description:`Served on ${r.targetPerson} at ${r.targetAddress} by ${r.serverName}.`,filedBy:"System Automation",isSealed:!1};return await i.docket.add(o),t.push("Auto-filed Proof of Service to Docket"),this.createSuccess(t)}}class St extends P{eventType=f.DATA_SOURCE_CONNECTED;async handle(e){const t=[],{provider:r,name:i,connectionId:s}=e;return await d.put("auditLogs",{action:"CONNECTION_ESTABLISHED",userId:"system",details:`Established secure connection to ${r} (${i})`,ip:"127.0.0.1",resourceId:s}),t.push(`Logged connection audit event for ${i}`),t.push(`Queued initial sync job for ${s}`),this.createSuccess(t)}}class he{static handlers=new Map;static{this.register(new dt),this.register(new ut),this.register(new yt),this.register(new ht),this.register(new pt),this.register(new gt),this.register(new wt),this.register(new ft),this.register(new mt),this.register(new vt),this.register(new St)}static register(e){this.handlers.set(e.eventType,e)}static getHandler(e){return this.handlers.get(e)}static hasHandler(e){return this.handlers.has(e)}static getRegisteredEvents(){return Array.from(this.handlers.keys())}static getStats(){return{totalHandlers:this.handlers.size,registeredEvents:this.getRegisteredEvents()}}}function It(a,e){if(!a)throw new u(`[IntegrationOrchestrator.${e}] Invalid event type parameter`)}function Et(a,e,t){if(a==null)throw new u(`[IntegrationOrchestrator.${t}] Invalid payload for event: ${e}`)}class Ee{static initialized=!1;static subscriptionCleanups=[];static initialize(){this.initialized||(Object.values(f).forEach(e=>{const t=R.subscribe(e,(r=>this.publish(e,r)));this.subscriptionCleanups.push(t)}),this.initialized=!0,console.log("[IntegrationOrchestrator] Initialized and subscribed to events"))}static cleanup(){console.log("[IntegrationOrchestrator] Cleaning up event subscriptions"),this.subscriptionCleanups.forEach(e=>{try{e()}catch(t){console.error("[IntegrationOrchestrator] Error during cleanup:",t)}}),this.subscriptionCleanups=[],this.initialized=!1}static async publish(e,t){try{const r=String(e);It(r,"publish"),Et(t,r,"publish"),console.log(`[IntegrationOrchestrator] Received event: ${r}`);const i=he.getHandler(r);if(!i)return console.warn(`[IntegrationOrchestrator] No handler registered for event: ${r}`),{success:!0,triggeredActions:[],errors:[`No handler registered for ${r}`]};const s=await i.execute(t);return console.log(`[IntegrationOrchestrator] Event ${r} completed:`,{success:s.success,actions:s.triggeredActions.length,errors:s.errors?.length??0}),s}catch(r){const i=r instanceof Error?r.message:String(r);return console.error(`[IntegrationOrchestrator] Fatal error processing ${String(e)}:`,i),{success:!1,triggeredActions:[],errors:[i]}}}static getStats(){try{return he.getStats()}catch(e){return console.error("[IntegrationOrchestrator.getStats] Error:",e),{handlerCount:0,handlers:[]}}}}const At=Object.freeze(Object.defineProperty({__proto__:null,IntegrationOrchestrator:Ee},Symbol.toStringTag,{value:"Module"}));class Ct extends Error{constructor(e,t,r){super(e),this.attempts=t,this.lastError=r,this.name="RetryError"}}async function Rt(a,e={}){const{maxRetries:t=ke,initialDelay:r=Be,maxDelay:i=nt,backoffFactor:s=2,onRetry:o}=e;let n,y=r;for(let g=0;g<=t;g++)try{return await a()}catch(S){if(n=S,g===t)break;o?.(g+1,n),await new Promise(v=>setTimeout(v,y)),y=Math.min(y*s,i)}throw new Ct(`Failed after ${t+1} attempts`,t+1,n)}class Dt extends C{docketApi;constructor(){super(c.DOCKET),this.docketApi=new Pe}async getAll(){return this.docketApi.getAll()}async getById(e){try{return await this.docketApi.getById(e)}catch(t){console.error("[DocketRepository.getById] Backend error:",t);return}return super.getById(e)}async add(e){{const t=await this.docketApi.add(e);return await Ee.publish(f.DOCKET_INGESTED,{entry:t,caseId:e.caseId}),t}}async update(e,t){return this.docketApi.update(e,t)}async delete(e){{await this.docketApi.delete(e);return}}async getByCaseId(e){return this.docketApi.getAll(e)}async syncFromPacer(e,t){return console.log(`[PACER] Syncing for ${t} in ${e}...`),Rt(async()=>{await h(1500);const r=new Date().toISOString().split("T")[0],i={id:`dk-sync-${Date.now()}`,sequenceNumber:9999,pacerSequenceNumber:123,caseId:t,date:r,dateFiled:r,entryDate:r,type:"Order",title:"ORDER ON MOTION TO COMPEL",description:"The court has reviewed the motion and hereby GRANTS it. Signed by Judge Smith.",filedBy:"Court",isSealed:!1};return await this.add(i),!0},{maxRetries:3,initialDelay:1e3,maxDelay:1e4})}}function Z(a,e){if(!a||typeof a!="string"||a.trim()==="")throw new u(`[CalendarService.${e}] Event ID is required and must be a non-empty string`)}function Ae(a,e){const t=["deadline","hearing","meeting","task","reminder"];if(a&&typeof a=="string"&&!t.includes(a))throw new u(`[CalendarService.${e}] Invalid event type. Must be: ${t.join(", ")}`)}function pe(a,e,t){if(!a||typeof a!="string")throw new u(`[CalendarService.${t}] ${e} must be an ISO 8601 date string`);const r=new Date(a);if(isNaN(r.getTime()))throw new u(`[CalendarService.${t}] Invalid ${e} format: ${a}`)}function ee(a,e){if(!a||typeof a!="object")throw new u(`[CalendarService.${e}] Event data is required`);a.type&&Ae(a.type,e),a.startDate&&pe(a.startDate,"startDate",e),a.endDate&&pe(a.endDate,"endDate",e)}const K={getAll:async()=>{try{return console.warn("[CalendarService.getAll] Calendar API not yet available"),[]}catch(a){throw console.error("[CalendarService.getAll] Error:",a),a}},getById:async a=>{try{return Z(a,"getById"),console.warn("[CalendarService.getById] Calendar API not yet available"),null}catch(e){throw console.error("[CalendarService.getById] Error:",e),e}},add:async a=>{try{ee(a,"add");const e={id:`event-${Date.now()}`,title:a.title||"New Event",startDate:a.startDate||new Date().toISOString(),type:a.type||"reminder",...a};return console.warn("[CalendarService.add] Calendar API not yet available"),e}catch(e){throw console.error("[CalendarService.add] Error:",e),e}},update:async(a,e)=>{try{return Z(a,"update"),ee(e,"update"),console.warn("[CalendarService.update] Calendar API not yet available"),{id:a,title:e.title||"Event",startDate:e.startDate||new Date().toISOString(),type:e.type||"reminder",...e}}catch(t){throw console.error("[CalendarService.update] Error:",t),t}},delete:async a=>{try{return Z(a,"delete"),console.warn("[CalendarService.delete] Calendar API not yet available"),!0}catch(e){throw console.error("[CalendarService.delete] Error:",e),e}},getEvents:async a=>{try{a?.type&&Ae(a.type,"getEvents"),console.warn("[CalendarService.getEvents] Calendar API not yet available");const e=[];return(a?.startDate||a?.endDate)&&e.filter(t=>{const r=new Date(t.startDate),i=a.startDate?new Date(a.startDate):new Date(0),s=a.endDate?new Date(a.endDate):new Date("2100-01-01");return r>=i&&r<=s}),a?.caseId&&e.filter(t=>t.caseId===a.caseId),a?.type&&e.filter(t=>t.type===a.type),e.sort((t,r)=>new Date(t.startDate).getTime()-new Date(r.startDate).getTime())}catch(e){throw console.error("[CalendarService.getEvents] Error:",e),e}},getUpcoming:async(a=7)=>{try{if(a<=0)throw new u("[CalendarService.getUpcoming] Days must be a positive number");const e=new Date,t=new Date(e.getTime()+a*24*60*60*1e3);return K.getEvents({startDate:e.toISOString(),endDate:t.toISOString()})}catch(e){throw console.error("[CalendarService.getUpcoming] Error:",e),e}},createEvent:async a=>{try{return ee(a,"createEvent"),{id:`event-${Date.now()}`,title:a.title||"New Event",description:a.description,startDate:a.startDate||new Date().toISOString(),endDate:a.endDate,type:a.type||"reminder",caseId:a.caseId,attendees:a.attendees||[],location:a.location,allDay:a.allDay||!1,recurring:a.recurring||!1,metadata:a.metadata}}catch(e){throw console.error("[CalendarService.createEvent] Error:",e),e}},updateEvent:async(a,e)=>K.update(a,e),deleteEvent:async a=>K.delete(a),sync:async a=>{try{const e=a?.provider||"default";return await h(500),console.log(`[CalendarService] Successfully synced with ${e} calendar`),!0}catch(e){throw console.error("[CalendarService.sync] Error:",e),e}}},Ce={validateEntityName:(a,e)=>{if(!a||a.trim()==="")throw new Error(`[ComplianceService.${e}] Invalid entityName parameter`)},validateId:(a,e)=>{if(!a||a.trim()==="")throw new Error(`[ComplianceService.${e}] Invalid id parameter`)},getRiskStats:async(a="light")=>{try{const{ChartColorService:e}=await m(async()=>{const{ChartColorService:n}=await import("./chartColorService-Dq1XQNFk.js");return{ChartColorService:n}},__vite__mapDeps([0,1,2,3,4])),t=e.getRiskColors(a),r=[],i=r.filter(n=>n.impact==="High"||n.probability==="High").length,s=r.filter(n=>(n.impact==="Medium"||n.probability==="Medium")&&n.impact!=="High").length;return[{name:"Low Risk",value:r.filter(n=>n.impact==="Low"&&n.probability==="Low").length,color:t.low},{name:"Medium Risk",value:s,color:t.medium},{name:"High Risk",value:i,color:t.high}]}catch(e){throw console.error("[ComplianceService.getRiskStats] Error:",e),new Error("Failed to fetch risk statistics")}},getRiskMetrics:async()=>{try{const a=[],e=await G.compliance.getEthicalWalls(),t=a.filter(n=>n.impact==="High").length,r=e.filter(n=>n.status==="active").length,i=100,s=t*5+r*.5;return{score:Math.max(0,Math.floor(i-s)),high:t,missingDocs:8,violations:0,activeWalls:r}}catch(a){throw console.error("[ComplianceService.getRiskMetrics] Error:",a),new Error("Failed to fetch risk metrics")}},getConflicts:async()=>{try{return(await G.conflictChecks.getAll()).map(e=>({id:e.id,entityName:e.entityName,date:e.date,status:e.status,foundIn:e.foundIn||[],checkedById:e.checkedById,checkedBy:e.checkedBy||"System",createdAt:e.createdAt,updatedAt:e.updatedAt}))}catch(a){throw console.error("[ComplianceService.getConflicts] Error:",a),new Error("Failed to fetch conflict checks")}},runConflictCheck:async a=>{Ce.validateEntityName(a,"runConflictCheck");try{const e=await G.conflictChecks.check({clientName:a});if(e.status==="Flagged"&&e.foundIn&&e.foundIn.length>0)try{const{SystemEventType:t}=await m(async()=>{const{SystemEventType:r}=await Promise.resolve().then(()=>se);return{SystemEventType:r}},void 0);await R.publish(t.CONFLICT_DETECTED,{check:e,entityName:a,conflictCount:e.foundIn.length})}catch(t){console.warn("[ComplianceService] Failed to publish integration event",t)}return e}catch(e){throw console.error("[ComplianceService.runConflictCheck] Error:",e),new Error("Failed to run conflict check")}},getEthicalWalls:async()=>{try{return(await G.compliance.getEthicalWalls()).map(e=>({id:e.id,caseId:e.caseId,title:e.title,restrictedGroups:e.restrictedGroups||[],authorizedUsers:e.authorizedUsers||[],status:e.status,createdAt:e.createdAt,updatedAt:e.updatedAt}))}catch(a){throw console.error("[ComplianceService.getEthicalWalls] Error:",a),new Error("Failed to fetch ethical walls")}},createEthicalWall:async a=>{if(!a||typeof a!="object")throw new Error("[ComplianceService.createEthicalWall] Invalid ethical wall data");if(!a.title||a.title.trim()==="")throw new Error("[ComplianceService.createEthicalWall] Ethical wall must have a title");try{const e=await G.compliance.createEthicalWall(a);try{const{SystemEventType:t}=await m(async()=>{const{SystemEventType:r}=await Promise.resolve().then(()=>se);return{SystemEventType:r}},void 0);await R.publish(t.ETHICAL_WALL_CREATED,{wall:e,caseId:a.caseId})}catch(t){console.warn("[ComplianceService] Failed to publish integration event",t)}return e}catch(e){throw console.error("[ComplianceService.createEthicalWall] Error:",e),new Error("Failed to create ethical wall")}},getPolicies:async()=>{try{return[]}catch(a){throw console.error("[ComplianceService.getPolicies] Error:",a),new Error("Failed to fetch policies")}}},Re={validateSignature:(a,e)=>{if(!a||a.trim()==="")throw new Error(`[SecurityService.${e}] Invalid signature parameter`)},validateId:(a,e)=>{if(!a||a.trim()==="")throw new Error(`[SecurityService.${e}] Invalid id parameter`)},getMalwareSignatures:async()=>{try{return console.warn("[SecurityService] Security API service not available, returning empty malware signatures"),[]}catch(a){throw console.error("[SecurityService.getMalwareSignatures] Error:",a),new l("SecurityService.getMalwareSignatures","Failed to fetch malware signatures")}},scanForMalware:async a=>{if(!a||a.trim()==="")throw new Error("[SecurityService.scanForMalware] Invalid content parameter");try{const t=(await Re.getMalwareSignatures()).filter(i=>a.includes(i)),r={clean:t.length===0,threatsFound:t,scannedAt:new Date().toISOString()};if(!r.clean){console.warn(`[SecurityService] Threats detected: ${t.length}`);try{const{IntegrationOrchestrator:i}=await m(async()=>{const{IntegrationOrchestrator:o}=await Promise.resolve().then(()=>At);return{IntegrationOrchestrator:o}},void 0),{SystemEventType:s}=await m(async()=>{const{SystemEventType:o}=await Promise.resolve().then(()=>se);return{SystemEventType:o}},void 0);await i.publish(s.SECURITY_THREAT_DETECTED,{threatCount:t.length,threats:t,scannedAt:r.scannedAt})}catch(i){console.warn("[SecurityService] Failed to publish security event",i)}}return r}catch(e){throw console.error("[SecurityService.scanForMalware] Error:",e),new l("SecurityService.scanForMalware","Failed to scan for malware")}},getThreatLevel:async()=>{try{return{level:"Low",score:25,lastUpdated:new Date().toISOString(),factors:[]}}catch(a){throw console.error("[SecurityService.getThreatLevel] Error:",a),new l("SecurityService.getThreatLevel","Failed to fetch threat level")}},getSecurityPolicies:async()=>{try{return[]}catch(a){throw console.error("[SecurityService.getSecurityPolicies] Error:",a),new l("SecurityService.getSecurityPolicies","Failed to fetch security policies")}},getAuditLogs:async(a,e)=>{try{if(a&&a.trim()==="")throw new Error("[SecurityService.getAuditLogs] Invalid startDate parameter");if(e&&e.trim()==="")throw new Error("[SecurityService.getAuditLogs] Invalid endDate parameter");return[]}catch(t){throw console.error("[SecurityService.getAuditLogs] Error:",t),new l("SecurityService.getAuditLogs","Failed to fetch audit logs")}},getVulnerabilities:async()=>{try{return[]}catch(a){throw console.error("[SecurityService.getVulnerabilities] Error:",a),new l("SecurityService.getVulnerabilities","Failed to fetch vulnerabilities")}}},Tt=[{name:"cases",description:"Manages all case and matter records.",methods:[{name:"getAll",http:"GET",path:`${b}/cases`,description:"Retrieves a list of all case records.",params:[],response:JSON.stringify([{id:"C-2024-001",title:"Martinez v. TechCorp",client:"TechCorp Industries",status:"Discovery"}],null,2)},{name:"getById",http:"GET",path:`${b}/cases/{id}`,description:"Retrieves a single case by its unique ID.",params:[{name:"id",type:"string",desc:"The unique case identifier (CaseId)."}],response:JSON.stringify({id:"C-2024-001",title:"Martinez v. TechCorp",client:"TechCorp Industries",status:"Discovery"},null,2)},{name:"add",http:"POST",path:`${b}/cases`,description:"Creates a new case record.",params:[{name:"caseData",type:"Case",desc:"The full case object."}],response:JSON.stringify({id:"C-2024-002",title:"New Case",client:"New Client",status:"Pre-Filing"},null,2)}]},{name:"documents",description:"Handles document metadata and blob storage.",methods:[{name:"getAll",http:"GET",path:`${b}/documents`,description:"Retrieves metadata for all documents.",params:[],response:JSON.stringify([{id:"doc-1",caseId:"C-2024-001",title:"Complaint.pdf",type:"Pleading",fileSize:"1.2 MB"}],null,2)},{name:"getFile",http:"GET",path:`${b}/documents/{id}/file`,description:"Retrieves the binary file content for a document.",params:[{name:"id",type:"string",desc:"The unique document identifier."}],response:"(binary data)"}]},{name:"billing",description:"Manages time entries, invoices, and financial data.",methods:[{name:"getTimeEntries",http:"GET",path:`${b}/billing/time`,description:"Retrieves all time entries, optionally filtered by case.",params:[{name:"caseId",type:"string (optional)",desc:"Filter entries by a specific case."}],response:JSON.stringify([{id:"t-1",caseId:"C-2024-001",duration:60,description:"Drafting motion.",total:450}],null,2)},{name:"createInvoice",http:"POST",path:`${b}/billing/invoices`,description:"Generates a new invoice from a set of unbilled time entries.",params:[{name:"timeEntryIds",type:"string[]",desc:"Array of time entry IDs to include."}],response:JSON.stringify({id:"INV-2024-001",client:"TechCorp",amount:15450,status:"Draft"},null,2)}]},{name:"discovery",description:"Manages all aspects of the e-discovery lifecycle.",methods:[{name:"getRequests",http:"GET",path:`${b}/discovery/requests`,description:"Retrieves all discovery requests (RFPs, ROGs, RFAs).",params:[{name:"caseId",type:"string (optional)",desc:"Filter by case."}],response:JSON.stringify([{id:"DR-001",type:"Production",title:"RFP Set One",status:"Served"}],null,2)},{name:"getPrivilegeLog",http:"GET",path:`${b}/discovery/privilege-log`,description:"Retrieves the privilege log for a given case.",params:[{name:"caseId",type:"string",desc:"The case identifier."}],response:JSON.stringify([{id:"PL-001",basis:"Attorney-Client",desc:"Legal advice re: termination."}],null,2)}]}],bt={getLogs:async()=>{try{const a=await _e.auditLogs?.getAll?.();if(!a)return[];const e=Array.isArray(a)?a:a&&typeof a=="object"&&"data"in a?a.data:[];return(Array.isArray(e)?e:[]).sort((r,i)=>new Date(i.timestamp).getTime()-new Date(r.timestamp).getTime())}catch(a){return console.error("[AdminService.getLogs] Error fetching audit logs:",a),[]}},getIntegrations:async()=>{try{const a=await fetch(`${b}/integrations`,{headers:{Authorization:`Bearer ${$.getItem("authToken")||""}`}});if(a.ok&&a.headers.get("content-type")?.includes("application/json"))return(await a.json()).map(t=>({id:t.id,name:t.name,type:t.type,status:t.status,icon:t.name.charAt(0).toUpperCase(),color:t.status==="Connected"?"bg-blue-600":t.status==="Error"?"bg-red-600":"bg-gray-600"}))}catch(a){console.error("[AdminService.getIntegrations] Backend unavailable:",a)}return await h(500),[{id:"int1",name:"Outlook 365",type:"Email & Calendar",status:"Connected",icon:"O",color:"bg-blue-600"},{id:"int2",name:"Salesforce",type:"CRM",status:"Error",icon:"S",color:"bg-sky-500"},{id:"int3",name:"QuickBooks",type:"Accounting",status:"Disconnected",icon:"Q",color:"bg-green-600"},{id:"int4",name:"Clio",type:"Practice Mgmt",status:"Connected",icon:"C",color:"bg-indigo-600"}]},getSecuritySettings:async()=>{try{const a=await fetch(`${b}/admin/security-settings`,{headers:{Authorization:`Bearer ${$.getItem("authToken")||""}`}});if(a.ok&&a.headers.get("content-type")?.includes("application/json"))return await a.json()}catch(a){console.error("[AdminService.getSecuritySettings] Backend unavailable:",a)}return await h(300),[{id:"sec1",label:"Require MFA",desc:"All internal users must use 2-factor authentication.",type:"Lock",enabled:!0},{id:"sec2",label:"Session Timeout",desc:"Inactive sessions are logged out after 4 hours.",type:"Clock",enabled:!0},{id:"sec3",label:"IP Whitelisting",desc:"Restrict access to specific IP ranges.",type:"Globe",enabled:!1}]},getRLSPolicies:async()=>(await h(200),[{id:"rls1",name:"tenant_isolation_cases",table:"cases",cmd:"ALL",roles:["All"],using:"org_id = current_setting('app.current_org_id')::uuid",status:"Active"},{id:"rls2",name:"partner_view_billing",table:"billing",cmd:"SELECT",roles:["Partner"],using:"true",status:"Active"},{id:"rls3",name:"associate_edit_own_time",table:"time_entries",cmd:"UPDATE",roles:["Associate"],using:"user_id = auth.uid()",status:"Active"}]),saveRLSPolicy:async a=>a,deleteRLSPolicy:async()=>{await h(100)},getPermissions:async()=>[{id:"p1",role:"Associate",resource:"Financials",access:"Read"}],updatePermission:async a=>a,getPipelines:async()=>[],getApiKeys:async()=>[{id:"key_1",name:"Default Key",key:"pk_live_ab12...",scopes:[],status:"active",lastUsedAt:void 0,expiresAt:void 0,createdAt:"2024-01-01",updatedAt:"2024-01-01"}],getAnomalies:async()=>{try{const a=await fetch(`${b}/data-platform/anomalies`,{headers:{Authorization:`Bearer ${$.getItem("authToken")||""}`}});if(a.ok&&a.headers.get("content-type")?.includes("application/json"))return await a.json()}catch(a){console.error("[AdminService.getAnomalies] Backend unavailable:",a)}return await h(600),[{id:1,table:"clients",field:"email",issue:"Invalid Format",count:12,sample:"john-doe@",status:"Detected",severity:"High"},{id:2,table:"cases",field:"status",issue:"Inconsistent Casing",count:5,sample:"closed",status:"Fixed",severity:"Low"},{id:3,table:"documents",field:"metadata",issue:"Missing Author",count:142,sample:"NULL",status:"Detected",severity:"Medium"}]},getDataDomains:async()=>{try{const a=await fetch(`${b}/data-platform/domains`,{headers:{Authorization:`Bearer ${$.getItem("authToken")||""}`}});if(a.ok&&a.headers.get("content-type")?.includes("application/json"))return await a.json()}catch(a){console.error("[AdminService.getDataDomains] Backend unavailable:",a)}return await h(200),[{name:"Legal",count:12,desc:"Core case and litigation data."},{name:"Finance",count:8,desc:"Billing, invoices, and trust accounts."},{name:"HR",count:4,desc:"Staff, roles, and performance data."}]},getTenantConfig:async()=>(await h(100),{name:"LexiFlow",tier:"Enterprise Suite",version:"2.5",region:"US-East-1"}),getConnectors:async()=>{try{const a=await fetch(`${b}/integrations/data-sources`,{headers:{Authorization:`Bearer ${$.getItem("authToken")||""}`}});if(a.ok&&a.headers.get("content-type")?.includes("application/json"))return(await a.json()).map(t=>{let r="Error";return t.status==="active"?r="Healthy":t.status==="syncing"?r="Syncing":t.status==="degraded"&&(r="Degraded"),{id:t.id,name:t.name,type:t.type,status:r,color:t.type==="PostgreSQL"?"text-blue-600":t.type==="Snowflake"?"text-sky-500":"text-gray-600"}})}catch{}return await h(200),[{id:"c1",name:"Primary Warehouse",type:"Snowflake",status:"Error",color:"text-sky-500"},{id:"c2",name:"Legacy Archive",type:"PostgreSQL",status:"Error",color:"text-blue-600"}]},getGovernanceRules:async()=>(await h(200),[{id:1,name:"PII Encryption",status:"Enforced",impact:"High",passing:"100%",desc:"All columns tagged PII must be encrypted at rest."},{id:2,name:"Duplicate Detection",status:"Monitoring",impact:"Medium",passing:"98.2%",desc:"Flag records with >95% similarity in core fields."},{id:3,name:"Retention Policy (7 Years)",status:"Enforced",impact:"Critical",passing:"100%",desc:"Hard delete case data 7 years after closure."}]),getGovernancePolicies:async()=>(await h(200),[{id:"pol1",title:"Data Retention Standard",version:"2.4",status:"Active",date:"2024-01-15"},{id:"pol2",title:"Access Control Policy",version:"1.1",status:"Review",date:"2023-11-30"},{id:"pol3",title:"GDPR Compliance Guide",version:"3.0",status:"Active",date:"2024-02-10"}]),getApiSpec:async()=>(await h(100),Tt)},kt={getOkrs:async()=>(await h(200),[]),getCleTracking:async()=>(await h(200),[]),getVendorContracts:async()=>(await h(200),[]),getVendorDirectory:async()=>(await h(200),[]),getRfps:async()=>(await h(200),[]),getMaintenanceTickets:async()=>(await h(200),[]),getFacilities:async()=>(await h(200),[]),getReplicationStatus:async()=>(await h(200),{lag:12,bandwidth:45,syncStatus:"Active",peakBandwidth:120}),getCostMetrics:async()=>(await h(200),[{name:"Compute",cost:1200},{name:"Storage",cost:850},{name:"Network",cost:300},{name:"DB",cost:1500},{name:"AI",cost:2200}]),getCostForecast:async()=>(await h(200),[{day:"1",actual:120,forecast:125},{day:"5",actual:135,forecast:130},{day:"10",actual:140,forecast:145},{day:"15",actual:180,forecast:160},{day:"20",actual:null,forecast:185},{day:"25",actual:null,forecast:190},{day:"30",actual:null,forecast:210}])},Bt={getCommunications:async()=>de.correspondence?.getAll?.()||[],getServiceJobs:async()=>[],addCommunication:async a=>{const e={...a,id:a.id||crypto.randomUUID()},t={id:e.id,caseId:e.caseId,correspondenceType:"email",subject:e.subject,sender:e.sender,recipients:[e.recipient],date:e.date,status:"sent"};return de.correspondence?.create?.(t)||t},addServiceJob:async a=>({...a,id:a.id||crypto.randomUUID()}),updateServiceJob:async(a,e)=>{const t={id:a,caseId:"",requestorId:"",documentTitle:"",targetPerson:"",targetAddress:"",serverName:"",method:"Personal",status:"DRAFT",dueDate:new Date().toISOString(),attempts:0,...e};return e.status==="SERVED"&&t.status!=="SERVED"&&await R.publish(f.SERVICE_COMPLETED,{job:t}),t},archive:async a=>{console.log(`[API] Archived correspondence ${a}`)}};class Pt{state="CLOSED";failureCount=0;lastFailureTime=0;options;constructor(e={failureThreshold:3,recoveryTimeout:1e4}){this.options=e}async execute(e){if(this.state==="OPEN")if(Date.now()-this.lastFailureTime>this.options.recoveryTimeout)this.state="HALF_OPEN";else throw new Error("CircuitBreaker: Service is currently unavailable (Circuit OPEN).");try{const t=await e();return this.state==="HALF_OPEN"&&this.reset(),t}catch(t){throw this.recordFailure(),t}}recordFailure(){this.failureCount++,this.lastFailureTime=Date.now(),this.failureCount>=this.options.failureThreshold&&(this.state="OPEN",console.warn("CircuitBreaker: Threshold reached. Circuit Opened."))}reset(){this.state="CLOSED",this.failureCount=0,console.info("CircuitBreaker: Service recovered. Circuit Closed.")}getState(){return this.state}}const _t=new Pt;class Ot{tokens;lastRefill;capacity;refillRate;constructor(e,t){this.capacity=e,this.refillRate=t,this.tokens=e,this.lastRefill=Date.now()}refill(){const e=Date.now(),r=(e-this.lastRefill)/1e3*this.refillRate;r>0&&(this.tokens=Math.min(this.capacity,this.tokens+r),this.lastRefill=e)}tryConsume(e=1){return this.refill(),this.tokens>=e?(this.tokens-=e,!0):!1}getTokensRemaining(){return this.refill(),Math.floor(this.tokens)}}const Lt=new Ot(10,2),Ft=()=>new Promise(a=>setTimeout(a,0));class xt{constructor(e){this.max=e,this.count=e}tasks=[];count;async acquire(){if(this.count>0){this.count--;return}return new Promise(e=>{this.tasks.push(e)})}release(){if(this.tasks.length>0){const e=this.tasks.shift();e&&e()}else this.count++}}const te=new xt(5);async function ge(a,e=3,t=500){return Lt.tryConsume()?_t.execute(async()=>{try{return await te.acquire(),await a()}catch(r){const i=r.status;if(e===0||i&&i>=400&&i<500&&i!==429)throw r;const s=Math.random()*(t*.5),o=t+s;return console.warn(`[Retry] Attempt failed. Retrying in ${o.toFixed(0)}ms...`),await new Promise(n=>setTimeout(n,o)),te.release(),ge(a,e-1,t*2)}finally{te.release()}}):(await new Promise(r=>setTimeout(r,1e3)),ge(a,e,t))}function ra(a,e){if(!a)return e;try{const t=a.replace(/^```(json)?\s*|\s*```$/g,"").trim();return JSON.parse(t)}catch(t){return console.error("JSON Parse Error",t,"Raw text:",a),e}}class Mt{async getAnomalies(){const e=await d.getAll("anomalies");return e.length===0?[{id:1,table:"clients",field:"email",issue:"Invalid Format",count:12,sample:"john-doe@",status:"Detected",severity:"High"},{id:2,table:"cases",field:"status",issue:"Inconsistent Casing",count:5,sample:"closed",status:"Fixed",severity:"Low"}]:e}async getDedupeClusters(){return await h(100),[]}async getHistory(){return await h(100),[]}async runCleansingJob(){return await h(800),{processed:1500,fixed:42}}async mergeCluster(){await h(100)}async ignoreCluster(){await h(100)}async applyFix(){await h(100)}async getProfiles(){const e=await d.getAll(c.CASES),t=e.length,r={};let i=0;const s={"0-10k":0,"10k-100k":0,"100k+":0},o={2023:0,2024:0,2025:0},n=new Set,y=new Set;for(let S=0;S<t;S++){const v=e[S];if(v.status&&(r[v.status]=(r[v.status]||0)+1),v.value===void 0||v.value===null?i++:(n.add(v.value),v.value<1e4?s["0-10k"]++:v.value<1e5?s["10k-100k"]++:s["100k+"]++),v.filingDate){y.add(v.filingDate);const _=v.filingDate.split("-")[0];o[_]!==void 0&&o[_]++}S%500===0&&await Ft()}const g=Object.keys(r).map(S=>({name:S,value:r[S]}));return[{column:"status",type:"string",nulls:0,unique:Object.keys(r).length,distribution:g},{column:"value",type:"numeric",nulls:t>0?parseFloat((i/t*100).toFixed(1)):0,unique:n.size,distribution:[{name:"0-10k",value:s["0-10k"]},{name:"10k-100k",value:s["10k-100k"]},{name:"100k+",value:s["100k+"]}]},{column:"filing_date",type:"datetime",nulls:0,unique:y.size,distribution:[{name:"2023",value:o[2023]??0},{name:"2024",value:o[2024]??0},{name:"2025",value:o[2025]??0}]}]}async getStandardizationRules(){return await h(100),[{id:"rule-phone",name:"Normalize Phone Numbers",targetField:"phone",operation:"FormatPhone",isActive:!0,parameters:{format:"E.164"}},{id:"rule-email",name:"Lowercase Emails",targetField:"email",operation:"Lowercase",isActive:!0},{id:"rule-trim",name:"Trim Whitespace",targetField:"*",operation:"Trim",isActive:!0}]}}const we=[{id:"dd-001",table:"public.cases",column:"title",dataType:"VARCHAR(500)",description:"The official legal title of the case/matter.",classification:"Internal",isPII:!1,domain:"Legal",owner:"Legal Ops",sourceSystem:"Case Management System",dataQualityScore:98},{id:"dd-002",table:"public.cases",column:"estimated_value",dataType:"NUMERIC(15,2)",description:"The projected financial value or exposure of the matter.",classification:"Confidential",isPII:!1,domain:"Finance",owner:"Billing Dept",sourceSystem:"Case Management System",dataQualityScore:85},{id:"dd-003",table:"public.clients",column:"tax_id",dataType:"VARCHAR(20)",description:"Tax Identification Number (EIN/SSN) for the client entity.",classification:"Restricted",isPII:!0,domain:"Finance",owner:"Compliance",sourceSystem:"CRM",dataQualityScore:100},{id:"dd-004",table:"public.documents",column:"content",dataType:"TEXT",description:"Full text content extracted via OCR for search indexing.",classification:"Confidential",isPII:!0,domain:"IT",owner:"IT Ops",sourceSystem:"DMS",dataQualityScore:92},{id:"dd-005",table:"hr.staff",column:"salary",dataType:"INTEGER",description:"Annual base salary of the employee.",classification:"Restricted",isPII:!0,domain:"HR",owner:"HR Director",sourceSystem:"HRIS",dataQualityScore:100},{id:"dd-006",table:"public.docket_entries",column:"pacer_sequence_number",dataType:"INTEGER",description:"The official sequence number from the PACER/ECF system.",classification:"Public",isPII:!1,domain:"Legal",owner:"Docket Clerk",sourceSystem:"PACER",dataQualityScore:99},{id:"dd-007",table:"public.parties",column:"email",dataType:"VARCHAR(255)",description:"Contact email address for the party.",classification:"Confidential",isPII:!0,domain:"Legal",owner:"Intake Team",sourceSystem:"CRM",dataQualityScore:88},{id:"dd-008",table:"finance.invoices",column:"status",dataType:"VARCHAR(50)",description:"Current payment status of the invoice (Draft, Sent, Paid).",classification:"Internal",isPII:!1,domain:"Finance",owner:"Billing Manager",sourceSystem:"ERP",dataQualityScore:95}],Nt={getDictionary:async()=>(await h(100),we),updateItem:async(a,e)=>{await h(300);const t=we.find(r=>r.id===a);if(!t)throw new Error("Item not found");return{...t,...e}},getDataDomains:async()=>(await h(200),[{name:"Legal",count:12,desc:"Core case and litigation data."},{name:"Finance",count:8,desc:"Billing, invoices, and trust accounts."},{name:"HR",count:4,desc:"Staff, roles, and performance data."},{name:"IT",count:15,desc:"System logs, security, and infrastructure."}]),getSchemaTables:async()=>Object.values(c).map((e,t)=>({name:e,x:t%6*300+50,y:Math.floor(t/6)*350+50,columns:[{name:"id",type:"UUID",pk:!0,notNull:!0},{name:"created_at",type:"TIMESTAMP WITH TIME ZONE",notNull:!0},{name:"updated_at",type:"TIMESTAMP WITH TIME ZONE"},{name:"version",type:"INTEGER",default:"1"}]})),getRegistryInfo:async()=>{const a=Object.values(c),e=[];for(const t of a)try{const r=await d.count(t);e.push({name:t,type:"System Table",records:r,size:`${(r*1.5+24).toFixed(1)} KB`})}catch{console.debug(`[DataCatalog] Store "${t}" not found in IndexedDB, skipping`)}return e},getDataLakeItems:async(a="root")=>(await h(150),{root:[{id:"f1",name:"raw_ingest",type:"folder",modified:"2024-03-10",tier:"Hot",parentId:"root"},{id:"f2",name:"processed_parquet",type:"folder",modified:"2024-03-11",tier:"Hot",parentId:"root"},{id:"f3",name:"archive_logs",type:"folder",modified:"2023-12-01",tier:"Cool",parentId:"root"}],raw_ingest:[{id:"raw1",name:"client_dump_2024.csv",type:"file",size:"450 MB",modified:"2024-03-10",format:"CSV",tier:"Hot",parentId:"raw_ingest"}],processed_parquet:[{id:"pq1",name:"fact_sales_q1.parquet",type:"file",size:"1.2 GB",modified:"2024-03-11",format:"Parquet",tier:"Hot",parentId:"processed_parquet"}]}[a]||[]),getLineageGraph:async()=>{const a=[],e=[],t=a.map(i=>{const s=i;return{id:s.id,label:s.name,type:s.type==="Corporation"?"org":"party"}}),r=e.map(i=>{const s=i;return{source:s.sourceId,target:s.targetId,strength:s.weight||.5}});return t.length===0?{nodes:[{id:"src1",label:"Salesforce CRM",type:"root"},{id:"stg1",label:"Raw Zone (S3)",type:"org"},{id:"wh1",label:"Data Warehouse",type:"org"},{id:"rpt1",label:"Revenue Dashboard",type:"evidence"}],links:[{source:"src1",target:"stg1",strength:.8},{source:"stg1",target:"wh1",strength:.8},{source:"wh1",target:"rpt1",strength:.8}]}:{nodes:t,links:r}}};function $t(a,e){const t=["Full","Incremental"];if(!a||!t.includes(a))throw new Error(`[BackupService.${e}] Invalid snapshot type. Must be: ${t.join(", ")}`)}function Ut(a,e){if(!a||typeof a!="string"||a.trim()==="")throw new Error(`[BackupService.${e}] Snapshot ID is required and must be a non-empty string`);if(!a.startsWith("snap-"))throw new Error(`[BackupService.${e}] Invalid snapshot ID format. Must start with 'snap-'`)}const Ht=[{id:"snap-auto-001",name:"Daily Automated Backup",type:"Full",created:new Date(Date.now()-864e5).toISOString(),size:"450 GB",status:"Completed"},{id:"snap-auto-002",name:"Hourly Log Backup",type:"Incremental",created:new Date(Date.now()-36e5).toISOString(),size:"2.5 GB",status:"Completed"},{id:"snap-man-003",name:"Pre-Deployment Snapshot",type:"Full",created:new Date(Date.now()-1728e5).toISOString(),size:"448 GB",status:"Completed"}],Vt={getSnapshots:async()=>{try{return(await new Q().getAll()).map(t=>({id:t.id,name:t.name,type:t.type==="full"?"Full":"Incremental",created:t.startedAt,size:t.size?`${(t.size/(1024*1024*1024)).toFixed(2)} GB`:"Unknown",status:t.status==="completed"?"Completed":t.status==="in_progress"?"Running":"Failed"})).sort((t,r)=>new Date(r.created).getTime()-new Date(t.created).getTime())}catch(a){return console.error("[BackupService.getSnapshots] Backend unavailable, using fallback data:",a),await h(200),[...Ht].sort((e,t)=>new Date(t.created).getTime()-new Date(e.created).getTime())}},getArchiveStats:async()=>{try{return await h(200),{totalSize:"85 TB",objectCount:1450200,monthlyCost:345.5,retentionPolicy:"7 Years (WORM)",glacierTier:"Deep Archive"}}catch(a){throw console.error("[BackupService.getArchiveStats] Error:",a),a}},createSnapshot:async a=>{try{$t(a,"createSnapshot");const t=await new Q().create({name:`Manual ${a} Backup`,type:a.toLowerCase()}),r={id:t.id,name:t.name,type:a,created:t.startedAt,size:t.size?`${(t.size/(1024*1024*1024)).toFixed(2)} GB`:a==="Full"?"452 GB":a==="Incremental"?"150 MB":"2.8 GB",status:t.status==="completed"?"Completed":"Running"};return console.log(`[BackupService] Created ${a} snapshot: ${r.id}`),r}catch(e){throw console.error("[BackupService.createSnapshot] Error:",e),e}},restoreSnapshot:async a=>{try{return Ut(a,"restoreSnapshot"),await new Q().restore(a),console.log(`[BackupService] Successfully restored snapshot ${a}`),!0}catch(e){throw console.error("[BackupService.restoreSnapshot] Error:",e),e}}},re=[{name:"Motion to Dismiss",grant:65,deny:35},{name:"Summary Judgment",grant:42,deny:58},{name:"Discovery Compel",grant:78,deny:22}],zt={validateId:(a,e)=>{if(!a||a.trim()==="")throw new Error(`[AnalyticsService.${e}] Invalid id parameter`)},validateName:(a,e)=>{if(!a||a.trim()==="")throw new Error(`[AnalyticsService.${e}] Invalid name parameter`)},getCounselProfiles:async()=>{try{return console.warn("[AnalyticsService.getCounselProfiles] Counsel profiles API not yet available"),[]}catch(a){throw console.error("[AnalyticsService.getCounselProfiles] Error:",a),new Error("Failed to fetch opposing counsel profiles")}},getJudgeMotionStats:async()=>{try{const a=await W.judgeStats?.getAll?.();return!a||!Array.isArray(a)||a.length===0?(console.warn("[AnalyticsService] Backend judge stats unavailable, using default data"),re):a.every(t=>t&&typeof t=="object"&&"name"in t&&"grant"in t&&"deny"in t&&typeof t.grant=="number"&&typeof t.deny=="number")?a:(console.warn("[AnalyticsService] Invalid judge stats structure, using default data"),re)}catch(a){return console.error("[AnalyticsService.getJudgeMotionStats] Error:",a),console.warn("[AnalyticsService] Falling back to default judge motion stats"),re}},getOutcomePredictions:async()=>{try{const a=await W.outcomePredictions?.getPredictions?.();return!a||!Array.isArray(a)?(console.warn("[AnalyticsService] Invalid outcome predictions data, returning empty array"),[]):a}catch(a){throw console.error("[AnalyticsService.getOutcomePredictions] Error:",a),new Error("Failed to fetch outcome predictions")}},validateHealth:async()=>{try{const[a,e]=await Promise.allSettled([W.judgeStats?.getAll?.().then(()=>!0).catch(()=>!1),W.outcomePredictions?.getPredictions?.().then(()=>!0).catch(()=>!1)]),t=[a.status==="fulfilled"&&a.value,e.status==="fulfilled"&&e.value],r=t.filter(Boolean).length,i=r/t.length*100;return console.log(`[AnalyticsService] Health check: ${i}% (${r}/${t.length} endpoints)`),i>=50}catch(a){return console.error("[AnalyticsService.validateHealth] Error:",a),!1}}},ne={getLeads:async()=>(await h(200),[]),getAnalytics:async(a="light")=>{const e=await ne.getLeads(),t=e.reduce((o,n)=>{const y=n;return o[y.source||"Referral"]=(o[y.source||"Referral"]||0)+1,o},{}),r=Object.keys(t).map(o=>({name:o,value:t[o]})),{ChartColorService:i}=await m(async()=>{const{ChartColorService:o}=await import("./chartColorService-Dq1XQNFk.js");return{ChartColorService:o}},__vite__mapDeps([0,1,2,3,4])),s=i.getCategoryColors(a||"light");return{growth:[{month:"Jan",clients:5},{month:"Feb",clients:8},{month:"Mar",clients:e.length}],industry:[{name:"Tech",value:40,color:s.tech},{name:"Finance",value:25,color:s.finance},{name:"Healthcare",value:15,color:s.healthcare}],revenue:[{name:"Q1",retained:4e5,new:12e4},{name:"Q2",retained:45e4,new:18e4}],sources:r}},updateLead:async(a,e)=>{const t={id:a,client:"Mock Client",title:"Mock Lead",stage:e.stage,value:"$0"};return e.stage&&await R.publish(f.LEAD_STAGE_CHANGED,{leadId:a,stage:e.stage,clientName:t.client,value:t.value}),e.stage==="Matter Created"&&await ne.convertLeadToClient(t),t},convertLeadToClient:async a=>{console.log(`[CRM] Converting Lead ${a.id} to Client/Case...`);const e=new ve,t=new me,r=await e.create({name:a.client,clientType:Fe.CORPORATION,status:Le.ACTIVE,industry:"General",totalBilled:0,currentBalance:0,creditLimit:0,totalCases:1,activeCases:1,isVip:!1,requiresConflictCheck:!0,hasRetainer:!1,paymentTerms:Oe.NET_30}),i=await t.add({title:a.title,client:a.client,clientId:r.id,matterType:We.OTHER,status:Se.Active,filingDate:new Date().toISOString().split("T")[0],description:`Converted from Lead ${a.id}`,ownerId:"usr-admin-justin",isArchived:!1,parties:[],citations:[],arguments:[],defenses:[]});await R.publish(f.CASE_CREATED,{caseData:i}),await R.publish(f.ENTITY_CREATED,{entity:{...r,type:"Corporation",roles:["Client"],riskScore:0,tags:[]}}),console.log(`[CRM] Successfully converted Lead ${a.id} to Client ${r.id} and Case ${i.id}`)}},V={getCurrentProfile:async()=>({id:"usr-admin-justin",name:"Justin Harbor",email:"justin@harborgrid.com",role:"Administrator",entityId:"ent-admin",title:"Senior Partner",department:"Litigation",userType:"Internal",status:"online",skills:["Commercial Litigation","Class Action","Bankruptcy","Negotiation"],barAdmissions:[{state:"VA",number:"99823",status:"Active"},{state:"DC",number:"445210",status:"Active"}],preferences:{theme:"system",notifications:{email:!0,push:!0,slack:!1,digestFrequency:"Daily"},dashboardLayout:["metrics","tasks","calendar"],density:"comfortable",locale:"en-US",timezone:"America/New_York"},security:{mfaEnabled:!0,mfaMethod:"App",lastPasswordChange:"2024-01-15",passwordExpiry:"2024-04-15",ipWhitelist:["192.168.1.1"],activeSessions:[{id:"sess-1",device:"MacBook Pro",ip:"192.168.1.55",lastActive:"Just now",current:!0},{id:"sess-2",device:"iPhone 15",ip:"10.0.0.5",lastActive:"2 hours ago",current:!1}]},accessMatrix:[{id:"perm-1",resource:"cases",action:"*",effect:"Allow",scope:"Global",reason:"Administrator - Full Access"},{id:"perm-2",resource:"documents",action:"*",effect:"Allow",scope:"Global",reason:"Administrator - Full Access"},{id:"perm-3",resource:"billing",action:"*",effect:"Allow",scope:"Global",reason:"Administrator - Full Access"},{id:"perm-4",resource:"billing.invoices",action:"*",effect:"Allow",scope:"Global",reason:"Administrator - Full Access"},{id:"perm-5",resource:"hr",action:"*",effect:"Allow",scope:"Global",reason:"Administrator - Full Access"},{id:"perm-6",resource:"admin",action:"*",effect:"Allow",scope:"Global",reason:"Administrator - Full Access"},{id:"perm-7",resource:"security",action:"*",effect:"Allow",scope:"Global",reason:"Administrator - Full Access"},{id:"perm-8",resource:"compliance",action:"*",effect:"Allow",scope:"Global",reason:"Administrator - Full Access"},{id:"perm-9",resource:"audit",action:"*",effect:"Allow",scope:"Global",reason:"Administrator - Full Access"},{id:"perm-10",resource:"analytics",action:"*",effect:"Allow",scope:"Global",reason:"Administrator - Full Access"},{id:"perm-11",resource:"integrations",action:"*",effect:"Allow",scope:"Global",reason:"Administrator - Full Access"},{id:"perm-12",resource:"api.keys",action:"*",effect:"Allow",scope:"Global",reason:"Administrator - Full Access"},{id:"perm-13",resource:"system",action:"*",effect:"Allow",scope:"Global",reason:"Administrator - Full Access"},{id:"perm-14",resource:"database",action:"*",effect:"Allow",scope:"Global",reason:"Administrator - Full Access"},{id:"perm-15",resource:"*",action:"*",effect:"Allow",scope:"Global",reason:"Super Admin - Unrestricted Access"}]}),updateProfile:async a=>{const t={...await V.getCurrentProfile(),...a};return await d.put(c.USERS,t),t},updatePreferences:async a=>{const e=await V.getCurrentProfile(),t={...e,preferences:{...e.preferences,...a}};await d.put(c.USERS,t)},updateSecurity:async a=>{const e=await V.getCurrentProfile();await h(500);const t={...e,security:{...e.security,...a}};await d.put(c.USERS,t)},addPermission:async a=>{const e=await V.getCurrentProfile(),t={...a,id:`perm-${Date.now()}`},r={...e,accessMatrix:[...e.accessMatrix,t]};return await d.put(c.USERS,r),t},revokePermission:async a=>{const e=await V.getCurrentProfile(),t={...e,accessMatrix:e.accessMatrix.filter(r=>r.id!==a)};await d.put(c.USERS,t)},getAuditLog:async a=>{const e=await d.getByIndex(c.LOGS,"userId",a);return e.length===0?[{id:"log-1",action:"Login",timestamp:new Date().toISOString(),ip:"192.168.1.55",device:"MacBook Pro"},{id:"log-2",action:"View Case",resource:"Martinez v. TechCorp",timestamp:new Date(Date.now()-36e5).toISOString()}]:e.sort((t,r)=>new Date(r.timestamp).getTime()-new Date(t.timestamp).getTime()).slice(0,50)}},jt=[{source:"Client Referral",leads:45,conversions:20,revenue:25e4,roi:500},{source:"Website / SEO",leads:120,conversions:5,revenue:45e3,roi:150},{source:"LinkedIn",leads:30,conversions:2,revenue:15e3,roi:80},{source:"Legal Directory",leads:15,conversions:8,revenue:12e4,roi:300}],Gt={getMetrics:async()=>(await h(200),jt),getCampaigns:async()=>[{id:"1",name:"Q1 Webinar Series",target:"Corporate Counsel",status:"Active",budget:"$2,000/mo"},{id:"2",name:'Google Ads - "Commercial Lit"',target:"Small Business",status:"Active",budget:"$2,000/mo"},{id:"3",name:"LegalTech Conference Sponsor",target:"Industry Wide",status:"Upcoming",dates:"Sep 15-18"}]},Wt={getAll:async()=>await x.getAll()||[],getFederal:async()=>await x.getFederal()||[],getState:async()=>await x.getState()||[],getRegulatoryBodies:async()=>{try{return await x.getRegulatory()}catch{return console.warn("Backend API unavailable, using mock data"),await h(100),[{id:"reg1",name:"FTC",desc:"Federal Trade Commission",ref:"15 U.S.C.  41",iconColor:"text-blue-600"},{id:"reg2",name:"SEC",desc:"Securities & Exchange Commission",ref:"15 U.S.C.  78d",iconColor:"text-green-600"},{id:"reg3",name:"EPA",desc:"Environmental Protection Agency",ref:"42 U.S.C.  4321",iconColor:"text-emerald-600"},{id:"reg4",name:"FCC",desc:"Federal Communications Commission",ref:"47 U.S.C.  151",iconColor:"text-purple-600"},{id:"reg5",name:"EEOC",desc:"Equal Employment Opportunity Comm.",ref:"42 U.S.C.  2000e",iconColor:"text-rose-600"}]}},getTreaties:async()=>{try{return await x.getInternational()}catch{return console.warn("Backend API unavailable, using mock data"),await h(100),[{id:"t1",name:"Hague Service Convention",type:"Service of Process",status:"Ratified",parties:79},{id:"t2",name:"Hague Evidence Convention",type:"Discovery",status:"Ratified",parties:63},{id:"t3",name:"New York Convention",type:"Arbitration Enforcement",status:"Ratified",parties:172},{id:"t4",name:"CISG",type:"Commercial Contracts",status:"Ratified",parties:95}]}},getArbitrationProviders:async()=>{try{return await x.getArbitration()}catch{return console.warn("Backend API unavailable, using mock data"),await h(100),[{id:"aaa",name:"AAA",fullName:"American Arbitration Association",rules:["Commercial","Consumer","Employment"]},{id:"jams",name:"JAMS",fullName:"Judicial Arbitration and Mediation Services",rules:["Comprehensive","Streamlined"]},{id:"icc",name:"ICC",fullName:"International Chamber of Commerce",rules:["ICC Rules of Arbitration"]}]}},getMapNodes:async()=>{try{return await x.getMapNodes()}catch{return console.warn("Backend API unavailable, using mock data"),await h(100),[{id:"n1",label:"SCOTUS",type:"federal",x:400,y:50,radius:40},{id:"n2",label:"9th Cir.",type:"federal",x:200,y:150,radius:30},{id:"n3",label:"4th Cir.",type:"federal",x:600,y:150,radius:30},{id:"n4",label:"N.D. Cal",type:"federal",x:150,y:250,radius:25},{id:"n5",label:"E.D. Va",type:"federal",x:650,y:250,radius:25},{id:"n6",label:"CA Supreme",type:"state",x:100,y:350,radius:30},{id:"n7",label:"VA Supreme",type:"state",x:700,y:350,radius:30},{id:"n8",label:"SF Superior",type:"state",x:100,y:450,radius:20},{id:"n9",label:"Fairfax Cir.",type:"state",x:700,y:450,radius:20}]}}};class qt{registry=new Map;contextIndex=new Map;create(e,t){const r=URL.createObjectURL(e),i={url:r,context:t,createdAt:Date.now(),blob:void 0};return this.registry.set(r,i),t&&(this.contextIndex.has(t)||this.contextIndex.set(t,new Set),this.contextIndex.get(t).add(r)),r}revoke(e){const t=this.registry.get(e);t&&(URL.revokeObjectURL(e),this.registry.delete(e),t.context&&this.contextIndex.has(t.context)&&(this.contextIndex.get(t.context).delete(e),this.contextIndex.get(t.context).size===0&&this.contextIndex.delete(t.context)))}revokeByContext(e){const t=this.contextIndex.get(e);t&&t.forEach(r=>this.revoke(r))}revokeOld(e=300*1e3){const r=Date.now()-e;let i=0;return this.registry.forEach((s,o)=>{s.createdAt<r&&(this.revoke(o),i++)}),i}revokeAll(){this.registry.forEach((e,t)=>{URL.revokeObjectURL(t)}),this.registry.clear(),this.contextIndex.clear()}getStats(){const e={};let t=0;const r=Date.now();return this.contextIndex.forEach((i,s)=>{e[s]=i.size}),this.registry.forEach(i=>{const s=r-i.createdAt;s>t&&(t=s)}),{total:this.registry.size,byContext:e,oldestAge:t}}has(e){return this.registry.has(e)}createTemporary(e,t=5e3){const r=this.create(e,"temporary");return setTimeout(()=>{this.revoke(r)},t),r}}const ce=new qt;typeof window<"u"&&(oe.addEventListener("beforeunload",(()=>{ce.revokeAll()})),setInterval(()=>{const a=ce.revokeOld(3e5);a>0&&console.debug(`[BlobManager] Auto-cleaned ${a} old blob URLs`)},120*1e3));const q=()=>new Promise(a=>setTimeout(a,0));class Jt extends C{useBackend;documentsApi;constructor(){super(c.DOCUMENTS),this.useBackend=T(),this.documentsApi=new xe,this.logInitialization()}logInitialization(){const e=this.useBackend?"Backend API (PostgreSQL)":"IndexedDB (Local)";console.log(`[DocumentRepository] Initialized with ${e}`)}validateId(e,t){if(!e||typeof e!="string"||e.trim()==="")throw new Error(`[DocumentRepository.${t}] Invalid id parameter`)}validateFile(e,t){if(!e||!(e instanceof File))throw new Error(`[DocumentRepository.${t}] Invalid file parameter`);if(e.size===0)throw new Error(`[DocumentRepository.${t}] File is empty`);if(e.size>100*1024*1024)throw new Error(`[DocumentRepository.${t}] File size exceeds 100MB limit`)}async getAll(e){if(this.useBackend&&e&&(e.caseId||e.type||e.status))try{return await this.documentsApi.getAll(e)}catch(t){console.warn("[DocumentRepository] Backend API unavailable, falling back to IndexedDB",t)}try{const t=await super.getAll(e);return!e||!e.caseId&&!e.type&&!e.status?t:t.filter(r=>e.caseId&&r.caseId!==e.caseId||e.type&&r.type!==e.type?!1:!(e.status&&r.status!==e.status))}catch(t){throw console.error("[DocumentRepository.getAll] Error:",t),new l("getAll","Failed to fetch documents")}}async getById(e){if(this.validateId(e,"getById"),this.useBackend)try{return await this.documentsApi.getById(e)}catch(t){console.warn("[DocumentRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await super.getById(e)}catch(t){throw console.error("[DocumentRepository.getById] Error:",t),new l("getById","Failed to fetch document")}}async add(e){if(!e||typeof e!="object")throw new u("[DocumentRepository.add] Invalid document data");if(this.useBackend)try{return await this.documentsApi.add(e)}catch(t){console.warn("[DocumentRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await super.add(e),e}catch(t){throw console.error("[DocumentRepository.add] Error:",t),new l("add","Failed to add document")}}async update(e,t){if(this.validateId(e,"update"),!t||typeof t!="object")throw new u("[DocumentRepository.update] Invalid updates data");if(this.useBackend)try{return await this.documentsApi.update(e,t)}catch(r){console.warn("[DocumentRepository] Backend API unavailable, falling back to IndexedDB",r)}try{return await super.update(e,t)}catch(r){throw console.error("[DocumentRepository.update] Error:",r),new l("update","Failed to update document")}}async delete(e){if(this.validateId(e,"delete"),this.useBackend)try{await this.documentsApi.delete(e);return}catch(t){console.warn("[DocumentRepository] Backend API unavailable, falling back to IndexedDB",t)}try{await super.delete(e)}catch(t){throw console.error("[DocumentRepository.delete] Error:",t),new l("delete","Failed to delete document")}}async getFile(e){this.validateId(e,"getFile");try{return await d.getFile(e)}catch(t){return console.error("[DocumentRepository.getFile] Error:",t),null}}async getContent(e){this.validateId(e,"getContent");try{const t=await this.getFile(e);if(t)try{return await t.text()}catch(i){console.error("[DocumentRepository.getContent] Could not read blob as text",i)}return(await this.getById(e))?.content||""}catch(t){throw console.error("[DocumentRepository.getContent] Error:",t),new l("getContent","Failed to get document content")}}async uploadDocument(e,t){if(this.validateFile(e,"uploadDocument"),this.useBackend)try{return await this.documentsApi.upload(e,t||{})}catch(r){console.warn("[DocumentRepository] Backend API unavailable, falling back to IndexedDB",r)}try{const r=`doc-${Date.now()}`,i={id:r,caseId:t.caseId||"General",title:e.name,type:t.type||e.type.split("/")[1]?.toUpperCase()||"File",content:"Binary content stored in secure blob storage.",uploadDate:new Date().toISOString().split("T")[0],lastModified:new Date().toISOString().split("T")[0],tags:t.tags||["Uploaded","Local"],versions:[],fileSize:this.formatBytes(e.size),sourceModule:t.sourceModule||"General",status:t.status||"Draft",isEncrypted:!1};return await this.add(i),await d.putFile(r,e),i}catch(r){throw console.error("[DocumentRepository.uploadDocument] Error:",r),new l("uploadDocument","Failed to upload document")}}async downloadDocument(e){if(this.validateId(e,"downloadDocument"),this.useBackend)try{return await this.documentsApi.download(e)}catch(t){console.warn("[DocumentRepository] Backend API unavailable, falling back to IndexedDB",t)}try{const t=await this.getFile(e);if(!t)throw new U("Document file",e);return t}catch(t){throw console.error("[DocumentRepository.downloadDocument] Error:",t),new l("downloadDocument","Failed to download document")}}async getDocumentUrl(e){this.validateId(e,"getDocumentUrl");try{const t=await this.getFile(e);return t?ce.create(t,`document-${e}`):null}catch(t){return console.error("[DocumentRepository.getDocumentUrl] Error:",t),null}}async bulkUpload(e,t){if(!Array.isArray(e)||e.length===0)throw new u("[DocumentRepository.bulkUpload] Invalid files array");if(e.forEach((r,i)=>{this.validateFile(r,`bulkUpload[${i}]`)}),this.useBackend)try{return await this.documentsApi.bulkUpload(e,t)}catch(r){console.warn("[DocumentRepository] Backend API unavailable, falling back to IndexedDB",r)}try{const r=[];for(const i of e){const s=await this.uploadDocument(i,t);r.push(s)}return r}catch(r){throw console.error("[DocumentRepository.bulkUpload] Error:",r),new l("bulkUpload","Failed to bulk upload documents")}}async processFile(e){this.validateFile(e,"processFile");try{const t=crypto.randomUUID();await q();const r="0x"+Array.from({length:64},()=>Math.floor(Math.random()*16).toString(16)).join("");await q();const i=Math.floor(Math.random()*5)+2,s=[];for(let y=1;y<=i;y++)await q(),s.push({id:`${t}-p${y}`,pageNumber:y,contentPreview:`Extracted content from page ${y} of ${e.name}. This section contains key definitions and clauses verified against the master record.`,hash:"0x"+Math.floor(Math.random()*1e7).toString(16)+"..."});const o=["Uploaded",e.type.split("/")[1]||"Unknown"],n=e.name.toLowerCase();return n.includes("contract")&&o.push("Contract"),n.includes("email")&&o.push("Correspondence"),n.includes("motion")&&o.push("Motion"),n.includes("brief")&&o.push("Brief"),{hash:r,uuid:t,chunks:s,tags:o,summary:`Auto-generated summary for ${e.name}. Parsed ${i} pages. Verified clean of malware. Authenticated source.`}}catch(t){throw console.error("[DocumentRepository.processFile] Error:",t),new l("processFile","Failed to process file")}}async verifyIntegrity(e){if(!e||typeof e!="string")throw new u("[DocumentRepository.verifyIntegrity] Invalid hash parameter");return new Promise((t,r)=>{setTimeout(()=>{try{t({verified:!0,timestamp:new Date().toISOString(),block:18452e3+Math.floor(Math.random()*5e3)})}catch{r(new Error("Failed to verify document integrity"))}},2e3)})}async redact(e){this.validateId(e,"redact");try{const t=await this.getById(e);if(!t)throw new U("Document",e);const r={id:`ver-${Date.now()}`,versionNumber:(t.versions?.length||0)+1,uploadedBy:"System",uploadDate:new Date().toISOString(),contentSnapshot:t.content},i={...t,content:"[REDACTED CONTENT] - PII Removed via Automated Scrubbing",isRedacted:!0,versions:[r,...t.versions||[]],lastModified:new Date().toISOString()};return await this.update(e,i)}catch(t){throw console.error("[DocumentRepository.redact] Error:",t),new l("redact","Failed to redact document")}}async summarizeBatch(e){if(!Array.isArray(e)||e.length===0)throw new u("[DocumentRepository.summarizeBatch] Invalid docIds array");e.forEach((t,r)=>{this.validateId(t,`summarizeBatch[${r}]`)});try{console.log(`[AI] Summarizing ${e.length} documents.`),await q();for(const t of e)await this.getById(t)&&await this.update(t,{summary:"AI Summary: Document processed successfully."});return e.length}catch(t){throw console.error("[DocumentRepository.summarizeBatch] Error:",t),new l("summarizeBatch","Failed to summarize documents")}}async getFolders(){return[{id:"root",label:"All Documents"},{id:"case_docs",label:"Case Files"},{id:"discovery",label:"Discovery Productions"},{id:"templates_folder",label:"Templates"},{id:"pleadings",label:"Pleadings"},{id:"correspondence",label:"Correspondence"}]}async getTemplates(){try{return(await this.getAll()).filter(t=>t.tags?.includes("Template")).map(t=>({id:t.id,title:t.title,category:t.sourceModule||"General",popular:t.riskScore?t.riskScore>50:!1}))}catch(e){throw console.error("[DocumentRepository.getTemplates] Error:",e),new l("getTemplates","Failed to fetch templates")}}async getRecent(e=10){if(typeof e!="number"||e<1)throw new u("[DocumentRepository.getRecent] Invalid limit parameter");try{return(await this.getAll()).sort((r,i)=>new Date(i.lastModified||"").getTime()-new Date(r.lastModified||"").getTime()).slice(0,e)}catch(t){throw console.error("[DocumentRepository.getRecent] Error:",t),new l("getRecent","Failed to fetch recent documents")}}formatBytes(e,t=2){if(!+e)return"0 Bytes";const r=1024,i=t<0?0:t,s=["Bytes","KB","MB","GB","TB"],o=Math.floor(Math.log(e)/Math.log(r));return`${parseFloat((e/Math.pow(r,o)).toFixed(i))} ${s[o]}`}}class Kt extends C{useBackend;evidenceApi;constructor(){super(c.EVIDENCE),this.useBackend=T(),this.evidenceApi=new Me,this.logInitialization()}logInitialization(){const e=this.useBackend?"Backend API (PostgreSQL)":"IndexedDB (Local)";console.log(`[EvidenceRepository] Initialized with ${e}`)}validateId(e,t){if(!e||e.trim()==="")throw new Error(`[EvidenceRepository.${t}] Invalid id parameter`)}validateCaseId(e,t){if(!e||e.trim()==="")throw new Error(`[EvidenceRepository.${t}] Invalid caseId parameter`)}async getAll(){if(this.useBackend)try{return await this.evidenceApi.getAll()}catch(e){console.warn("[EvidenceRepository] Backend API unavailable, falling back to IndexedDB",e)}try{return await super.getAll()}catch(e){throw console.error("[EvidenceRepository.getAll] Error:",e),new l("getAll","Failed to fetch evidence items")}}getByCaseId=async e=>{if(this.validateCaseId(e,"getByCaseId"),this.useBackend)try{return await this.evidenceApi.getAll(e)}catch(t){console.warn("[EvidenceRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await this.getByIndex("caseId",e)}catch(t){throw console.error("[EvidenceRepository.getByCaseId] Error:",t),new l("getByCaseId","Failed to fetch evidence items by case ID")}};async getById(e){if(this.validateId(e,"getById"),this.useBackend)try{return await this.evidenceApi.getById(e)}catch(t){console.warn("[EvidenceRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await super.getById(e)}catch(t){throw console.error("[EvidenceRepository.getById] Error:",t),new l("getById","Failed to fetch evidence item")}}async add(e){if(!e||typeof e!="object")throw new u("[EvidenceRepository.add] Invalid evidence item data");if(this.useBackend)try{return await this.evidenceApi.add(e)}catch(t){console.warn("[EvidenceRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await super.add(e),e}catch(t){throw console.error("[EvidenceRepository.add] Error:",t),new l("add","Failed to add evidence item")}}async update(e,t){if(this.validateId(e,"update"),!t||typeof t!="object")throw new u("[EvidenceRepository.update] Invalid updates data");try{const r=await this.getById(e);if(!r)throw new U("EvidenceItem",e);let i;if(this.useBackend)try{i=await this.evidenceApi.update(e,t)}catch(s){console.warn("[EvidenceRepository] Backend API unavailable, falling back to IndexedDB",s),i=await super.update(e,t)}else i=await super.update(e,t);if(t.admissibility&&t.admissibility!==r.admissibility)try{await R.publish(f.EVIDENCE_STATUS_UPDATED,{item:i,oldStatus:r.admissibility,newStatus:t.admissibility})}catch(s){console.warn("[EvidenceRepository] Failed to publish integration event",s)}return i}catch(r){throw console.error("[EvidenceRepository.update] Error:",r),new l("update","Failed to update evidence item")}}async delete(e){if(this.validateId(e,"delete"),this.useBackend)try{await this.evidenceApi.delete(e);return}catch(t){console.warn("[EvidenceRepository] Backend API unavailable, falling back to IndexedDB",t)}try{await super.delete(e)}catch(t){throw console.error("[EvidenceRepository.delete] Error:",t),new l("delete","Failed to delete evidence item")}}verifyIntegrity=async e=>{this.validateId(e,"verifyIntegrity");try{await h(1500);const t=await this.getById(e),r=t;return{verified:!0,timestamp:new Date().toISOString(),chainIntact:r?.chainOfCustodyIntact??!0,lastCustodian:r?.currentCustodian??t?.custodian}}catch(t){throw console.error("[EvidenceRepository.verifyIntegrity] Error:",t),new l("verifyIntegrity","Failed to verify evidence integrity")}};async updateAdmissibility(e,t){if(this.validateId(e,"updateAdmissibility"),!t||!["pending","admissible","inadmissible","challenged"].includes(t))throw new u("[EvidenceRepository.updateAdmissibility] Invalid status parameter");return await this.update(e,{admissibility:t})}async updateCustody(e,t,r){if(this.validateId(e,"updateCustody"),!t||t.trim()==="")throw new u("[EvidenceRepository.updateCustody] Invalid custodian parameter");try{const i=await this.getById(e);if(!i)throw new U("EvidenceItem",e);const s={timestamp:new Date().toISOString(),custodian:t,action:"transferred",notes:r||`Custody transferred to ${t}`},o={custodian:t,chainOfCustody:[...i.chainOfCustody||[],s]};return await this.update(e,o)}catch(i){throw console.error("[EvidenceRepository.updateCustody] Error:",i),new l("updateCustody","Failed to update chain of custody")}}generateReport=async e=>{this.validateId(e,"generateReport");try{await h(1e3),console.log(`[EvidenceRepository] Report generated for evidence ${e}`)}catch(t){throw console.error("[EvidenceRepository.generateReport] Error:",t),new l("generateReport","Failed to generate evidence report")}};async getStatistics(e){this.validateCaseId(e,"getStatistics");try{const t=await this.getByCaseId(e),r={},i={};let s=0,o=0;return t.forEach(n=>{const y=n,g=n.type||y.evidenceType||"Unknown",S=String(g);r[S]=(r[S]||0)+1;const v=n.status||"Unknown";i[v]=(i[v]||0)+1,n.admissibility?.toString()==="ADMISSIBLE"||n.admissibility?.toString()==="admissible"||y.isAdmitted?s++:(n.admissibility?.toString()==="PENDING"||n.admissibility?.toString()==="pending")&&o++}),{total:t.length,byType:r,byStatus:i,admitted:s,pending:o}}catch(t){throw console.error("[EvidenceRepository.getStatistics] Error:",t),new l("getStatistics","Failed to get evidence statistics")}}async search(e){try{let t=await this.getAll();if(e.caseId&&(t=t.filter(r=>r.caseId===e.caseId)),e.query){const r=e.query.toLowerCase();t=t.filter(i=>{const s=i;return i.title?.toLowerCase().includes(r)||i.description?.toLowerCase().includes(r)||s.evidenceNumber?.toLowerCase().includes(r)||s.batesNumber?.toLowerCase().includes(r)})}if(e.type&&(t=t.filter(r=>{const i=r;return r.type===e.type||i.evidenceType===e.type})),e.admissibility){const r=e.admissibility;t=t.filter(i=>i.admissibility?.toString()===r||i.admissibility?.toString().toLowerCase()===r.toLowerCase())}return e.custodian&&(t=t.filter(r=>r.currentCustodian===e.custodian||r.custodian===e.custodian)),t}catch(t){throw console.error("[EvidenceRepository.search] Error:",t),new l("search","Failed to search evidence")}}}const k=a=>{const e=Date.now().toString(36),t=Math.random().toString(36).substring(2,15),r=Math.random().toString(36).substring(2,15);return`${a}-${e}-${t}${r}`},J={pleading:()=>k("plead"),section:()=>k("sec"),template:()=>k("tmpl"),formattingRule:()=>k("rule"),case:()=>k("case"),user:()=>k("user"),evidence:()=>k("evid"),document:()=>k("doc"),docket:()=>k("dk"),party:()=>k("party"),staff:()=>k("staff"),stipulation:()=>k("stip"),generic:a=>k(a)},Yt=/\{\{([^}]+)\}\}/g;function Qt(a,e){const t=e.trim().split(".");let r=a;for(const i of t){if(r==null)return;r=r[i]}return r}function Xt(a,e){return a.replace(Yt,(t,r)=>{const i=Qt(e,r);return i==null?t:typeof i=="object"?JSON.stringify(i):String(i)})}function Zt(a,e){return a.map(t=>({...t,content:t.content?Xt(t.content,e):""}))}function er(a){const e=a.parties?.find(r=>r.role.includes("Plaintiff")||r.role.includes("Appellant")),t=a.parties?.find(r=>r.role.includes("Defendant")||r.role.includes("Appellee"));return{case:a,Plaintiff:e?.name||"[PLAINTIFF]",Defendant:t?.name||"[DEFENDANT]",CaseNumber:a.id,Court:a.court||"[COURT]",Judge:a.judge||"[JUDGE]",FilingDate:a.filingDate||new Date().toISOString(),Title:a.title||"[CASE TITLE]",Parties:a.parties||[],"case.id":a.id,"case.title":a.title,"case.court":a.court,"case.judge":a.judge}}const tr=["Caption","Certificate"],rr=5e4,ar=/\[\[?[A-Z_\s]+\]?\]/g,N={validateRequired:(a,e,t)=>{if(a==null)throw new Error(`[ValidationService.${t}] ${e} is required and cannot be null or undefined`)},validateString:(a,e,t)=>{},validateArray:(a,e,t)=>{if(!Array.isArray(a))throw new Error(`[ValidationService.${t}] ${e} must be an array`)},validatePleadingCompleteness:a=>{try{if(N.validateRequired(a,"document","validatePleadingCompleteness"),!a||typeof a!="object")throw new Error("[ValidationService.validatePleadingCompleteness] Invalid document structure");N.validateArray(a.sections,"document.sections","validatePleadingCompleteness");const e=[],t=[],r=new Set(a.sections.map(y=>y.type));for(const y of tr)r.has(y)||e.push({field:"sections",message:`Missing required section: ${y}`,severity:"error"});const i=a.sections.filter(y=>!y.content||y.content.trim().length===0);i.length>0&&t.push({field:"sections",message:`${i.length} section(s) are empty`,severity:"warning"});const s=a.sections.map(y=>y.order);return s.filter((y,g)=>s.indexOf(y)!==g).length>0&&e.push({field:"sections",message:"Duplicate section orders detected",severity:"error"}),a.sections.filter(y=>y.order<0||!Number.isInteger(y.order)).length>0&&e.push({field:"sections",message:"Invalid section order values detected (must be non-negative integers)",severity:"error"}),{valid:e.length===0,errors:e,warnings:t}}catch(e){return console.error("[ValidationService.validatePleadingCompleteness] Error:",e),{valid:!1,errors:[{field:"document",message:e instanceof Error?e.message:"Validation failed",severity:"error"}],warnings:[]}}},validateTemplate:a=>{try{if(N.validateRequired(a,"template","validateTemplate"),!a||typeof a!="object")throw new Error("[ValidationService.validateTemplate] Invalid template structure");const e=[],t=[];return(!a.name||a.name.trim().length===0)&&e.push({field:"name",message:"Template name is required",severity:"error"}),(!a.category||a.category.trim().length===0)&&e.push({field:"category",message:"Template category is required",severity:"error"}),(!a.defaultSections||!Array.isArray(a.defaultSections)||a.defaultSections.length===0)&&t.push({field:"defaultSections",message:"Template has no default sections",severity:"warning"}),a.defaultSections&&Array.isArray(a.defaultSections)&&a.defaultSections.forEach((r,i)=>{(!r||typeof r!="object")&&e.push({field:`defaultSections[${i}]`,message:`Section ${i} has invalid structure`,severity:"error"})}),{valid:e.length===0,errors:e,warnings:t}}catch(e){return console.error("[ValidationService.validateTemplate] Error:",e),{valid:!1,errors:[{field:"template",message:e instanceof Error?e.message:"Validation failed",severity:"error"}],warnings:[]}}},validateSectionContent:a=>{try{if(N.validateRequired(a,"section","validateSectionContent"),!a||typeof a!="object")throw new Error("[ValidationService.validateSectionContent] Invalid section structure");const e=[],t=[];if(!a.content)return e.push({field:"content",message:"Section content is required and must be a string",severity:"error"}),{valid:!1,errors:e,warnings:t};const r=a.content.match(ar);r&&r.length>0&&t.push({field:"content",message:`Unreplaced placeholders found: ${r.join(", ")}`,severity:"warning"}),a.content.length>rr&&t.push({field:"content",message:`Section content is very long (${a.content.length} chars) and may cause performance issues`,severity:"warning"});const i=[/<script/i,/javascript:/i,/on\w+\s*=/i,/<iframe/i];for(const s of i)if(s.test(a.content)){e.push({field:"content",message:"Section content contains potentially dangerous HTML or scripts",severity:"error"});break}return{valid:e.length===0,errors:e,warnings:t}}catch(e){return console.error("[ValidationService.validateSectionContent] Error:",e),{valid:!1,errors:[{field:"section",message:e instanceof Error?e.message:"Validation failed",severity:"error"}],warnings:[]}}},validateSections:a=>{try{return N.validateArray(a,"sections","validateSections"),a.map(e=>N.validateSectionContent(e))}catch(e){return console.error("[ValidationService.validateSections] Error:",e),[{valid:!1,errors:[{field:"sections",message:e instanceof Error?e.message:"Batch validation failed",severity:"error"}],warnings:[]}]}}},ir=N.validateTemplate;class fe extends Error{constructor(e,t,r){super(e),this.expectedVersion=t,this.actualVersion=r,this.name="VersionConflictError"}}class sr extends C{useBackend;pleadingsApi;constructor(){super(c.PLEADINGS),this.useBackend=T(),this.pleadingsApi=new Ne,this.logInitialization()}logInitialization(){const e=this.useBackend?"Backend API (PostgreSQL)":"IndexedDB (Local)";console.log(`[PleadingRepository] Initialized with ${e}`)}validateId(e,t){if(!e||typeof e!="string"||e.trim()==="")throw new Error(`[PleadingRepository.${t}] Invalid id parameter`)}validateCaseId(e,t){if(!e||typeof e!="string"||e.trim()==="")throw new Error(`[PleadingRepository.${t}] Invalid caseId parameter`)}async getAll(){if(this.useBackend)try{return await this.pleadingsApi.getAll()}catch(e){console.warn("[PleadingRepository] Backend API unavailable, falling back to IndexedDB",e)}try{return await super.getAll()}catch(e){throw console.error("[PleadingRepository.getAll] Error:",e),new l("getAll","Failed to fetch pleadings")}}getByCaseId=async e=>{if(this.validateCaseId(e,"getByCaseId"),this.useBackend)try{return await this.pleadingsApi.getByCaseId(e)}catch(t){console.warn("[PleadingRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await this.getByIndex("caseId",e)}catch(t){throw console.error("[PleadingRepository.getByCaseId] Error:",t),new l("getByCaseId","Failed to fetch pleadings by case ID")}};async getById(e){if(this.validateId(e,"getById"),this.useBackend)try{return await this.pleadingsApi.getById(e)}catch(t){console.warn("[PleadingRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await super.getById(e)}catch(t){throw console.error("[PleadingRepository.getById] Error:",t),new l("getById","Failed to fetch pleading")}}async add(e){if(!e||typeof e!="object")throw new u("[PleadingRepository.add] Invalid pleading data");if(this.useBackend)try{return await this.pleadingsApi.create(e)}catch(t){console.warn("[PleadingRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await super.add(e),e}catch(t){throw console.error("[PleadingRepository.add] Error:",t),new l("add","Failed to add pleading")}}async update(e,t){if(this.validateId(e,"update"),!t||typeof t!="object")throw new u("[PleadingRepository.update] Invalid updates data");if(this.useBackend)try{return await this.pleadingsApi.update(e,t)}catch(r){console.warn("[PleadingRepository] Backend API unavailable, falling back to IndexedDB",r)}try{return await super.update(e,t)}catch(r){throw console.error("[PleadingRepository.update] Error:",r),new l("update","Failed to update pleading")}}async delete(e){if(this.validateId(e,"delete"),this.useBackend)try{await this.pleadingsApi.delete(e);return}catch(t){console.warn("[PleadingRepository] Backend API unavailable, falling back to IndexedDB",t)}try{await super.delete(e)}catch(t){throw console.error("[PleadingRepository.delete] Error:",t),new l("delete","Failed to delete pleading")}}getTemplates=async()=>{try{return await d.getAll(c.PLEADING_TEMPLATES)}catch(e){throw console.error("[PleadingRepository.getTemplates] Error:",e),new l("getTemplates","Failed to fetch pleading templates")}};createFromTemplate=async(e,t,r,i)=>{if(this.validateId(e,"createFromTemplate"),this.validateCaseId(t,"createFromTemplate"),!r||typeof r!="string"||r.trim()==="")throw new u("[PleadingRepository.createFromTemplate] Invalid title parameter");if(!i||typeof i!="string"||i.trim()==="")throw new u("[PleadingRepository.createFromTemplate] Invalid userId parameter");try{const[s,o]=await Promise.all([d.get(c.PLEADING_TEMPLATES,e),d.get(c.CASES,t)]);if(!s)throw new Error(`Template not found: ${e}`);if(!o)throw new Error(`Case not found: ${t}`);const n=ir(s);if(!n.valid)throw new Error(`Invalid template: ${n.errors.map(_=>_.message).join(", ")}`);const y=er(o),S=Zt(s.defaultSections,y).map((_,be)=>({id:J.section(),type:_.type||"Paragraph",content:_.content||"",order:be,meta:_.meta})),v={id:J.pleading(),caseId:t,title:r,status:"Draft",filingStatus:"Pre-Filing",jurisdictionRulesId:"default",version:1,sections:S,createdBy:i,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await this.add(v),v}catch(s){throw console.error("[PleadingRepository.createFromTemplate] Error:",s),s instanceof Error?s:new l("createFromTemplate","Failed to create pleading from template")}};updateWithVersionCheck=async(e,t,r)=>{this.validateId(e,"updateWithVersionCheck");try{const i=await this.getById(e);if(!i)throw new Error(`Pleading not found: ${e}`);if(i.version!==r)throw new fe("Version conflict: document was modified by another user",r,i.version);const s={...i,...t,version:i.version+1,updatedAt:new Date().toISOString()};return await this.update(e,s),s}catch(i){throw console.error("[PleadingRepository.updateWithVersionCheck] Error:",i),i instanceof fe?i:new l("updateWithVersionCheck","Failed to update pleading with version check")}};getFormattingRules=async e=>{try{return e==="CA-SUPERIOR"?{id:J.formattingRule(),name:"California Superior Court Rules",fontFamily:"Times New Roman",fontSize:12,lineHeight:1.5,marginTop:"1in",marginBottom:"1in",marginLeft:"1in",marginRight:"1in",showLineNumbers:!0,paperSize:"Letter",captionStyle:"Plain"}:{id:J.formattingRule(),name:"Federal Civil Rules",fontFamily:"Times New Roman",fontSize:12,lineHeight:2,marginTop:"1in",marginBottom:"1in",marginLeft:"1.25in",marginRight:"1in",showLineNumbers:!0,paperSize:"Letter",captionStyle:"Boxed"}}catch(t){throw console.error("[PleadingRepository.getFormattingRules] Error:",t),new l("getFormattingRules","Failed to get formatting rules")}};generatePDF=async e=>{this.validateId(e,"generatePDF");try{if(!await this.getById(e))throw new Error(`Pleading not found: ${e}`);return await new Promise(r=>setTimeout(r,1500)),`https://example.com/pleading-${e}.pdf`}catch(t){throw console.error("[PleadingRepository.generatePDF] Error:",t),t instanceof Error?t:new l("generatePDF","Failed to generate PDF")}};async search(e){try{let t=await this.getAll();if(e.caseId&&(t=t.filter(r=>r.caseId===e.caseId)),e.type&&(t=t.filter(r=>r.type===e.type)),e.status&&(t=t.filter(r=>r.status===e.status)),e.filingStatus&&(t=t.filter(r=>r.filingStatus===e.filingStatus)),e.query){const r=e.query.toLowerCase();t=t.filter(i=>i.title?.toLowerCase().includes(r)||i.sections?.some(s=>s.content?.toLowerCase().includes(r)))}return t}catch(t){throw console.error("[PleadingRepository.search] Error:",t),new l("search","Failed to search pleadings")}}}class or extends C{useBackend;tasksApi;constructor(){super(c.TASKS),this.useBackend=T(),this.tasksApi=new $e,this.logInitialization()}logInitialization(){const e=this.useBackend?"Backend API (PostgreSQL)":"IndexedDB (Local)";console.log(`[TaskRepository] Initialized with ${e}`)}validateId(e,t){if(!e||e.trim()==="")throw new Error(`[TaskRepository.${t}] Invalid id parameter`)}validateCaseId(e,t){if(!e||e.trim()==="")throw new Error(`[TaskRepository.${t}] Invalid caseId parameter`)}validateUserId(e,t){if(!e||e.trim()==="")throw new Error(`[TaskRepository.${t}] Invalid userId parameter`)}async getAll(){if(this.useBackend)try{return await this.tasksApi.getAll()}catch(e){console.warn("[TaskRepository] Backend API unavailable, falling back to IndexedDB",e)}try{return await super.getAll()}catch(e){throw console.error("[TaskRepository.getAll] Error:",e),new l("getAll","Failed to fetch tasks")}}async getByCaseId(e){if(this.validateCaseId(e,"getByCaseId"),this.useBackend)try{return await this.tasksApi.getAll({caseId:e})}catch(t){console.warn("[TaskRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await this.getByIndex("caseId",e)}catch(t){throw console.error("[TaskRepository.getByCaseId] Error:",t),new l("getByCaseId","Failed to fetch tasks by case ID")}}async countByCaseId(e){this.validateCaseId(e,"countByCaseId");try{return(await this.getByCaseId(e)).filter(r=>r.status!==D.COMPLETED).length}catch(t){throw console.error("[TaskRepository.countByCaseId] Error:",t),new l("countByCaseId","Failed to count tasks by case ID")}}async getById(e){if(this.validateId(e,"getById"),this.useBackend)try{return await this.tasksApi.getById(e)}catch(t){console.warn("[TaskRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await super.getById(e)}catch(t){throw console.error("[TaskRepository.getById] Error:",t),new l("getById","Failed to fetch task")}}async add(e){if(!e||typeof e!="object")throw new u("[TaskRepository.add] Invalid task data");if(this.useBackend)try{return await this.tasksApi.create(e)}catch(t){console.warn("[TaskRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await super.add(e)}catch(t){throw console.error("[TaskRepository.add] Error:",t),new l("add","Failed to add task")}}async update(e,t){if(this.validateId(e,"update"),!t||typeof t!="object")throw new u("[TaskRepository.update] Invalid updates data");let r;if(this.useBackend)try{r=await this.tasksApi.update(e,t)}catch(i){console.warn("[TaskRepository] Backend API unavailable, falling back to IndexedDB",i),r=await super.update(e,t)}else r=await super.update(e,t);if(t.status===D.COMPLETED)try{await R.publish(f.TASK_COMPLETED,{task:r})}catch(i){console.warn("[TaskRepository] Failed to publish integration event",i)}return r}async delete(e){if(this.validateId(e,"delete"),this.useBackend)try{await this.tasksApi.delete(e);return}catch(t){console.warn("[TaskRepository] Backend API unavailable, falling back to IndexedDB",t)}try{await super.delete(e)}catch(t){throw console.error("[TaskRepository.delete] Error:",t),new l("delete","Failed to delete task")}}completeTask=async e=>{this.validateId(e,"completeTask");try{if(!await this.getById(e))throw new Error(`Task ${e} not found`);return await this.update(e,{status:D.COMPLETED,completionPercentage:100})}catch(t){throw console.error("[TaskRepository.completeTask] Error:",t),new l("completeTask","Failed to complete task")}};async updateStatus(e,t){if(this.validateId(e,"updateStatus"),!t||typeof t!="string"||t.trim()==="")throw new u("[TaskRepository.updateStatus] Invalid status parameter");if(this.useBackend)try{return await this.tasksApi.updateStatus(e,t)}catch(r){console.warn("[TaskRepository] Backend API unavailable, falling back to IndexedDB",r)}try{const r={status:t};return t===D.COMPLETED&&(r.completionPercentage=100),await this.update(e,r)}catch(r){throw console.error("[TaskRepository.updateStatus] Error:",r),new l("updateStatus","Failed to update task status")}}async updatePriority(e,t){if(this.validateId(e,"updatePriority"),!t)throw new u("[TaskRepository.updatePriority] Invalid priority parameter");return await this.update(e,{priority:t})}async updateProgress(e,t){if(this.validateId(e,"updateProgress"),t<0||t>100)throw new u("[TaskRepository.updateProgress] Invalid progress parameter (must be 0-100)");const r={completionPercentage:t};return t===100&&(r.status=D.COMPLETED),await this.update(e,r)}async assignToUser(e,t){if(this.validateId(e,"assignToUser"),this.validateUserId(t,"assignToUser"),this.useBackend)try{return await this.tasksApi.patch(e,{assignedTo:t})}catch(r){console.warn("[TaskRepository] Backend API unavailable, falling back to IndexedDB",r)}return await this.update(e,{assignedTo:t})}async unassignTask(e){if(this.validateId(e,"unassignTask"),this.useBackend)try{return await this.tasksApi.patch(e,{assignedTo:void 0})}catch(t){console.warn("[TaskRepository] Backend API unavailable, falling back to IndexedDB",t)}return await this.update(e,{assignedTo:void 0})}async getByAssignee(e){if(this.validateUserId(e,"getByAssignee"),this.useBackend)try{return await this.tasksApi.getAll({assignedTo:e})}catch(t){console.warn("[TaskRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await this.getByIndex("assignedTo",e)}catch(t){throw console.error("[TaskRepository.getByAssignee] Error:",t),new l("getByAssignee","Failed to fetch tasks by assignee")}}async getOverdue(){try{const e=await this.getAll(),t=new Date;return e.filter(r=>!r.dueDate||r.status===D.COMPLETED?!1:new Date(r.dueDate)<t)}catch(e){throw console.error("[TaskRepository.getOverdue] Error:",e),new l("getOverdue","Failed to fetch overdue tasks")}}async getUpcoming(e=7){try{const t=await this.getAll(),r=new Date,i=new Date(r.getTime()+e*24*60*60*1e3);return t.filter(s=>{if(!s.dueDate||s.status===D.COMPLETED)return!1;const o=new Date(s.dueDate);return o>=r&&o<=i})}catch(t){throw console.error("[TaskRepository.getUpcoming] Error:",t),new l("getUpcoming","Failed to fetch upcoming tasks")}}async getByStatus(e){if(!e||e.trim()==="")throw new u("[TaskRepository.getByStatus] Invalid status parameter");if(this.useBackend)try{return await this.tasksApi.getAll({status:e})}catch(t){console.warn("[TaskRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await this.getByIndex("status",e)}catch(t){throw console.error("[TaskRepository.getByStatus] Error:",t),new l("getByStatus","Failed to fetch tasks by status")}}async getByPriority(e){if(!e||e.trim()==="")throw new u("[TaskRepository.getByPriority] Invalid priority parameter");if(this.useBackend)try{return await this.tasksApi.getAll({priority:e})}catch(t){console.warn("[TaskRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await this.getByIndex("priority",e)}catch(t){throw console.error("[TaskRepository.getByPriority] Error:",t),new l("getByPriority","Failed to fetch tasks by priority")}}async search(e){try{let t=await this.getAll();if(e.caseId&&(t=t.filter(r=>r.caseId===e.caseId)),e.assignedTo&&(t=t.filter(r=>r.assignedTo===e.assignedTo)),e.status&&(t=t.filter(r=>r.status===e.status)),e.priority&&(t=t.filter(r=>r.priority===e.priority)),e.query){const r=e.query.toLowerCase();t=t.filter(i=>i.title?.toLowerCase().includes(r)||i.description?.toLowerCase().includes(r))}return t}catch(t){throw console.error("[TaskRepository.search] Error:",t),new l("search","Failed to search tasks")}}async getStatistics(e){try{const t=e?await this.getByCaseId(e):await this.getAll(),r={},i={};let s=0,o=0;t.forEach(g=>{const S=g.status||"unknown";r[S]=(r[S]||0)+1;const v=g.priority||"medium";i[v]=(i[v]||0)+1,g.status===D.COMPLETED&&s++,o+=g.completionPercentage||0});const n=await this.getOverdue(),y=e?n.filter(g=>g.caseId===e).length:n.length;return{total:t.length,byStatus:r,byPriority:i,completed:s,overdue:y,avgProgress:t.length>0?o/t.length:0}}catch(t){throw console.error("[TaskRepository.getStatistics] Error:",t),new l("getStatistics","Failed to get task statistics")}}}const ae=[{id:"bp1",name:"New Client Onboarding",status:"Active",triggers:"CRM: New Lead",tasks:12,completed:8,owner:"Admin Team"},{id:"bp2",name:"Month-End Billing",status:"Scheduled",triggers:"Finance: Day 28",tasks:45,completed:0,owner:"Finance"},{id:"bp3",name:"Annual Conflict Audit",status:"Idle",triggers:"Admin: Manual",tasks:150,completed:0,owner:"Compliance"},{id:"bp4",name:"Associate Review Cycle",status:"Active",triggers:"HR: Nov 1",tasks:20,completed:5,owner:"HR"},{id:"bp5",name:"E-Discovery Processing",status:"Active",triggers:"Discovery: Upload > 1GB",tasks:8,completed:3,owner:"Litigation Support"},{id:"bp6",name:"Evidence Chain Audit",status:"Scheduled",triggers:"Vault: Transfer Event",tasks:35,completed:0,owner:"Risk Committee"},{id:"bp7",name:"Pro Hac Vice Admission",status:"Pending",triggers:"Jurisdiction: Out-of-State",tasks:5,completed:0,owner:"Managing Partner"},{id:"bp8",name:"Pre-Bill Review Cycle",status:"Active",triggers:"Billing: WIP Threshold",tasks:18,completed:12,owner:"Billing Dept"},{id:"bp9",name:"GDPR/CCPA Compliance",status:"Idle",triggers:"Intake: EU/CA Citizen",tasks:6,completed:0,owner:"Privacy Officer"},{id:"bp10",name:"Matter Closing & Archive",status:"Idle",triggers:"Case: Status=Closed",tasks:15,completed:0,owner:"Records Dept"},{id:"bp11",name:"Privilege Log Gen",status:"Active",triggers:"Discovery: Production Set",tasks:4,completed:1,owner:"Associate Team"},{id:"bp12",name:"Vendor Risk Assessment",status:"Pending",triggers:"Admin: New Vendor",tasks:9,completed:0,owner:"Compliance"},{id:"bp13",name:"Conflict Waiver Protocol",status:"Active",triggers:"Compliance: Conflict Hit",tasks:3,completed:2,owner:"Ethics Committee"},{id:"bp14",name:"Litigation Hold Enforcement",status:"Completed",triggers:"Case: Created",tasks:5,completed:5,owner:"General Counsel"},{id:"bp15",name:"Document Malware Scan",status:"Active",triggers:"DMS: File Upload",tasks:1,completed:1,owner:"Security Ops"}],ie=[{id:"tpl-1",title:"Civil Litigation (Standard)",category:"Litigation",complexity:"High",duration:"12-18 Months",auditReady:!0,tags:["Federal","Civil","Complex"],stages:["Intake & Conflicts","Pleadings & Service","Discovery (Fact/Expert)","Dispositive Motions","Pre-Trial","Trial","Appeal"]},{id:"tpl-2",title:"Small Claims Defense",category:"Litigation",complexity:"Low",duration:"1-3 Months",auditReady:!0,tags:["State","Defense","Fast-Track"],stages:["Demand Review","Settlement Offer","Hearing Prep","Hearing","Judgment Payment"]},{id:"tpl-3",title:"Class Action Settlement",category:"Litigation",complexity:"High",duration:"24+ Months",auditReady:!0,tags:["Mass Tort","Admin","Finance"],stages:["Prelim Approval","Notice Period","Claims Processing","Fairness Hearing","Final Approval","Distribution"]},{id:"tpl-4",title:"Corporate Formation (DE)",category:"Corporate",complexity:"Medium",duration:"2 Weeks",auditReady:!0,tags:["Entity","Startup","Delaware"],stages:["Name Reservation","Articles of Inc.","Bylaws Drafting","EIN Obtainment","First Board Meeting","Stock Issuance"]},{id:"tpl-5",title:"M&A Due Diligence",category:"Corporate",complexity:"High",duration:"3-6 Months",auditReady:!0,tags:["Deal","Audit","Review"],stages:["NDA Execution","Data Room Setup","Financial Review","Legal Review","Risk Assessment","Report Gen"]},{id:"tpl-6",title:"Client Intake & Onboarding",category:"Operations",complexity:"Medium",duration:"3 Days",auditReady:!0,tags:["Admin","KYC","Finance"],stages:["Lead Capture","Conflict Check","Risk Score","Engagement Letter","Retainer Collection","File Opening"]},{id:"tpl-7",title:"Invoice Approval Chain",category:"Operations",complexity:"Low",duration:"5 Days",auditReady:!0,tags:["Billing","Finance","Approval"],stages:["Draft Bill","Partner Review","Compliance Check","Client Sent","Payment Tracking","Collection"]},{id:"tpl-8",title:"Conflict Waiver Protocol",category:"Operations",complexity:"High",duration:"1 Week",auditReady:!0,tags:["Ethics","Risk","Compliance"],stages:["Conflict ID","Ethics Comm Review","Waiver Drafting","Client 1 Consent","Client 2 Consent","Wall Setup"]},{id:"tpl-9",title:"Employee Onboarding",category:"HR",complexity:"Medium",duration:"2 Weeks",auditReady:!0,tags:["Internal","Staffing"],stages:["Offer Acceptance","Background Check","IT Provisioning","Orientation","Training Modules","30-Day Review"]},{id:"tpl-10",title:"Vendor Security Assessment",category:"IT/Security",complexity:"Medium",duration:"1 Month",auditReady:!0,tags:["Security","GDPR","Procurement"],stages:["Questionnaire Sent","Security Review","Contract Negotiation","DPA Signing","Access Grant"]},{id:"tpl-11",title:"Case Closing & Archive",category:"Operations",complexity:"Low",duration:"1 Week",auditReady:!0,tags:["Records","Retention"],stages:["Final Bill Paid","Doc Return","Retention Tagging","Database Close","Physical Archive","Survey Sent"]}],nr={getProcesses:async()=>{try{const a=await d.getAll(c.PROCESSES);return a.length>0?a:ae}catch(a){return console.warn("[WorkflowRepository] Error fetching processes from IndexedDB, using mock data:",a),ae}},getTemplates:async()=>{try{const a=await d.getAll(c.TEMPLATES);return a.length>0?a:ie}catch(a){return console.warn("[WorkflowRepository] Error fetching templates from IndexedDB, using mock data:",a),ie}},getTasks:async()=>{try{return await d.getAll(c.TASKS)}catch(a){return console.warn("[WorkflowRepository] Error fetching tasks from IndexedDB:",a),[]}},getAnalytics:async()=>{await h(50);try{const a=await d.getAll(c.TASKS),e=a.filter(n=>n.status===D.COMPLETED).length,t=a.length,r=new Date,i=a.filter(n=>n.status!==D.COMPLETED&&n.dueDate&&new Date(n.dueDate)<r).length,s=a.filter(n=>{if(n.status===D.COMPLETED||!n.dueDate)return!1;const g=(new Date(n.dueDate).getTime()-r.getTime())/(1e3*60*60);return g>0&&g<48}).length,o=t-e-i-s;return{completion:[{name:"Mon",completed:Math.floor(e*.1)},{name:"Tue",completed:Math.floor(e*.2)},{name:"Wed",completed:Math.floor(e*.15)},{name:"Thu",completed:Math.floor(e*.25)},{name:"Fri",completed:Math.floor(e*.3)}],status:[{name:"On Track",value:Math.max(0,o),color:"#10b981"},{name:"At Risk",value:s,color:"#f59e0b"},{name:"Overdue",value:i,color:"#ef4444"}]}}catch(a){return console.warn("[WorkflowRepository] Error fetching analytics:",a),{completion:[],status:[{name:"On Track",value:0,color:"#10b981"},{name:"At Risk",value:0,color:"#f59e0b"},{name:"Overdue",value:0,color:"#ef4444"}]}}},getSettings:async()=>{const a=[{label:"Auto-Assign Reviewers",enabled:!0},{label:"SLA Breach Notifications",enabled:!1},{label:"Strict Dependency Enforcement",enabled:!0}];return I.get("WORKFLOW_SETTINGS",a)},updateSettings:async a=>(await h(50),I.set("WORKFLOW_SETTINGS",a),a),saveTemplate:async a=>(await d.put(c.TEMPLATES,a),a),getApprovals:async()=>{try{return(await d.getAll(c.TASKS)).filter(t=>t.status===D.BLOCKED).map(t=>({id:t.id,title:t.title,requester:t.assignee||"System",date:t.startDate||t.createdAt||new Date().toISOString().split("T")[0],status:D.TODO,description:t.description||"Approval required for this task.",priority:t.priority===M.CRITICAL||t.priority===M.HIGH?M.HIGH:M.MEDIUM}))}catch(a){return console.warn("[WorkflowRepository] Error fetching approvals:",a),[]}},deploy:async(a,e)=>{try{console.log(`[API] Deploying workflow ${a}...`);const t=await d.get(c.TEMPLATES,a)||ie.find(s=>s.id===a);if(!t)throw new Error("Template not found");const r=new Date,i=[];t.stages.forEach((s,o)=>{const n=new Date(r);n.setDate(n.getDate()+(o+1)*2);const y={id:`t-auto-${Date.now()}-${o}`,title:s,status:D.TODO,assignee:"Unassigned",priority:M.MEDIUM,dueDate:n.toISOString().split("T")[0],caseId:e?.caseId||"General",description:`Automated task from template: ${t.title}`,linkedRules:[]};i.push(y)});for(const s of i)await d.put(c.TASKS,s);return i}catch(t){throw console.error("[WorkflowRepository] Error deploying workflow:",t),t}},deployStrategyToCase:async(a,e)=>{try{const[t,r]=await Promise.all([d.getByIndex(c.PHASES,"caseId",a),d.getByIndex(c.TASKS,"caseId",a)]);for(const i of t)await d.delete(c.PHASES,i.id);for(const i of r)await d.delete(c.TASKS,i.id);return await d.bulkPut(c.PHASES,e.phases),await d.bulkPut(c.TASKS,e.tasks),{success:!0}}catch(t){return console.error("[WorkflowRepository] Error deploying strategy to case:",t),{success:!1}}},getAutomations:async()=>{try{const a=await d.getAll(c.WORKFLOW_AUTOMATIONS);return a.length>0?a:[{id:"auto-1",title:"Document Upload Trigger",description:'IF new document contains "Motion" THEN create task "Review Motion".',type:"Trigger",module:"Documents",target:"Workflow",active:!0,icon:"Zap",color:"amber"},{id:"auto-2",title:"SLA Breach Warning",description:'IF "High Priority" task is overdue > 24h THEN notify Senior Partner.',type:"Monitor",module:"Tasks",target:"Notifications",icon:"Clock",color:"blue",active:!0}]}catch(a){return console.warn("[WorkflowRepository] Error fetching automations:",a),[{id:"auto-1",title:"Document Upload Trigger",description:'IF new document contains "Motion" THEN create task "Review Motion".',type:"Trigger",module:"Documents",target:"Workflow",active:!0,icon:"Zap",color:"amber"}]}},getProcessDetails:async a=>{try{const e=await d.get(c.PROCESSES,a),t=ae.find(r=>r.id===a);return e||t?e||t:{id:a,name:"Unknown Process",description:"Process definition not found.",owner:"System",triggers:"Manual",sla:"N/A"}}catch(e){return console.warn("[WorkflowRepository] Error fetching process details:",e),{id:a,name:"Unknown Process",description:"Error loading process details.",owner:"System",triggers:"Manual",sla:"N/A"}}},runAutomation:async a=>{try{await h(800),console.log(`[API] Running automation scope: ${a}`);const e=await d.getAll(c.TASKS),t=e.filter(r=>r.status!==D.COMPLETED&&r.dueDate&&new Date(r.dueDate)<new Date);if(t.length>0){const r={id:`notif-auto-${Date.now()}`,text:`Automation Run: Identified ${t.length} overdue tasks. Escalations triggered.`,time:new Date().toLocaleTimeString(),read:!1,type:"System"};await d.put(c.NOTIFICATIONS,r)}return{success:!0,processed:e.length,actions:t.length}}catch(e){return console.error("[WorkflowRepository] Error running automation:",e),{success:!1,processed:0,actions:0}}},syncEngine:async()=>{console.log("[API] Engine synced")},getEngineDetails:async(a,e)=>{try{await h(100);const t=await d.getByIndex(c.TASKS,"caseId",a),r=t.length,i=t.filter(o=>o.status===D.COMPLETED).length,s=r>0?Math.round(i/r*100):0;return{id:a,type:e,status:"Active",progress:s,tasksTotal:r,tasksCompleted:i,nextDeadline:"2 Days",automationRate:"85%"}}catch(t){return console.warn("[WorkflowRepository] Error fetching engine details:",t),{id:a,type:e,status:"Unknown",progress:0,tasksTotal:0,tasksCompleted:0,nextDeadline:"N/A",automationRate:"0%"}}}};class cr extends C{constructor(){super(c.PROJECTS)}}class lr extends C{useBackend;constructor(){super(c.EXHIBITS),this.useBackend=T(),console.log(`[TrialRepository] Initialized with ${this.useBackend?"Backend API":"IndexedDB"}`)}validateId(e,t){if(!e||e.trim()==="")throw new Error(`[TrialRepository.${t}] Invalid id parameter`)}validateCaseId(e,t){if(!e||e.trim()==="")throw new Error(`[TrialRepository.${t}] Invalid caseId parameter`)}getJurors=async e=>{this.validateCaseId(e,"getJurors");try{return await d.getByIndex(c.JURORS,"caseId",e)}catch(t){return console.error("[TrialRepository.getJurors] Error:",t),[]}};addJuror=async e=>{if(!e||typeof e!="object")throw new u("[TrialRepository.addJuror] Invalid juror data");try{await d.put(c.JURORS,e)}catch(t){throw console.error("[TrialRepository.addJuror] Error:",t),new l("addJuror","Failed to add juror to database")}};strikeJuror=async(e,t,r)=>{if(this.validateId(e,"strikeJuror"),!t||!["Plaintiff","Defense"].includes(t))throw new u("[TrialRepository.strikeJuror] Invalid party parameter");try{const i=await d.get(c.JURORS,e);i&&await d.put(c.JURORS,{...i,status:"Struck",strikeParty:t,notes:r})}catch(i){throw console.error("[TrialRepository.strikeJuror] Error:",i),new l("strikeJuror","Failed to strike juror in database")}};getFacts=async e=>{this.validateCaseId(e,"getFacts");try{return[]}catch(t){return console.error("[TrialRepository.getFacts] Error:",t),[]}};getWitnesses=async e=>{this.validateCaseId(e,"getWitnesses");try{return await d.getByIndex(c.WITNESSES,"caseId",e)}catch(t){return console.error("[TrialRepository.getWitnesses] Error:",t),[]}};rateWitness=async(e,t)=>{if(this.validateId(e,"rateWitness"),t<0||t>100)throw new u("[TrialRepository.rateWitness] Invalid score parameter (must be 0-100)");try{const r=await d.get(c.WITNESSES,e);r&&await d.put(c.WITNESSES,{...r,credibilityScore:t})}catch(r){throw console.error("[TrialRepository.rateWitness] Error:",r),new l("rateWitness","Failed to rate witness in database")}};addExhibit=async e=>{if(!e||typeof e!="object")throw new u("[TrialRepository.addExhibit] Invalid exhibit data");return await this.add(e)};getExhibits=async e=>{try{return e?(this.validateCaseId(e,"getExhibits"),await this.getByIndex("caseId",e)):await this.getAll()}catch(t){return console.error("[TrialRepository.getExhibits] Error:",t),[]}};getAll=async()=>{try{return await d.getAll(c.EXHIBITS)}catch(e){return console.error("[TrialRepository.getAll] Error:",e),[]}};async getById(e){this.validateId(e,"getById");try{return await super.getById(e)}catch(t){console.error("[TrialRepository.getById] Error:",t);return}}async getByCaseId(e){this.validateCaseId(e,"getByCaseId");try{return await this.getByIndex("caseId",e)}catch(t){return console.error("[TrialRepository.getByCaseId] Error:",t),[]}}async update(e,t){this.validateId(e,"update");try{return await super.update(e,t)}catch(r){throw console.error("[TrialRepository.update] Error:",r),new l("updateExhibit","Failed to update exhibit in database")}}async delete(e){this.validateId(e,"delete");try{await super.delete(e)}catch(t){throw console.error("[TrialRepository.delete] Error:",t),new l("deleteExhibit","Failed to delete exhibit from database")}}async search(e){try{let t=await this.getAll();if(e.caseId&&(t=t.filter(r=>r.caseId===e.caseId)),e.status&&(t=t.filter(r=>r.status===e.status)),e.query){const r=e.query.toLowerCase();t=t.filter(i=>i.title?.toLowerCase().includes(r)||i.description?.toLowerCase().includes(r)||i.exhibitNumber?.toLowerCase().includes(r))}return t}catch(t){return console.error("[TrialRepository.search] Error:",t),[]}}}class dr extends C{useBackend;motionsApi;constructor(){super(c.MOTIONS),this.useBackend=T(),this.motionsApi=new Ue,console.log(`[MotionRepository] Initialized with ${this.useBackend?"Backend API":"IndexedDB"}`)}validateId(e,t){if(!e||typeof e!="string"||e.trim()==="")throw new Error(`[MotionRepository.${t}] Invalid id parameter`)}async getAll(){if(this.useBackend)try{return await this.motionsApi.getAll()}catch(e){console.warn("[MotionRepository] Backend API unavailable, falling back to IndexedDB",e)}return await super.getAll()}getByCaseId=async e=>{if(this.validateId(e,"getByCaseId"),this.useBackend)try{return await this.motionsApi.getByCaseId(e)}catch(t){console.warn("[MotionRepository] Backend API unavailable",t)}return await this.getByIndex("caseId",e)};async getById(e){if(this.validateId(e,"getById"),this.useBackend)try{return await this.motionsApi.getById(e)}catch(t){console.warn("[MotionRepository] Backend API unavailable",t)}return await super.getById(e)}async add(e){if(!e||typeof e!="object")throw new u("[MotionRepository.add] Invalid motion data");if(this.useBackend)try{return await this.motionsApi.create(e)}catch(t){console.warn("[MotionRepository] Backend API unavailable",t)}return await super.add(e),e}async update(e,t){if(this.validateId(e,"update"),this.useBackend)try{return await this.motionsApi.update(e,t)}catch(r){console.warn("[MotionRepository] Backend API unavailable",r)}return await super.update(e,t)}async delete(e){if(this.validateId(e,"delete"),this.useBackend)try{await this.motionsApi.delete(e);return}catch(t){console.warn("[MotionRepository] Backend API unavailable",t)}await super.delete(e)}async updateStatus(e,t){if(this.validateId(e,"updateStatus"),!t||typeof t!="string")throw new u("[MotionRepository.updateStatus] Invalid status");return await this.update(e,{status:t})}async search(e){let t=await this.getAll();if(e.caseId&&(t=t.filter(r=>r.caseId===e.caseId)),e.type&&(t=t.filter(r=>r.type===e.type)),e.status&&(t=t.filter(r=>r.status===e.status)),e.query){const r=e.query.toLowerCase();t=t.filter(i=>i.title?.toLowerCase().includes(r)||i.notes?.toLowerCase().includes(r))}return t}}class ur{useBackend;constructor(){this.useBackend=T(),this.logInitialization()}logInitialization(){const e=this.useBackend?"Backend API (PostgreSQL)":"IndexedDB (Local)";console.log(`[DiscoveryRepository] Initialized with ${e}`)}validateCaseId(e,t){if(e!==void 0&&e.trim()==="")throw new Error(`[DiscoveryRepository.${t}] Invalid caseId parameter`)}validateId(e,t){if(!e||e.trim()==="")throw new Error(`[DiscoveryRepository.${t}] Invalid id parameter`)}getFunnelStats=async()=>{try{const e=await d.getAll(c.DOCUMENTS),t=e.length,r=e.filter(o=>o.tags?.includes("Processed")||o.ocrStatus==="Completed").length,i=e.filter(o=>o.tags?.includes("Reviewed")||o.status==="Reviewed").length,s=e.filter(o=>o.status==="Produced").length;return t===0?[{name:"Collection",value:12e4,label:"120k Docs"},{name:"Processing",value:85e3,label:"85k De-NIST"},{name:"Review",value:24e3,label:"24k Responsive"},{name:"Production",value:1500,label:"1.5k Produced"}]:[{name:"Collection",value:t,label:`${(t/1e3).toFixed(1)}k Docs`},{name:"Processing",value:r,label:`${(r/1e3).toFixed(1)}k OCR`},{name:"Review",value:i,label:`${i} Reviewed`},{name:"Production",value:s,label:`${s} Produced`}]}catch(e){throw console.error("[DiscoveryRepository.getFunnelStats] Error:",e),new l("getFunnelStats","Failed to fetch discovery funnel statistics")}};getCustodianStats=async()=>{try{return(await d.get(c.DISCOVERY_CUSTODIAN_STATS,"custodian-main"))?.data||[]}catch(e){return console.error("[DiscoveryRepository.getCustodianStats] Error:",e),[]}};getCustodians=async e=>{if(this.validateCaseId(e,"getCustodians"),this.useBackend)try{return await A.custodians.getAll(e?{caseId:e}:void 0)}catch(t){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",t)}try{const t=await d.getAll(c.CUSTODIANS);return e?t.filter(r=>r.caseId===e):t}catch(t){throw console.error("[DiscoveryRepository.getCustodians] Error:",t),new l("getCustodians","Failed to fetch custodians")}};addCustodian=async e=>{if(!e||typeof e!="object")throw new u("[DiscoveryRepository.addCustodian] Invalid custodian data");if(this.useBackend)try{return await A.custodians.create(e)}catch(t){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await d.put(c.CUSTODIANS,e)}catch(t){throw console.error("[DiscoveryRepository.addCustodian] Error:",t),new l("addCustodian","Failed to add custodian")}};updateCustodian=async e=>{const t=e;if(!t?.id)throw new u("[DiscoveryRepository.updateCustodian] Custodian ID required");if(this.useBackend)try{const{id:r,...i}=t;return await A.custodians.update(r,i)}catch(r){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",r)}try{return await d.put(c.CUSTODIANS,e)}catch(r){throw console.error("[DiscoveryRepository.updateCustodian] Error:",r),new l("updateCustodian","Failed to update custodian")}};deleteCustodian=async e=>{if(this.validateId(e,"deleteCustodian"),this.useBackend)try{await A.custodians.delete(e);return}catch(t){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",t)}try{await d.delete(c.CUSTODIANS,e)}catch(t){throw console.error("[DiscoveryRepository.deleteCustodian] Error:",t),new l("deleteCustodian","Failed to delete custodian")}};getDepositions=async e=>{if(this.validateCaseId(e,"getDepositions"),this.useBackend)try{return await A.depositions.getAll(e?{caseId:e}:void 0)}catch(t){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",t)}try{const t=await d.getAll(c.DISCOVERY_EXT_DEPO);return e?t.filter(r=>r.caseId===e):t}catch(t){throw console.error("[DiscoveryRepository.getDepositions] Error:",t),new l("getDepositions","Failed to fetch depositions")}};addDeposition=async e=>{if(!e||typeof e!="object")throw new u("[DiscoveryRepository.addDeposition] Invalid deposition data");if(this.useBackend)try{return await A.depositions.create(e)}catch(t){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await d.put(c.DISCOVERY_EXT_DEPO,e),e}catch(t){throw console.error("[DiscoveryRepository.addDeposition] Error:",t),new l("addDeposition","Failed to add deposition")}};getESISources=async e=>{if(this.validateCaseId(e,"getESISources"),this.useBackend)try{return await A.esiSources.getAll(e?{caseId:e}:void 0)}catch(t){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",t)}try{const t=await d.getAll(c.DISCOVERY_EXT_ESI);return e?t.filter(r=>r.caseId===e):t}catch(t){throw console.error("[DiscoveryRepository.getESISources] Error:",t),new l("getESISources","Failed to fetch ESI sources")}};addESISource=async e=>{if(!e||typeof e!="object")throw new u("[DiscoveryRepository.addESISource] Invalid ESI source data");if(this.useBackend)try{return await A.esiSources.create(e)}catch(t){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await d.put(c.DISCOVERY_EXT_ESI,e),e}catch(t){throw console.error("[DiscoveryRepository.addESISource] Error:",t),new l("addESISource","Failed to add ESI source")}};updateESISourceStatus=async(e,t)=>{if(this.validateId(e,"updateESISourceStatus"),!t||t.trim()==="")throw new u("[DiscoveryRepository.updateESISourceStatus] Invalid status parameter");if(this.useBackend)try{return await A.esiSources.updateStatus(e,t)}catch(r){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",r)}try{const r=await d.get(c.DISCOVERY_EXT_ESI,e);if(!r)throw new U("ESISource",e);const i={...r,status:t};return await d.put(c.DISCOVERY_EXT_ESI,i),i}catch(r){throw console.error("[DiscoveryRepository.updateESISourceStatus] Error:",r),new l("updateESISourceStatus","Failed to update ESI source status")}};getProductions=async e=>{if(this.validateCaseId(e,"getProductions"),this.useBackend)try{return await A.productions.getAll(e?{caseId:e}:void 0)}catch(t){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",t)}try{const t=await d.getAll(c.DISCOVERY_EXT_PROD);return e?t.filter(r=>r.caseId===e):t}catch(t){throw console.error("[DiscoveryRepository.getProductions] Error:",t),new l("getProductions","Failed to fetch productions")}};createProduction=async e=>{if(!e||typeof e!="object")throw new u("[DiscoveryRepository.createProduction] Invalid production data");if(this.useBackend)try{return await A.productions.create(e)}catch(t){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await d.put(c.DISCOVERY_EXT_PROD,e),e}catch(t){throw console.error("[DiscoveryRepository.createProduction] Error:",t),new l("createProduction","Failed to create production")}};downloadProduction=async e=>(this.validateId(e,"downloadProduction"),await h(800),`https://example.com/production/${e}.zip`);getInterviews=async e=>{if(this.validateCaseId(e,"getInterviews"),this.useBackend)try{return await A.custodianInterviews.getAll(e?{caseId:e}:void 0)}catch(t){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",t)}try{const t=await d.getAll(c.DISCOVERY_EXT_INT);return e?t.filter(r=>r.caseId===e):t}catch(t){throw console.error("[DiscoveryRepository.getInterviews] Error:",t),new l("getInterviews","Failed to fetch custodian interviews")}};createInterview=async e=>{if(!e||typeof e!="object")throw new u("[DiscoveryRepository.createInterview] Invalid interview data");if(this.useBackend)try{return await A.custodianInterviews.create(e)}catch(t){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await d.put(c.DISCOVERY_EXT_INT,e),e}catch(t){throw console.error("[DiscoveryRepository.createInterview] Error:",t),new l("createInterview","Failed to create custodian interview")}};getRequests=async e=>{if(this.validateCaseId(e,"getRequests"),this.useBackend)try{return await A.discoveryRequests.getAll(e?{caseId:e}:void 0)}catch(t){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",t)}try{const t=await d.getAll(c.REQUESTS);return e?t.filter(r=>r.caseId===e):t}catch(t){throw console.error("[DiscoveryRepository.getRequests] Error:",t),new l("getRequests","Failed to fetch discovery requests")}};addRequest=async e=>{if(!e||typeof e!="object")throw new u("[DiscoveryRepository.addRequest] Invalid request data");if(this.useBackend)try{return await A.discoveryRequests.create(e)}catch(t){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await d.put(c.REQUESTS,e),e}catch(t){throw console.error("[DiscoveryRepository.addRequest] Error:",t),new l("addRequest","Failed to add discovery request")}};updateRequestStatus=async(e,t)=>{if(this.validateId(e,"updateRequestStatus"),!t||t.trim()==="")throw new u("[DiscoveryRepository.updateRequestStatus] Invalid status parameter");if(this.useBackend)try{return await A.discoveryRequests.updateStatus(e,t)}catch(r){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",r)}try{const r=await d.get(c.REQUESTS,e);if(!r)throw new U("DiscoveryRequest",e);const i={...r,status:t};return await d.put(c.REQUESTS,i),i}catch(r){throw console.error("[DiscoveryRepository.updateRequestStatus] Error:",r),new l("updateRequestStatus","Failed to update discovery request status")}};getReviewBatches=async e=>{this.validateId(e,"getReviewBatches");try{return await d.getByIndex(c.REVIEW_BATCHES,"caseId",e)}catch(t){throw console.error("[DiscoveryRepository.getReviewBatches] Error:",t),new l("getReviewBatches","Failed to fetch review batches")}};createReviewBatch=async e=>{if(!e||typeof e!="object")throw new u("[DiscoveryRepository.createReviewBatch] Invalid batch data");try{return await d.put(c.REVIEW_BATCHES,e),e}catch(t){throw console.error("[DiscoveryRepository.createReviewBatch] Error:",t),new l("createReviewBatch","Failed to create review batch")}};getProcessingJobs=async()=>{try{return await d.getAll(c.PROCESSING_JOBS)}catch(e){throw console.error("[DiscoveryRepository.getProcessingJobs] Error:",e),new l("getProcessingJobs","Failed to fetch processing jobs")}};getExaminations=async e=>{if(this.validateCaseId(e,"getExaminations"),this.useBackend)try{return await A.examinations.getAll(e?{caseId:e}:void 0)}catch(t){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",t)}try{const t=await d.getAll(c.EXAMINATIONS);return e?t.filter(r=>r.caseId===e):t}catch(t){throw console.error("[DiscoveryRepository.getExaminations] Error:",t),new l("getExaminations","Failed to fetch examinations")}};addExamination=async e=>{if(!e||typeof e!="object")throw new u("[DiscoveryRepository.addExamination] Invalid examination data");if(this.useBackend)try{return await A.examinations.create(e)}catch(t){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await d.put(c.EXAMINATIONS,e),e}catch(t){throw console.error("[DiscoveryRepository.addExamination] Error:",t),new l("addExamination","Failed to add examination")}};getTranscripts=async e=>{this.validateCaseId(e,"getTranscripts");try{const t=await d.getAll(c.TRANSCRIPTS);return e?t.filter(r=>r.caseId===e):t}catch(t){throw console.error("[DiscoveryRepository.getTranscripts] Error:",t),new l("getTranscripts","Failed to fetch transcripts")}};addTranscript=async e=>{if(!e||typeof e!="object")throw new u("[DiscoveryRepository.addTranscript] Invalid transcript data");try{return await d.put(c.TRANSCRIPTS,e),e}catch(t){throw console.error("[DiscoveryRepository.addTranscript] Error:",t),new l("addTranscript","Failed to add transcript")}};getVendors=async()=>{try{return await d.getAll(c.VENDORS)}catch(e){throw console.error("[DiscoveryRepository.getVendors] Error:",e),new l("getVendors","Failed to fetch vendors")}};addVendor=async e=>{if(!e||typeof e!="object")throw new u("[DiscoveryRepository.addVendor] Invalid vendor data");try{return await d.put(c.VENDORS,e),e}catch(t){throw console.error("[DiscoveryRepository.addVendor] Error:",t),new l("addVendor","Failed to add vendor")}};getReporters=async()=>{try{return await d.getAll(c.REPORTERS)}catch(e){throw console.error("[DiscoveryRepository.getReporters] Error:",e),new l("getReporters","Failed to fetch reporters")}};getSanctions=async e=>{this.validateCaseId(e,"getSanctions");try{const t=await d.getAll(c.SANCTIONS);return e?t.filter(r=>r.caseId===e):t}catch(t){throw console.error("[DiscoveryRepository.getSanctions] Error:",t),new l("getSanctions","Failed to fetch sanctions")}};addSanctionMotion=async e=>{if(!e||typeof e!="object")throw new u("[DiscoveryRepository.addSanctionMotion] Invalid sanction motion data");try{return await d.put(c.SANCTIONS,e),e}catch(t){throw console.error("[DiscoveryRepository.addSanctionMotion] Error:",t),new l("addSanctionMotion","Failed to add sanction motion")}};getStipulations=async e=>{this.validateCaseId(e,"getStipulations");try{const t=await d.getAll(c.STIPULATIONS);return e?t.filter(r=>r.caseId===e):t}catch(t){throw console.error("[DiscoveryRepository.getStipulations] Error:",t),new l("getStipulations","Failed to fetch stipulations")}};addStipulation=async e=>{if(!e||typeof e!="object")throw new u("[DiscoveryRepository.addStipulation] Invalid stipulation data");try{return await d.put(c.STIPULATIONS,e),e}catch(t){throw console.error("[DiscoveryRepository.addStipulation] Error:",t),new l("addStipulation","Failed to add stipulation")}};getPetitions=async()=>(await h(100),[]);getLegalHolds=async()=>{if(this.useBackend)try{return await A.legalHolds.getAll()}catch(e){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",e)}try{return await d.getAll(c.LEGAL_HOLDS)}catch(e){throw console.error("[DiscoveryRepository.getLegalHolds] Error:",e),new l("getLegalHolds","Failed to fetch legal holds")}};getPrivilegeLog=async()=>{if(this.useBackend)try{return await A.privilegeLog.getAll()}catch(e){console.warn("[DiscoveryRepository] Backend API unavailable, falling back to IndexedDB",e)}try{return await d.getAll(c.PRIVILEGE_LOG)}catch(e){throw console.error("[DiscoveryRepository.getPrivilegeLog] Error:",e),new l("getPrivilegeLog","Failed to fetch privilege log")}};syncDeadlines=async()=>{try{await h(500);const t=(await this.getRequests()).filter(r=>r.status==="Served"||r.status==="Overdue");console.log(`[DiscoveryRepository] Synced ${t.length} discovery deadlines to Master Calendar.`)}catch(e){throw console.error("[DiscoveryRepository.syncDeadlines] Error:",e),new l("syncDeadlines","Failed to sync discovery deadlines")}};startCollection=async e=>(this.validateId(e,"startCollection"),await h(500),`job-${Date.now()}`)}class yr extends C{constructor(){super(c.BILLING),this.getTimeEntries=this.getTimeEntries.bind(this),this.getRates=this.getRates.bind(this),this.addTimeEntry=this.addTimeEntry.bind(this),this.getWIPStats=this.getWIPStats.bind(this),this.getRealizationStats=this.getRealizationStats.bind(this),this.getInvoices=this.getInvoices.bind(this),this.createInvoice=this.createInvoice.bind(this),this.updateInvoice=this.updateInvoice.bind(this),this.sendInvoice=this.sendInvoice.bind(this)}async getRates(e){return d.getByIndex(c.RATES,"timekeeperId",e)}async getTimeEntries(e){const t=await this.getAll();return typeof e=="string"?t.filter(r=>r.caseId===e):e?.caseId?t.filter(r=>r.caseId===e.caseId):e?.userId?t.filter(r=>r.userId===e.userId||r.createdBy===e.userId):t}async addTimeEntry(e){return this.add(e)}async getWIPStats(){const[e,t]=await Promise.all([d.getAll(c.CLIENTS),this.getAll()]),r={};e.forEach(o=>{(o.matters||[]).forEach(n=>{r[n]=o.id})});const i={};t.forEach(o=>{if(o.status==="Unbilled"){const n=r[o.caseId];n&&(i[n]=(i[n]||0)+o.total)}});const s=Object.keys(i).map(o=>{const n=e.find(y=>y.id===o);return{name:n?(n.name||"").split(" ")[0]:"Unknown",wip:i[o],billed:n?n.totalBilled:0}});return s.length===0?e.slice(0,3).map(o=>({name:(o.name||"").split(" ")[0],wip:0,billed:o.totalBilled})):s.sort((o,n)=>n.wip-o.wip).slice(0,5)}async getRealizationStats(e="light"){const t=await this.getInvoices(),r=t.reduce((y,g)=>y+(g.amount||0),0),i=t.filter(y=>y.status==="Paid").reduce((y,g)=>y+(g.amount||0),0),{ChartColorService:s}=await m(async()=>{const{ChartColorService:y}=await import("./chartColorService-Dq1XQNFk.js");return{ChartColorService:y}},__vite__mapDeps([0,1,2,3,4])),o=s.getChartColors(e),n=r>0?Math.round(i/r*100):0;return[{name:"Billed",value:n,color:o.success},{name:"Write-off",value:100-n,color:o.danger}]}async getInvoices(){return await d.getAll(c.INVOICES)}async createInvoice(e,t,r){const i=r.reduce((y,g)=>y+g.total,0),s=new Date,o=new Date;o.setDate(s.getDate()+30);const n={id:`INV-${Date.now()}`,invoiceNumber:`INV-${Date.now()}`,caseId:t,clientId:`client-${Date.now()}`,clientName:e,matterDescription:t,invoiceDate:s.toISOString().split("T")[0],dueDate:o.toISOString().split("T")[0],billingModel:"Hourly",status:"Draft",subtotal:i,taxAmount:0,discountAmount:0,totalAmount:i,paidAmount:0,balanceDue:i,timeCharges:i,expenseCharges:0,currency:"USD",createdAt:s.toISOString(),updatedAt:s.toISOString()};await d.put(c.INVOICES,n);for(const y of r){const g={...y,status:"Billed",invoiceId:n.id};await this.update(y.id,g)}return n}async updateInvoice(e,t){const r=await d.get(c.INVOICES,e);if(!r)throw new Error("Invoice not found");const i={...r,...t};return await d.put(c.INVOICES,i),t.status&&t.status!==r.status&&await R.publish(f.INVOICE_STATUS_CHANGED,{invoice:i}),i}async sendInvoice(e){return await h(500),console.log(`[API] Invoice ${e} sent`),!0}async getTrustTransactions(e){return d.getByIndex(c.TRUST_TX,"accountId",e)}async getTrustAccounts(){return d.getAll(c.TRUST)}async getTopAccounts(){return(await d.getAll(c.CLIENTS)).sort((t,r)=>r.totalBilled-t.totalBilled).slice(0,4)}async getOverviewStats(){return await h(50),{realization:92.4,totalBilled:482e3,month:"March 2024"}}async getOperatingSummary(){return await d.get(c.OPERATING_SUMMARY,"op-summary-main")||{balance:0,expensesMtd:0,cashFlowMtd:0}}async getFinancialPerformance(){return await h(200),{revenue:[{month:"Jan",actual:42e4,target:4e5},{month:"Feb",actual:45e4,target:41e4},{month:"Mar",actual:38e4,target:42e4},{month:"Apr",actual:49e4,target:43e4},{month:"May",actual:51e4,target:44e4},{month:"Jun",actual:55e4,target:45e4}],expenses:[{category:"Payroll",value:25e4},{category:"Rent",value:45e3},{category:"Software",value:15e3},{category:"Marketing",value:25e3},{category:"Travel",value:12e3}]}}async sync(){await h(1e3),console.log("[API] Financials Synced")}async export(e){return await h(1500),`report.${e}`}}const De={getStaff:async()=>{try{const[a,e]=await Promise.all([d.getAll(c.STAFF),d.getAll(c.BILLING)]);return a.map(t=>{const i=e.filter(o=>o.userId===t.userId).reduce((o,n)=>o+n.duration/60,0),s=t.billableTarget>0?Math.min(100,Math.round(i/(t.billableTarget/4)*100)):0;return{...t,currentBillable:Math.round(i),utilizationRate:s}})}catch(a){return console.warn("[HRRepository] getStaff failed, returning empty array:",a),[]}},getUtilizationMetrics:async()=>{try{return(await De.getStaff()).map(e=>({name:e.name,role:e.role,utilization:e.utilizationRate,cases:5}))}catch(a){return console.warn("[HRRepository] getUtilizationMetrics failed, returning empty array:",a),[]}},addStaff:async a=>{const e={...a,id:a.id||crypto.randomUUID()};return await d.put(c.STAFF,e),await R.publish(f.STAFF_HIRED,{staff:e}),e},updateStaff:async(a,e)=>{const t=await d.get(c.STAFF,a);if(!t)throw new Error("Staff not found");return d.put(c.STAFF,{...t,...e})},deleteStaff:async a=>d.delete(c.STAFF,a)};class hr extends C{useBackend;clientsApi;constructor(){super(c.CLIENTS),this.useBackend=T(),this.clientsApi=new ve,this.logInitialization()}logInitialization(){const e=this.useBackend?"Backend API (PostgreSQL)":"IndexedDB (Local)";console.log(`[ClientRepository] Initialized with ${e}`)}validateId(e,t){if(!e||e.trim()==="")throw new Error(`[ClientRepository.${t}] Invalid id parameter`)}validateEmail(e,t){if(!e)throw new Error(`[ClientRepository.${t}] Invalid email parameter`);if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))throw new Error(`[ClientRepository.${t}] Invalid email format`)}async getAll(){if(this.useBackend)try{return await this.clientsApi.getAll()}catch(e){console.warn("[ClientRepository] Backend API unavailable, falling back to IndexedDB",e)}try{return await super.getAll()}catch(e){throw console.error("[ClientRepository.getAll] Error:",e),new l("getAll","Failed to fetch clients")}}async getById(e){if(this.validateId(e,"getById"),this.useBackend)try{return await this.clientsApi.getById(e)}catch(t){console.warn("[ClientRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await super.getById(e)}catch(t){throw console.error("[ClientRepository.getById] Error:",t),new l("getById","Failed to fetch client")}}async add(e){if(!e||typeof e!="object")throw new u("[ClientRepository.add] Invalid client data");if(e.email)try{this.validateEmail(e.email,"add")}catch(t){console.warn("[ClientRepository.add] Invalid email, proceeding anyway:",t)}if(this.useBackend)try{return await this.clientsApi.create(e)}catch(t){console.warn("[ClientRepository] Backend API unavailable, falling back to IndexedDB",t)}try{return await super.add(e),e}catch(t){throw console.error("[ClientRepository.add] Error:",t),new l("add","Failed to add client")}}async update(e,t){if(this.validateId(e,"update"),!t||typeof t!="object")throw new u("[ClientRepository.update] Invalid updates data");if(t.email)try{this.validateEmail(t.email,"update")}catch(r){console.warn("[ClientRepository.update] Invalid email, proceeding anyway:",r)}if(this.useBackend)try{return await this.clientsApi.update(e,t)}catch(r){console.warn("[ClientRepository] Backend API unavailable, falling back to IndexedDB",r)}try{return await super.update(e,t)}catch(r){throw console.error("[ClientRepository.update] Error:",r),new l("update","Failed to update client")}}async delete(e){if(this.validateId(e,"delete"),this.useBackend)try{await this.clientsApi.delete(e);return}catch(t){console.warn("[ClientRepository] Backend API unavailable, falling back to IndexedDB",t)}try{await super.delete(e)}catch(t){throw console.error("[ClientRepository.delete] Error:",t),new l("delete","Failed to delete client")}}async generatePortalToken(e){this.validateId(e,"generatePortalToken");try{const t=crypto.getRandomValues(new Uint8Array(6)),r=Array.from(t).map(s=>s.toString(16).padStart(2,"0")).join(""),i=`token-${e}-${Date.now()}-${r}`;return console.log(`[ClientRepository] Generated portal token for client ${e}`),i}catch(t){throw console.error("[ClientRepository.generatePortalToken] Error:",t),new l("generatePortalToken","Failed to generate portal token")}}async checkConflicts(e,t){if(!e||e.trim()==="")throw new u("[ClientRepository.checkConflicts] Invalid clientName parameter");try{const r=await this.getAll(),i=[],s=e.toLowerCase();return r.forEach(o=>{const n=(o.name||"").toLowerCase();if(n.includes(s)||s.includes(n)){i.push(o);return}t&&t.some(g=>n.includes(g.toLowerCase())||g.toLowerCase().includes(n))&&i.push(o)}),{hasConflict:i.length>0,conflicts:i}}catch(r){throw console.error("[ClientRepository.checkConflicts] Error:",r),new l("checkConflicts","Failed to check conflicts")}}async getActive(){try{return(await this.getAll()).filter(t=>t.status?.toString().toLowerCase()==="active"||!t.status)}catch(e){throw console.error("[ClientRepository.getActive] Error:",e),new l("getActive","Failed to fetch active clients")}}async getInactive(){try{return(await this.getAll()).filter(t=>t.status?.toString().toLowerCase()==="inactive")}catch(e){throw console.error("[ClientRepository.getInactive] Error:",e),new l("getInactive","Failed to fetch inactive clients")}}async getByType(e){if(!e||e.trim()==="")throw new u("[ClientRepository.getByType] Invalid type parameter");try{return(await this.getAll()).filter(r=>r.type===e||r.clientType===e)}catch(t){throw console.error("[ClientRepository.getByType] Error:",t),new l("getByType","Failed to fetch clients by type")}}async search(e){if(!e||e.trim()==="")throw new u("[ClientRepository.search] Invalid query parameter");try{const t=await this.getAll(),r=e.toLowerCase();return t.filter(i=>{const s=i;return i.name?.toLowerCase().includes(r)||i.email?.toLowerCase().includes(r)||s.company?.toLowerCase().includes(r)||i.notes?.toLowerCase().includes(r)||s.firstName?.toLowerCase().includes(r)||s.lastName?.toLowerCase().includes(r)||i.phone?.includes(e)})}catch(t){throw console.error("[ClientRepository.search] Error:",t),new l("search","Failed to search clients")}}async findByEmail(e){this.validateEmail(e,"findByEmail");try{return(await this.getAll()).find(r=>r.email?.toLowerCase()===e.toLowerCase())}catch(t){throw console.error("[ClientRepository.findByEmail] Error:",t),new l("findByEmail","Failed to find client by email")}}async getStatistics(){try{const e=await this.getAll(),t={};let r=0,i=0,s=0;const o=new Date;return o.setDate(o.getDate()-30),e.forEach(n=>{const y=n.status?.toString().toLowerCase();y==="active"||!n.status?r++:y==="inactive"&&i++;const S=n.type||n.clientType||"Unknown",v=String(S);t[v]=(t[v]||0)+1,n.createdAt&&new Date(n.createdAt)>o&&s++}),{total:e.length,active:r,inactive:i,byType:t,recentlyAdded:s}}catch(e){throw console.error("[ClientRepository.getStatistics] Error:",e),new l("getStatistics","Failed to get client statistics")}}async getRecentlyAdded(e=30){if(e<1)throw new u("[ClientRepository.getRecentlyAdded] Invalid days parameter");try{const t=await this.getAll(),r=new Date;return r.setDate(r.getDate()-e),t.filter(i=>i.createdAt&&new Date(i.createdAt)>r).sort((i,s)=>new Date(s.createdAt).getTime()-new Date(i.createdAt).getTime())}catch(t){throw console.error("[ClientRepository.getRecentlyAdded] Error:",t),new l("getRecentlyAdded","Failed to fetch recently added clients")}}}class pr extends C{useBackend;orgsApi;constructor(){super(c.ORGS),this.useBackend=T(),this.orgsApi=new He,console.log(`[OrganizationRepository] Initialized with ${this.useBackend?"Backend API":"IndexedDB"}`)}validateId(e,t){if(!e||e.trim()==="")throw new Error(`[OrganizationRepository.${t}] Invalid id parameter`)}async getAll(){if(this.useBackend)try{return await this.orgsApi.getAll()}catch(e){console.warn("[OrganizationRepository] Backend API unavailable",e)}return await super.getAll()}async getById(e){if(this.validateId(e,"getById"),this.useBackend)try{return await this.orgsApi.getById(e)}catch(t){console.warn("[OrganizationRepository] Backend API unavailable",t)}return await super.getById(e)}async add(e){if(!e||typeof e!="object")throw new u("[OrganizationRepository.add] Invalid organization data");if(this.useBackend)try{return await this.orgsApi.create(e)}catch(t){console.warn("[OrganizationRepository] Backend API unavailable",t)}return await super.add(e),e}async update(e,t){if(this.validateId(e,"update"),this.useBackend)try{return await this.orgsApi.update(e,t)}catch(r){console.warn("[OrganizationRepository] Backend API unavailable",r)}return await super.update(e,t)}async delete(e){if(this.validateId(e,"delete"),this.useBackend)try{await this.orgsApi.delete(e);return}catch(t){console.warn("[OrganizationRepository] Backend API unavailable",t)}await super.delete(e)}async search(e){if(!e)return[];if(this.useBackend)try{return await this.orgsApi.search(e)}catch(r){console.warn("[OrganizationRepository] Backend API unavailable",r)}return(await this.getAll()).filter(r=>r.name?.toLowerCase().includes(e.toLowerCase())||r.legalName?.toLowerCase().includes(e.toLowerCase()))}async getByType(e){if(!e)throw new u("[OrganizationRepository.getByType] Invalid type");if(this.useBackend)try{return await this.orgsApi.getByType(e)}catch(t){console.warn("[OrganizationRepository] Backend API unavailable",t)}return await this.getByIndex("organizationType",e)}async getByJurisdiction(e){if(!e)throw new u("[OrganizationRepository.getByJurisdiction] Invalid jurisdiction");if(this.useBackend)try{return await this.orgsApi.getByJurisdiction(e)}catch(r){console.warn("[OrganizationRepository] Backend API unavailable",r)}return(await this.getAll()).filter(r=>r.jurisdiction===e)}}class gr extends C{useBackend;witnessesApi;constructor(){super(c.WITNESSES),this.useBackend=T(),this.witnessesApi=new Ve,console.log(`[WitnessRepository] Initialized with ${this.useBackend?"Backend API":"IndexedDB"}`)}validateId(e,t){if(!e||typeof e!="string"||e.trim()==="")throw new Error(`[WitnessRepository.${t}] Invalid id parameter`)}async getAll(){if(this.useBackend)try{return await this.witnessesApi.getAll()}catch(e){console.warn("[WitnessRepository] Backend API unavailable",e)}return await super.getAll()}async getByCaseId(e){if(this.validateId(e,"getByCaseId"),this.useBackend)try{return await this.witnessesApi.getByCaseId(e)}catch(t){console.warn("[WitnessRepository] Backend API unavailable",t)}return await this.getByIndex("caseId",e)}async getByType(e){if(!e)throw new u("[WitnessRepository.getByType] Invalid witnessType");if(this.useBackend)try{return await this.witnessesApi.getByType(e)}catch(r){console.warn("[WitnessRepository] Backend API unavailable",r)}return(await this.getAll()).filter(r=>r.witnessType===e)}async getByStatus(e){if(!e)throw new u("[WitnessRepository.getByStatus] Invalid status");if(this.useBackend)try{return await this.witnessesApi.getByStatus(e)}catch(r){console.warn("[WitnessRepository] Backend API unavailable",r)}return(await this.getAll()).filter(r=>r.status===e)}async getById(e){if(this.validateId(e,"getById"),this.useBackend)try{return await this.witnessesApi.getById(e)}catch(t){console.warn("[WitnessRepository] Backend API unavailable",t)}return await super.getById(e)}async add(e){if(!e||typeof e!="object")throw new u("[WitnessRepository.add] Invalid witness data");if(this.useBackend)try{return await this.witnessesApi.create(e)}catch(t){console.warn("[WitnessRepository] Backend API unavailable",t)}return await super.add(e),e}async update(e,t){if(this.validateId(e,"update"),this.useBackend)try{return await this.witnessesApi.update(e,t)}catch(r){console.warn("[WitnessRepository] Backend API unavailable",r)}return await super.update(e,t)}async updateStatus(e,t){if(this.validateId(e,"updateStatus"),!t||typeof t!="string")throw new u("[WitnessRepository.updateStatus] Invalid status");if(this.useBackend)try{return await this.witnessesApi.updateStatus(e,t)}catch(r){console.warn("[WitnessRepository] Backend API unavailable",r)}return await this.update(e,{status:t})}async delete(e){if(this.validateId(e,"delete"),this.useBackend)try{await this.witnessesApi.delete(e);return}catch(t){console.warn("[WitnessRepository] Backend API unavailable",t)}await super.delete(e)}async search(e){let t=await this.getAll();if(e.caseId&&(t=t.filter(r=>r.caseId===e.caseId)),e.type&&(t=t.filter(r=>r.witnessType===e.type)),e.status&&(t=t.filter(r=>r.status===e.status)),e.query){const r=e.query.toLowerCase();t=t.filter(i=>i.name?.toLowerCase().includes(r)||i.organization?.toLowerCase().includes(r)||i.notes?.toLowerCase().includes(r))}return t}}class wr extends C{useBackend;legalEntitiesApi;constructor(){super(c.ENTITIES),this.useBackend=T(),this.legalEntitiesApi=new ze,console.log(`[EntityRepository] Initialized with ${this.useBackend?"Backend API":"IndexedDB"}`)}validateId(e,t){if(!e||e.trim()==="")throw new Error(`[EntityRepository.${t}] Invalid id parameter`)}async getAll(){if(this.useBackend)try{return(await this.legalEntitiesApi.getAll()).map(t=>({...t,id:t.id,type:this.mapEntityType(t.entityType),roles:[],riskScore:0,tags:[],status:"Active"}))}catch(e){return console.error("[EntityRepository] Backend API unavailable",e),await super.getAll()}return await super.getAll()}mapEntityType(e){return{individual:"Individual",corporation:"Corporation",llc:"Corporation",partnership:"Law Firm",trust:"Vendor",estate:"Vendor",nonprofit:"Vendor",government:"Government",foreign_entity:"Corporation",other:"Vendor"}[e]||"Vendor"}async getById(e){if(this.validateId(e,"getById"),this.useBackend)try{const t=await this.legalEntitiesApi.getById(e);return{...t,id:t.id,type:this.mapEntityType(t.entityType),roles:[],riskScore:0,tags:[],status:"Active"}}catch(t){return console.error("[EntityRepository] Backend API unavailable",t),await super.getById(e)}return await super.getById(e)}async getRelationships(e){if(this.validateId(e,"getRelationships"),this.useBackend&&e!=="all")try{return await this.legalEntitiesApi.getRelationships(e)}catch(t){return console.error("[EntityRepository] Backend API unavailable",t),[]}return[]}async add(e){if(!e||typeof e!="object")throw new u("[EntityRepository.add] Invalid entity data");const t=await super.add(e);try{await R.publish(f.ENTITY_CREATED,{entity:t})}catch(r){console.warn("[EntityRepository] Failed to publish entity creation event",r)}return t}async update(e,t){return this.validateId(e,"update"),await super.update(e,t)}async delete(e){this.validateId(e,"delete"),await super.delete(e)}async getByType(e){if(!e)throw new u("[EntityRepository.getByType] Invalid type");return(await this.getAll()).filter(r=>r.type===e)}async search(e){if(!e)return[];const t=await this.getAll(),r=e.toLowerCase();return t.filter(i=>i.name?.toLowerCase().includes(r)||i.legalName?.toLowerCase().includes(r))}}class fr extends C{useBackend;constructor(){super(c.ANALYSIS),this.useBackend=T(),console.log(`[AnalysisRepository] Initialized with ${this.useBackend?"Backend API":"IndexedDB"}`)}validateId(e,t){if(!e||e.trim()==="")throw new Error(`[AnalysisRepository.${t}] Invalid id parameter`)}async getAll(){return await super.getAll()}async getById(e){return this.validateId(e,"getById"),await super.getById(e)}async add(e){if(!e||typeof e!="object")throw new u("[AnalysisRepository.add] Invalid analysis session data");return await super.add(e),e}async update(e,t){return this.validateId(e,"update"),await super.update(e,t)}async delete(e){this.validateId(e,"delete"),await super.delete(e)}async getJudgeProfiles(){try{return await h(100),await d.getAll(c.JUDGES)}catch(e){return console.error("[AnalysisRepository.getJudgeProfiles] Error:",e),[]}}async getCounselProfiles(){try{return await h(100),[]}catch(e){return console.error("[AnalysisRepository.getCounselProfiles] Error:",e),[]}}async getPredictionData(){try{return await h(100),[]}catch(e){return console.error("[AnalysisRepository.getPredictionData] Error:",e),[]}}async search(e){if(!e)return[];const t=await this.getAll(),r=e.toLowerCase();return t.filter(i=>i.id?.toLowerCase().includes(r)||i.title?.toLowerCase().includes(r)||i.caseId?.toLowerCase().includes(r))}}class mr extends C{useBackend;citationsApi;constructor(){super(c.CITATIONS),this.useBackend=T(),this.citationsApi=new je,console.log(`[CitationRepository] Initialized with ${this.useBackend?"Backend API":"IndexedDB"}`)}validateId(e,t){if(!e||typeof e!="string"||e.trim()==="")throw new Error(`[CitationRepository.${t}] Invalid id parameter`)}async getAll(){if(this.useBackend)try{return await this.citationsApi.getAll()}catch(e){console.warn("[CitationRepository] Backend API unavailable",e)}return await super.getAll()}async getById(e){if(this.validateId(e,"getById"),this.useBackend)try{return await this.citationsApi.getById(e)}catch(t){console.warn("[CitationRepository] Backend API unavailable",t)}return await super.getById(e)}add=async e=>{if(!e||typeof e!="object")throw new u("[CitationRepository.add] Invalid citation data");let t;if(this.useBackend)try{t=await this.citationsApi.create(e)}catch(r){console.warn("[CitationRepository] Backend API unavailable",r),await super.add(e),t=e}else await super.add(e),t=e;try{await R.publish(f.CITATION_SAVED,{citation:t,queryContext:e.caseContext||""})}catch(r){console.warn("[CitationRepository] Failed to publish integration event",r)}return t};async update(e,t){if(this.validateId(e,"update"),this.useBackend)try{return await this.citationsApi.update(e,t)}catch(r){console.warn("[CitationRepository] Backend API unavailable",r)}return await super.update(e,t)}async delete(e){if(this.validateId(e,"delete"),this.useBackend)try{await this.citationsApi.delete(e);return}catch(t){console.warn("[CitationRepository] Backend API unavailable",t)}await super.delete(e)}async verifyAll(){return{checked:150,flagged:3}}async quickAdd(e){return this.add(e)}async validate(e){if(!e)throw new u("[CitationRepository.validate] Invalid citationText");if(this.useBackend)try{return await this.citationsApi.validate(e)}catch(t){console.warn("[CitationRepository] Backend API unavailable",t)}return{valid:!0,formatted:e}}async shepardize(e){if(this.validateId(e,"shepardize"),this.useBackend)try{return await this.citationsApi.shepardize(e)}catch(r){console.warn("[CitationRepository] Backend API unavailable",r)}const t=await this.getById(e);if(!t)throw new U("Citation",e);return{...t,shepardized:!0,shepardStatus:"good_law"}}async search(e){let t=await this.getAll();if(e.caseId&&(t=t.filter(r=>r.caseId===e.caseId)),e.documentId&&(t=t.filter(r=>r.documentId===e.documentId)),e.type&&(t=t.filter(r=>r.type===e.type)),e.query){const r=e.query.toLowerCase();t=t.filter(i=>i.citation?.toLowerCase().includes(r)||i.citationText?.toLowerCase().includes(r)||i.bluebookFormat?.toLowerCase().includes(r))}return t}}class vr extends C{useBackend;risksApi;constructor(){super(c.RISKS),this.useBackend=T(),this.risksApi=new Ge,console.log(`[RiskRepository] Initialized with ${this.useBackend?"Backend API":"IndexedDB"}`)}validateId(e,t){if(!e||e.trim()==="")throw new Error(`[RiskRepository.${t}] Invalid id parameter`)}async getAll(){if(this.useBackend)try{return await this.risksApi.getAll()}catch(e){console.warn("[RiskRepository] Backend API unavailable",e)}return await super.getAll()}async getByCaseId(e){if(this.validateId(e,"getByCaseId"),this.useBackend)try{return await this.risksApi.getAll({caseId:e})}catch(t){console.warn("[RiskRepository] Backend API unavailable",t)}return await this.getByIndex("caseId",e)}async getById(e){if(this.validateId(e,"getById"),this.useBackend)try{return await this.risksApi.getById(e)}catch(t){console.warn("[RiskRepository] Backend API unavailable",t)}return await super.getById(e)}async add(e){if(!e||typeof e!="object")throw new u("[RiskRepository.add] Invalid risk data");let t;if(this.useBackend)try{t=await this.risksApi.create(e)}catch(r){console.warn("[RiskRepository] Backend API unavailable",r),await super.add(e),t=e}else await super.add(e),t=e;if(t.impact==="High"&&t.probability==="High")try{await R.publish(f.RISK_ESCALATED,{risk:t})}catch(r){console.warn("[RiskRepository] Failed to publish escalation event",r)}return t}async update(e,t){if(this.validateId(e,"update"),this.useBackend)try{return await this.risksApi.update(e,t)}catch(r){console.warn("[RiskRepository] Backend API unavailable",r)}return await super.update(e,t)}async delete(e){if(this.validateId(e,"delete"),this.useBackend)try{await this.risksApi.delete(e);return}catch(t){console.warn("[RiskRepository] Backend API unavailable",t)}await super.delete(e)}async getByImpact(e){return(await this.getAll()).filter(r=>r.impact===e)}async getByProbability(e){return(await this.getAll()).filter(r=>r.probability===e)}async search(e){let t=await this.getAll();if(e.caseId&&(t=t.filter(r=>r.caseId===e.caseId)),e.impact&&(t=t.filter(r=>r.impact===e.impact)),e.probability&&(t=t.filter(r=>r.probability===e.probability)),e.query){const r=e.query.toLowerCase();t=t.filter(i=>i.title?.toLowerCase().includes(r)||i.description?.toLowerCase().includes(r))}return t}}const Y=[{id:"j1",name:"Hon. Sarah Miller",court:"CA Superior - SF",motionStats:[{motionType:"Dismiss",granted:45,denied:24,totalRuled:69,grantRate:65},{motionType:"Summary Judgment",granted:32,denied:44,totalRuled:76,grantRate:42}],grantRateDismiss:65,grantRateSummary:42,avgCaseDuration:450,tendencies:["Strict on discovery deadlines","favors mediation","Detailed rulings"]},{id:"j-brinkema",name:"Hon. Leonie M. Brinkema",court:"E.D. Virginia (Alexandria)",motionStats:[{motionType:"Dismiss",granted:58,denied:22,totalRuled:80,grantRate:72},{motionType:"Summary Judgment",granted:44,denied:36,totalRuled:80,grantRate:55}],grantRateDismiss:72,grantRateSummary:55,avgCaseDuration:380,tendencies:["Rocket Docket efficiency","Strict adherence to local rules","Expects preparedness"]},{id:"j-davis",name:"Magistrate Ivan D. Davis",court:"E.D. Virginia (Alexandria)",motionStats:[{motionType:"Dismiss",granted:24,denied:36,totalRuled:60,grantRate:40},{motionType:"Summary Judgment",granted:18,denied:42,totalRuled:60,grantRate:30}],grantRateDismiss:40,grantRateSummary:30,avgCaseDuration:200,tendencies:["Hands-on discovery management","Encourages settlement conferences"]}];Y[0];class Sr extends C{constructor(e){super(e)}}function Ir(a){return new Sr(a)}class Er{instances=new Map;getOrCreate(e){return this.instances.has(e)||this.instances.set(e,Ir(e)),this.instances.get(e)}register(e,t){this.instances.set(e,t)}clear(){for(const e of this.instances.values())typeof e.clearAllListeners=="function"&&e.clearAllListeners();this.instances.clear()}getStoreNames(){return Array.from(this.instances.keys())}getMemoryStats(){const e=[];let t=0;for(const[r,i]of this.instances.entries()){const s=typeof i.getListenerCount=="function"?i.getListenerCount():0;e.push({name:r,listeners:s}),t+=s}return{repositoryCount:this.instances.size,totalListeners:t,repositories:e.sort((r,i)=>i.listeners-r.listeners)}}}const w=new Er,Ar=le(ct,async a=>await R.publishCaseCreated(a)),Cr=le(Dt,async a=>await R.publishDocketIngested(a)),Rr=le(Jt,async a=>await R.publishDocumentUploaded(a));class Dr extends yr{async addTimeEntry(e){const t=await super.addTimeEntry(e);return await R.publishTimeLogged(t),t}}const Tr=()=>E.getOrCreate("IntegratedCaseRepository",()=>new Ar),br=()=>E.getOrCreate("IntegratedDocketRepository",()=>new Cr),kr=()=>E.getOrCreate("IntegratedDocumentRepository",()=>new Rr),Br=()=>E.getOrCreate("IntegratedBillingRepository",()=>new Dr),Pr=()=>E.getOrCreate("EvidenceRepository",()=>new Kt),_r=()=>E.getOrCreate("DiscoveryRepository",()=>new ur),Or=()=>E.getOrCreate("TrialRepository",()=>new lr),Lr=()=>E.getOrCreate("PleadingRepository",()=>new sr),Fr=()=>E.getOrCreate("AnalysisRepository",()=>new fr),xr=()=>E.getOrCreate("PhaseRepository",()=>new lt),Mr=()=>E.getOrCreate("DataQualityService",()=>new Mt),Nr=()=>E.getOrCreate("HRRepository",()=>De),$r=()=>E.getOrCreate("WorkflowRepository",()=>nr),Ur=()=>E.getOrCreate("TasksRepository",()=>new or),Hr=()=>E.getOrCreate("ProjectsRepository",()=>new cr),Vr=()=>E.getOrCreate("RisksRepository",()=>new vr),zr=()=>E.getOrCreate("MotionsRepository",()=>new dr),jr=()=>E.getOrCreate("ClientsRepository",()=>new hr),Gr=()=>E.getOrCreate("CitationsRepository",()=>new mr),Wr=()=>E.getOrCreate("EntitiesRepository",()=>new wr),qr=()=>E.getOrCreate("OrganizationsRepository",()=>new pr),Jr=()=>E.getOrCreate("WitnessesRepository",()=>new gr),Te={};Object.defineProperties(Te,{cases:p.createPropertyDescriptor("cases",Tr),docket:p.createPropertyDescriptor("docket",br),documents:p.createPropertyDescriptor("documents",kr),drafting:{get:()=>B.drafting},pleadings:p.createPropertyDescriptor("pleadings",Lr),motions:p.createPropertyDescriptor("motions",zr),evidence:p.createPropertyDescriptor("evidence",Pr),legalHolds:p.createPropertyDescriptor("legalHolds",()=>w.getOrCreate(c.LEGAL_HOLDS)),depositions:p.createPropertyDescriptor("depositions",()=>w.getOrCreate("depositions")),discoveryRequests:p.createPropertyDescriptor("discoveryRequests",()=>w.getOrCreate("discoveryRequests")),esiSources:p.createPropertyDescriptor("esiSources",()=>w.getOrCreate("esiSources")),privilegeLog:p.createPropertyDescriptor("privilegeLog",()=>w.getOrCreate(c.PRIVILEGE_LOG)),productions:p.createPropertyDescriptor("productions",()=>w.getOrCreate("productions")),custodianInterviews:p.createPropertyDescriptor("custodianInterviews",()=>w.getOrCreate("custodianInterviews")),custodians:p.createPropertyDescriptor("custodians",()=>w.getOrCreate("custodians")),trial:p.createPropertyDescriptor("trial",Or),exhibits:p.createPropertyDescriptor(null,()=>w.getOrCreate(c.EXHIBITS)),witnesses:p.createPropertyDescriptor("witnesses",Jr),examinations:p.createPropertyDescriptor("examinations",()=>w.getOrCreate("examinations")),billing:p.createPropertyDescriptor("billing",Br),timeEntries:p.createPropertyDescriptor("timeEntries",()=>w.getOrCreate(c.BILLING)),invoices:p.createPropertyDescriptor("invoices",()=>w.getOrCreate("invoices")),expenses:p.createPropertyDescriptor("expenses",()=>w.getOrCreate(c.EXPENSES)),feeAgreements:p.createPropertyDescriptor("feeAgreements",()=>w.getOrCreate("feeAgreements")),rateTables:p.createPropertyDescriptor("rateTables",()=>w.getOrCreate("rateTables")),trustAccounts:p.createPropertyDescriptor("trustAccounts",()=>w.getOrCreate("trustAccounts")),billingAnalytics:p.createPropertyDescriptor("billingAnalytics",()=>w.getOrCreate("billingAnalytics")),clients:p.createPropertyDescriptor("clients",jr),parties:p.createPropertyDescriptor("parties",()=>w.getOrCreate("parties")),organizations:p.createPropertyDescriptor("organizations",qr),entities:p.createPropertyDescriptor("legalEntities",Wr),tasks:p.createPropertyDescriptor("tasks",Ur),projects:p.createPropertyDescriptor(null,Hr),workflow:{get:()=>B.workflow?B.workflow:$r(),enumerable:!0},compliance:{get:()=>Ce,enumerable:!0},conflictChecks:p.createPropertyDescriptor("conflictChecks",()=>w.getOrCreate("conflictChecks")),ethicalWalls:p.createPropertyDescriptor("ethicalWalls",()=>w.getOrCreate("ethicalWalls")),auditLogs:p.createPropertyDescriptor("auditLogs",()=>w.getOrCreate("auditLogs")),permissions:p.createPropertyDescriptor("permissions",()=>w.getOrCreate("permissions")),rlsPolicies:p.createPropertyDescriptor("rlsPolicies",()=>w.getOrCreate(c.POLICIES)),complianceReporting:p.createPropertyDescriptor("complianceReporting",()=>w.getOrCreate("complianceReports")),knowledge:{get:()=>W.knowledge,enumerable:!0},citations:p.createPropertyDescriptor(null,Gr),analytics:{get:()=>zt,enumerable:!0},judgeStats:p.createPropertyDescriptor("judgeStats",()=>({getAll:async()=>Y,getById:async a=>Y.find(e=>e.id===a),search:async a=>Y.filter(e=>e.name.toLowerCase().includes(a.toLowerCase()))})),outcomePredictions:p.createPropertyDescriptor("outcomePredictions",()=>({predict:async a=>({caseId:a,prediction:"unavailable",confidence:0,factors:[]}),getHistory:async()=>[]})),risks:p.createPropertyDescriptor(null,Vr),communications:p.createPropertyDescriptor("communications",()=>w.getOrCreate("communications")),correspondence:{get:()=>Bt,enumerable:!0},messaging:p.createPropertyDescriptor("messaging",()=>w.getOrCreate("messages")),notifications:{get:()=>m(()=>import("./NotificationDomain-CboSxEPd.js"),__vite__mapDeps([5,6,2,3,4])).then(a=>a.NotificationService),enumerable:!0},calendar:{get:()=>K,enumerable:!0},collaboration:{get:()=>m(()=>import("./CollaborationDomain-BHMeC4HU.js"),__vite__mapDeps([7,8,6,2,3,4,9])).then(a=>a.CollaborationService),enumerable:!0},ocr:p.createPropertyDescriptor("ocr",()=>({processDocument:async()=>({success:!1,message:"Backend required"}),getStatus:async()=>({status:"unavailable"})})),warRoom:p.createPropertyDescriptor(null,async()=>{const{WarRoomService:a}=await m(async()=>{const{WarRoomService:e}=await import("./WarRoomDomain-gMI7obYj.js");return{WarRoomService:e}},__vite__mapDeps([10,6,2,3,4]));return a}),processingJobs:p.createPropertyDescriptor("processingJobs",()=>w.getOrCreate(c.PROCESSING_JOBS)),documentVersions:p.createPropertyDescriptor("documentVersions",()=>{const a=w.getOrCreate("documentVersions");return{...a,delete:async e=>(await a.delete(e),{success:!0,id:e})}}),search:{get:()=>m(()=>import("./SearchDomain-CBnrWQ7Z.js"),__vite__mapDeps([11,6,2,3,4])).then(a=>a.SearchService),enumerable:!0},hr:{get:()=>B.hr?B.hr:Nr(),enumerable:!0},users:p.createPropertyDescriptor("users",()=>w.getOrCreate(c.USERS)),groups:p.createPropertyDescriptor("groups",()=>w.getOrCreate("groups")),caseTeams:p.createPropertyDescriptor("caseTeams",()=>w.getOrCreate("caseTeams")),casePhases:p.createPropertyDescriptor("casePhases",()=>w.getOrCreate(c.PHASES)),admin:{get:()=>bt,enumerable:!0},reports:p.createPropertyDescriptor(null,()=>w.getOrCreate(c.REPORTERS)),quality:{get:()=>Mr(),enumerable:!0},catalog:{get:()=>Nt,enumerable:!0},backup:{get:()=>Vt,enumerable:!0},dashboard:p.createPropertyDescriptor(null,async()=>{const{DashboardService:a}=await m(async()=>{const{DashboardService:e}=await import("./DashboardDomain-B4reiZxA.js");return{DashboardService:e}},__vite__mapDeps([12,6,2,3,4,8,9]));return a}),metrics:p.createPropertyDescriptor("metrics",()=>({getSystem:async()=>({cpu:0,memory:0,disk:0,network:0}),getApplication:async()=>({requests:0,errors:0,responseTime:0})})),serviceJobs:p.createPropertyDescriptor("serviceJobs",()=>w.getOrCreate("serviceJobs")),crm:{get:()=>ne,enumerable:!0},marketing:{get:()=>Gt,enumerable:!0},profile:{get:()=>V,enumerable:!0},strategy:{get:()=>m(()=>import("./StrategyDomain-ixp8fBvc.js"),__vite__mapDeps([13,6,2,3,4,8,9])).then(a=>a.StrategyService),enumerable:!0},research:{get:()=>m(()=>import("./ResearchDomain-D6KfW5Ej.js"),__vite__mapDeps([14,6,2,3,4,8,9])).then(a=>a.ResearchService),enumerable:!0},playbooks:p.createPropertyDescriptor(null,()=>w.getOrCreate(c.TEMPLATES)),clauses:p.createPropertyDescriptor(null,()=>w.getOrCreate(c.CLAUSES)),rules:{get:()=>({getAll:async()=>{try{return await B.jurisdiction?.getRules?.()||[]}catch(a){return console.error("[DataService.rules] Failed to fetch rules:",a),[]}},getById:async a=>{try{return await B.jurisdiction?.getRuleById?.(a)}catch(e){console.error("[DataService.rules] Failed to fetch rule:",e);return}},search:async(a,e)=>{try{return await B.jurisdiction?.searchRules?.(a,e)||[]}catch(t){return console.error("[DataService.rules] Failed to search rules:",t),[]}},add:async a=>{try{return await B.jurisdiction?.createRule?.(a)}catch(e){throw console.error("[DataService.rules] Failed to create rule:",e),e}},update:async(a,e)=>{try{return await B.jurisdiction?.updateRule?.(a,e)}catch(t){throw console.error("[DataService.rules] Failed to update rule:",t),t}},delete:async a=>{try{await B.jurisdiction?.deleteRule?.(a)}catch(e){throw console.error("[DataService.rules] Failed to delete rule:",e),e}}}),enumerable:!0},jurisdiction:{get:()=>Wt,enumerable:!0},dataSourcesIntegration:p.createPropertyDescriptor("dataSources",()=>w.getOrCreate("dataSources")),organization:{get:()=>m(()=>import("./OrganizationDomain-DtXDtnda.js"),__vite__mapDeps([15,8,6,2,3,4,9])).then(a=>a.OrganizationService),enumerable:!0},transactions:{get:()=>m(()=>import("./TransactionDomain-mxpB2Z22.js"),__vite__mapDeps([16,8,6,2,3,4,9])).then(a=>a.TransactionService),enumerable:!0},messenger:{get:()=>m(()=>import("./MessengerDomain-Bz44GAkg.js"),__vite__mapDeps([17,6,2,3,4])).then(a=>a.MessengerService),enumerable:!0},assets:{get:()=>m(()=>import("./AssetDomain-CnE8szAw.js"),__vite__mapDeps([18,8,6,2,3,4,9])).then(a=>a.AssetService),enumerable:!0},sources:{get:()=>m(()=>import("./DataSourceDomain-Dcwsp64o.js"),__vite__mapDeps([19,8,6,2,3,4,9])).then(a=>a.DataSourceService),enumerable:!0},security:{get:()=>Re,enumerable:!0},tokenBlacklist:p.createPropertyDescriptor("tokenBlacklistAdmin",()=>({getAll:async()=>[],add:async()=>({success:!1}),remove:async()=>({success:!1})})),operations:{get:()=>kt,enumerable:!0},production:p.createPropertyDescriptor("productions",()=>({getStatus:async()=>({environment:"development",version:"1.0.0",healthy:!0}),deploy:async()=>({success:!1,message:"Backend required"})})),discovery:{get:()=>_r(),enumerable:!0},analysis:{get:()=>Fr(),enumerable:!0},phases:{get:()=>xr(),enumerable:!0},discoveryMain:p.createPropertyDescriptor("discovery",()=>w.getOrCreate("discovery")),complianceMain:p.createPropertyDescriptor("compliance",()=>w.getOrCreate("complianceReports"))});const Kr=Te,F=Object.freeze(Object.defineProperty({__proto__:null,DataService:Kr},Symbol.toStringTag,{value:"Module"}));export{ce as B,Ie as C,Kr as D,Ee as I,Ct as R,c as S,D as T,fe as V,nr as W,oe as a,f as b,I as c,d,it as e,M as f,h as g,J as h,Rt as r,ra as s,ge as w,Ft as y};
