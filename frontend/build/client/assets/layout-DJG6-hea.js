import{r as u,j as e,T as H,A as V,k as $,C as le,W as oe,l as R,m as Q,n as ce,X as Y,Z,o as de,p as U,q as F,t as ue,u as ee,v as te,D as _,x as G,I as he,y as fe,z as me,B as ge,F as xe,U as pe,E as ye,G as be,J as ke,K as ve,N as Ne,Q as Ce,V as je,e as Ee,f as we,Y as Se,_ as Ie,$ as Te,O as Ae}from"./vendor-core-V-oW58GW.js";import{u as Re,a as se,S as Be,T as Le,A as Oe}from"./AppShell-Z1zGEOCG.js";import{u as B}from"./ThemeContext-OPG61qw5.js";import{u as ae}from"./useInterval-C7tD4i7N.js";import{c as i,a as re,g as De,u as Me,q as Pe}from"./useQueryHooks-BdeOvP9e.js";import{G as He}from"./geminiService-DjDdWyh4.js";import{P as p}from"./paths.config-lqyvjjOK.js";import{u as $e,S as Ue,a as Fe}from"./search.config-B6mvIgDA.js";import{u as W,a as Ge}from"./SyncContext-DYD5yPAv.js";import{a2 as Ke,a3 as O}from"./vendor-misc-Dwkhvdtg.js";import{E as D}from"./ErrorBoundary-BekiuBRc.js";import{u as Ve}from"./useNotify-Bhb3OIEg.js";import{D as E}from"./dataService-75QCl8KS.js";import{q as S}from"./queryKeys-BBVgMz36.js";import{S as Ye}from"./scheduler-BERajRBE.js";import{L as _e}from"./useSessionStorage-HC9RvMcM.js";import{u as We}from"./useAppContext-nb9kXNZp.js";import"./vendor-charts-KZIdMATq.js";import"./schemas-B2_dy3tf.js";import"./preload-helper-BXl3LOEh.js";import"./type-mappings-DEPYyX4d.js";import"./useDomainData-DVGIWLUf.js";const qe=()=>{const{theme:s}=B(),[t,a]=u.useState(24);let n=!0,c=0,o=0,m="synced",g=()=>{};try{const l=Re();n=l.isOnline,c=l.pendingCount,o=l.failedCount,m=l.syncStatus,g=l.retryFailed}catch{}return ae(()=>{a(l=>{const y=Math.floor(Math.random()*10)-5;return Math.max(10,Math.min(150,l+y))})},2e3),o>0?e.jsxs("button",{onClick:g,className:"relative p-2 rounded-lg transition-all duration-200 flex items-center justify-center group text-red-600 bg-red-50 hover:bg-red-100 border border-red-200 animate-pulse",title:`${o} items failed to sync. Click to retry.`,children:[e.jsx(H,{className:"h-5 w-5"}),e.jsx("span",{className:"absolute -top-1 -right-1 h-4 min-w-[1rem] px-1 bg-red-600 text-white text-[9px] font-bold flex items-center justify-center rounded-full shadow-sm border-2 border-white",children:o})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:i("hidden md:flex items-center gap-1 text-[10px] font-mono",t>100?"text-amber-500":s.text.tertiary),children:[e.jsx(V,{className:"h-3 w-3"}),t,"ms"]}),e.jsxs("button",{className:i("relative p-2 rounded-lg transition-all duration-200 flex items-center justify-center group",n?m==="syncing"?"text-blue-600 bg-blue-50 hover:bg-blue-100":i(s.text.tertiary,`hover:${s.text.secondary}`,`hover:${s.surface.highlight}`):"text-amber-600 bg-amber-50 hover:bg-amber-100"),title:n?m==="syncing"?"Syncing...":"System Online":"Offline Mode",children:[m==="syncing"?e.jsx($,{className:"h-5 w-5 animate-spin"}):n?e.jsx(oe,{className:"h-5 w-5"}):e.jsx(le,{className:"h-5 w-5"}),c>0&&e.jsx("span",{className:"absolute -top-1 -right-1 h-4 min-w-[1rem] px-1 bg-amber-500 text-white text-[9px] font-bold flex items-center justify-center rounded-full shadow-sm border-2 border-white",children:c})]})]})},r={FINANCE:/money|financ|bill|revenue/i,TASKS:/task|todo|work/i,ALERTS:/alert|notif/i,DOCKET:/docket|calendar/i,INTAKE:/intake|lead|new/i,CONFLICTS:/conflict|check/i,RESOURCES:/resource|staff/i,TRUST:/trust|account|iolta/i,EXPERTS:/expert/i,REPORTERS:/report|steno/i,CLOSING:/clos|binder/i,ARCHIVED:/archiv|old|cold/i,TEMPLATES:/template|library/i,FIRM:/firm|process/i,OPS:/op|center/i,ANALYTICS:/anal|stat|metric/i,SETTINGS:/conf|setting/i,PROCESS:/serv|process|job/i,STICKER:/sticker|label|design/i,STATS:/stat|anal|count/i,COUNSEL:/counsel|oppos|firm/i,PREDICTION:/predict|outcome|forecast/i,SHEPARD:/shep|key|check|signal/i,BLUEBOOK:/blue|format/i,EVIDENCE:/evid|wall/i,WITNESS:/witness/i,BINDER:/binder|notebook/i,INTEL:/oppos|intel/i,ADVISORY:/adv|expert/i,REQUESTS:/request|rog|rfa/i,DEPOSITIONS:/depos|witnes/i,PRODUCTIONS:/prod/i,ESI:/esi|data/i,PRIVILEGE:/privilege/i,HOLD:/hold/i,INTERVIEW:/interview/i,CUSTODY:/custody|chain/i,INVENTORY:/invent|list/i,LOG:/intake|log|add/i,HISTORY:/his/i,SAVED:/sav|book/i,CONFIG:/set|config/i,STATE:/state/i,MAP:/map|geo/i,REGULATORY:/reg|admin/i,INTERNATIONAL:/inter|hague/i,ARBITRATION:/arb|adr/i,LOCAL:/rule|local/i,INVOICE:/invoice/i,WIP:/wip|work|time/i,EXPENSE:/expense|ledger|trust/i,HR:/hr|staff/i,ASSET:/asset|it/i,MARKETING:/market|lead/i,DIRECTORY:/direct|list/i,PIPELINE:/pipe|intake/i,WALL:/wall|barrier/i,POLICY:/policy|regulat/i,HIERARCHY:/user|role|hierarchy/i,SECURITY:/secur/i,DB:/db|data/i,LOGS:/log|audit/i,INTEGRATION:/integrat/i,SCHEMA:/schema|model|diagram/i,MIGRATION:/migrat|change/i,QUERY:/query|sql|select/i,QUERY_HIST:/history/i,PIPELINE_DAG:/pipeline|etl|job/i,CONNECT:/connect/i,LAKE:/lake|s3|store/i,LINEAGE:/lineage|depend/i,QUALITY:/quality|clean/i,VALIDATION:/rule|valid/i,GOVERNANCE:/govern|compliance/i,CATALOG:/catalog|diction/i,RLS:/secur|rls|policy/i,ROLES:/role|access/i,REPLICATION:/replic|failover/i,API:/api|key/i,BACKUP:/backup|recover|vault/i,COST:/cost|finops|spend/i,RECENT:/recent/i,FAVORITES:/favor/i,PRECEDENTS:/prec/i,QA:/qa|ask/i,USAGE:/anal|usage/i,CIVIL:/frcp|civ/i,FRE:/fre|evid/i,ORDER:/order|stand/i,SEARCH:/search|find/i,CONTACTS:/contact|people/i,FILES:/file|doc/i,ARCHIVED_MSG:/arch/i,ORDERS:/order|judgment/i},ze={resolveTab:(s,t="")=>{if(t)switch(s){case p.DASHBOARD:return r.FINANCE.test(t)?"financials":r.TASKS.test(t)?"tasks":r.ALERTS.test(t)?"notifications":"overview";case p.CASES:return r.DOCKET.test(t)?"docket":r.TASKS.test(t)?"tasks":r.INTAKE.test(t)?"intake":r.CONFLICTS.test(t)?"conflicts":r.RESOURCES.test(t)?"resources":r.TRUST.test(t)?"trust":r.EXPERTS.test(t)?"experts":r.REPORTERS.test(t)?"reporters":r.CLOSING.test(t)?"closing":r.ARCHIVED.test(t)?"archived":"active";case p.WORKFLOWS:return r.TEMPLATES.test(t)?"templates":r.FIRM.test(t)?"firm":r.OPS.test(t)?"ops_center":r.ANALYTICS.test(t)?"analytics":r.SETTINGS.test(t)?"settings":"cases";case p.CORRESPONDENCE:return r.PROCESS.test(t)?"process":"communications";case p.EXHIBITS:return r.STICKER.test(t)?"sticker":r.STATS.test(t)?"stats":"list";case p.ANALYTICS:return r.COUNSEL.test(t)?"counsel":r.PREDICTION.test(t)?"prediction":"judge";case p.CITATIONS:return r.SHEPARD.test(t)?"shepard":r.BLUEBOOK.test(t)?"bluebook":"library";case p.WAR_ROOM:return r.EVIDENCE.test(t)?"evidence":r.WITNESS.test(t)?"witnesses":r.BINDER.test(t)?"binder":r.INTEL.test(t)?"opposition":r.ADVISORY.test(t)?"advisory":"command";case p.DISCOVERY:return r.REQUESTS.test(t)?"requests":r.DEPOSITIONS.test(t)?"depositions":r.PRODUCTIONS.test(t)?"productions":r.ESI.test(t)?"esi":r.PRIVILEGE.test(t)?"privilege":r.HOLD.test(t)?"holds":r.INTERVIEW.test(t)?"interviews":"dashboard";case p.EVIDENCE:return r.CUSTODY.test(t)?"custody":r.INVENTORY.test(t)?"inventory":r.LOG.test(t)?"intake":"dashboard";case p.RESEARCH:return r.HISTORY.test(t)?"history":r.SAVED.test(t)?"saved":r.CONFIG.test(t)?"settings":"active";case p.JURISDICTION:return r.STATE.test(t)?"state":r.MAP.test(t)?"map":r.REGULATORY.test(t)?"regulatory":r.INTERNATIONAL.test(t)?"international":r.ARBITRATION.test(t)?"arbitration":r.LOCAL.test(t)?"local":"federal";case p.BILLING:return r.INVOICE.test(t)?"invoices":r.WIP.test(t)?"wip":r.EXPENSE.test(t)?"expenses":r.ANALYTICS.test(t)?"analytics":"overview";case p.PRACTICE:return r.HR.test(t)?"hr":r.ASSET.test(t)?"assets":r.FINANCE.test(t)?"finance":r.MARKETING.test(t)?"marketing":"hr";case p.CRM:return r.DIRECTORY.test(t)?"directory":r.PIPELINE.test(t)?"pipeline":r.ANALYTICS.test(t)?"analytics":"dashboard";case p.COMPLIANCE:return r.CONFLICTS.test(t)?"conflicts":r.WALL.test(t)?"walls":r.POLICY.test(t)?"policies":"overview";case p.ADMIN:return r.HIERARCHY.test(t)?"hierarchy":r.SECURITY.test(t)?"security":r.DB.test(t)?"db":r.LOGS.test(t)?"logs":r.INTEGRATION.test(t)?"integrations":"hierarchy";case p.DATA_PLATFORM:return r.SCHEMA.test(t)?"schema-designer":r.MIGRATION.test(t)?"schema-migrations":r.QUERY.test(t)?"query-editor":r.QUERY_HIST.test(t)&&r.QUERY.test(t)?"query-history":r.PIPELINE_DAG.test(t)?"pipeline-dag":r.CONNECT.test(t)?"pipeline-connectors":r.LAKE.test(t)?"lake":r.LINEAGE.test(t)?"lineage-graph":r.QUALITY.test(t)?"quality-dashboard":r.VALIDATION.test(t)?"quality-rules":r.GOVERNANCE.test(t)?"governance-overview":r.CATALOG.test(t)?"catalog-dictionary":r.RLS.test(t)?"security-policies":r.ROLES.test(t)?"security-roles":r.REPLICATION.test(t)?"replication":r.API.test(t)?"api":r.BACKUP.test(t)?"backup":r.COST.test(t)?"cost":"overview";case p.DOCUMENTS:return r.TEMPLATES.test(t)?"templates":r.RECENT.test(t)?"recent":r.FAVORITES.test(t)?"favorites":"browse";case p.LIBRARY:return r.PRECEDENTS.test(t)?"precedents":r.QA.test(t)?"qa":r.USAGE.test(t)?"insights":"wiki";case p.RULES_ENGINE:return r.CIVIL.test(t)?"federal_civil":r.FRE.test(t)?"federal_evidence":r.LOCAL.test(t)?"local":r.ORDER.test(t)?"standing_orders":r.SEARCH.test(t)?"search":"dashboard";case p.CLAUSES:return r.FAVORITES.test(t)?"favorites":r.ANALYTICS.test(t)?"analytics":"browse";case p.MESSAGES:return r.CONTACTS.test(t)?"contacts":r.FILES.test(t)?"files":r.ARCHIVED_MSG.test(t)?"archived":"chats";case p.DOCKET:return r.DOCKET.test(t)?"calendar":r.STATS.test(t)?"stats":r.CONFIG.test(t)?"sync":r.ORDERS.test(t)?"orders":"all";default:return}}};function Qe({items:s,mode:t="simple",onSelect:a,onActivate:n,onClose:c,isOpen:o=!0,initialIndex:m=-1,enabled:g=!0,containerRef:l,circular:y=!0}){const[h,x]=u.useState(m),d=u.useRef(s.length);u.useEffect(()=>{t==="simple"&&x(o&&s.length>0?0:-1)},[o,s.length,t]),u.useEffect(()=>{t==="full"&&s.length!==d.current&&(d.current=s.length,h>=s.length&&x(s.length-1))},[s.length,h,t]);const k=u.useCallback(()=>{x(f=>{let b;return y&&t==="simple"?b=(f+1)%s.length:b=Math.min(f+1,s.length-1),a&&b!==f&&a(s[b],b),b})},[s,a,y,t]),C=u.useCallback(()=>{x(f=>{let b;return y&&t==="simple"?b=(f-1+s.length)%s.length:b=Math.max(f-1,0),a&&b!==f&&a(s[b],b),b})},[s,a,y,t]),v=u.useCallback(()=>{x(0),a&&s.length>0&&a(s[0],0)},[s,a]),N=u.useCallback(()=>{const f=s.length-1;x(f),a&&f>=0&&a(s[f],f)},[s,a]),j=u.useCallback(()=>{h>=0&&h<s.length&&(n?n(s[h],h):a&&a(s[h],h))},[h,s,n,a]),I=u.useCallback(f=>{if(!(!g||t==="simple"&&!o))switch(f.key){case"ArrowDown":f.preventDefault(),k();break;case"ArrowUp":f.preventDefault(),C();break;case"Enter":f.preventDefault(),j();break;case"Escape":t==="simple"&&c&&(f.preventDefault(),c());break;case" ":t==="full"&&(f.preventDefault(),j());break;case"Home":t==="full"&&(f.preventDefault(),v());break;case"End":t==="full"&&(f.preventDefault(),N());break;case"PageDown":t==="full"&&(f.preventDefault(),x(b=>{const T=Math.min(b+10,s.length-1);return a&&T!==b&&a(s[T],T),T}));break;case"PageUp":t==="full"&&(f.preventDefault(),x(b=>{const T=Math.max(b-10,0);return a&&T!==b&&a(s[T],T),T}));break}},[g,o,t,k,C,v,N,j,c,s,a]);u.useEffect(()=>{if(t!=="full"||h<0||!l?.current)return;const f=l.current,b=f.querySelector(`[data-index="${h}"]`);if(b){const T=f.getBoundingClientRect(),q=b.getBoundingClientRect(),z=q.top<T.top,ie=q.bottom>T.bottom;(z||ie)&&b.scrollIntoView({behavior:"smooth",block:z?"start":"end"}),b.focus()}},[h,l,t]);const A=u.useCallback(f=>{if(t==="full")return{tabIndex:f===h||h===-1&&f===0?0:-1,"data-index":f,"aria-selected":f===h,onKeyDown:I}},[h,I,t]),w={focusedIndex:h,setFocusedIndex:x,handleKeyDown:I};return t==="full"&&(w.getFocusProps=A),w}const ne="bg-yellow-200 text-slate-900 font-bold dark:bg-yellow-900/50 dark:text-yellow-100",Xe="rounded-sm px-0.5",Je=s=>i(Xe,s||ne),K=u.memo(({text:s,query:t,className:a="",highlightClassName:n=ne})=>{if(!t)return e.jsx("span",{className:a,children:s});const c=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),o=s.split(new RegExp(`(${c})`,"gi"));return e.jsx("span",{className:a,children:o.map((m,g)=>m.toLowerCase()===t.toLowerCase()?e.jsx("span",{className:Je(n),children:m},`highlight-${g}-${m}`):e.jsx(R.Fragment,{children:m},`text-${g}-${m}`))})});K.displayName="HighlightedText";const Ze=R.memo(({globalSearch:s,setGlobalSearch:t,onGlobalSearch:a,onSearchResultClick:n,onNeuralCommand:c})=>{const{theme:o}=B(),[m,g]=u.useState(!1),[l,y]=u.useState(!1),[h,x]=u.useState([]),d=$e(s,Fe),k=u.useRef(null),C=u.useRef(null);se(k,()=>g(!1)),u.useEffect(()=>{(async()=>{if(d.length>=Ue&&!l){const b=await Be.search(d);x(b.slice(0,10)),g(!0)}else x([]),g(!1)})()},[d,l]);const v=f=>{t(""),g(!1),n&&n(f)},N=async()=>{if(s.length>10||/open|go to|draft|create|show/.test(s.toLowerCase())){y(!0);const f=await He.predictIntent(s);if(f.action==="NAVIGATE"&&f.targetModule){const b=ze.resolveTab(f.targetModule,f.context);f.context=b||f.context}y(!1),f.action!=="UNKNOWN"&&c&&(t(""),c(f))}},{focusedIndex:j,setFocusedIndex:I,handleKeyDown:A}=Qe({items:h,mode:"simple",isOpen:m,onSelect:v,onClose:()=>g(!1),circular:!0}),w=f=>{f.key==="Enter"&&j===-1?(N(),a(f)):A(f)};return e.jsxs("div",{className:"relative w-full hidden sm:block max-w-2xl",ref:k,children:[e.jsx("div",{className:i("absolute left-3 top-1/2 -translate-y-1/2 transition-all duration-300",l?"scale-110 text-purple-600":o.text.tertiary),children:l?e.jsx(Q,{className:"h-5 w-5 animate-pulse"}):e.jsx(ce,{className:"h-4 w-4"})}),e.jsx("input",{ref:C,type:"text",placeholder:l?"Analyzing intent...":"Search or type a command (e.g., 'Draft motion for Martinez')...",className:i("w-full pl-10 pr-10 py-2.5 rounded-xl text-sm outline-none transition-all border shadow-sm font-medium",o.surface.input,o.text.primary,l?"border-purple-500 ring-2 ring-purple-500/20":i(o.border.default,"focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20")),value:s,onChange:f=>t(f.target.value),onKeyDown:w,onFocus:()=>{s.length>0&&g(!0)},disabled:l}),s&&!l&&e.jsx("button",{onClick:()=>{t(""),g(!1)},className:i("absolute right-3 top-1/2 -translate-y-1/2",o.text.tertiary,`hover:${o.text.primary}`),children:e.jsx(Y,{className:"h-4 w-4"})}),m&&e.jsxs("div",{className:i("absolute top-full left-0 right-0 mt-2 rounded-lg shadow-2xl border overflow-hidden max-h-96 overflow-y-auto z-50 animate-in fade-in zoom-in-95 duration-100",o.surface.default,o.border.default),children:[e.jsxs("div",{className:i("bg-gradient-to-r from-purple-500/10 to-blue-500/10 p-2 border-b flex justify-between items-center",o.border.default),children:[e.jsxs("span",{className:"text-[10px] font-bold text-purple-600 uppercase tracking-wider flex items-center",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"})," AI Command Ready"]}),e.jsxs("span",{className:i("text-[9px] flex items-center gap-1",o.text.secondary),children:[e.jsx("kbd",{className:i("border rounded px-1 font-mono",o.border.default),children:"↵"})," to execute"]})]}),h.length>0?e.jsxs("div",{className:"py-1",children:[h.length>0&&h[0].score&&h[0].score>80&&e.jsxs("div",{className:i("px-3 py-1.5 text-[10px] font-semibold uppercase tracking-wider flex justify-between",o.text.tertiary),children:[e.jsx("span",{children:"Top Matches"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-2 w-2"})," Instant"]})]}),h.map((f,b)=>e.jsxs("button",{onClick:()=>v(f),onMouseEnter:()=>I(b),className:i("w-full text-left px-4 py-2.5 flex items-center gap-3 transition-colors border-b last:border-0",j===b?i(o.surface.highlight,o.border.default):i(o.surface.default,o.border.default)),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:i("text-sm font-bold truncate",o.text.primary),children:e.jsx(K,{text:f.title,query:s,highlightClassName:"bg-yellow-200 dark:bg-yellow-900/50 text-slate-900 dark:text-yellow-100"})}),e.jsx("p",{className:i("text-xs truncate",o.text.secondary),children:e.jsx(K,{text:f.subtitle,query:s,highlightClassName:"bg-yellow-200 dark:bg-yellow-900/50 text-slate-900 dark:text-yellow-100"})})]}),j===b&&e.jsxs("div",{className:"hidden sm:flex items-center gap-2 text-[10px] text-blue-600 font-medium animate-in fade-in slide-in-from-left-1",children:["Open ",e.jsx(de,{className:"h-3 w-3"})]})]},`${f.type}-${f.id}`))]}):e.jsxs("div",{className:i("p-8 text-center flex flex-col items-center justify-center",o.text.secondary),children:[e.jsx(U,{className:"h-8 w-8 mb-2 opacity-50"}),e.jsx("p",{className:"text-sm font-medium",children:"No direct matches found."}),e.jsx("p",{className:"text-xs mt-1 opacity-70",children:'Try a natural language command like "Find cases about tax fraud".'})]})]})]})}),et=({isOpen:s,onClose:t})=>{const{theme:a}=B(),[n,c]=u.useState(null),[o,m]=u.useState(!1),[g,l]=u.useState(null),y=u.useId(),h=u.useId(),x=async()=>{m(!0);try{const v=await re.checkSystemHealth();c(v),l(new Date)}catch(v){console.error("Failed to check system health:",v)}finally{m(!1)}};u.useEffect(()=>{s&&x()},[s]);const d=v=>{switch(v){case"online":return e.jsx(te,{className:"h-5 w-5 text-emerald-500"});case"degraded":return e.jsx(H,{className:"h-5 w-5 text-amber-500"});case"offline":return e.jsx(ee,{className:"h-5 w-5 text-rose-500"});default:return e.jsx(H,{className:"h-5 w-5 text-gray-400"})}},k=v=>{switch(v){case"online":return"bg-emerald-50 border-emerald-200 text-emerald-700 dark:bg-emerald-900/20 dark:border-emerald-800 dark:text-emerald-300";case"degraded":return"bg-amber-50 border-amber-200 text-amber-700 dark:bg-amber-900/20 dark:border-amber-800 dark:text-amber-300";case"offline":return"bg-rose-50 border-rose-200 text-rose-700 dark:bg-rose-900/20 dark:border-rose-800 dark:text-rose-300";default:return"bg-gray-50 border-gray-200 text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300"}},C=v=>{switch(v){case"online":return"text-emerald-600 dark:text-emerald-400";case"degraded":return"text-amber-600 dark:text-amber-400";case"offline":return"text-rose-600 dark:text-rose-400";default:return"text-gray-600 dark:text-gray-400"}};return s?e.jsx(Ke,{children:e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:t,children:e.jsxs(O.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:v=>v.stopPropagation(),role:"dialog","aria-modal":"true","aria-labelledby":y,"aria-describedby":h,className:i("w-full max-w-4xl max-h-[90vh] rounded-2xl shadow-2xl overflow-hidden flex flex-col",a.surface.default),children:[e.jsxs("div",{className:i("px-6 py-4 border-b flex items-center justify-between",a.border.default),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h2",{id:y,className:i("text-xl font-bold",a.text.primary),children:"Backend Health Monitor"}),e.jsx("p",{id:h,className:i("text-xs mt-0.5",a.text.secondary),children:"Real-time service status and performance metrics"})]})]}),e.jsx("button",{onClick:t,className:i("p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors",a.text.secondary),children:e.jsx(Y,{className:"h-5 w-5"})})]}),n&&e.jsx("div",{className:i("px-6 py-4 border-b",a.border.default),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:i("text-sm font-medium",a.text.secondary),children:"Overall Status:"}),e.jsxs("div",{className:i("text-2xl font-bold flex items-center gap-2",C(n.overall)),children:[d(n.overall),n.overall.toUpperCase()]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[g&&e.jsxs("div",{className:i("text-xs flex items-center gap-1",a.text.secondary),children:[e.jsx(F,{className:"h-3 w-3"}),g.toLocaleTimeString()]}),e.jsxs("button",{onClick:x,disabled:o,className:i("px-4 py-2 text-sm font-medium rounded-lg border flex items-center gap-2 transition-colors",a.border.default,o?"opacity-50 cursor-not-allowed":"hover:bg-gray-50 dark:hover:bg-slate-800"),children:[e.jsx($,{className:i("h-4 w-4",o&&"animate-spin")}),"Refresh"]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:o&&!n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx($,{className:"h-8 w-8 animate-spin text-blue-600"})}):n?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(n.services).map(([v,N])=>e.jsxs(O.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:i("p-4 rounded-xl border-2 transition-all",k(N.status)),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d(N.status),e.jsx("h3",{className:"font-bold text-sm",children:v})]}),e.jsx("div",{className:i("px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider",k(N.status)),children:N.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[N.latency!==void 0&&e.jsxs("div",{children:[e.jsxs("div",{className:i("flex items-center gap-1 mb-1",a.text.tertiary),children:[e.jsx(Z,{className:"h-3 w-3"}),e.jsx("span",{className:"font-semibold",children:"Latency"})]}),e.jsxs("div",{className:i("font-mono font-bold",a.text.primary),children:[N.latency,"ms"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:i("flex items-center gap-1 mb-1",a.text.tertiary),children:[e.jsx(F,{className:"h-3 w-3"}),e.jsx("span",{className:"font-semibold",children:"Last Check"})]}),e.jsx("div",{className:i("font-mono text-xs",a.text.primary),children:new Date(N.lastChecked).toLocaleTimeString()})]})]}),N.error&&e.jsx("div",{className:"mt-3 p-2 rounded bg-white/50 dark:bg-black/20 text-xs font-mono",children:N.error})]},v))}):e.jsx("div",{className:i("text-center py-12",a.text.secondary),children:'Click "Refresh" to check backend service health'})}),e.jsx("div",{className:i("px-6 py-4 border-t",a.border.default),children:e.jsxs("div",{className:i("flex items-center gap-2 text-xs",a.text.tertiary),children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{children:"Health checks run against backend API endpoints to monitor service availability and performance."})]})})]})})}):null},L=[{name:"Cases",category:"Core Data",hasBackend:!0},{name:"Docket",category:"Core Data",hasBackend:!0},{name:"Evidence",category:"Core Data",hasBackend:!0},{name:"Documents",category:"Core Data",hasBackend:!0},{name:"Pleadings",category:"Litigation",hasBackend:!0},{name:"Motions",category:"Litigation",hasBackend:!0},{name:"Parties",category:"Litigation",hasBackend:!0},{name:"Clauses",category:"Litigation",hasBackend:!0},{name:"Case Phases",category:"Litigation",hasBackend:!0},{name:"Legal Holds",category:"Discovery",hasBackend:!0},{name:"Depositions",category:"Discovery",hasBackend:!0},{name:"Discovery Requests",category:"Discovery",hasBackend:!0},{name:"ESI Sources",category:"Discovery",hasBackend:!0},{name:"Privilege Log",category:"Discovery",hasBackend:!0},{name:"Productions",category:"Discovery",hasBackend:!0},{name:"Custodian Interviews",category:"Discovery",hasBackend:!0},{name:"Time Entries",category:"Billing",hasBackend:!0},{name:"Invoices",category:"Billing",hasBackend:!0},{name:"Expenses",category:"Billing",hasBackend:!0},{name:"Trust Accounts",category:"Billing",hasBackend:!0},{name:"Rate Tables",category:"Billing",hasBackend:!0},{name:"Fee Agreements",category:"Billing",hasBackend:!0},{name:"Billing Analytics",category:"Billing",hasBackend:!0},{name:"Processing Jobs",category:"Billing",hasBackend:!0},{name:"Reports",category:"Billing",hasBackend:!0},{name:"Conflict Checks",category:"Compliance",hasBackend:!0},{name:"Ethical Walls",category:"Compliance",hasBackend:!0},{name:"Audit Logs",category:"Compliance",hasBackend:!0},{name:"Permissions",category:"Compliance",hasBackend:!0},{name:"RLS Policies",category:"Compliance",hasBackend:!0},{name:"Compliance Reports",category:"Compliance",hasBackend:!0},{name:"Projects",category:"Operations",hasBackend:!0},{name:"Communications",category:"Operations",hasBackend:!0},{name:"Users",category:"Operations",hasBackend:!0},{name:"Custodians",category:"Operations",hasBackend:!0},{name:"Examinations",category:"Operations",hasBackend:!0},{name:"Case Teams",category:"Operations",hasBackend:!0},{name:"Time Entries (Extended)",category:"Operations",hasBackend:!0},{name:"Tasks",category:"Workflow",hasBackend:!0},{name:"Risks",category:"Workflow",hasBackend:!0},{name:"Workflow Templates",category:"Workflow",hasBackend:!0},{name:"HR",category:"HR",hasBackend:!0},{name:"Trial Management",category:"Trial",hasBackend:!0},{name:"Exhibits",category:"Trial",hasBackend:!0},{name:"Clients",category:"CRM",hasBackend:!0},{name:"Citations",category:"Research",hasBackend:!0},{name:"Knowledge Base",category:"Research",hasBackend:!0},{name:"Calendar",category:"Collaboration",hasBackend:!0},{name:"Messenger",category:"Collaboration",hasBackend:!0},{name:"War Room",category:"Collaboration",hasBackend:!0},{name:"Analytics Dashboard",category:"Analytics",hasBackend:!0}],tt=R.memo(function({className:t="",compact:a=!1}){const{isBackendApiEnabled:n}=W(),c=L.length,o=L.filter(l=>l.hasBackend).length,m=Math.round(o/c*100);if(!n)return e.jsxs("div",{className:`flex items-center gap-2 ${t}`,children:[e.jsx(_,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Local Storage (All Services)"})]});if(a)return e.jsxs("div",{className:`flex items-center gap-2 ${t}`,children:[e.jsx(G,{className:"w-4 h-4 text-emerald-500"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Backend: ",e.jsxs("span",{className:"font-semibold text-emerald-600 dark:text-emerald-400",children:[o,"/",c]}),e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",m,"%)"]})]})]});const g=L.reduce((l,y)=>(l[y.category]||(l[y.category]={total:0,backend:0}),l[y.category].total++,y.hasBackend&&l[y.category].backend++,l),{});return e.jsxs("div",{className:`space-y-3 ${t}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Backend Service Coverage"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-emerald-500"}),e.jsxs("span",{className:"text-sm font-bold text-emerald-600 dark:text-emerald-400",children:[o,"/",c," (",m,"%)"]})]})]}),e.jsx("div",{className:"space-y-2",children:Object.entries(g).map(([l,y])=>{const h=Math.round(y.backend/y.total*100);return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:l}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[y.backend,"/",y.total," (",h,"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-slate-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${h===100?"bg-emerald-500":"bg-amber-500"}`,style:{width:`${h}%`}})})]},l)})}),e.jsx("div",{className:"pt-3 border-t border-gray-200 dark:border-slate-700",children:e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:["When backend mode is enabled, ",o," services use PostgreSQL.",c-o>0&&e.jsxs(e.Fragment,{children:[" ",c-o," services still use local IndexedDB storage."]})]})})]})}),st=({isOpen:s,onClose:t})=>s?e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center",onClick:t,children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto mx-4",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"Service Coverage Report"}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"✕"})]}),e.jsx(tt,{}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Service Details"}),Object.entries(L.reduce((a,n)=>(a[n.category]||(a[n.category]=[]),a[n.category].push(n),a),{})).map(([a,n])=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide",children:a}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:n.map(c=>e.jsxs("div",{className:"flex items-center gap-2 text-xs py-1 px-2 rounded bg-gray-50 dark:bg-slate-700",children:[c.hasBackend?e.jsx(te,{className:"w-3 h-3 text-emerald-500 flex-shrink-0"}):e.jsx(ee,{className:"w-3 h-3 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:c.hasBackend?"text-gray-900 dark:text-gray-100":"text-gray-500 dark:text-gray-400",children:c.name})]},c.name))})]},a))]})]})})}):null,at=({className:s=""})=>{const[t,a]=u.useState(!0),[n,c]=u.useState("checking"),[o,m]=u.useState(!1),[g,l]=u.useState(!1),[y,h]=u.useState(0),{currentSource:x,isBackendApiEnabled:d}=W();u.useEffect(()=>{let N,j=!0;const I=w=>Math.min(5e3*Math.pow(2,w),6e4),A=async()=>{if(!j||!d){c("disconnected");return}try{await re.healthCheck(),j&&(c("connected"),h(0),N=setTimeout(A,3e4))}catch{if(j){c("disconnected");const f=y+1;h(f);const b=I(f);console.debug(`[ConnectionStatus] Backend offline, retrying in ${b/1e3}s...`),N=setTimeout(A,b)}}};return A(),()=>{j=!1,clearTimeout(N)}},[d,y]),u.useEffect(()=>{const N=()=>a(!0),j=()=>a(!1);return window.addEventListener("online",N),window.addEventListener("offline",j),()=>{window.removeEventListener("online",N),window.removeEventListener("offline",j)}},[]);const k=()=>d?n==="connected"&&t?"text-emerald-600 bg-emerald-50":n==="checking"?"text-amber-600 bg-amber-50":"text-rose-600 bg-rose-50":"text-blue-600 bg-blue-50",C=()=>x==="indexeddb"?"IndexedDB (Offline)":n==="checking"?"Checking...":x==="postgresql"&&n==="connected"&&t?"PostgreSQL (35+ Services)":x==="cloud"&&n==="connected"&&t?"Cloud DB (Not Implemented)":t?"Backend Offline":"No Internet",v=()=>d?n==="checking"?e.jsx(U,{className:"w-4 h-4 animate-pulse"}):n==="connected"&&t?e.jsx(G,{className:"w-4 h-4"}):t?e.jsx(U,{className:"w-4 h-4"}):e.jsx(fe,{className:"w-4 h-4"}):e.jsx(_,{className:"w-4 h-4"});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-medium ${k()} ${s}`,children:[v(),e.jsx("span",{children:C()})]}),e.jsx("button",{onClick:()=>l(!0),className:"p-1.5 rounded-full bg-gray-100 dark:bg-slate-800 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors",title:"View Service Coverage",children:e.jsx(he,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})}),d&&e.jsx("button",{onClick:()=>m(!0),className:"p-1.5 rounded-full bg-gray-100 dark:bg-slate-800 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors",title:"View Backend Health Monitor",children:e.jsx(V,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})})]}),e.jsx(st,{isOpen:g,onClose:()=>l(!1)}),e.jsx(et,{isOpen:o,onClose:()=>m(!1)})]})},rt=({user:s,className:t})=>e.jsx("div",{className:i("rounded-full bg-blue-500 text-white flex items-center justify-center",t),children:s?.name?.[0]||"U"}),nt=({onToggleSidebar:s,globalSearch:t,setGlobalSearch:a,onGlobalSearch:n,currentUser:c,onSwitchUser:o,onSearchResultClick:m,onNeuralCommand:g})=>{const{theme:l}=B(),[y,h]=u.useState(!1),[x,d]=u.useState(!1),k=R.useRef(null);return se(k,()=>d(!1)),ae(()=>h(C=>!C),2e3),e.jsxs("header",{role:"banner",className:"flex-1 flex items-center justify-between h-full",children:[e.jsxs("div",{className:"flex items-center flex-1 gap-4",children:[e.jsx("button",{onClick:s,className:i("md:hidden p-2 -ml-2 rounded-lg focus:outline-none transition-colors",l.text.secondary,`hover:${l.surface.highlight}`),children:e.jsx(me,{className:"h-6 w-6"})}),e.jsx(Ze,{globalSearch:t,setGlobalSearch:a,onGlobalSearch:n,onSearchResultClick:m,onNeuralCommand:g}),e.jsx(at,{className:"hidden lg:flex"}),e.jsxs("div",{className:i("hidden xl:flex items-center gap-2 px-3 py-1 rounded border",l.surface.highlight,l.border.default),children:[e.jsx("div",{className:i("w-2 h-2 rounded-full transition-opacity duration-1000",y?`${l.status.success.bg} opacity-100`:`${l.status.success.text} opacity-40`)}),e.jsx("span",{className:i("text-[9px] font-mono uppercase tracking-widest",l.text.tertiary),children:"System Online"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsxs("div",{className:"relative",ref:k,children:[e.jsxs("button",{onClick:()=>d(!x),className:i("flex items-center gap-1 px-3 py-1.5 rounded-full border transition-all text-xs font-bold shadow-sm",l.surface.default,l.border.default,l.text.primary,`hover:${l.surface.highlight}`),children:[e.jsx(ge,{className:i("h-4 w-4",l.primary.text)})," Quick Add"]}),x&&e.jsxs("div",{className:i("absolute top-full right-0 mt-2 w-48 rounded-lg shadow-xl border overflow-hidden z-50 animate-in fade-in zoom-in-95 duration-100",l.surface.default,l.border.default),children:[e.jsxs("button",{className:i("w-full text-left px-4 py-3 text-sm flex items-center gap-3 transition-colors",l.text.primary,`hover:${l.surface.highlight}`),children:[e.jsx(F,{className:i("h-4 w-4",l.status.success.icon)})," Log Time"]}),e.jsxs("button",{className:i("w-full text-left px-4 py-3 text-sm flex items-center gap-3 transition-colors",l.text.primary,`hover:${l.surface.highlight}`),children:[e.jsx(xe,{className:i("h-4 w-4",l.primary.text)})," New Document"]}),e.jsxs("button",{className:i("w-full text-left px-4 py-3 text-sm flex items-center gap-3 transition-colors",l.text.primary,`hover:${l.surface.highlight}`),children:[e.jsx(pe,{className:"h-4 w-4 text-purple-600 dark:text-purple-400"})," New Client"]})]})]}),e.jsx(qe,{}),e.jsxs("button",{className:i("relative p-2 rounded-lg transition-colors group",l.text.tertiary,`hover:${l.surface.highlight} hover:${l.text.secondary}`),children:[e.jsx(ye,{className:"h-5 w-5"}),e.jsx("span",{className:i("absolute top-2 right-2 h-2 w-2 rounded-full border-2 animate-pulse",l.status.error.icon,l.border.default)})]}),e.jsx("div",{className:i("h-8 w-px mx-1",l.border.default)}),e.jsxs("button",{className:i("flex items-center gap-3 pl-2 pr-1 py-1 rounded-lg transition-colors group",`hover:${l.surface.highlight}`),onClick:o,title:"Switch User Profile",children:[e.jsxs("div",{className:"text-right hidden md:block",children:[e.jsx("p",{className:i("text-xs font-bold leading-tight",l.text.primary),children:c?.name||"Guest"}),e.jsx("p",{className:i("text-[10px] uppercase font-medium tracking-wide",l.text.secondary),children:c?.role||"User"})]}),e.jsx(rt,{user:c,className:"shadow-sm"})]})]})]})},it=R.memo(({onToggleCommand:s,onNavigate:t})=>{const a=Ve();return u.useEffect(()=>{const n=c=>{if((c.metaKey||c.ctrlKey)&&c.key==="k"&&(c.preventDefault(),s()),(c.metaKey||c.ctrlKey)&&c.key==="/"&&(c.preventDefault(),a.info("Shortcuts: Cmd+K (Search), Alt+C (Cases), Alt+D (Docket)")),c.altKey)switch(c.key.toLowerCase()){case"c":c.preventDefault(),t("cases"),a.info("Navigated to Cases");break;case"d":c.preventDefault(),t("docket"),a.info("Navigated to Docket");break;case"w":c.preventDefault(),t("workflows"),a.info("Navigated to Workflows");break;case"r":c.preventDefault(),t("research"),a.info("Navigated to Research");break}};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[s,t,a]),null});class lt{status={available:!1,healthy:!1,lastChecked:new Date};checkInterval=null;listeners=new Set;CHECK_INTERVAL_MS=6e4;getHealthEndpoint(){return`${De()}/api/health`}TIMEOUT_MS=3e3;notifyTimeout=null;start(){console.log("[BackendDiscovery] Starting auto-discovery service"),this.checkBackend(),this.checkInterval=setInterval(()=>{this.checkBackend()},this.CHECK_INTERVAL_MS)}stop(){console.log("[BackendDiscovery] Stopping auto-discovery service"),this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null),this.notifyTimeout&&(clearTimeout(this.notifyTimeout),this.notifyTimeout=null)}async checkBackend(){const t=Date.now(),a=this.getHealthEndpoint();console.log("[BackendDiscovery] Checking health at:",a);try{const n=new AbortController,c=setTimeout(()=>n.abort(),this.TIMEOUT_MS),o=await fetch(this.getHealthEndpoint(),{method:"GET",signal:n.signal,headers:{Accept:"application/json"}});clearTimeout(c);const m=Date.now()-t;if(o.ok){let g;try{const l=await o.json();g=l.version||l.info?.version}catch{}this.updateStatus({available:!0,healthy:o.status===200,lastChecked:new Date,version:g,latency:m,error:void 0}),console.log(`[BackendDiscovery] Backend is ${this.status.healthy?"healthy":"available"} (${m}ms)`)}else this.updateStatus({available:!0,healthy:!1,lastChecked:new Date,latency:m,error:`HTTP ${o.status}: ${o.statusText}`}),console.warn(`[BackendDiscovery] Backend returned error: ${o.status}`)}catch(n){const c=n instanceof Error?n.message:"Unknown error";this.updateStatus({available:!1,healthy:!1,lastChecked:new Date,error:c}),this.status.available&&console.warn("[BackendDiscovery] Backend unavailable:",c)}}updateStatus(t){const a=this.status.available,n=this.status.healthy;this.status=t,(a!==t.available||n!==t.healthy)&&this.notifyListeners()}notifyListeners(){this.notifyTimeout&&clearTimeout(this.notifyTimeout),this.notifyTimeout=setTimeout(()=>{this.listeners.forEach(t=>{try{t(this.status)}catch(a){console.error("[BackendDiscovery] Error in listener callback:",a)}}),this.notifyTimeout=null},100)}getStatus(){return{...this.status}}subscribe(t){return this.listeners.add(t),t(this.status),()=>{this.listeners.delete(t)}}async refresh(){return await this.checkBackend(),this.getStatus()}isAvailable(){return this.status.available}isHealthy(){return this.status.healthy}}const M=new lt;function ot(){const[s,t]=u.useState(()=>{try{const d=M.getStatus();return console.log("[useBackendHealth] Initialized with status:",{available:d.available,healthy:d.healthy,lastChecked:d.lastChecked}),d}catch(d){return console.error("[useBackendHealth] Error initializing status:",d),{available:!1,healthy:!1,lastChecked:new Date,latency:void 0,version:void 0,error:"Failed to initialize backend health monitoring"}}}),[a,n]=u.useState(!1);u.useEffect(()=>{try{console.log("[useBackendHealth] Setting up status subscription");const d=M.subscribe(k=>{try{if(!k||typeof k!="object"){console.error("[useBackendHealth] Invalid status update:",k);return}s.available!==k.available&&console.log(`[useBackendHealth] Availability changed: ${s.available} → ${k.available}`),s.healthy!==k.healthy&&console.log(`[useBackendHealth] Health changed: ${s.healthy} → ${k.healthy}`),t(k)}catch(C){console.error("[useBackendHealth] Error processing status update:",C)}});return()=>{try{console.log("[useBackendHealth] Cleaning up status subscription"),d()}catch(k){console.error("[useBackendHealth] Error during cleanup:",k)}}}catch(d){return console.error("[useBackendHealth] Error setting up subscription:",d),()=>{}}},[s.available,s.healthy]);const c=u.useCallback(async()=>{try{console.log("[useBackendHealth] Manual refresh triggered"),n(!0);const d=await M.refresh();if(!d||typeof d!="object")throw new Error("Invalid status response from refresh");return console.log("[useBackendHealth] Manual refresh completed:",{available:d.available,healthy:d.healthy,latency:d.latency}),d}catch(d){return console.error("[useBackendHealth.refresh] Error:",d),s}finally{n(!1)}},[s]),o=u.useCallback(d=>{try{return!d||typeof d!="object"?(console.error("[useBackendHealth] Invalid status object:",d),!1):typeof d.available!="boolean"||typeof d.healthy!="boolean"?(console.error("[useBackendHealth] Invalid required fields:",d),!1):!d.lastChecked||!(d.lastChecked instanceof Date)&&typeof d.lastChecked!="string"?(console.error("[useBackendHealth] Invalid lastChecked field:",d.lastChecked),!1):!0}catch(k){return console.error("[useBackendHealth.validateStatus] Error:",k),!1}},[]);u.useEffect(()=>{},[s,o]);const m=s.available,g=s.healthy,l=s.lastChecked,y=s.latency??null,h=s.version??null,x=s.error?new Error(s.error):null;return{status:s,isAvailable:m,isHealthy:g,lastChecked:l,latency:y,version:h,error:x,isLoading:a,refresh:c}}const ct=({showLabel:s=!0,variant:t="compact",showPulse:a=!0})=>{const{isAvailable:n,isHealthy:c,latency:o,lastChecked:m}=ot(),{currentSource:g}=W(),l=()=>g==="indexeddb"?"text-slate-500 bg-slate-100":n?c?"text-emerald-500 bg-emerald-100":"text-amber-500 bg-amber-100":"text-rose-500 bg-rose-100",y=()=>g==="indexeddb"?be:n?_:ke,h=()=>{const k=g==="indexeddb"?`Local Mode - Backend ${n?"detected":"not detected"}`:n?c?`Backend online${o?` (${o}ms)`:""}`:"Backend degraded":"Backend offline",C=typeof m=="string"?new Date(m):m,v=Math.floor((Date.now()-C.getTime())/1e3);return`${k}
Last checked: ${v}s ago`},x=y(),d=a&&n;return t==="compact"?e.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded-md ${l()} relative`,title:h(),children:[d&&e.jsx("span",{className:"absolute inset-0 rounded-md bg-emerald-400 animate-ping opacity-20"}),e.jsx(x,{className:`h-3.5 w-3.5 relative z-10 ${d?"animate-pulse":""}`}),s&&e.jsx("span",{className:"text-xs font-medium relative z-10",children:g==="indexeddb"?n?"Local (Backend Ready)":"Local Only":n?"Online":"Offline"})]}):e.jsxs("div",{className:`flex items-center gap-3 px-3 py-2 rounded-lg border ${l()} relative overflow-hidden`,title:h(),children:[d&&e.jsx("span",{className:"absolute inset-0 bg-emerald-400 animate-ping opacity-10"}),e.jsx(x,{className:`h-4 w-4 relative z-10 ${d?"animate-pulse":""}`}),s&&e.jsxs("div",{className:"flex flex-col relative z-10",children:[e.jsx("span",{className:"text-xs font-medium",children:g==="indexeddb"?n?"Local Storage (Backend Detected)":"Local Storage Only":"Backend Server"}),e.jsx("span",{className:"text-[10px] opacity-75",children:g==="indexeddb"?n?`Backend ready • ${o}ms`:"No backend connection":n?`${c?"Healthy":"Degraded"}${o?` • ${o}ms`:""}`:"Disconnected"})]})]})},dt=s=>i("p-4 border-t shrink-0",s.surface.highlight,s.border.default),ut="mb-3",ht="mb-4 flex items-center justify-between px-1",ft=s=>i("text-xs font-bold uppercase tracking-wide",s.text.tertiary),mt=(s,t)=>i("relative inline-flex h-5 w-9 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none",t?s.action.primary.bg:s.surface.active),gt=s=>i("pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",s?"translate-x-4":"translate-x-0"),xt=(s,t)=>i("w-full flex items-center p-2 rounded-lg transition-colors group mb-3 border shadow-sm",t?s.primary.light:s.surface.default,s.border.default,`hover:${s.surface.highlight}`),pt="mr-3",yt="text-left flex-1 min-w-0",bt=s=>i("text-xs font-bold truncate",s.text.primary),kt=s=>i("text--[10px] truncate font-medium",s.text.secondary),vt=s=>i("h-4 w-4 opacity-50",s.text.tertiary),Nt="grid grid-cols-2 gap-2",X=s=>i("h-8 px-2 text-xs font-medium rounded transition-colors flex items-center justify-center border",s.surface.default,s.border.default,s.text.secondary,`hover:${s.text.primary} hover:${s.surface.highlight}`),J="h-3.5 w-3.5 mr-1.5",Ct=({user:s,className:t})=>e.jsx("div",{className:i("rounded-full bg-blue-500 text-white flex items-center justify-center text-xs w-8 h-8",t),children:s?.name?.[0]||"U"}),jt=R.memo(function({currentUser:t,onSwitchUser:a,onNavigate:n,activeView:c}){const{theme:o}=B(),{isOrbitalEnabled:m,toggleOrbitalMode:g}=Ge();return e.jsxs("div",{className:dt(o),children:[e.jsx("div",{className:ut,title:"Real-time backend monitoring (updates every 30s)",children:e.jsx(ct,{variant:"compact",showLabel:!0,showPulse:!0})}),e.jsxs("div",{className:ht,children:[e.jsx("span",{className:ft(o),children:"Holographic Mode"}),e.jsx("button",{onClick:g,className:mt(o,m),title:m?"Windowed Interface":"Flat Interface",children:e.jsx("span",{className:gt(m)})})]}),e.jsxs("button",{onClick:()=>n(p.PROFILE),className:xt(o,c===p.PROFILE),children:[e.jsx(Ct,{user:t,className:pt}),e.jsxs("div",{className:yt,children:[e.jsx("p",{className:bt(o),children:t?.name||"Guest"}),e.jsx("p",{className:kt(o),children:t?.role||"User"})]}),e.jsx(ve,{className:vt(o)})]}),e.jsxs("div",{className:Nt,children:[e.jsxs("button",{onClick:()=>n(p.ADMIN),className:X(o),children:[e.jsx(Ne,{className:J})," Settings"]}),e.jsxs("button",{onClick:a,className:X(o),children:[e.jsx(Ce,{className:J})," Switch"]})]})]})}),Et=s=>i("h-16 flex items-center justify-between px-6 border-b shrink-0",s.surface.default,s.border.default),wt="flex items-center space-x-3",St=s=>i("p-1.5 rounded-lg shadow-sm border",s.primary.DEFAULT,s.primary.border),It="h-5 w-5 text-white",Tt="",At=s=>i("text-lg font-bold tracking-tight leading-none",s.text.primary),Rt=s=>i("text-[10px] uppercase tracking-widest font-bold mt-0.5 opacity-60",s.text.primary),Bt=s=>i("md:hidden p-1.5 rounded-md transition-colors",s.text.tertiary,`hover:${s.surface.highlight}`,`hover:${s.text.primary}`),Lt="h-5 w-5",Ot=R.memo(({onClose:s})=>{const{theme:t}=B(),{data:a}=Me(["admin","tenant"],E.admin.getTenantConfig,{initialData:{name:"LexiFlow",tier:"Enterprise Suite",version:"2.5",region:"US-East-1"}});return e.jsxs("div",{className:Et(t),children:[e.jsxs("div",{className:wt,children:[e.jsx("div",{className:St(t),children:e.jsx(je,{className:It})}),e.jsxs("div",{className:Tt,children:[e.jsx("h1",{className:At(t),children:a?.name}),e.jsx("p",{className:Rt(t),children:a?.tier})]})]}),e.jsx("button",{onClick:s,"aria-label":"Close sidebar",className:Bt(t),children:e.jsx(Y,{className:Lt})})]})});class Dt{modules=new Map;listeners=new Set;register(t){return this.modules.has(t.id)&&console.warn(`Module ${t.id} already registered. Overwriting.`),this.modules.set(t.id,t),this.notifyListeners(),this}registerBatch(t){t.forEach(a=>this.modules.set(a.id,a)),this.notifyListeners()}getModule(t){return this.modules.get(t)}getAllModules(){return Array.from(this.modules.values())}resolveIntent(t,a){if(this.modules.has(t))return t;for(const[n,c]of this.modules.entries())if(c.intentMatcher&&c.intentMatcher(t,a)||c.label.toLowerCase()===t.toLowerCase())return n;return null}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notifyListeners(){this.listeners.forEach(t=>t())}}const P=new Dt;function Mt({onHover:s,timeout:t=Le}){const a=u.useRef(null),n=u.useRef(s);u.useEffect(()=>{n.current=s},[s]);const c=u.useCallback(()=>{a.current&&(window.clearTimeout(a.current),a.current=null)},[]),o=u.useCallback(g=>{c(),a.current=window.setTimeout(()=>{n.current(g)},t)},[t,c]),m=u.useCallback(()=>{c()},[c]);return u.useEffect(()=>()=>c(),[c]),{onMouseEnter:o,onMouseLeave:m}}const Pt={[p.CASES]:{key:S.cases.all(),fn:()=>E.cases.getAll()},[p.MATTERS_OVERVIEW]:{key:S.cases.matters.all(),fn:()=>E.cases.getAll()},[p.MATTERS_CALENDAR]:{key:S.cases.matters.all(),fn:()=>E.cases.getAll()},[p.MATTERS_ANALYTICS]:{key:S.cases.matters.all(),fn:()=>E.cases.getAll()},[p.MATTERS_INTAKE]:{key:S.cases.matters.all(),fn:()=>E.cases.getAll()},[p.MATTERS_OPERATIONS]:{key:S.cases.matters.all(),fn:()=>E.cases.getAll()},[p.MATTERS_INSIGHTS]:{key:S.cases.matters.all(),fn:()=>E.cases.getAll()},[p.MATTERS_FINANCIALS]:{key:S.cases.matters.all(),fn:()=>E.cases.getAll()},[p.DOCKET]:{key:S.docket.all(),fn:()=>E.docket.getAll()},[p.DOCUMENTS]:{key:S.documents.all(),fn:()=>E.documents.getAll()},[p.WORKFLOWS]:{key:S.tasks.all(),fn:()=>E.tasks.getAll()},[p.BILLING]:{key:S.billing.timeEntries(),fn:()=>E.billing.getTimeEntries()},[p.EVIDENCE]:{key:S.evidence.all(),fn:()=>E.evidence.getAll()},[p.CRM]:{key:S.clients.all(),fn:()=>E.clients.getAll()}},Ht="flex-1 overflow-y-auto py-6 px-3 space-y-8 custom-scrollbar touch-auto",$t=s=>i("px-3 text-[10px] font-bold uppercase tracking-wider mb-2",s.text.tertiary),Ut="space-y-0.5",Ft=(s,t)=>i("w-full flex items-center space-x-3 px-3 h-9 rounded-lg text-sm font-medium transition-all duration-200 group relative",t?i(s.primary.light,s.action.primary.text):i(s.text.secondary,`hover:${s.surface.highlight}`,`hover:${s.text.primary}`)),Gt=s=>i("h-4 w-4 shrink-0 transition-colors",s?"":"opacity-70 group-hover:opacity-100"),Kt="truncate",Vt=s=>i("absolute left-0 top-1/2 -translate-y-1/2 w-1 h-5 rounded-r-full",s.action.primary.bg),Yt=s=>i("ml-4 mt-1 space-y-0.5 border-l-2 pl-2",s.border.default),_t=(s,t)=>i("w-full flex items-center space-x-2 px-2 h-8 rounded text-xs font-medium transition-all duration-200 group",t?i(s.primary.light,s.action.primary.text):i(s.text.tertiary,`hover:${s.surface.highlight}`,`hover:${s.text.primary}`)),Wt=s=>i("h-3.5 w-3.5 shrink-0",s?"":"opacity-60"),qt="truncate",zt=({activeView:s,setActiveView:t,currentUserRole:a})=>{const{theme:n}=B(),[c,o]=u.useState([]);u.useEffect(()=>{o(P.getAllModules());const h=P.subscribe(()=>o(P.getAllModules()));return()=>{h()}},[]);const m=u.useMemo(()=>{const h=a==="Administrator"||a==="Senior Partner";return c.filter(x=>x.hidden?!1:!(x.requiresAdmin&&!h))},[a,c]),g=u.useMemo(()=>{const h={};return["Main","Case Work","Litigation Tools","Operations","Knowledge","Admin"].forEach(d=>{h[d]=[]}),m.forEach(d=>{h[d.category]&&h[d.category].push(d)}),h},[m]),{onMouseEnter:l,onMouseLeave:y}=Mt({onHover:h=>{Ye.defer(()=>{const x=h.component;x?.preload&&typeof x.preload=="function"&&x.preload();const d=Pt[h.id];d&&Pe.fetch(d.key,d.fn,12e4)},"background")},timeout:350});return e.jsx("nav",{className:Ht,children:Object.keys(g).map(h=>{const x=g[h];return!x||x.length===0?null:e.jsxs("div",{children:[e.jsx("h3",{className:$t(n),children:h}),e.jsx("div",{className:Ut,children:x.map(d=>{if(!d.icon)return null;const k=d.icon,C=s===d.id,v=d.children?.some(N=>N.id===s);return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>t(d.id),onMouseEnter:()=>l(d),onMouseLeave:y,className:Ft(n,!!(C||v)),children:[e.jsx(k,{className:Gt(!!(C||v))}),e.jsx("span",{className:Kt,children:d.label}),(C||v)&&e.jsx("div",{className:Vt(n)})]}),d.children&&d.children.length>0&&(C||v)&&e.jsx("div",{className:Yt(n),children:d.children.map(N=>{const j=N.icon,I=s===N.id;return e.jsxs("button",{onClick:()=>t(N.id),className:_t(n,I),children:[j&&e.jsx(j,{className:Wt(I)}),e.jsx("span",{className:qt,children:N.label})]},N.id)})})]},d.id)})})]},h)})})},Qt=R.memo(({activeView:s,setActiveView:t,isOpen:a,onClose:n,currentUser:c,onSwitchUser:o})=>{const{theme:m}=B();return e.jsxs(e.Fragment,{children:[a&&e.jsx("div",{className:i("fixed inset-0 backdrop-blur-sm z-40 md:hidden transition-opacity",m.backdrop),onClick:n}),e.jsxs("aside",{className:i("fixed inset-y-0 left-0 z-50 w-72 flex flex-col h-full border-r transform transition-transform duration-300 ease-in-out shadow-2xl md:shadow-none touch-pan-y",m.surface.default,m.border.default,a?"translate-x-0":"-translate-x-full md:translate-x-0 md:static md:inset-auto"),children:[e.jsx(Ot,{onClose:n}),e.jsx(zt,{activeView:s,setActiveView:g=>{t(g),window.innerWidth<768&&n()},currentUserRole:c?.role||"user"}),c&&e.jsx(jt,{currentUser:c,onSwitchUser:o,onNavigate:t,activeView:s})]})]})});function bs({}){return[{title:"LexiFlow AI Legal Suite"}]}const ks=Ee(function(){const t=Se(),a=Ie(),{caseId:n}=Te(),{isSidebarOpen:c,toggleSidebar:o,currentUser:m,globalSearch:g,updateSearch:l,switchUser:y,isAppLoading:h,appStatusMessage:x}=We(),d=u.useMemo(()=>t.pathname.split("/")[1]||"dashboard",[t.pathname]),k=u.useCallback(()=>{y(0)},[y]),C=u.useCallback(w=>{a(`/${w}`)},[a]),v=u.useCallback(()=>{o()},[o]),N=u.useCallback(w=>{a(`/cases/${w.id}`)},[a]),j=u.useCallback(w=>{console.log("Neural command:",w)},[]),I=u.useCallback(()=>{},[]),A=u.useCallback(()=>{a("/")},[a]);return h||!m?e.jsx("div",{className:"h-screen w-screen overflow-hidden",role:"status","aria-label":x||"Loading application",children:e.jsx(_e,{message:x})}):e.jsxs(Oe,{activeView:d,onNavigate:C,selectedCaseId:n||null,sidebar:e.jsx(D,{scope:"Sidebar",children:e.jsx(Qt,{activeView:d,setActiveView:C,isOpen:c,onClose:v,currentUser:m,onSwitchUser:k})}),headerContent:e.jsx(D,{scope:"Header",children:e.jsx(nt,{onToggleSidebar:v,globalSearch:g,setGlobalSearch:l,onGlobalSearch:I,currentUser:m,onSwitchUser:k,onSearchResultClick:N,onNeuralCommand:j})}),children:[e.jsx(it,{onToggleCommand:()=>l(""),onNavigate:C}),e.jsx(D,{scope:"MainContent",onReset:A,children:e.jsx(Ae,{})})]})}),vs=we(function({error:t}){return console.error("Layout Error Boundary:",t),e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 p-8 dark:bg-gray-900",children:e.jsxs("div",{className:"w-full max-w-md rounded-lg border border-red-200 bg-white p-6 shadow-lg dark:border-red-800 dark:bg-gray-800",children:[e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"rounded-full bg-red-100 p-2 dark:bg-red-900/20",children:e.jsx("svg",{className:"h-6 w-6 text-red-600 dark:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"Page Error"})]}),e.jsx("p",{className:"mb-4 text-gray-600 dark:text-gray-400",children:"An error occurred while loading this page. Please try again."}),t instanceof Error&&e.jsxs("details",{className:"mb-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300",children:"Error Details"}),e.jsx("pre",{className:"mt-2 overflow-auto rounded bg-gray-100 p-3 text-xs text-gray-800 dark:bg-gray-900 dark:text-gray-200",children:t.message})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>window.location.reload(),className:"flex-1 rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",children:"Refresh"}),e.jsx("a",{href:"/",className:"flex-1 rounded-md bg-blue-600 px-4 py-2 text-center text-sm font-medium text-white hover:bg-blue-700",children:"Go to Dashboard"})]})]})})});export{vs as ErrorBoundary,ks as default,bs as meta};
