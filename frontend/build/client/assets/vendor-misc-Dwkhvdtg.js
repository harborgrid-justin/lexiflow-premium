import{r as z,j as In,c as hf}from"./vendor-core-V-oW58GW.js";import{g as Us}from"./vendor-charts-KZIdMATq.js";var _l={exports:{}},wl={};var Rm;function QE(){return Rm||(Rm=1,(function(n){function t(k,L){var H=k.length;k.push(L);t:for(;0<H;){var lt=H-1>>>1,et=k[lt];if(0<i(et,L))k[lt]=L,k[H]=et,H=lt;else break t}}function e(k){return k.length===0?null:k[0]}function s(k){if(k.length===0)return null;var L=k[0],H=k.pop();if(H!==L){k[0]=H;t:for(var lt=0,et=k.length,ft=et>>>1;lt<ft;){var Jt=2*(lt+1)-1,ve=k[Jt],Wt=Jt+1,yt=k[Wt];if(0>i(ve,H))Wt<et&&0>i(yt,ve)?(k[lt]=yt,k[Wt]=H,lt=Wt):(k[lt]=ve,k[Jt]=H,lt=Jt);else if(Wt<et&&0>i(yt,H))k[lt]=yt,k[Wt]=H,lt=Wt;else break t}}return L}function i(k,L){var H=k.sortIndex-L.sortIndex;return H!==0?H:k.id-L.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;n.unstable_now=function(){return r.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,h=null,d=3,f=!1,m=!1,p=!1,g=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(k){for(var L=e(l);L!==null;){if(L.callback===null)s(l);else if(L.startTime<=k)s(l),L.sortIndex=L.expirationTime,t(c,L);else break;L=e(l)}}function w(k){if(p=!1,b(k),!m)if(e(c)!==null)m=!0,$(v);else{var L=e(l);L!==null&&D(w,L.startTime-k)}}function v(k,L){m=!1,p&&(p=!1,y(T),T=-1),f=!0;var H=d;try{for(b(L),h=e(c);h!==null&&(!(h.expirationTime>L)||k&&!x());){var lt=h.callback;if(typeof lt=="function"){h.callback=null,d=h.priorityLevel;var et=lt(h.expirationTime<=L);L=n.unstable_now(),typeof et=="function"?h.callback=et:h===e(c)&&s(c),b(L)}else s(c);h=e(c)}if(h!==null)var ft=!0;else{var Jt=e(l);Jt!==null&&D(w,Jt.startTime-L),ft=!1}return ft}finally{h=null,d=H,f=!1}}var A=!1,S=null,T=-1,E=5,P=-1;function x(){return!(n.unstable_now()-P<E)}function I(){if(S!==null){var k=n.unstable_now();P=k;var L=!0;try{L=S(!0,k)}finally{L?V():(A=!1,S=null)}}else A=!1}var V;if(typeof _=="function")V=function(){_(I)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,st=X.port2;X.port1.onmessage=I,V=function(){st.postMessage(null)}}else V=function(){g(I,0)};function $(k){S=k,A||(A=!0,V())}function D(k,L){T=g(function(){k(n.unstable_now())},L)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(k){k.callback=null},n.unstable_continueExecution=function(){m||f||(m=!0,$(v))},n.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<k?Math.floor(1e3/k):5},n.unstable_getCurrentPriorityLevel=function(){return d},n.unstable_getFirstCallbackNode=function(){return e(c)},n.unstable_next=function(k){switch(d){case 1:case 2:case 3:var L=3;break;default:L=d}var H=d;d=L;try{return k()}finally{d=H}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(k,L){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var H=d;d=k;try{return L()}finally{d=H}},n.unstable_scheduleCallback=function(k,L,H){var lt=n.unstable_now();switch(typeof H=="object"&&H!==null?(H=H.delay,H=typeof H=="number"&&0<H?lt+H:lt):H=lt,k){case 1:var et=-1;break;case 2:et=250;break;case 5:et=1073741823;break;case 4:et=1e4;break;default:et=5e3}return et=H+et,k={id:u++,callback:L,priorityLevel:k,startTime:H,expirationTime:et,sortIndex:-1},H>lt?(k.sortIndex=H,t(l,k),e(c)===null&&k===e(l)&&(p?(y(T),T=-1):p=!0,D(w,H-lt))):(k.sortIndex=et,t(c,k),m||f||(m=!0,$(v))),k},n.unstable_shouldYield=x,n.unstable_wrapCallback=function(k){var L=d;return function(){var H=d;d=L;try{return k.apply(this,arguments)}finally{d=H}}}})(wl)),wl}var Om;function MH(){return Om||(Om=1,_l.exports=QE()),_l.exports}var Dm;(function(n){n.STRING="string",n.NUMBER="number",n.INTEGER="integer",n.BOOLEAN="boolean",n.ARRAY="array",n.OBJECT="object"})(Dm||(Dm={}));var Im;(function(n){n.LANGUAGE_UNSPECIFIED="language_unspecified",n.PYTHON="python"})(Im||(Im={}));var Lm;(function(n){n.OUTCOME_UNSPECIFIED="outcome_unspecified",n.OUTCOME_OK="outcome_ok",n.OUTCOME_FAILED="outcome_failed",n.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Lm||(Lm={}));const Nm=["user","model","function","system"];var Fm;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(Fm||(Fm={}));var Bm;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(Bm||(Bm={}));var $m;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})($m||($m={}));var Um;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER"})(Um||(Um={}));var _r;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.OTHER="OTHER"})(_r||(_r={}));var jm;(function(n){n.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",n.RETRIEVAL_QUERY="RETRIEVAL_QUERY",n.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",n.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",n.CLASSIFICATION="CLASSIFICATION",n.CLUSTERING="CLUSTERING"})(jm||(jm={}));var zm;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(zm||(zm={}));var Vm;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(Vm||(Vm={}));class he extends Error{constructor(t){super(`[GoogleGenerativeAI Error]: ${t}`)}}class Gs extends he{constructor(t,e){super(t),this.response=e}}class mw extends he{constructor(t,e,s,i){super(t),this.status=e,this.statusText=s,this.errorDetails=i}}class Zn extends he{}class gw extends he{}const tx="https://generativelanguage.googleapis.com",ex="v1beta",nx="0.24.1",sx="genai-js";var Ms;(function(n){n.GENERATE_CONTENT="generateContent",n.STREAM_GENERATE_CONTENT="streamGenerateContent",n.COUNT_TOKENS="countTokens",n.EMBED_CONTENT="embedContent",n.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Ms||(Ms={}));class ix{constructor(t,e,s,i,r){this.model=t,this.task=e,this.apiKey=s,this.stream=i,this.requestOptions=r}toString(){var t,e;const s=((t=this.requestOptions)===null||t===void 0?void 0:t.apiVersion)||ex;let r=`${((e=this.requestOptions)===null||e===void 0?void 0:e.baseUrl)||tx}/${s}/${this.model}:${this.task}`;return this.stream&&(r+="?alt=sse"),r}}function rx(n){const t=[];return n?.apiClient&&t.push(n.apiClient),t.push(`${sx}/${nx}`),t.join(" ")}async function ox(n){var t;const e=new Headers;e.append("Content-Type","application/json"),e.append("x-goog-api-client",rx(n.requestOptions)),e.append("x-goog-api-key",n.apiKey);let s=(t=n.requestOptions)===null||t===void 0?void 0:t.customHeaders;if(s){if(!(s instanceof Headers))try{s=new Headers(s)}catch(i){throw new Zn(`unable to convert customHeaders value ${JSON.stringify(s)} to Headers: ${i.message}`)}for(const[i,r]of s.entries()){if(i==="x-goog-api-key")throw new Zn(`Cannot set reserved header name ${i}`);if(i==="x-goog-api-client")throw new Zn(`Header name ${i} can only be set using the apiClient field`);e.append(i,r)}}return e}async function ax(n,t,e,s,i,r){const o=new ix(n,t,e,s,r);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},hx(r)),{method:"POST",headers:await ox(o),body:i})}}async function no(n,t,e,s,i,r={},o=fetch){const{url:a,fetchOptions:c}=await ax(n,t,e,s,i,r);return cx(a,c,o)}async function cx(n,t,e=fetch){let s;try{s=await e(n,t)}catch(i){lx(i,n)}return s.ok||await ux(s,n),s}function lx(n,t){let e=n;throw e.name==="AbortError"?(e=new gw(`Request aborted when fetching ${t.toString()}: ${n.message}`),e.stack=n.stack):n instanceof mw||n instanceof Zn||(e=new he(`Error fetching from ${t.toString()}: ${n.message}`),e.stack=n.stack),e}async function ux(n,t){let e="",s;try{const i=await n.json();e=i.error.message,i.error.details&&(e+=` ${JSON.stringify(i.error.details)}`,s=i.error.details)}catch{}throw new mw(`Error fetching from ${t.toString()}: [${n.status} ${n.statusText}] ${e}`,n.status,n.statusText,s)}function hx(n){const t={};if(n?.signal!==void 0||n?.timeout>=0){const e=new AbortController;n?.timeout>=0&&setTimeout(()=>e.abort(),n.timeout),n?.signal&&n.signal.addEventListener("abort",()=>{e.abort()}),t.signal=e.signal}return t}function df(n){return n.text=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),la(n.candidates[0]))throw new Gs(`${Gn(n)}`,n);return dx(n)}else if(n.promptFeedback)throw new Gs(`Text not available. ${Gn(n)}`,n);return""},n.functionCall=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),la(n.candidates[0]))throw new Gs(`${Gn(n)}`,n);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Hm(n)[0]}else if(n.promptFeedback)throw new Gs(`Function call not available. ${Gn(n)}`,n)},n.functionCalls=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),la(n.candidates[0]))throw new Gs(`${Gn(n)}`,n);return Hm(n)}else if(n.promptFeedback)throw new Gs(`Function call not available. ${Gn(n)}`,n)},n}function dx(n){var t,e,s,i;const r=[];if(!((e=(t=n.candidates)===null||t===void 0?void 0:t[0].content)===null||e===void 0)&&e.parts)for(const o of(i=(s=n.candidates)===null||s===void 0?void 0:s[0].content)===null||i===void 0?void 0:i.parts)o.text&&r.push(o.text),o.executableCode&&r.push("\n```"+o.executableCode.language+`
`+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&r.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return r.length>0?r.join(""):""}function Hm(n){var t,e,s,i;const r=[];if(!((e=(t=n.candidates)===null||t===void 0?void 0:t[0].content)===null||e===void 0)&&e.parts)for(const o of(i=(s=n.candidates)===null||s===void 0?void 0:s[0].content)===null||i===void 0?void 0:i.parts)o.functionCall&&r.push(o.functionCall);if(r.length>0)return r}const fx=[_r.RECITATION,_r.SAFETY,_r.LANGUAGE];function la(n){return!!n.finishReason&&fx.includes(n.finishReason)}function Gn(n){var t,e,s;let i="";if((!n.candidates||n.candidates.length===0)&&n.promptFeedback)i+="Response was blocked",!((t=n.promptFeedback)===null||t===void 0)&&t.blockReason&&(i+=` due to ${n.promptFeedback.blockReason}`),!((e=n.promptFeedback)===null||e===void 0)&&e.blockReasonMessage&&(i+=`: ${n.promptFeedback.blockReasonMessage}`);else if(!((s=n.candidates)===null||s===void 0)&&s[0]){const r=n.candidates[0];la(r)&&(i+=`Candidate was blocked due to ${r.finishReason}`,r.finishMessage&&(i+=`: ${r.finishMessage}`))}return i}function kr(n){return this instanceof kr?(this.v=n,this):new kr(n)}function px(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=e.apply(n,t||[]),i,r=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(d){s[d]&&(i[d]=function(f){return new Promise(function(m,p){r.push([d,f,m,p])>1||a(d,f)})})}function a(d,f){try{c(s[d](f))}catch(m){h(r[0][3],m)}}function c(d){d.value instanceof kr?Promise.resolve(d.value.v).then(l,u):h(r[0][2],d)}function l(d){a("next",d)}function u(d){a("throw",d)}function h(d,f){d(f),r.shift(),r.length&&a(r[0][0],r[0][1])}}const qm=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function mx(n){const t=n.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),e=bx(t),[s,i]=e.tee();return{stream:yx(s),response:gx(i)}}async function gx(n){const t=[],e=n.getReader();for(;;){const{done:s,value:i}=await e.read();if(s)return df(_x(t));t.push(i)}}function yx(n){return px(this,arguments,function*(){const e=n.getReader();for(;;){const{value:s,done:i}=yield kr(e.read());if(i)break;yield yield kr(df(s))}})}function bx(n){const t=n.getReader();return new ReadableStream({start(s){let i="";return r();function r(){return t.read().then(({value:o,done:a})=>{if(a){if(i.trim()){s.error(new he("Failed to parse stream"));return}s.close();return}i+=o;let c=i.match(qm),l;for(;c;){try{l=JSON.parse(c[1])}catch{s.error(new he(`Error parsing JSON response: "${c[1]}"`));return}s.enqueue(l),i=i.substring(c[0].length),c=i.match(qm)}return r()}).catch(o=>{let a=o;throw a.stack=o.stack,a.name==="AbortError"?a=new gw("Request aborted when reading from the stream"):a=new he("Error reading from the stream"),a})}}})}function _x(n){const t=n[n.length-1],e={promptFeedback:t?.promptFeedback};for(const s of n){if(s.candidates){let i=0;for(const r of s.candidates)if(e.candidates||(e.candidates=[]),e.candidates[i]||(e.candidates[i]={index:i}),e.candidates[i].citationMetadata=r.citationMetadata,e.candidates[i].groundingMetadata=r.groundingMetadata,e.candidates[i].finishReason=r.finishReason,e.candidates[i].finishMessage=r.finishMessage,e.candidates[i].safetyRatings=r.safetyRatings,r.content&&r.content.parts){e.candidates[i].content||(e.candidates[i].content={role:r.content.role||"user",parts:[]});const o={};for(const a of r.content.parts)a.text&&(o.text=a.text),a.functionCall&&(o.functionCall=a.functionCall),a.executableCode&&(o.executableCode=a.executableCode),a.codeExecutionResult&&(o.codeExecutionResult=a.codeExecutionResult),Object.keys(o).length===0&&(o.text=""),e.candidates[i].content.parts.push(o)}i++}s.usageMetadata&&(e.usageMetadata=s.usageMetadata)}return e}async function yw(n,t,e,s){const i=await no(t,Ms.STREAM_GENERATE_CONTENT,n,!0,JSON.stringify(e),s);return mx(i)}async function bw(n,t,e,s){const r=await(await no(t,Ms.GENERATE_CONTENT,n,!1,JSON.stringify(e),s)).json();return{response:df(r)}}function _w(n){if(n!=null){if(typeof n=="string")return{role:"system",parts:[{text:n}]};if(n.text)return{role:"system",parts:[n]};if(n.parts)return n.role?n:{role:"system",parts:n.parts}}}function Mr(n){let t=[];if(typeof n=="string")t=[{text:n}];else for(const e of n)typeof e=="string"?t.push({text:e}):t.push(e);return wx(t)}function wx(n){const t={role:"user",parts:[]},e={role:"function",parts:[]};let s=!1,i=!1;for(const r of n)"functionResponse"in r?(e.parts.push(r),i=!0):(t.parts.push(r),s=!0);if(s&&i)throw new he("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!s&&!i)throw new he("No content is provided for sending chat message.");return s?t:e}function vx(n,t){var e;let s={model:t?.model,generationConfig:t?.generationConfig,safetySettings:t?.safetySettings,tools:t?.tools,toolConfig:t?.toolConfig,systemInstruction:t?.systemInstruction,cachedContent:(e=t?.cachedContent)===null||e===void 0?void 0:e.name,contents:[]};const i=n.generateContentRequest!=null;if(n.contents){if(i)throw new Zn("CountTokensRequest must have one of contents or generateContentRequest, not both.");s.contents=n.contents}else if(i)s=Object.assign(Object.assign({},s),n.generateContentRequest);else{const r=Mr(n);s.contents=[r]}return{generateContentRequest:s}}function Wm(n){let t;return n.contents?t=n:t={contents:[Mr(n)]},n.systemInstruction&&(t.systemInstruction=_w(n.systemInstruction)),t}function Ax(n){return typeof n=="string"||Array.isArray(n)?{content:Mr(n)}:n}const Gm=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Sx={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Tx(n){let t=!1;for(const e of n){const{role:s,parts:i}=e;if(!t&&s!=="user")throw new he(`First content should be with role 'user', got ${s}`);if(!Nm.includes(s))throw new he(`Each item should include role field. Got ${s} but valid roles are: ${JSON.stringify(Nm)}`);if(!Array.isArray(i))throw new he("Content should have 'parts' property with an array of Parts");if(i.length===0)throw new he("Each Content should have at least one part");const r={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const a of i)for(const c of Gm)c in a&&(r[c]+=1);const o=Sx[s];for(const a of Gm)if(!o.includes(a)&&r[a]>0)throw new he(`Content with role '${s}' can't contain '${a}' part`);t=!0}}function Ym(n){var t;if(n.candidates===void 0||n.candidates.length===0)return!1;const e=(t=n.candidates[0])===null||t===void 0?void 0:t.content;if(e===void 0||e.parts===void 0||e.parts.length===0)return!1;for(const s of e.parts)if(s===void 0||Object.keys(s).length===0||s.text!==void 0&&s.text==="")return!1;return!0}const Xm="SILENT_ERROR";class Ex{constructor(t,e,s,i={}){this.model=e,this.params=s,this._requestOptions=i,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=t,s?.history&&(Tx(s.history),this._history=s.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(t,e={}){var s,i,r,o,a,c;await this._sendPromise;const l=Mr(t),u={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,l]},h=Object.assign(Object.assign({},this._requestOptions),e);let d;return this._sendPromise=this._sendPromise.then(()=>bw(this._apiKey,this.model,u,h)).then(f=>{var m;if(Ym(f.response)){this._history.push(l);const p=Object.assign({parts:[],role:"model"},(m=f.response.candidates)===null||m===void 0?void 0:m[0].content);this._history.push(p)}else{const p=Gn(f.response);p&&console.warn(`sendMessage() was unsuccessful. ${p}. Inspect response object for details.`)}d=f}).catch(f=>{throw this._sendPromise=Promise.resolve(),f}),await this._sendPromise,d}async sendMessageStream(t,e={}){var s,i,r,o,a,c;await this._sendPromise;const l=Mr(t),u={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,l]},h=Object.assign(Object.assign({},this._requestOptions),e),d=yw(this._apiKey,this.model,u,h);return this._sendPromise=this._sendPromise.then(()=>d).catch(f=>{throw new Error(Xm)}).then(f=>f.response).then(f=>{if(Ym(f)){this._history.push(l);const m=Object.assign({},f.candidates[0].content);m.role||(m.role="model"),this._history.push(m)}else{const m=Gn(f);m&&console.warn(`sendMessageStream() was unsuccessful. ${m}. Inspect response object for details.`)}}).catch(f=>{f.message!==Xm&&console.error(f)}),d}}async function xx(n,t,e,s){return(await no(t,Ms.COUNT_TOKENS,n,!1,JSON.stringify(e),s)).json()}async function Cx(n,t,e,s){return(await no(t,Ms.EMBED_CONTENT,n,!1,JSON.stringify(e),s)).json()}async function Px(n,t,e,s){const i=e.requests.map(o=>Object.assign(Object.assign({},o),{model:t}));return(await no(t,Ms.BATCH_EMBED_CONTENTS,n,!1,JSON.stringify({requests:i}),s)).json()}class Km{constructor(t,e,s={}){this.apiKey=t,this._requestOptions=s,e.model.includes("/")?this.model=e.model:this.model=`models/${e.model}`,this.generationConfig=e.generationConfig||{},this.safetySettings=e.safetySettings||[],this.tools=e.tools,this.toolConfig=e.toolConfig,this.systemInstruction=_w(e.systemInstruction),this.cachedContent=e.cachedContent}async generateContent(t,e={}){var s;const i=Wm(t),r=Object.assign(Object.assign({},this._requestOptions),e);return bw(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},i),r)}async generateContentStream(t,e={}){var s;const i=Wm(t),r=Object.assign(Object.assign({},this._requestOptions),e);return yw(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},i),r)}startChat(t){var e;return new Ex(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(e=this.cachedContent)===null||e===void 0?void 0:e.name},t),this._requestOptions)}async countTokens(t,e={}){const s=vx(t,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),i=Object.assign(Object.assign({},this._requestOptions),e);return xx(this.apiKey,this.model,s,i)}async embedContent(t,e={}){const s=Ax(t),i=Object.assign(Object.assign({},this._requestOptions),e);return Cx(this.apiKey,this.model,s,i)}async batchEmbedContents(t,e={}){const s=Object.assign(Object.assign({},this._requestOptions),e);return Px(this.apiKey,this.model,t,s)}}class RH{constructor(t){this.apiKey=t}getGenerativeModel(t,e){if(!t.model)throw new he("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Km(this.apiKey,t,e)}getGenerativeModelFromCachedContent(t,e,s){if(!t.name)throw new Zn("Cached content must contain a `name` field.");if(!t.model)throw new Zn("Cached content must contain a `model` field.");const i=["model","systemInstruction"];for(const o of i)if(e?.[o]&&t[o]&&e?.[o]!==t[o]){if(o==="model"){const a=e.model.startsWith("models/")?e.model.replace("models/",""):e.model,c=t.model.startsWith("models/")?t.model.replace("models/",""):t.model;if(a===c)continue}throw new Zn(`Different value for "${o}" specified in modelParams (${e[o]}) and cachedContent (${t[o]})`)}const r=Object.assign(Object.assign({},e),{model:t.model,tools:t.tools,toolConfig:t.toolConfig,systemInstruction:t.systemInstruction,cachedContent:t});return new Km(this.apiKey,r,s)}}const ff=z.createContext({});function pf(n){const t=z.useRef(null);return t.current===null&&(t.current=n()),t.current}const mf=typeof window<"u",ww=mf?z.useLayoutEffect:z.useEffect,Cc=z.createContext(null);function gf(n,t){n.indexOf(t)===-1&&n.push(t)}function yf(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}const Nn=(n,t,e)=>e>t?t:e<n?n:e;let bf=()=>{};const Fn={},vw=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n);function Aw(n){return typeof n=="object"&&n!==null}const Sw=n=>/^0[^.\s]+$/u.test(n);function _f(n){let t;return()=>(t===void 0&&(t=n()),t)}const Xe=n=>n,kx=(n,t)=>e=>t(n(e)),so=(...n)=>n.reduce(kx),Rr=(n,t,e)=>{const s=t-n;return s===0?1:(e-n)/s};class wf{constructor(){this.subscriptions=[]}add(t){return gf(this.subscriptions,t),()=>yf(this.subscriptions,t)}notify(t,e,s){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](t,e,s);else for(let r=0;r<i;r++){const o=this.subscriptions[r];o&&o(t,e,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const _n=n=>n*1e3,We=n=>n/1e3;function Tw(n,t){return t?n*(1e3/t):0}const Ew=(n,t,e)=>(((1-3*e+3*t)*n+(3*e-6*t))*n+3*t)*n,Mx=1e-7,Rx=12;function Ox(n,t,e,s,i){let r,o,a=0;do o=t+(e-t)/2,r=Ew(o,s,i)-n,r>0?e=o:t=o;while(Math.abs(r)>Mx&&++a<Rx);return o}function io(n,t,e,s){if(n===t&&e===s)return Xe;const i=r=>Ox(r,0,1,n,e);return r=>r===0||r===1?r:Ew(i(r),t,s)}const xw=n=>t=>t<=.5?n(2*t)/2:(2-n(2*(1-t)))/2,Cw=n=>t=>1-n(1-t),Pw=io(.33,1.53,.69,.99),vf=Cw(Pw),kw=xw(vf),Mw=n=>(n*=2)<1?.5*vf(n):.5*(2-Math.pow(2,-10*(n-1))),Af=n=>1-Math.sin(Math.acos(n)),Rw=Cw(Af),Ow=xw(Af),Dx=io(.42,0,1,1),Ix=io(0,0,.58,1),Dw=io(.42,0,.58,1),Lx=n=>Array.isArray(n)&&typeof n[0]!="number",Iw=n=>Array.isArray(n)&&typeof n[0]=="number",Nx={linear:Xe,easeIn:Dx,easeInOut:Dw,easeOut:Ix,circIn:Af,circInOut:Ow,circOut:Rw,backIn:vf,backInOut:kw,backOut:Pw,anticipate:Mw},Fx=n=>typeof n=="string",Zm=n=>{if(Iw(n)){bf(n.length===4);const[t,e,s,i]=n;return io(t,e,s,i)}else if(Fx(n))return Nx[n];return n},Co=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Bx(n,t){let e=new Set,s=new Set,i=!1,r=!1;const o=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function c(u){o.has(u)&&(l.schedule(u),n()),u(a)}const l={schedule:(u,h=!1,d=!1)=>{const m=d&&i?e:s;return h&&o.add(u),m.has(u)||m.add(u),u},cancel:u=>{s.delete(u),o.delete(u)},process:u=>{if(a=u,i){r=!0;return}i=!0,[e,s]=[s,e],e.forEach(c),e.clear(),i=!1,r&&(r=!1,l.process(u))}};return l}const $x=40;function Lw(n,t){let e=!1,s=!0;const i={delta:0,timestamp:0,isProcessing:!1},r=()=>e=!0,o=Co.reduce((b,w)=>(b[w]=Bx(r),b),{}),{setup:a,read:c,resolveKeyframes:l,preUpdate:u,update:h,preRender:d,render:f,postRender:m}=o,p=()=>{const b=Fn.useManualTiming?i.timestamp:performance.now();e=!1,Fn.useManualTiming||(i.delta=s?1e3/60:Math.max(Math.min(b-i.timestamp,$x),1)),i.timestamp=b,i.isProcessing=!0,a.process(i),c.process(i),l.process(i),u.process(i),h.process(i),d.process(i),f.process(i),m.process(i),i.isProcessing=!1,e&&t&&(s=!1,n(p))},g=()=>{e=!0,s=!0,i.isProcessing||n(p)};return{schedule:Co.reduce((b,w)=>{const v=o[w];return b[w]=(A,S=!1,T=!1)=>(e||g(),v.schedule(A,S,T)),b},{}),cancel:b=>{for(let w=0;w<Co.length;w++)o[Co[w]].cancel(b)},state:i,steps:o}}const{schedule:Tt,cancel:ts,state:ie,steps:vl}=Lw(typeof requestAnimationFrame<"u"?requestAnimationFrame:Xe,!0);let ua;function Ux(){ua=void 0}const Ee={now:()=>(ua===void 0&&Ee.set(ie.isProcessing||Fn.useManualTiming?ie.timestamp:performance.now()),ua),set:n=>{ua=n,queueMicrotask(Ux)}},Nw=n=>t=>typeof t=="string"&&t.startsWith(n),Fw=Nw("--"),jx=Nw("var(--"),Sf=n=>jx(n)?zx.test(n.split("/*")[0].trim()):!1,zx=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Di={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},Or={...Di,transform:n=>Nn(0,1,n)},Po={...Di,default:1},wr=n=>Math.round(n*1e5)/1e5,Tf=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Vx(n){return n==null}const Hx=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Ef=(n,t)=>e=>!!(typeof e=="string"&&Hx.test(e)&&e.startsWith(n)||t&&!Vx(e)&&Object.prototype.hasOwnProperty.call(e,t)),Bw=(n,t,e)=>s=>{if(typeof s!="string")return s;const[i,r,o,a]=s.match(Tf);return{[n]:parseFloat(i),[t]:parseFloat(r),[e]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},qx=n=>Nn(0,255,n),Al={...Di,transform:n=>Math.round(qx(n))},bs={test:Ef("rgb","red"),parse:Bw("red","green","blue"),transform:({red:n,green:t,blue:e,alpha:s=1})=>"rgba("+Al.transform(n)+", "+Al.transform(t)+", "+Al.transform(e)+", "+wr(Or.transform(s))+")"};function Wx(n){let t="",e="",s="",i="";return n.length>5?(t=n.substring(1,3),e=n.substring(3,5),s=n.substring(5,7),i=n.substring(7,9)):(t=n.substring(1,2),e=n.substring(2,3),s=n.substring(3,4),i=n.substring(4,5),t+=t,e+=e,s+=s,i+=i),{red:parseInt(t,16),green:parseInt(e,16),blue:parseInt(s,16),alpha:i?parseInt(i,16)/255:1}}const Oh={test:Ef("#"),parse:Wx,transform:bs.transform},ro=n=>({test:t=>typeof t=="string"&&t.endsWith(n)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${n}`}),Wn=ro("deg"),wn=ro("%"),K=ro("px"),Gx=ro("vh"),Yx=ro("vw"),Jm={...wn,parse:n=>wn.parse(n)/100,transform:n=>wn.transform(n*100)},ai={test:Ef("hsl","hue"),parse:Bw("hue","saturation","lightness"),transform:({hue:n,saturation:t,lightness:e,alpha:s=1})=>"hsla("+Math.round(n)+", "+wn.transform(wr(t))+", "+wn.transform(wr(e))+", "+wr(Or.transform(s))+")"},Ft={test:n=>bs.test(n)||Oh.test(n)||ai.test(n),parse:n=>bs.test(n)?bs.parse(n):ai.test(n)?ai.parse(n):Oh.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?bs.transform(n):ai.transform(n),getAnimatableNone:n=>{const t=Ft.parse(n);return t.alpha=0,Ft.transform(t)}},Xx=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Kx(n){return isNaN(n)&&typeof n=="string"&&(n.match(Tf)?.length||0)+(n.match(Xx)?.length||0)>0}const $w="number",Uw="color",Zx="var",Jx="var(",Qm="${}",Qx=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Dr(n){const t=n.toString(),e=[],s={color:[],number:[],var:[]},i=[];let r=0;const a=t.replace(Qx,c=>(Ft.test(c)?(s.color.push(r),i.push(Uw),e.push(Ft.parse(c))):c.startsWith(Jx)?(s.var.push(r),i.push(Zx),e.push(c)):(s.number.push(r),i.push($w),e.push(parseFloat(c))),++r,Qm)).split(Qm);return{values:e,split:a,indexes:s,types:i}}function jw(n){return Dr(n).values}function zw(n){const{split:t,types:e}=Dr(n),s=t.length;return i=>{let r="";for(let o=0;o<s;o++)if(r+=t[o],i[o]!==void 0){const a=e[o];a===$w?r+=wr(i[o]):a===Uw?r+=Ft.transform(i[o]):r+=i[o]}return r}}const tC=n=>typeof n=="number"?0:Ft.test(n)?Ft.getAnimatableNone(n):n;function eC(n){const t=jw(n);return zw(n)(t.map(tC))}const es={test:Kx,parse:jw,createTransformer:zw,getAnimatableNone:eC};function Sl(n,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?n+(t-n)*6*e:e<1/2?t:e<2/3?n+(t-n)*(2/3-e)*6:n}function nC({hue:n,saturation:t,lightness:e,alpha:s}){n/=360,t/=100,e/=100;let i=0,r=0,o=0;if(!t)i=r=o=e;else{const a=e<.5?e*(1+t):e+t-e*t,c=2*e-a;i=Sl(c,a,n+1/3),r=Sl(c,a,n),o=Sl(c,a,n-1/3)}return{red:Math.round(i*255),green:Math.round(r*255),blue:Math.round(o*255),alpha:s}}function Ma(n,t){return e=>e>0?t:n}const Pt=(n,t,e)=>n+(t-n)*e,Tl=(n,t,e)=>{const s=n*n,i=e*(t*t-s)+s;return i<0?0:Math.sqrt(i)},sC=[Oh,bs,ai],iC=n=>sC.find(t=>t.test(n));function tg(n){const t=iC(n);if(!t)return!1;let e=t.parse(n);return t===ai&&(e=nC(e)),e}const eg=(n,t)=>{const e=tg(n),s=tg(t);if(!e||!s)return Ma(n,t);const i={...e};return r=>(i.red=Tl(e.red,s.red,r),i.green=Tl(e.green,s.green,r),i.blue=Tl(e.blue,s.blue,r),i.alpha=Pt(e.alpha,s.alpha,r),bs.transform(i))},Dh=new Set(["none","hidden"]);function rC(n,t){return Dh.has(n)?e=>e<=0?n:t:e=>e>=1?t:n}function oC(n,t){return e=>Pt(n,t,e)}function xf(n){return typeof n=="number"?oC:typeof n=="string"?Sf(n)?Ma:Ft.test(n)?eg:lC:Array.isArray(n)?Vw:typeof n=="object"?Ft.test(n)?eg:aC:Ma}function Vw(n,t){const e=[...n],s=e.length,i=n.map((r,o)=>xf(r)(r,t[o]));return r=>{for(let o=0;o<s;o++)e[o]=i[o](r);return e}}function aC(n,t){const e={...n,...t},s={};for(const i in e)n[i]!==void 0&&t[i]!==void 0&&(s[i]=xf(n[i])(n[i],t[i]));return i=>{for(const r in s)e[r]=s[r](i);return e}}function cC(n,t){const e=[],s={color:0,var:0,number:0};for(let i=0;i<t.values.length;i++){const r=t.types[i],o=n.indexes[r][s[r]],a=n.values[o]??0;e[i]=a,s[r]++}return e}const lC=(n,t)=>{const e=es.createTransformer(t),s=Dr(n),i=Dr(t);return s.indexes.var.length===i.indexes.var.length&&s.indexes.color.length===i.indexes.color.length&&s.indexes.number.length>=i.indexes.number.length?Dh.has(n)&&!i.values.length||Dh.has(t)&&!s.values.length?rC(n,t):so(Vw(cC(s,i),i.values),e):Ma(n,t)};function Hw(n,t,e){return typeof n=="number"&&typeof t=="number"&&typeof e=="number"?Pt(n,t,e):xf(n)(n,t)}const uC=n=>{const t=({timestamp:e})=>n(e);return{start:(e=!0)=>Tt.update(t,e),stop:()=>ts(t),now:()=>ie.isProcessing?ie.timestamp:Ee.now()}},qw=(n,t,e=10)=>{let s="";const i=Math.max(Math.round(t/e),2);for(let r=0;r<i;r++)s+=Math.round(n(r/(i-1))*1e4)/1e4+", ";return`linear(${s.substring(0,s.length-2)})`},Ra=2e4;function Cf(n){let t=0;const e=50;let s=n.next(t);for(;!s.done&&t<Ra;)t+=e,s=n.next(t);return t>=Ra?1/0:t}function hC(n,t=100,e){const s=e({...n,keyframes:[0,t]}),i=Math.min(Cf(s),Ra);return{type:"keyframes",ease:r=>s.next(i*r).value/t,duration:We(i)}}const dC=5;function Ww(n,t,e){const s=Math.max(t-dC,0);return Tw(e-n(s),t-s)}const Rt={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},El=.001;function fC({duration:n=Rt.duration,bounce:t=Rt.bounce,velocity:e=Rt.velocity,mass:s=Rt.mass}){let i,r,o=1-t;o=Nn(Rt.minDamping,Rt.maxDamping,o),n=Nn(Rt.minDuration,Rt.maxDuration,We(n)),o<1?(i=l=>{const u=l*o,h=u*n,d=u-e,f=Ih(l,o),m=Math.exp(-h);return El-d/f*m},r=l=>{const h=l*o*n,d=h*e+e,f=Math.pow(o,2)*Math.pow(l,2)*n,m=Math.exp(-h),p=Ih(Math.pow(l,2),o);return(-i(l)+El>0?-1:1)*((d-f)*m)/p}):(i=l=>{const u=Math.exp(-l*n),h=(l-e)*n+1;return-El+u*h},r=l=>{const u=Math.exp(-l*n),h=(e-l)*(n*n);return u*h});const a=5/n,c=mC(i,r,a);if(n=_n(n),isNaN(c))return{stiffness:Rt.stiffness,damping:Rt.damping,duration:n};{const l=Math.pow(c,2)*s;return{stiffness:l,damping:o*2*Math.sqrt(s*l),duration:n}}}const pC=12;function mC(n,t,e){let s=e;for(let i=1;i<pC;i++)s=s-n(s)/t(s);return s}function Ih(n,t){return n*Math.sqrt(1-t*t)}const gC=["duration","bounce"],yC=["stiffness","damping","mass"];function ng(n,t){return t.some(e=>n[e]!==void 0)}function bC(n){let t={velocity:Rt.velocity,stiffness:Rt.stiffness,damping:Rt.damping,mass:Rt.mass,isResolvedFromDuration:!1,...n};if(!ng(n,yC)&&ng(n,gC))if(n.visualDuration){const e=n.visualDuration,s=2*Math.PI/(e*1.2),i=s*s,r=2*Nn(.05,1,1-(n.bounce||0))*Math.sqrt(i);t={...t,mass:Rt.mass,stiffness:i,damping:r}}else{const e=fC(n);t={...t,...e,mass:Rt.mass},t.isResolvedFromDuration=!0}return t}function Oa(n=Rt.visualDuration,t=Rt.bounce){const e=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:t}:n;let{restSpeed:s,restDelta:i}=e;const r=e.keyframes[0],o=e.keyframes[e.keyframes.length-1],a={done:!1,value:r},{stiffness:c,damping:l,mass:u,duration:h,velocity:d,isResolvedFromDuration:f}=bC({...e,velocity:-We(e.velocity||0)}),m=d||0,p=l/(2*Math.sqrt(c*u)),g=o-r,y=We(Math.sqrt(c/u)),_=Math.abs(g)<5;s||(s=_?Rt.restSpeed.granular:Rt.restSpeed.default),i||(i=_?Rt.restDelta.granular:Rt.restDelta.default);let b;if(p<1){const v=Ih(y,p);b=A=>{const S=Math.exp(-p*y*A);return o-S*((m+p*y*g)/v*Math.sin(v*A)+g*Math.cos(v*A))}}else if(p===1)b=v=>o-Math.exp(-y*v)*(g+(m+y*g)*v);else{const v=y*Math.sqrt(p*p-1);b=A=>{const S=Math.exp(-p*y*A),T=Math.min(v*A,300);return o-S*((m+p*y*g)*Math.sinh(T)+v*g*Math.cosh(T))/v}}const w={calculatedDuration:f&&h||null,next:v=>{const A=b(v);if(f)a.done=v>=h;else{let S=v===0?m:0;p<1&&(S=v===0?_n(m):Ww(b,v,A));const T=Math.abs(S)<=s,E=Math.abs(o-A)<=i;a.done=T&&E}return a.value=a.done?o:A,a},toString:()=>{const v=Math.min(Cf(w),Ra),A=qw(S=>w.next(v*S).value,v,30);return v+"ms "+A},toTransition:()=>{}};return w}Oa.applyToOptions=n=>{const t=hC(n,100,Oa);return n.ease=t.ease,n.duration=_n(t.duration),n.type="keyframes",n};function Lh({keyframes:n,velocity:t=0,power:e=.8,timeConstant:s=325,bounceDamping:i=10,bounceStiffness:r=500,modifyTarget:o,min:a,max:c,restDelta:l=.5,restSpeed:u}){const h=n[0],d={done:!1,value:h},f=T=>a!==void 0&&T<a||c!==void 0&&T>c,m=T=>a===void 0?c:c===void 0||Math.abs(a-T)<Math.abs(c-T)?a:c;let p=e*t;const g=h+p,y=o===void 0?g:o(g);y!==g&&(p=y-h);const _=T=>-p*Math.exp(-T/s),b=T=>y+_(T),w=T=>{const E=_(T),P=b(T);d.done=Math.abs(E)<=l,d.value=d.done?y:P};let v,A;const S=T=>{f(d.value)&&(v=T,A=Oa({keyframes:[d.value,m(d.value)],velocity:Ww(b,T,d.value),damping:i,stiffness:r,restDelta:l,restSpeed:u}))};return S(0),{calculatedDuration:null,next:T=>{let E=!1;return!A&&v===void 0&&(E=!0,w(T),S(T)),v!==void 0&&T>=v?A.next(T-v):(!E&&w(T),d)}}}function _C(n,t,e){const s=[],i=e||Fn.mix||Hw,r=n.length-1;for(let o=0;o<r;o++){let a=i(n[o],n[o+1]);if(t){const c=Array.isArray(t)?t[o]||Xe:t;a=so(c,a)}s.push(a)}return s}function wC(n,t,{clamp:e=!0,ease:s,mixer:i}={}){const r=n.length;if(bf(r===t.length),r===1)return()=>t[0];if(r===2&&t[0]===t[1])return()=>t[1];const o=n[0]===n[1];n[0]>n[r-1]&&(n=[...n].reverse(),t=[...t].reverse());const a=_C(t,s,i),c=a.length,l=u=>{if(o&&u<n[0])return t[0];let h=0;if(c>1)for(;h<n.length-2&&!(u<n[h+1]);h++);const d=Rr(n[h],n[h+1],u);return a[h](d)};return e?u=>l(Nn(n[0],n[r-1],u)):l}function vC(n,t){const e=n[n.length-1];for(let s=1;s<=t;s++){const i=Rr(0,t,s);n.push(Pt(e,1,i))}}function AC(n){const t=[0];return vC(t,n.length-1),t}function SC(n,t){return n.map(e=>e*t)}function TC(n,t){return n.map(()=>t||Dw).splice(0,n.length-1)}function vr({duration:n=300,keyframes:t,times:e,ease:s="easeInOut"}){const i=Lx(s)?s.map(Zm):Zm(s),r={done:!1,value:t[0]},o=SC(e&&e.length===t.length?e:AC(t),n),a=wC(o,t,{ease:Array.isArray(i)?i:TC(t,i)});return{calculatedDuration:n,next:c=>(r.value=a(c),r.done=c>=n,r)}}const EC=n=>n!==null;function Pf(n,{repeat:t,repeatType:e="loop"},s,i=1){const r=n.filter(EC),a=i<0||t&&e!=="loop"&&t%2===1?0:r.length-1;return!a||s===void 0?r[a]:s}const xC={decay:Lh,inertia:Lh,tween:vr,keyframes:vr,spring:Oa};function Gw(n){typeof n.type=="string"&&(n.type=xC[n.type])}class kf{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,e){return this.finished.then(t,e)}}const CC=n=>n/100;class Mf extends kf{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:e}=this.options;e&&e.updatedAt!==Ee.now()&&this.tick(Ee.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;Gw(t);const{type:e=vr,repeat:s=0,repeatDelay:i=0,repeatType:r,velocity:o=0}=t;let{keyframes:a}=t;const c=e||vr;c!==vr&&typeof a[0]!="number"&&(this.mixKeyframes=so(CC,Hw(a[0],a[1])),a=[0,100]);const l=c({...t,keyframes:a});r==="mirror"&&(this.mirroredGenerator=c({...t,keyframes:[...a].reverse(),velocity:-o})),l.calculatedDuration===null&&(l.calculatedDuration=Cf(l));const{calculatedDuration:u}=l;this.calculatedDuration=u,this.resolvedDuration=u+i,this.totalDuration=this.resolvedDuration*(s+1)-i,this.generator=l}updateTime(t){const e=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=e}tick(t,e=!1){const{generator:s,totalDuration:i,mixKeyframes:r,mirroredGenerator:o,resolvedDuration:a,calculatedDuration:c}=this;if(this.startTime===null)return s.next(0);const{delay:l=0,keyframes:u,repeat:h,repeatType:d,repeatDelay:f,type:m,onUpdate:p,finalKeyframe:g}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-i/this.speed,this.startTime)),e?this.currentTime=t:this.updateTime(t);const y=this.currentTime-l*(this.playbackSpeed>=0?1:-1),_=this.playbackSpeed>=0?y<0:y>i;this.currentTime=Math.max(y,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=i);let b=this.currentTime,w=s;if(h){const T=Math.min(this.currentTime,i)/a;let E=Math.floor(T),P=T%1;!P&&T>=1&&(P=1),P===1&&E--,E=Math.min(E,h+1),E%2&&(d==="reverse"?(P=1-P,f&&(P-=f/a)):d==="mirror"&&(w=o)),b=Nn(0,1,P)*a}const v=_?{done:!1,value:u[0]}:w.next(b);r&&(v.value=r(v.value));let{done:A}=v;!_&&c!==null&&(A=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);const S=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&A);return S&&m!==Lh&&(v.value=Pf(u,this.options,g,this.speed)),p&&p(v.value),S&&this.finish(),v}then(t,e){return this.finished.then(t,e)}get duration(){return We(this.calculatedDuration)}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+We(t)}get time(){return We(this.currentTime)}set time(t){t=_n(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(Ee.now());const e=this.playbackSpeed!==t;this.playbackSpeed=t,e&&(this.time=We(this.currentTime))}play(){if(this.isStopped)return;const{driver:t=uC,startTime:e}=this.options;this.driver||(this.driver=t(i=>this.tick(i))),this.options.onPlay?.();const s=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=s):this.holdTime!==null?this.startTime=s-this.holdTime:this.startTime||(this.startTime=e??s),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Ee.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),t.observe(this)}}function PC(n){for(let t=1;t<n.length;t++)n[t]??(n[t]=n[t-1])}const _s=n=>n*180/Math.PI,Nh=n=>{const t=_s(Math.atan2(n[1],n[0]));return Fh(t)},kC={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:n=>(Math.abs(n[0])+Math.abs(n[3]))/2,rotate:Nh,rotateZ:Nh,skewX:n=>_s(Math.atan(n[1])),skewY:n=>_s(Math.atan(n[2])),skew:n=>(Math.abs(n[1])+Math.abs(n[2]))/2},Fh=n=>(n=n%360,n<0&&(n+=360),n),sg=Nh,ig=n=>Math.sqrt(n[0]*n[0]+n[1]*n[1]),rg=n=>Math.sqrt(n[4]*n[4]+n[5]*n[5]),MC={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:ig,scaleY:rg,scale:n=>(ig(n)+rg(n))/2,rotateX:n=>Fh(_s(Math.atan2(n[6],n[5]))),rotateY:n=>Fh(_s(Math.atan2(-n[2],n[0]))),rotateZ:sg,rotate:sg,skewX:n=>_s(Math.atan(n[4])),skewY:n=>_s(Math.atan(n[1])),skew:n=>(Math.abs(n[1])+Math.abs(n[4]))/2};function Bh(n){return n.includes("scale")?1:0}function $h(n,t){if(!n||n==="none")return Bh(t);const e=n.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let s,i;if(e)s=MC,i=e;else{const a=n.match(/^matrix\(([-\d.e\s,]+)\)$/u);s=kC,i=a}if(!i)return Bh(t);const r=s[t],o=i[1].split(",").map(OC);return typeof r=="function"?r(o):o[r]}const RC=(n,t)=>{const{transform:e="none"}=getComputedStyle(n);return $h(e,t)};function OC(n){return parseFloat(n.trim())}const Ii=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Li=new Set(Ii),og=n=>n===Di||n===K,DC=new Set(["x","y","z"]),IC=Ii.filter(n=>!DC.has(n));function LC(n){const t=[];return IC.forEach(e=>{const s=n.getValue(e);s!==void 0&&(t.push([e,s.get()]),s.set(e.startsWith("scale")?1:0))}),t}const Es={width:({x:n},{paddingLeft:t="0",paddingRight:e="0"})=>n.max-n.min-parseFloat(t)-parseFloat(e),height:({y:n},{paddingTop:t="0",paddingBottom:e="0"})=>n.max-n.min-parseFloat(t)-parseFloat(e),top:(n,{top:t})=>parseFloat(t),left:(n,{left:t})=>parseFloat(t),bottom:({y:n},{top:t})=>parseFloat(t)+(n.max-n.min),right:({x:n},{left:t})=>parseFloat(t)+(n.max-n.min),x:(n,{transform:t})=>$h(t,"x"),y:(n,{transform:t})=>$h(t,"y")};Es.translateX=Es.x;Es.translateY=Es.y;const xs=new Set;let Uh=!1,jh=!1,zh=!1;function Yw(){if(jh){const n=Array.from(xs).filter(s=>s.needsMeasurement),t=new Set(n.map(s=>s.element)),e=new Map;t.forEach(s=>{const i=LC(s);i.length&&(e.set(s,i),s.render())}),n.forEach(s=>s.measureInitialState()),t.forEach(s=>{s.render();const i=e.get(s);i&&i.forEach(([r,o])=>{s.getValue(r)?.set(o)})}),n.forEach(s=>s.measureEndState()),n.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}jh=!1,Uh=!1,xs.forEach(n=>n.complete(zh)),xs.clear()}function Xw(){xs.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(jh=!0)})}function NC(){zh=!0,Xw(),Yw(),zh=!1}class Rf{constructor(t,e,s,i,r,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=e,this.name=s,this.motionValue=i,this.element=r,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(xs.add(this),Uh||(Uh=!0,Tt.read(Xw),Tt.resolveKeyframes(Yw))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:e,element:s,motionValue:i}=this;if(t[0]===null){const r=i?.get(),o=t[t.length-1];if(r!==void 0)t[0]=r;else if(s&&e){const a=s.readValue(e,o);a!=null&&(t[0]=a)}t[0]===void 0&&(t[0]=o),i&&r===void 0&&i.set(t[0])}PC(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),xs.delete(this)}cancel(){this.state==="scheduled"&&(xs.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const FC=n=>n.startsWith("--");function BC(n,t,e){FC(t)?n.style.setProperty(t,e):n.style[t]=e}const $C=_f(()=>window.ScrollTimeline!==void 0),UC={};function jC(n,t){const e=_f(n);return()=>UC[t]??e()}const Kw=jC(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),ir=([n,t,e,s])=>`cubic-bezier(${n}, ${t}, ${e}, ${s})`,ag={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ir([0,.65,.55,1]),circOut:ir([.55,0,1,.45]),backIn:ir([.31,.01,.66,-.59]),backOut:ir([.33,1.53,.69,.99])};function Zw(n,t){if(n)return typeof n=="function"?Kw()?qw(n,t):"ease-out":Iw(n)?ir(n):Array.isArray(n)?n.map(e=>Zw(e,t)||ag.easeOut):ag[n]}function zC(n,t,e,{delay:s=0,duration:i=300,repeat:r=0,repeatType:o="loop",ease:a="easeOut",times:c}={},l=void 0){const u={[t]:e};c&&(u.offset=c);const h=Zw(a,i);Array.isArray(h)&&(u.easing=h);const d={delay:s,duration:i,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:r+1,direction:o==="reverse"?"alternate":"normal"};return l&&(d.pseudoElement=l),n.animate(u,d)}function Jw(n){return typeof n=="function"&&"applyToOptions"in n}function VC({type:n,...t}){return Jw(n)&&Kw()?n.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class HC extends kf{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,!t)return;const{element:e,name:s,keyframes:i,pseudoElement:r,allowFlatten:o=!1,finalKeyframe:a,onComplete:c}=t;this.isPseudoElement=!!r,this.allowFlatten=o,this.options=t,bf(typeof t.type!="string");const l=VC(t);this.animation=zC(e,s,i,l,r),l.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!r){const u=Pf(i,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(u):BC(e,s,u),this.animation.cancel()}c?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const t=this.animation.effect?.getComputedTiming?.().duration||0;return We(Number(t))}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+We(t)}get time(){return We(Number(this.animation.currentTime)||0)}set time(t){this.finishedTime=null,this.animation.currentTime=_n(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(t){this.animation.startTime=t}attachTimeline({timeline:t,observe:e}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,t&&$C()?(this.animation.timeline=t,Xe):e(this)}}const Qw={anticipate:Mw,backInOut:kw,circInOut:Ow};function qC(n){return n in Qw}function WC(n){typeof n.ease=="string"&&qC(n.ease)&&(n.ease=Qw[n.ease])}const cg=10;class GC extends HC{constructor(t){WC(t),Gw(t),super(t),t.startTime&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:e,onUpdate:s,onComplete:i,element:r,...o}=this.options;if(!e)return;if(t!==void 0){e.set(t);return}const a=new Mf({...o,autoplay:!1}),c=_n(this.finishedTime??this.time);e.setWithVelocity(a.sample(c-cg).value,a.sample(c).value,cg),a.stop()}}const lg=(n,t)=>t==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(es.test(n)||n==="0")&&!n.startsWith("url("));function YC(n){const t=n[0];if(n.length===1)return!0;for(let e=0;e<n.length;e++)if(n[e]!==t)return!0}function XC(n,t,e,s){const i=n[0];if(i===null)return!1;if(t==="display"||t==="visibility")return!0;const r=n[n.length-1],o=lg(i,t),a=lg(r,t);return!o||!a?!1:YC(n)||(e==="spring"||Jw(e))&&s}function Vh(n){n.duration=0,n.type="keyframes"}const KC=new Set(["opacity","clipPath","filter","transform"]),ZC=_f(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function JC(n){const{motionValue:t,name:e,repeatDelay:s,repeatType:i,damping:r,type:o}=n;if(!(t?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:l}=t.owner.getProps();return ZC()&&e&&KC.has(e)&&(e!=="transform"||!l)&&!c&&!s&&i!=="mirror"&&r!==0&&o!=="inertia"}const QC=40;class tP extends kf{constructor({autoplay:t=!0,delay:e=0,type:s="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:o="loop",keyframes:a,name:c,motionValue:l,element:u,...h}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Ee.now();const d={autoplay:t,delay:e,type:s,repeat:i,repeatDelay:r,repeatType:o,name:c,motionValue:l,element:u,...h},f=u?.KeyframeResolver||Rf;this.keyframeResolver=new f(a,(m,p,g)=>this.onKeyframesResolved(m,p,d,!g),c,l,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(t,e,s,i){this.keyframeResolver=void 0;const{name:r,type:o,velocity:a,delay:c,isHandoff:l,onUpdate:u}=s;this.resolvedAt=Ee.now(),XC(t,r,o,a)||((Fn.instantAnimations||!c)&&u?.(Pf(t,s,e)),t[0]=t[t.length-1],Vh(s),s.repeat=0);const d={startTime:i?this.resolvedAt?this.resolvedAt-this.createdAt>QC?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:e,...s,keyframes:t},f=!l&&JC(d)?new GC({...d,element:d.motionValue.owner.current}):new Mf(d);f.finished.then(()=>this.notifyFinished()).catch(Xe),this.pendingTimeline&&(this.stopTimeline=f.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=f}get finished(){return this._animation?this.animation.finished:this._finished}then(t,e){return this.finished.finally(t).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),NC()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const eP=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function nP(n){const t=eP.exec(n);if(!t)return[,];const[,e,s,i]=t;return[`--${e??s}`,i]}function tv(n,t,e=1){const[s,i]=nP(n);if(!s)return;const r=window.getComputedStyle(t).getPropertyValue(s);if(r){const o=r.trim();return vw(o)?parseFloat(o):o}return Sf(i)?tv(i,t,e+1):i}function Of(n,t){return n?.[t]??n?.default??n}const ev=new Set(["width","height","top","left","right","bottom",...Ii]),sP={test:n=>n==="auto",parse:n=>n},nv=n=>t=>t.test(n),sv=[Di,K,wn,Wn,Yx,Gx,sP],ug=n=>sv.find(nv(n));function iP(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||Sw(n):!0}const rP=new Set(["brightness","contrast","saturate","opacity"]);function oP(n){const[t,e]=n.slice(0,-1).split("(");if(t==="drop-shadow")return n;const[s]=e.match(Tf)||[];if(!s)return n;const i=e.replace(s,"");let r=rP.has(t)?1:0;return s!==e&&(r*=100),t+"("+r+i+")"}const aP=/\b([a-z-]*)\(.*?\)/gu,Hh={...es,getAnimatableNone:n=>{const t=n.match(aP);return t?t.map(oP).join(" "):n}},hg={...Di,transform:Math.round},cP={rotate:Wn,rotateX:Wn,rotateY:Wn,rotateZ:Wn,scale:Po,scaleX:Po,scaleY:Po,scaleZ:Po,skew:Wn,skewX:Wn,skewY:Wn,distance:K,translateX:K,translateY:K,translateZ:K,x:K,y:K,z:K,perspective:K,transformPerspective:K,opacity:Or,originX:Jm,originY:Jm,originZ:K},Df={borderWidth:K,borderTopWidth:K,borderRightWidth:K,borderBottomWidth:K,borderLeftWidth:K,borderRadius:K,radius:K,borderTopLeftRadius:K,borderTopRightRadius:K,borderBottomRightRadius:K,borderBottomLeftRadius:K,width:K,maxWidth:K,height:K,maxHeight:K,top:K,right:K,bottom:K,left:K,padding:K,paddingTop:K,paddingRight:K,paddingBottom:K,paddingLeft:K,margin:K,marginTop:K,marginRight:K,marginBottom:K,marginLeft:K,backgroundPositionX:K,backgroundPositionY:K,...cP,zIndex:hg,fillOpacity:Or,strokeOpacity:Or,numOctaves:hg},lP={...Df,color:Ft,backgroundColor:Ft,outlineColor:Ft,fill:Ft,stroke:Ft,borderColor:Ft,borderTopColor:Ft,borderRightColor:Ft,borderBottomColor:Ft,borderLeftColor:Ft,filter:Hh,WebkitFilter:Hh},iv=n=>lP[n];function rv(n,t){let e=iv(n);return e!==Hh&&(e=es),e.getAnimatableNone?e.getAnimatableNone(t):void 0}const uP=new Set(["auto","none","0"]);function hP(n,t,e){let s=0,i;for(;s<n.length&&!i;){const r=n[s];typeof r=="string"&&!uP.has(r)&&Dr(r).values.length&&(i=n[s]),s++}if(i&&e)for(const r of t)n[r]=rv(e,i)}class dP extends Rf{constructor(t,e,s,i,r){super(t,e,s,i,r,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:e,name:s}=this;if(!e||!e.current)return;super.readKeyframes();for(let c=0;c<t.length;c++){let l=t[c];if(typeof l=="string"&&(l=l.trim(),Sf(l))){const u=tv(l,e.current);u!==void 0&&(t[c]=u),c===t.length-1&&(this.finalKeyframe=l)}}if(this.resolveNoneKeyframes(),!ev.has(s)||t.length!==2)return;const[i,r]=t,o=ug(i),a=ug(r);if(o!==a)if(og(o)&&og(a))for(let c=0;c<t.length;c++){const l=t[c];typeof l=="string"&&(t[c]=parseFloat(l))}else Es[s]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:e}=this,s=[];for(let i=0;i<t.length;i++)(t[i]===null||iP(t[i]))&&s.push(i);s.length&&hP(t,s,e)}measureInitialState(){const{element:t,unresolvedKeyframes:e,name:s}=this;if(!t||!t.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Es[s](t.measureViewportBox(),window.getComputedStyle(t.current)),e[0]=this.measuredOrigin;const i=e[e.length-1];i!==void 0&&t.getValue(s,i).jump(i,!1)}measureEndState(){const{element:t,name:e,unresolvedKeyframes:s}=this;if(!t||!t.current)return;const i=t.getValue(e);i&&i.jump(this.measuredOrigin,!1);const r=s.length-1,o=s[r];s[r]=Es[e](t.measureViewportBox(),window.getComputedStyle(t.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),this.removedTransforms?.length&&this.removedTransforms.forEach(([a,c])=>{t.getValue(a).set(c)}),this.resolveNoneKeyframes()}}function fP(n,t,e){if(n instanceof EventTarget)return[n];if(typeof n=="string"){let s=document;const i=e?.[n]??s.querySelectorAll(n);return i?Array.from(i):[]}return Array.from(n)}const ov=(n,t)=>t&&typeof n=="number"?t.transform(n):n;function av(n){return Aw(n)&&"offsetHeight"in n}const dg=30,pP=n=>!isNaN(parseFloat(n));class mP{constructor(t,e={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=s=>{const i=Ee.now();if(this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const r of this.dependents)r.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=e.owner}setCurrent(t){this.current=t,this.updatedAt=Ee.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=pP(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,e){this.events[t]||(this.events[t]=new wf);const s=this.events[t].add(e);return t==="change"?()=>{s(),Tt.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,e){this.passiveEffect=t,this.stopPassiveEffect=e}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,e,s){this.set(e),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-s}jump(t,e=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,e&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Ee.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>dg)return 0;const e=Math.min(this.updatedAt-this.prevUpdatedAt,dg);return Tw(parseFloat(this.current)-parseFloat(this.prevFrameValue),e)}start(t){return this.stop(),new Promise(e=>{this.hasAnimated=!0,this.animation=t(e),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Ti(n,t){return new mP(n,t)}const{schedule:If}=Lw(queueMicrotask,!1),nn={x:!1,y:!1};function cv(){return nn.x||nn.y}function gP(n){return n==="x"||n==="y"?nn[n]?null:(nn[n]=!0,()=>{nn[n]=!1}):nn.x||nn.y?null:(nn.x=nn.y=!0,()=>{nn.x=nn.y=!1})}function lv(n,t){const e=fP(n),s=new AbortController,i={passive:!0,...t,signal:s.signal};return[e,i,()=>s.abort()]}function fg(n){return!(n.pointerType==="touch"||cv())}function yP(n,t,e={}){const[s,i,r]=lv(n,e),o=a=>{if(!fg(a))return;const{target:c}=a,l=t(c,a);if(typeof l!="function"||!c)return;const u=h=>{fg(h)&&(l(h),c.removeEventListener("pointerleave",u))};c.addEventListener("pointerleave",u,i)};return s.forEach(a=>{a.addEventListener("pointerenter",o,i)}),r}const uv=(n,t)=>t?n===t?!0:uv(n,t.parentElement):!1,Lf=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,bP=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function _P(n){return bP.has(n.tagName)||n.tabIndex!==-1}const ha=new WeakSet;function pg(n){return t=>{t.key==="Enter"&&n(t)}}function xl(n,t){n.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const wP=(n,t)=>{const e=n.currentTarget;if(!e)return;const s=pg(()=>{if(ha.has(e))return;xl(e,"down");const i=pg(()=>{xl(e,"up")}),r=()=>xl(e,"cancel");e.addEventListener("keyup",i,t),e.addEventListener("blur",r,t)});e.addEventListener("keydown",s,t),e.addEventListener("blur",()=>e.removeEventListener("keydown",s),t)};function mg(n){return Lf(n)&&!cv()}function vP(n,t,e={}){const[s,i,r]=lv(n,e),o=a=>{const c=a.currentTarget;if(!mg(a))return;ha.add(c);const l=t(c,a),u=(f,m)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",d),ha.has(c)&&ha.delete(c),mg(f)&&typeof l=="function"&&l(f,{success:m})},h=f=>{u(f,c===window||c===document||e.useGlobalTarget||uv(c,f.target))},d=f=>{u(f,!1)};window.addEventListener("pointerup",h,i),window.addEventListener("pointercancel",d,i)};return s.forEach(a=>{(e.useGlobalTarget?window:a).addEventListener("pointerdown",o,i),av(a)&&(a.addEventListener("focus",l=>wP(l,i)),!_P(a)&&!a.hasAttribute("tabindex")&&(a.tabIndex=0))}),r}function hv(n){return Aw(n)&&"ownerSVGElement"in n}function AP(n){return hv(n)&&n.tagName==="svg"}const de=n=>!!(n&&n.getVelocity),SP=[...sv,Ft,es],TP=n=>SP.find(nv(n)),Nf=z.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});function gg(n,t){if(typeof n=="function")return n(t);n!=null&&(n.current=t)}function EP(...n){return t=>{let e=!1;const s=n.map(i=>{const r=gg(i,t);return!e&&typeof r=="function"&&(e=!0),r});if(e)return()=>{for(let i=0;i<s.length;i++){const r=s[i];typeof r=="function"?r():gg(n[i],null)}}}}function xP(...n){return z.useCallback(EP(...n),n)}class CP extends z.Component{getSnapshotBeforeUpdate(t){const e=this.props.childRef.current;if(e&&t.isPresent&&!this.props.isPresent){const s=e.offsetParent,i=av(s)&&s.offsetWidth||0,r=this.props.sizeRef.current;r.height=e.offsetHeight||0,r.width=e.offsetWidth||0,r.top=e.offsetTop,r.left=e.offsetLeft,r.right=i-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}}function PP({children:n,isPresent:t,anchorX:e,root:s}){const i=z.useId(),r=z.useRef(null),o=z.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=z.useContext(Nf),c=xP(r,n?.ref);return z.useInsertionEffect(()=>{const{width:l,height:u,top:h,left:d,right:f}=o.current;if(t||!r.current||!l||!u)return;const m=e==="left"?`left: ${d}`:`right: ${f}`;r.current.dataset.motionPopId=i;const p=document.createElement("style");a&&(p.nonce=a);const g=s??document.head;return g.appendChild(p),p.sheet&&p.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${l}px !important;
            height: ${u}px !important;
            ${m}px !important;
            top: ${h}px !important;
          }
        `),()=>{g.contains(p)&&g.removeChild(p)}},[t]),In.jsx(CP,{isPresent:t,childRef:r,sizeRef:o,children:z.cloneElement(n,{ref:c})})}const kP=({children:n,initial:t,isPresent:e,onExitComplete:s,custom:i,presenceAffectsLayout:r,mode:o,anchorX:a,root:c})=>{const l=pf(MP),u=z.useId();let h=!0,d=z.useMemo(()=>(h=!1,{id:u,initial:t,isPresent:e,custom:i,onExitComplete:f=>{l.set(f,!0);for(const m of l.values())if(!m)return;s&&s()},register:f=>(l.set(f,!1),()=>l.delete(f))}),[e,l,s]);return r&&h&&(d={...d}),z.useMemo(()=>{l.forEach((f,m)=>l.set(m,!1))},[e]),z.useEffect(()=>{!e&&!l.size&&s&&s()},[e]),o==="popLayout"&&(n=In.jsx(PP,{isPresent:e,anchorX:a,root:c,children:n})),In.jsx(Cc.Provider,{value:d,children:n})};function MP(){return new Map}function dv(n=!0){const t=z.useContext(Cc);if(t===null)return[!0,null];const{isPresent:e,onExitComplete:s,register:i}=t,r=z.useId();z.useEffect(()=>{if(n)return i(r)},[n]);const o=z.useCallback(()=>n&&s&&s(r),[r,s,n]);return!e&&s?[!1,o]:[!0]}const ko=n=>n.key||"";function yg(n){const t=[];return z.Children.forEach(n,e=>{z.isValidElement(e)&&t.push(e)}),t}const OH=({children:n,custom:t,initial:e=!0,onExitComplete:s,presenceAffectsLayout:i=!0,mode:r="sync",propagate:o=!1,anchorX:a="left",root:c})=>{const[l,u]=dv(o),h=z.useMemo(()=>yg(n),[n]),d=o&&!l?[]:h.map(ko),f=z.useRef(!0),m=z.useRef(h),p=pf(()=>new Map),[g,y]=z.useState(h),[_,b]=z.useState(h);ww(()=>{f.current=!1,m.current=h;for(let A=0;A<_.length;A++){const S=ko(_[A]);d.includes(S)?p.delete(S):p.get(S)!==!0&&p.set(S,!1)}},[_,d.length,d.join("-")]);const w=[];if(h!==g){let A=[...h];for(let S=0;S<_.length;S++){const T=_[S],E=ko(T);d.includes(E)||(A.splice(S,0,T),w.push(T))}return r==="wait"&&w.length&&(A=w),b(yg(A)),y(h),null}const{forceRender:v}=z.useContext(ff);return In.jsx(In.Fragment,{children:_.map(A=>{const S=ko(A),T=o&&!l?!1:h===_||d.includes(S),E=()=>{if(p.has(S))p.set(S,!0);else return;let P=!0;p.forEach(x=>{x||(P=!1)}),P&&(v?.(),b(m.current),o&&u?.(),s&&s())};return In.jsx(kP,{isPresent:T,initial:!f.current||e?void 0:!1,custom:t,presenceAffectsLayout:i,mode:r,root:c,onExitComplete:T?void 0:E,anchorX:a,children:A},S)})})},fv=z.createContext({strict:!1}),bg={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Ei={};for(const n in bg)Ei[n]={isEnabled:t=>bg[n].some(e=>!!t[e])};function RP(n){for(const t in n)Ei[t]={...Ei[t],...n[t]}}const OP=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Da(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||OP.has(n)}let pv=n=>!Da(n);function DP(n){typeof n=="function"&&(pv=t=>t.startsWith("on")?!Da(t):n(t))}try{DP(require("@emotion/is-prop-valid").default)}catch{}function IP(n,t,e){const s={};for(const i in n)i==="values"&&typeof n.values=="object"||(pv(i)||e===!0&&Da(i)||!t&&!Da(i)||n.draggable&&i.startsWith("onDrag"))&&(s[i]=n[i]);return s}const Pc=z.createContext({});function kc(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}function Ir(n){return typeof n=="string"||Array.isArray(n)}const Ff=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Bf=["initial",...Ff];function Mc(n){return kc(n.animate)||Bf.some(t=>Ir(n[t]))}function mv(n){return!!(Mc(n)||n.variants)}function LP(n,t){if(Mc(n)){const{initial:e,animate:s}=n;return{initial:e===!1||Ir(e)?e:void 0,animate:Ir(s)?s:void 0}}return n.inherit!==!1?t:{}}function NP(n){const{initial:t,animate:e}=LP(n,z.useContext(Pc));return z.useMemo(()=>({initial:t,animate:e}),[_g(t),_g(e)])}function _g(n){return Array.isArray(n)?n.join(" "):n}function wg(n,t){return t.max===t.min?0:n/(t.max-t.min)*100}const Vi={correct:(n,t)=>{if(!t.target)return n;if(typeof n=="string")if(K.test(n))n=parseFloat(n);else return n;const e=wg(n,t.target.x),s=wg(n,t.target.y);return`${e}% ${s}%`}},FP={correct:(n,{treeScale:t,projectionDelta:e})=>{const s=n,i=es.parse(n);if(i.length>5)return s;const r=es.createTransformer(n),o=typeof i[0]!="number"?1:0,a=e.x.scale*t.x,c=e.y.scale*t.y;i[0+o]/=a,i[1+o]/=c;const l=Pt(a,c,.5);return typeof i[2+o]=="number"&&(i[2+o]/=l),typeof i[3+o]=="number"&&(i[3+o]/=l),r(i)}},qh={borderRadius:{...Vi,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Vi,borderTopRightRadius:Vi,borderBottomLeftRadius:Vi,borderBottomRightRadius:Vi,boxShadow:FP};function gv(n,{layout:t,layoutId:e}){return Li.has(n)||n.startsWith("origin")||(t||e!==void 0)&&(!!qh[n]||n==="opacity")}const BP={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},$P=Ii.length;function UP(n,t,e){let s="",i=!0;for(let r=0;r<$P;r++){const o=Ii[r],a=n[o];if(a===void 0)continue;let c=!0;if(typeof a=="number"?c=a===(o.startsWith("scale")?1:0):c=parseFloat(a)===0,!c||e){const l=ov(a,Df[o]);if(!c){i=!1;const u=BP[o]||o;s+=`${u}(${l}) `}e&&(t[o]=l)}}return s=s.trim(),e?s=e(t,i?"":s):i&&(s="none"),s}function $f(n,t,e){const{style:s,vars:i,transformOrigin:r}=n;let o=!1,a=!1;for(const c in t){const l=t[c];if(Li.has(c)){o=!0;continue}else if(Fw(c)){i[c]=l;continue}else{const u=ov(l,Df[c]);c.startsWith("origin")?(a=!0,r[c]=u):s[c]=u}}if(t.transform||(o||e?s.transform=UP(t,n.transform,e):s.transform&&(s.transform="none")),a){const{originX:c="50%",originY:l="50%",originZ:u=0}=r;s.transformOrigin=`${c} ${l} ${u}`}}const Uf=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function yv(n,t,e){for(const s in t)!de(t[s])&&!gv(s,e)&&(n[s]=t[s])}function jP({transformTemplate:n},t){return z.useMemo(()=>{const e=Uf();return $f(e,t,n),Object.assign({},e.vars,e.style)},[t])}function zP(n,t){const e=n.style||{},s={};return yv(s,e,n),Object.assign(s,jP(n,t)),s}function VP(n,t){const e={},s=zP(n,t);return n.drag&&n.dragListener!==!1&&(e.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(e.tabIndex=0),e.style=s,e}const HP={offset:"stroke-dashoffset",array:"stroke-dasharray"},qP={offset:"strokeDashoffset",array:"strokeDasharray"};function WP(n,t,e=1,s=0,i=!0){n.pathLength=1;const r=i?HP:qP;n[r.offset]=K.transform(-s);const o=K.transform(t),a=K.transform(e);n[r.array]=`${o} ${a}`}function bv(n,{attrX:t,attrY:e,attrScale:s,pathLength:i,pathSpacing:r=1,pathOffset:o=0,...a},c,l,u){if($f(n,a,l),c){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:h,style:d}=n;h.transform&&(d.transform=h.transform,delete h.transform),(d.transform||h.transformOrigin)&&(d.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),d.transform&&(d.transformBox=u?.transformBox??"fill-box",delete h.transformBox),t!==void 0&&(h.x=t),e!==void 0&&(h.y=e),s!==void 0&&(h.scale=s),i!==void 0&&WP(h,i,r,o,!1)}const _v=()=>({...Uf(),attrs:{}}),wv=n=>typeof n=="string"&&n.toLowerCase()==="svg";function GP(n,t,e,s){const i=z.useMemo(()=>{const r=_v();return bv(r,t,wv(s),n.transformTemplate,n.style),{...r.attrs,style:{...r.style}}},[t]);if(n.style){const r={};yv(r,n.style,n),i.style={...r,...i.style}}return i}const YP=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function jf(n){return typeof n!="string"||n.includes("-")?!1:!!(YP.indexOf(n)>-1||/[A-Z]/u.test(n))}function XP(n,t,e,{latestValues:s},i,r=!1){const a=(jf(n)?GP:VP)(t,s,i,n),c=IP(t,typeof n=="string",r),l=n!==z.Fragment?{...c,...a,ref:e}:{},{children:u}=t,h=z.useMemo(()=>de(u)?u.get():u,[u]);return z.createElement(n,{...l,children:h})}function vg(n){const t=[{},{}];return n?.values.forEach((e,s)=>{t[0][s]=e.get(),t[1][s]=e.getVelocity()}),t}function zf(n,t,e,s){if(typeof t=="function"){const[i,r]=vg(s);t=t(e!==void 0?e:n.custom,i,r)}if(typeof t=="string"&&(t=n.variants&&n.variants[t]),typeof t=="function"){const[i,r]=vg(s);t=t(e!==void 0?e:n.custom,i,r)}return t}function da(n){return de(n)?n.get():n}function KP({scrapeMotionValuesFromProps:n,createRenderState:t},e,s,i){return{latestValues:ZP(e,s,i,n),renderState:t()}}function ZP(n,t,e,s){const i={},r=s(n,{});for(const d in r)i[d]=da(r[d]);let{initial:o,animate:a}=n;const c=Mc(n),l=mv(n);t&&l&&!c&&n.inherit!==!1&&(o===void 0&&(o=t.initial),a===void 0&&(a=t.animate));let u=e?e.initial===!1:!1;u=u||o===!1;const h=u?a:o;if(h&&typeof h!="boolean"&&!kc(h)){const d=Array.isArray(h)?h:[h];for(let f=0;f<d.length;f++){const m=zf(n,d[f]);if(m){const{transitionEnd:p,transition:g,...y}=m;for(const _ in y){let b=y[_];if(Array.isArray(b)){const w=u?b.length-1:0;b=b[w]}b!==null&&(i[_]=b)}for(const _ in p)i[_]=p[_]}}}return i}const vv=n=>(t,e)=>{const s=z.useContext(Pc),i=z.useContext(Cc),r=()=>KP(n,t,s,i);return e?r():pf(r)};function Vf(n,t,e){const{style:s}=n,i={};for(const r in s)(de(s[r])||t.style&&de(t.style[r])||gv(r,n)||e?.getValue(r)?.liveStyle!==void 0)&&(i[r]=s[r]);return i}const JP=vv({scrapeMotionValuesFromProps:Vf,createRenderState:Uf});function Av(n,t,e){const s=Vf(n,t,e);for(const i in n)if(de(n[i])||de(t[i])){const r=Ii.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;s[r]=n[i]}return s}const QP=vv({scrapeMotionValuesFromProps:Av,createRenderState:_v}),tk=Symbol.for("motionComponentSymbol");function ci(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function ek(n,t,e){return z.useCallback(s=>{s&&n.onMount&&n.onMount(s),t&&(s?t.mount(s):t.unmount()),e&&(typeof e=="function"?e(s):ci(e)&&(e.current=s))},[t])}const Hf=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),nk="framerAppearId",Sv="data-"+Hf(nk),Tv=z.createContext({});function sk(n,t,e,s,i){const{visualElement:r}=z.useContext(Pc),o=z.useContext(fv),a=z.useContext(Cc),c=z.useContext(Nf).reducedMotion,l=z.useRef(null);s=s||o.renderer,!l.current&&s&&(l.current=s(n,{visualState:t,parent:r,props:e,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:c}));const u=l.current,h=z.useContext(Tv);u&&!u.projection&&i&&(u.type==="html"||u.type==="svg")&&ik(l.current,e,i,h);const d=z.useRef(!1);z.useInsertionEffect(()=>{u&&d.current&&u.update(e,a)});const f=e[Sv],m=z.useRef(!!f&&!window.MotionHandoffIsComplete?.(f)&&window.MotionHasOptimisedAnimation?.(f));return ww(()=>{u&&(d.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),m.current&&u.animationState&&u.animationState.animateChanges())}),z.useEffect(()=>{u&&(!m.current&&u.animationState&&u.animationState.animateChanges(),m.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(f)}),m.current=!1),u.enteringChildren=void 0)}),u}function ik(n,t,e,s){const{layoutId:i,layout:r,drag:o,dragConstraints:a,layoutScroll:c,layoutRoot:l,layoutCrossfade:u}=t;n.projection=new e(n.latestValues,t["data-framer-portal-id"]?void 0:Ev(n.parent)),n.projection.setOptions({layoutId:i,layout:r,alwaysMeasureLayout:!!o||a&&ci(a),visualElement:n,animationType:typeof r=="string"?r:"both",initialPromotionConfig:s,crossfade:u,layoutScroll:c,layoutRoot:l})}function Ev(n){if(n)return n.options.allowProjection!==!1?n.projection:Ev(n.parent)}function Cl(n,{forwardMotionProps:t=!1}={},e,s){e&&RP(e);const i=jf(n)?QP:JP;function r(a,c){let l;const u={...z.useContext(Nf),...a,layoutId:rk(a)},{isStatic:h}=u,d=NP(a),f=i(a,h);if(!h&&mf){ok();const m=ak(u);l=m.MeasureLayout,d.visualElement=sk(n,f,u,s,m.ProjectionNode)}return In.jsxs(Pc.Provider,{value:d,children:[l&&d.visualElement?In.jsx(l,{visualElement:d.visualElement,...u}):null,XP(n,a,ek(f,d.visualElement,c),f,h,t)]})}r.displayName=`motion.${typeof n=="string"?n:`create(${n.displayName??n.name??""})`}`;const o=z.forwardRef(r);return o[tk]=n,o}function rk({layoutId:n}){const t=z.useContext(ff).id;return t&&n!==void 0?t+"-"+n:n}function ok(n,t){z.useContext(fv).strict}function ak(n){const{drag:t,layout:e}=Ei;if(!t&&!e)return{};const s={...t,...e};return{MeasureLayout:t?.isEnabled(n)||e?.isEnabled(n)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}function ck(n,t){if(typeof Proxy>"u")return Cl;const e=new Map,s=(r,o)=>Cl(r,o,n,t),i=(r,o)=>s(r,o);return new Proxy(i,{get:(r,o)=>o==="create"?s:(e.has(o)||e.set(o,Cl(o,void 0,n,t)),e.get(o))})}function xv({top:n,left:t,right:e,bottom:s}){return{x:{min:t,max:e},y:{min:n,max:s}}}function lk({x:n,y:t}){return{top:t.min,right:n.max,bottom:t.max,left:n.min}}function uk(n,t){if(!t)return n;const e=t({x:n.left,y:n.top}),s=t({x:n.right,y:n.bottom});return{top:e.y,left:e.x,bottom:s.y,right:s.x}}function Pl(n){return n===void 0||n===1}function Wh({scale:n,scaleX:t,scaleY:e}){return!Pl(n)||!Pl(t)||!Pl(e)}function hs(n){return Wh(n)||Cv(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function Cv(n){return Ag(n.x)||Ag(n.y)}function Ag(n){return n&&n!=="0%"}function Ia(n,t,e){const s=n-e,i=t*s;return e+i}function Sg(n,t,e,s,i){return i!==void 0&&(n=Ia(n,i,s)),Ia(n,e,s)+t}function Gh(n,t=0,e=1,s,i){n.min=Sg(n.min,t,e,s,i),n.max=Sg(n.max,t,e,s,i)}function Pv(n,{x:t,y:e}){Gh(n.x,t.translate,t.scale,t.originPoint),Gh(n.y,e.translate,e.scale,e.originPoint)}const Tg=.999999999999,Eg=1.0000000000001;function hk(n,t,e,s=!1){const i=e.length;if(!i)return;t.x=t.y=1;let r,o;for(let a=0;a<i;a++){r=e[a],o=r.projectionDelta;const{visualElement:c}=r.options;c&&c.props.style&&c.props.style.display==="contents"||(s&&r.options.layoutScroll&&r.scroll&&r!==r.root&&ui(n,{x:-r.scroll.offset.x,y:-r.scroll.offset.y}),o&&(t.x*=o.x.scale,t.y*=o.y.scale,Pv(n,o)),s&&hs(r.latestValues)&&ui(n,r.latestValues))}t.x<Eg&&t.x>Tg&&(t.x=1),t.y<Eg&&t.y>Tg&&(t.y=1)}function li(n,t){n.min=n.min+t,n.max=n.max+t}function xg(n,t,e,s,i=.5){const r=Pt(n.min,n.max,i);Gh(n,t,e,r,s)}function ui(n,t){xg(n.x,t.x,t.scaleX,t.scale,t.originX),xg(n.y,t.y,t.scaleY,t.scale,t.originY)}function kv(n,t){return xv(uk(n.getBoundingClientRect(),t))}function dk(n,t,e){const s=kv(n,e),{scroll:i}=t;return i&&(li(s.x,i.offset.x),li(s.y,i.offset.y)),s}const Cg=()=>({translate:0,scale:1,origin:0,originPoint:0}),hi=()=>({x:Cg(),y:Cg()}),Pg=()=>({min:0,max:0}),Ht=()=>({x:Pg(),y:Pg()}),Yh={current:null},Mv={current:!1};function fk(){if(Mv.current=!0,!!mf)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),t=()=>Yh.current=n.matches;n.addEventListener("change",t),t()}else Yh.current=!1}const pk=new WeakMap;function mk(n,t,e){for(const s in t){const i=t[s],r=e[s];if(de(i))n.addValue(s,i);else if(de(r))n.addValue(s,Ti(i,{owner:n}));else if(r!==i)if(n.hasValue(s)){const o=n.getValue(s);o.liveStyle===!0?o.jump(i):o.hasAnimated||o.set(i)}else{const o=n.getStaticValue(s);n.addValue(s,Ti(o!==void 0?o:i,{owner:n}))}}for(const s in e)t[s]===void 0&&n.removeValue(s);return t}const kg=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class gk{scrapeMotionValuesFromProps(t,e,s){return{}}constructor({parent:t,props:e,presenceContext:s,reducedMotionConfig:i,blockInitialAnimation:r,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Rf,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const d=Ee.now();this.renderScheduledAt<d&&(this.renderScheduledAt=d,Tt.render(this.render,!1,!0))};const{latestValues:c,renderState:l}=o;this.latestValues=c,this.baseTarget={...c},this.initialValues=e.initial?{...c}:{},this.renderState=l,this.parent=t,this.props=e,this.presenceContext=s,this.depth=t?t.depth+1:0,this.reducedMotionConfig=i,this.options=a,this.blockInitialAnimation=!!r,this.isControllingVariants=Mc(e),this.isVariantNode=mv(e),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:u,...h}=this.scrapeMotionValuesFromProps(e,{},this);for(const d in h){const f=h[d];c[d]!==void 0&&de(f)&&f.set(c[d])}}mount(t){this.current=t,pk.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,s)=>this.bindToMotionValue(s,e)),Mv.current||fk(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Yh.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),ts(this.notifyUpdate),ts(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const e=this.features[t];e&&(e.unmount(),e.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,e){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const s=Li.has(t);s&&this.onBindTransform&&this.onBindTransform();const i=e.on("change",o=>{this.latestValues[t]=o,this.props.onUpdate&&Tt.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let r;window.MotionCheckAppearSync&&(r=window.MotionCheckAppearSync(this,t,e)),this.valueSubscriptions.set(t,()=>{i(),r&&r(),e.owner&&e.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in Ei){const e=Ei[t];if(!e)continue;const{isEnabled:s,Feature:i}=e;if(!this.features[t]&&i&&s(this.props)&&(this.features[t]=new i(this)),this.features[t]){const r=this.features[t];r.isMounted?r.update():(r.mount(),r.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ht()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,e){this.latestValues[t]=e}update(t,e){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=e;for(let s=0;s<kg.length;s++){const i=kg[s];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const r="on"+i,o=t[r];o&&(this.propEventSubscriptions[i]=this.on(i,o))}this.prevMotionValues=mk(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const e=this.getClosestVariantNode();if(e)return e.variantChildren&&e.variantChildren.add(t),()=>e.variantChildren.delete(t)}addValue(t,e){const s=this.values.get(t);e!==s&&(s&&this.removeValue(t),this.bindToMotionValue(t,e),this.values.set(t,e),this.latestValues[t]=e.get())}removeValue(t){this.values.delete(t);const e=this.valueSubscriptions.get(t);e&&(e(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,e){if(this.props.values&&this.props.values[t])return this.props.values[t];let s=this.values.get(t);return s===void 0&&e!==void 0&&(s=Ti(e===null?void 0:e,{owner:this}),this.addValue(t,s)),s}readValue(t,e){let s=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return s!=null&&(typeof s=="string"&&(vw(s)||Sw(s))?s=parseFloat(s):!TP(s)&&es.test(e)&&(s=rv(t,e)),this.setBaseTarget(t,de(s)?s.get():s)),de(s)?s.get():s}setBaseTarget(t,e){this.baseTarget[t]=e}getBaseTarget(t){const{initial:e}=this.props;let s;if(typeof e=="string"||typeof e=="object"){const r=zf(this.props,e,this.presenceContext?.custom);r&&(s=r[t])}if(e&&s!==void 0)return s;const i=this.getBaseTargetFromProps(this.props,t);return i!==void 0&&!de(i)?i:this.initialValues[t]!==void 0&&s===void 0?void 0:this.baseTarget[t]}on(t,e){return this.events[t]||(this.events[t]=new wf),this.events[t].add(e)}notify(t,...e){this.events[t]&&this.events[t].notify(...e)}scheduleRenderMicrotask(){If.render(this.render)}}class Rv extends gk{constructor(){super(...arguments),this.KeyframeResolver=dP}sortInstanceNodePosition(t,e){return t.compareDocumentPosition(e)&2?1:-1}getBaseTargetFromProps(t,e){return t.style?t.style[e]:void 0}removeValueFromRenderState(t,{vars:e,style:s}){delete e[t],delete s[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;de(t)&&(this.childSubscription=t.on("change",e=>{this.current&&(this.current.textContent=`${e}`)}))}}function Ov(n,{style:t,vars:e},s,i){const r=n.style;let o;for(o in t)r[o]=t[o];i?.applyProjectionStyles(r,s);for(o in e)r.setProperty(o,e[o])}function yk(n){return window.getComputedStyle(n)}class bk extends Rv{constructor(){super(...arguments),this.type="html",this.renderInstance=Ov}readValueFromInstance(t,e){if(Li.has(e))return this.projection?.isProjecting?Bh(e):RC(t,e);{const s=yk(t),i=(Fw(e)?s.getPropertyValue(e):s[e])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(t,{transformPagePoint:e}){return kv(t,e)}build(t,e,s){$f(t,e,s.transformTemplate)}scrapeMotionValuesFromProps(t,e,s){return Vf(t,e,s)}}const Dv=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function _k(n,t,e,s){Ov(n,t,void 0,s);for(const i in t.attrs)n.setAttribute(Dv.has(i)?i:Hf(i),t.attrs[i])}class wk extends Rv{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ht}getBaseTargetFromProps(t,e){return t[e]}readValueFromInstance(t,e){if(Li.has(e)){const s=iv(e);return s&&s.default||0}return e=Dv.has(e)?e:Hf(e),t.getAttribute(e)}scrapeMotionValuesFromProps(t,e,s){return Av(t,e,s)}build(t,e,s){bv(t,e,this.isSVGTag,s.transformTemplate,s.style)}renderInstance(t,e,s,i){_k(t,e,s,i)}mount(t){this.isSVGTag=wv(t.tagName),super.mount(t)}}const vk=(n,t)=>jf(n)?new wk(t):new bk(t,{allowProjection:n!==z.Fragment});function yi(n,t,e){const s=n.getProps();return zf(s,t,e!==void 0?e:s.custom,n)}const Xh=n=>Array.isArray(n);function Ak(n,t,e){n.hasValue(t)?n.getValue(t).set(e):n.addValue(t,Ti(e))}function Sk(n){return Xh(n)?n[n.length-1]||0:n}function Tk(n,t){const e=yi(n,t);let{transitionEnd:s={},transition:i={},...r}=e||{};r={...r,...s};for(const o in r){const a=Sk(r[o]);Ak(n,o,a)}}function Ek(n){return!!(de(n)&&n.add)}function Kh(n,t){const e=n.getValue("willChange");if(Ek(e))return e.add(t);if(!e&&Fn.WillChange){const s=new Fn.WillChange("auto");n.addValue("willChange",s),s.add(t)}}function Iv(n){return n.props[Sv]}const xk=n=>n!==null;function Ck(n,{repeat:t,repeatType:e="loop"},s){const i=n.filter(xk),r=t&&e!=="loop"&&t%2===1?0:i.length-1;return i[r]}const Pk={type:"spring",stiffness:500,damping:25,restSpeed:10},kk=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),Mk={type:"keyframes",duration:.8},Rk={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Ok=(n,{keyframes:t})=>t.length>2?Mk:Li.has(n)?n.startsWith("scale")?kk(t[1]):Pk:Rk;function Dk({when:n,delay:t,delayChildren:e,staggerChildren:s,staggerDirection:i,repeat:r,repeatType:o,repeatDelay:a,from:c,elapsed:l,...u}){return!!Object.keys(u).length}const qf=(n,t,e,s={},i,r)=>o=>{const a=Of(s,n)||{},c=a.delay||s.delay||0;let{elapsed:l=0}=s;l=l-_n(c);const u={keyframes:Array.isArray(e)?e:[null,e],ease:"easeOut",velocity:t.getVelocity(),...a,delay:-l,onUpdate:d=>{t.set(d),a.onUpdate&&a.onUpdate(d)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:n,motionValue:t,element:r?void 0:i};Dk(a)||Object.assign(u,Ok(n,u)),u.duration&&(u.duration=_n(u.duration)),u.repeatDelay&&(u.repeatDelay=_n(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let h=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(Vh(u),u.delay===0&&(h=!0)),(Fn.instantAnimations||Fn.skipAnimations)&&(h=!0,Vh(u),u.delay=0),u.allowFlatten=!a.type&&!a.ease,h&&!r&&t.get()!==void 0){const d=Ck(u.keyframes,a);if(d!==void 0){Tt.update(()=>{u.onUpdate(d),u.onComplete()});return}}return a.isSync?new Mf(u):new tP(u)};function Ik({protectedKeys:n,needsAnimating:t},e){const s=n.hasOwnProperty(e)&&t[e]!==!0;return t[e]=!1,s}function Lv(n,t,{delay:e=0,transitionOverride:s,type:i}={}){let{transition:r=n.getDefaultTransition(),transitionEnd:o,...a}=t;s&&(r=s);const c=[],l=i&&n.animationState&&n.animationState.getState()[i];for(const u in a){const h=n.getValue(u,n.latestValues[u]??null),d=a[u];if(d===void 0||l&&Ik(l,u))continue;const f={delay:e,...Of(r||{},u)},m=h.get();if(m!==void 0&&!h.isAnimating&&!Array.isArray(d)&&d===m&&!f.velocity)continue;let p=!1;if(window.MotionHandoffAnimation){const y=Iv(n);if(y){const _=window.MotionHandoffAnimation(y,u,Tt);_!==null&&(f.startTime=_,p=!0)}}Kh(n,u),h.start(qf(u,h,d,n.shouldReduceMotion&&ev.has(u)?{type:!1}:f,n,p));const g=h.animation;g&&c.push(g)}return o&&Promise.all(c).then(()=>{Tt.update(()=>{o&&Tk(n,o)})}),c}function Nv(n,t,e,s=0,i=1){const r=Array.from(n).sort((l,u)=>l.sortNodePosition(u)).indexOf(t),o=n.size,a=(o-1)*s;return typeof e=="function"?e(r,o):i===1?r*s:a-r*s}function Zh(n,t,e={}){const s=yi(n,t,e.type==="exit"?n.presenceContext?.custom:void 0);let{transition:i=n.getDefaultTransition()||{}}=s||{};e.transitionOverride&&(i=e.transitionOverride);const r=s?()=>Promise.all(Lv(n,s,e)):()=>Promise.resolve(),o=n.variantChildren&&n.variantChildren.size?(c=0)=>{const{delayChildren:l=0,staggerChildren:u,staggerDirection:h}=i;return Lk(n,t,c,l,u,h,e)}:()=>Promise.resolve(),{when:a}=i;if(a){const[c,l]=a==="beforeChildren"?[r,o]:[o,r];return c().then(()=>l())}else return Promise.all([r(),o(e.delay)])}function Lk(n,t,e=0,s=0,i=0,r=1,o){const a=[];for(const c of n.variantChildren)c.notify("AnimationStart",t),a.push(Zh(c,t,{...o,delay:e+(typeof s=="function"?0:s)+Nv(n.variantChildren,c,s,i,r)}).then(()=>c.notify("AnimationComplete",t)));return Promise.all(a)}function Nk(n,t,e={}){n.notify("AnimationStart",t);let s;if(Array.isArray(t)){const i=t.map(r=>Zh(n,r,e));s=Promise.all(i)}else if(typeof t=="string")s=Zh(n,t,e);else{const i=typeof t=="function"?yi(n,t,e.custom):t;s=Promise.all(Lv(n,i,e))}return s.then(()=>{n.notify("AnimationComplete",t)})}function Fv(n,t){if(!Array.isArray(t))return!1;const e=t.length;if(e!==n.length)return!1;for(let s=0;s<e;s++)if(t[s]!==n[s])return!1;return!0}const Fk=Bf.length;function Bv(n){if(!n)return;if(!n.isControllingVariants){const e=n.parent?Bv(n.parent)||{}:{};return n.props.initial!==void 0&&(e.initial=n.props.initial),e}const t={};for(let e=0;e<Fk;e++){const s=Bf[e],i=n.props[s];(Ir(i)||i===!1)&&(t[s]=i)}return t}const Bk=[...Ff].reverse(),$k=Ff.length;function Uk(n){return t=>Promise.all(t.map(({animation:e,options:s})=>Nk(n,e,s)))}function jk(n){let t=Uk(n),e=Mg(),s=!0;const i=c=>(l,u)=>{const h=yi(n,u,c==="exit"?n.presenceContext?.custom:void 0);if(h){const{transition:d,transitionEnd:f,...m}=h;l={...l,...m,...f}}return l};function r(c){t=c(n)}function o(c){const{props:l}=n,u=Bv(n.parent)||{},h=[],d=new Set;let f={},m=1/0;for(let g=0;g<$k;g++){const y=Bk[g],_=e[y],b=l[y]!==void 0?l[y]:u[y],w=Ir(b),v=y===c?_.isActive:null;v===!1&&(m=g);let A=b===u[y]&&b!==l[y]&&w;if(A&&s&&n.manuallyAnimateOnMount&&(A=!1),_.protectedKeys={...f},!_.isActive&&v===null||!b&&!_.prevProp||kc(b)||typeof b=="boolean")continue;const S=zk(_.prevProp,b);let T=S||y===c&&_.isActive&&!A&&w||g>m&&w,E=!1;const P=Array.isArray(b)?b:[b];let x=P.reduce(i(y),{});v===!1&&(x={});const{prevResolvedValues:I={}}=_,V={...I,...x},X=D=>{T=!0,d.has(D)&&(E=!0,d.delete(D)),_.needsAnimating[D]=!0;const k=n.getValue(D);k&&(k.liveStyle=!1)};for(const D in V){const k=x[D],L=I[D];if(f.hasOwnProperty(D))continue;let H=!1;Xh(k)&&Xh(L)?H=!Fv(k,L):H=k!==L,H?k!=null?X(D):d.add(D):k!==void 0&&d.has(D)?X(D):_.protectedKeys[D]=!0}_.prevProp=b,_.prevResolvedValues=x,_.isActive&&(f={...f,...x}),s&&n.blockInitialAnimation&&(T=!1);const st=A&&S;T&&(!st||E)&&h.push(...P.map(D=>{const k={type:y};if(typeof D=="string"&&s&&!st&&n.manuallyAnimateOnMount&&n.parent){const{parent:L}=n,H=yi(L,D);if(L.enteringChildren&&H){const{delayChildren:lt}=H.transition||{};k.delay=Nv(L.enteringChildren,n,lt)}}return{animation:D,options:k}}))}if(d.size){const g={};if(typeof l.initial!="boolean"){const y=yi(n,Array.isArray(l.initial)?l.initial[0]:l.initial);y&&y.transition&&(g.transition=y.transition)}d.forEach(y=>{const _=n.getBaseTarget(y),b=n.getValue(y);b&&(b.liveStyle=!0),g[y]=_??null}),h.push({animation:g})}let p=!!h.length;return s&&(l.initial===!1||l.initial===l.animate)&&!n.manuallyAnimateOnMount&&(p=!1),s=!1,p?t(h):Promise.resolve()}function a(c,l){if(e[c].isActive===l)return Promise.resolve();n.variantChildren?.forEach(h=>h.animationState?.setActive(c,l)),e[c].isActive=l;const u=o(c);for(const h in e)e[h].protectedKeys={};return u}return{animateChanges:o,setActive:a,setAnimateFunction:r,getState:()=>e,reset:()=>{e=Mg()}}}function zk(n,t){return typeof t=="string"?t!==n:Array.isArray(t)?!Fv(t,n):!1}function us(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Mg(){return{animate:us(!0),whileInView:us(),whileHover:us(),whileTap:us(),whileDrag:us(),whileFocus:us(),exit:us()}}class is{constructor(t){this.isMounted=!1,this.node=t}update(){}}class Vk extends is{constructor(t){super(t),t.animationState||(t.animationState=jk(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();kc(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:e}=this.node.prevProps||{};t!==e&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let Hk=0;class qk extends is{constructor(){super(...arguments),this.id=Hk++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:e}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===s)return;const i=this.node.animationState.setActive("exit",!t);e&&!t&&i.then(()=>{e(this.id)})}mount(){const{register:t,onExitComplete:e}=this.node.presenceContext||{};e&&e(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const Wk={animation:{Feature:Vk},exit:{Feature:qk}};function Lr(n,t,e,s={passive:!0}){return n.addEventListener(t,e,s),()=>n.removeEventListener(t,e)}function oo(n){return{point:{x:n.pageX,y:n.pageY}}}const Gk=n=>t=>Lf(t)&&n(t,oo(t));function Ar(n,t,e,s){return Lr(n,t,Gk(e),s)}const $v=1e-4,Yk=1-$v,Xk=1+$v,Uv=.01,Kk=0-Uv,Zk=0+Uv;function be(n){return n.max-n.min}function Jk(n,t,e){return Math.abs(n-t)<=e}function Rg(n,t,e,s=.5){n.origin=s,n.originPoint=Pt(t.min,t.max,n.origin),n.scale=be(e)/be(t),n.translate=Pt(e.min,e.max,n.origin)-n.originPoint,(n.scale>=Yk&&n.scale<=Xk||isNaN(n.scale))&&(n.scale=1),(n.translate>=Kk&&n.translate<=Zk||isNaN(n.translate))&&(n.translate=0)}function Sr(n,t,e,s){Rg(n.x,t.x,e.x,s?s.originX:void 0),Rg(n.y,t.y,e.y,s?s.originY:void 0)}function Og(n,t,e){n.min=e.min+t.min,n.max=n.min+be(t)}function Qk(n,t,e){Og(n.x,t.x,e.x),Og(n.y,t.y,e.y)}function Dg(n,t,e){n.min=t.min-e.min,n.max=n.min+be(t)}function La(n,t,e){Dg(n.x,t.x,e.x),Dg(n.y,t.y,e.y)}function Ve(n){return[n("x"),n("y")]}const jv=({current:n})=>n?n.ownerDocument.defaultView:null,Ig=(n,t)=>Math.abs(n-t);function tM(n,t){const e=Ig(n.x,t.x),s=Ig(n.y,t.y);return Math.sqrt(e**2+s**2)}class zv{constructor(t,e,{transformPagePoint:s,contextWindow:i=window,dragSnapToOrigin:r=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const d=Ml(this.lastMoveEventInfo,this.history),f=this.startEvent!==null,m=tM(d.offset,{x:0,y:0})>=this.distanceThreshold;if(!f&&!m)return;const{point:p}=d,{timestamp:g}=ie;this.history.push({...p,timestamp:g});const{onStart:y,onMove:_}=this.handlers;f||(y&&y(this.lastMoveEvent,d),this.startEvent=this.lastMoveEvent),_&&_(this.lastMoveEvent,d)},this.handlePointerMove=(d,f)=>{this.lastMoveEvent=d,this.lastMoveEventInfo=kl(f,this.transformPagePoint),Tt.update(this.updatePoint,!0)},this.handlePointerUp=(d,f)=>{this.end();const{onEnd:m,onSessionEnd:p,resumeAnimation:g}=this.handlers;if(this.dragSnapToOrigin&&g&&g(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const y=Ml(d.type==="pointercancel"?this.lastMoveEventInfo:kl(f,this.transformPagePoint),this.history);this.startEvent&&m&&m(d,y),p&&p(d,y)},!Lf(t))return;this.dragSnapToOrigin=r,this.handlers=e,this.transformPagePoint=s,this.distanceThreshold=o,this.contextWindow=i||window;const a=oo(t),c=kl(a,this.transformPagePoint),{point:l}=c,{timestamp:u}=ie;this.history=[{...l,timestamp:u}];const{onSessionStart:h}=e;h&&h(t,Ml(c,this.history)),this.removeListeners=so(Ar(this.contextWindow,"pointermove",this.handlePointerMove),Ar(this.contextWindow,"pointerup",this.handlePointerUp),Ar(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),ts(this.updatePoint)}}function kl(n,t){return t?{point:t(n.point)}:n}function Lg(n,t){return{x:n.x-t.x,y:n.y-t.y}}function Ml({point:n},t){return{point:n,delta:Lg(n,Vv(t)),offset:Lg(n,eM(t)),velocity:nM(t,.1)}}function eM(n){return n[0]}function Vv(n){return n[n.length-1]}function nM(n,t){if(n.length<2)return{x:0,y:0};let e=n.length-1,s=null;const i=Vv(n);for(;e>=0&&(s=n[e],!(i.timestamp-s.timestamp>_n(t)));)e--;if(!s)return{x:0,y:0};const r=We(i.timestamp-s.timestamp);if(r===0)return{x:0,y:0};const o={x:(i.x-s.x)/r,y:(i.y-s.y)/r};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function sM(n,{min:t,max:e},s){return t!==void 0&&n<t?n=s?Pt(t,n,s.min):Math.max(n,t):e!==void 0&&n>e&&(n=s?Pt(e,n,s.max):Math.min(n,e)),n}function Ng(n,t,e){return{min:t!==void 0?n.min+t:void 0,max:e!==void 0?n.max+e-(n.max-n.min):void 0}}function iM(n,{top:t,left:e,bottom:s,right:i}){return{x:Ng(n.x,e,i),y:Ng(n.y,t,s)}}function Fg(n,t){let e=t.min-n.min,s=t.max-n.max;return t.max-t.min<n.max-n.min&&([e,s]=[s,e]),{min:e,max:s}}function rM(n,t){return{x:Fg(n.x,t.x),y:Fg(n.y,t.y)}}function oM(n,t){let e=.5;const s=be(n),i=be(t);return i>s?e=Rr(t.min,t.max-s,n.min):s>i&&(e=Rr(n.min,n.max-i,t.min)),Nn(0,1,e)}function aM(n,t){const e={};return t.min!==void 0&&(e.min=t.min-n.min),t.max!==void 0&&(e.max=t.max-n.min),e}const Jh=.35;function cM(n=Jh){return n===!1?n=0:n===!0&&(n=Jh),{x:Bg(n,"left","right"),y:Bg(n,"top","bottom")}}function Bg(n,t,e){return{min:$g(n,t),max:$g(n,e)}}function $g(n,t){return typeof n=="number"?n:n[t]||0}const lM=new WeakMap;class uM{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ht(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:e=!1,distanceThreshold:s}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const r=h=>{const{dragSnapToOrigin:d}=this.getProps();d?this.pauseAnimation():this.stopAnimation(),e&&this.snapToCursor(oo(h).point)},o=(h,d)=>{const{drag:f,dragPropagation:m,onDragStart:p}=this.getProps();if(f&&!m&&(this.openDragLock&&this.openDragLock(),this.openDragLock=gP(f),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=d,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ve(y=>{let _=this.getAxisMotionValue(y).get()||0;if(wn.test(_)){const{projection:b}=this.visualElement;if(b&&b.layout){const w=b.layout.layoutBox[y];w&&(_=be(w)*(parseFloat(_)/100))}}this.originPoint[y]=_}),p&&Tt.postRender(()=>p(h,d)),Kh(this.visualElement,"transform");const{animationState:g}=this.visualElement;g&&g.setActive("whileDrag",!0)},a=(h,d)=>{this.latestPointerEvent=h,this.latestPanInfo=d;const{dragPropagation:f,dragDirectionLock:m,onDirectionLock:p,onDrag:g}=this.getProps();if(!f&&!this.openDragLock)return;const{offset:y}=d;if(m&&this.currentDirection===null){this.currentDirection=hM(y),this.currentDirection!==null&&p&&p(this.currentDirection);return}this.updateAxis("x",d.point,y),this.updateAxis("y",d.point,y),this.visualElement.render(),g&&g(h,d)},c=(h,d)=>{this.latestPointerEvent=h,this.latestPanInfo=d,this.stop(h,d),this.latestPointerEvent=null,this.latestPanInfo=null},l=()=>Ve(h=>this.getAnimationState(h)==="paused"&&this.getAxisMotionValue(h).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new zv(t,{onSessionStart:r,onStart:o,onMove:a,onSessionEnd:c,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:s,contextWindow:jv(this.visualElement)})}stop(t,e){const s=t||this.latestPointerEvent,i=e||this.latestPanInfo,r=this.isDragging;if(this.cancel(),!r||!i||!s)return;const{velocity:o}=i;this.startAnimation(o);const{onDragEnd:a}=this.getProps();a&&Tt.postRender(()=>a(s,i))}cancel(){this.isDragging=!1;const{projection:t,animationState:e}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),e&&e.setActive("whileDrag",!1)}updateAxis(t,e,s){const{drag:i}=this.getProps();if(!s||!Mo(t,i,this.currentDirection))return;const r=this.getAxisMotionValue(t);let o=this.originPoint[t]+s[t];this.constraints&&this.constraints[t]&&(o=sM(o,this.constraints[t],this.elastic[t])),r.set(o)}resolveConstraints(){const{dragConstraints:t,dragElastic:e}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,i=this.constraints;t&&ci(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&s?this.constraints=iM(s.layoutBox,t):this.constraints=!1,this.elastic=cM(e),i!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&Ve(r=>{this.constraints!==!1&&this.getAxisMotionValue(r)&&(this.constraints[r]=aM(s.layoutBox[r],this.constraints[r]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:e}=this.getProps();if(!t||!ci(t))return!1;const s=t.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const r=dk(s,i.root,this.visualElement.getTransformPagePoint());let o=rM(i.layout.layoutBox,r);if(e){const a=e(lk(o));this.hasMutatedConstraints=!!a,a&&(o=xv(a))}return o}startAnimation(t){const{drag:e,dragMomentum:s,dragElastic:i,dragTransition:r,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),c=this.constraints||{},l=Ve(u=>{if(!Mo(u,e,this.currentDirection))return;let h=c&&c[u]||{};o&&(h={min:0,max:0});const d=i?200:1e6,f=i?40:1e7,m={type:"inertia",velocity:s?t[u]:0,bounceStiffness:d,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...r,...h};return this.startAxisValueAnimation(u,m)});return Promise.all(l).then(a)}startAxisValueAnimation(t,e){const s=this.getAxisMotionValue(t);return Kh(this.visualElement,t),s.start(qf(t,s,0,e,this.visualElement,!1))}stopAnimation(){Ve(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Ve(t=>this.getAxisMotionValue(t).animation?.pause())}getAnimationState(t){return this.getAxisMotionValue(t).animation?.state}getAxisMotionValue(t){const e=`_drag${t.toUpperCase()}`,s=this.visualElement.getProps(),i=s[e];return i||this.visualElement.getValue(t,(s.initial?s.initial[t]:void 0)||0)}snapToCursor(t){Ve(e=>{const{drag:s}=this.getProps();if(!Mo(e,s,this.currentDirection))return;const{projection:i}=this.visualElement,r=this.getAxisMotionValue(e);if(i&&i.layout){const{min:o,max:a}=i.layout.layoutBox[e];r.set(t[e]-Pt(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:e}=this.getProps(),{projection:s}=this.visualElement;if(!ci(e)||!s||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Ve(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const c=a.get();i[o]=oM({min:c,max:c},this.constraints[o])}});const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Ve(o=>{if(!Mo(o,t,null))return;const a=this.getAxisMotionValue(o),{min:c,max:l}=this.constraints[o];a.set(Pt(c,l,i[o]))})}addListeners(){if(!this.visualElement.current)return;lM.set(this.visualElement,this);const t=this.visualElement.current,e=Ar(t,"pointerdown",c=>{const{drag:l,dragListener:u=!0}=this.getProps();l&&u&&this.start(c)}),s=()=>{const{dragConstraints:c}=this.getProps();ci(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,r=i.addEventListener("measure",s);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),Tt.read(s);const o=Lr(window,"resize",()=>this.scalePositionWithinConstraints()),a=i.addEventListener("didUpdate",(({delta:c,hasLayoutChanged:l})=>{this.isDragging&&l&&(Ve(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=c[u].translate,h.set(h.get()+c[u].translate))}),this.visualElement.render())}));return()=>{o(),e(),r(),a&&a()}}getProps(){const t=this.visualElement.getProps(),{drag:e=!1,dragDirectionLock:s=!1,dragPropagation:i=!1,dragConstraints:r=!1,dragElastic:o=Jh,dragMomentum:a=!0}=t;return{...t,drag:e,dragDirectionLock:s,dragPropagation:i,dragConstraints:r,dragElastic:o,dragMomentum:a}}}function Mo(n,t,e){return(t===!0||t===n)&&(e===null||e===n)}function hM(n,t=10){let e=null;return Math.abs(n.y)>t?e="y":Math.abs(n.x)>t&&(e="x"),e}class dM extends is{constructor(t){super(t),this.removeGroupControls=Xe,this.removeListeners=Xe,this.controls=new uM(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Xe}unmount(){this.removeGroupControls(),this.removeListeners()}}const Ug=n=>(t,e)=>{n&&Tt.postRender(()=>n(t,e))};class fM extends is{constructor(){super(...arguments),this.removePointerDownListener=Xe}onPointerDown(t){this.session=new zv(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:jv(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:e,onPan:s,onPanEnd:i}=this.node.getProps();return{onSessionStart:Ug(t),onStart:Ug(e),onMove:s,onEnd:(r,o)=>{delete this.session,i&&Tt.postRender(()=>i(r,o))}}}mount(){this.removePointerDownListener=Ar(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const fa={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let Rl=!1;class pM extends z.Component{componentDidMount(){const{visualElement:t,layoutGroup:e,switchLayoutGroup:s,layoutId:i}=this.props,{projection:r}=t;r&&(e.group&&e.group.add(r),s&&s.register&&i&&s.register(r),Rl&&r.root.didUpdate(),r.addEventListener("animationComplete",()=>{this.safeToRemove()}),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),fa.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:e,visualElement:s,drag:i,isPresent:r}=this.props,{projection:o}=s;return o&&(o.isPresent=r,Rl=!0,i||t.layoutDependency!==e||e===void 0||t.isPresent!==r?o.willUpdate():this.safeToRemove(),t.isPresent!==r&&(r?o.promote():o.relegate()||Tt.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),If.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:e,switchLayoutGroup:s}=this.props,{projection:i}=t;Rl=!0,i&&(i.scheduleCheckAfterUnmount(),e&&e.group&&e.group.remove(i),s&&s.deregister&&s.deregister(i))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function Hv(n){const[t,e]=dv(),s=z.useContext(ff);return In.jsx(pM,{...n,layoutGroup:s,switchLayoutGroup:z.useContext(Tv),isPresent:t,safeToRemove:e})}function mM(n,t,e){const s=de(n)?n:Ti(n);return s.start(qf("",s,t,e)),s.animation}const gM=(n,t)=>n.depth-t.depth;class yM{constructor(){this.children=[],this.isDirty=!1}add(t){gf(this.children,t),this.isDirty=!0}remove(t){yf(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(gM),this.isDirty=!1,this.children.forEach(t)}}function bM(n,t){const e=Ee.now(),s=({timestamp:i})=>{const r=i-e;r>=t&&(ts(s),n(r-t))};return Tt.setup(s,!0),()=>ts(s)}const qv=["TopLeft","TopRight","BottomLeft","BottomRight"],_M=qv.length,jg=n=>typeof n=="string"?parseFloat(n):n,zg=n=>typeof n=="number"||K.test(n);function wM(n,t,e,s,i,r){i?(n.opacity=Pt(0,e.opacity??1,vM(s)),n.opacityExit=Pt(t.opacity??1,0,AM(s))):r&&(n.opacity=Pt(t.opacity??1,e.opacity??1,s));for(let o=0;o<_M;o++){const a=`border${qv[o]}Radius`;let c=Vg(t,a),l=Vg(e,a);if(c===void 0&&l===void 0)continue;c||(c=0),l||(l=0),c===0||l===0||zg(c)===zg(l)?(n[a]=Math.max(Pt(jg(c),jg(l),s),0),(wn.test(l)||wn.test(c))&&(n[a]+="%")):n[a]=l}(t.rotate||e.rotate)&&(n.rotate=Pt(t.rotate||0,e.rotate||0,s))}function Vg(n,t){return n[t]!==void 0?n[t]:n.borderRadius}const vM=Wv(0,.5,Rw),AM=Wv(.5,.95,Xe);function Wv(n,t,e){return s=>s<n?0:s>t?1:e(Rr(n,t,s))}function Hg(n,t){n.min=t.min,n.max=t.max}function en(n,t){Hg(n.x,t.x),Hg(n.y,t.y)}function qg(n,t){n.translate=t.translate,n.scale=t.scale,n.originPoint=t.originPoint,n.origin=t.origin}function Wg(n,t,e,s,i){return n-=t,n=Ia(n,1/e,s),i!==void 0&&(n=Ia(n,1/i,s)),n}function SM(n,t=0,e=1,s=.5,i,r=n,o=n){if(wn.test(t)&&(t=parseFloat(t),t=Pt(o.min,o.max,t/100)-o.min),typeof t!="number")return;let a=Pt(r.min,r.max,s);n===r&&(a-=t),n.min=Wg(n.min,t,e,a,i),n.max=Wg(n.max,t,e,a,i)}function Gg(n,t,[e,s,i],r,o){SM(n,t[e],t[s],t[i],t.scale,r,o)}const TM=["x","scaleX","originX"],EM=["y","scaleY","originY"];function Yg(n,t,e,s){Gg(n.x,t,TM,e?e.x:void 0,s?s.x:void 0),Gg(n.y,t,EM,e?e.y:void 0,s?s.y:void 0)}function Xg(n){return n.translate===0&&n.scale===1}function Gv(n){return Xg(n.x)&&Xg(n.y)}function Kg(n,t){return n.min===t.min&&n.max===t.max}function xM(n,t){return Kg(n.x,t.x)&&Kg(n.y,t.y)}function Zg(n,t){return Math.round(n.min)===Math.round(t.min)&&Math.round(n.max)===Math.round(t.max)}function Yv(n,t){return Zg(n.x,t.x)&&Zg(n.y,t.y)}function Jg(n){return be(n.x)/be(n.y)}function Qg(n,t){return n.translate===t.translate&&n.scale===t.scale&&n.originPoint===t.originPoint}class CM{constructor(){this.members=[]}add(t){gf(this.members,t),t.scheduleRender()}remove(t){if(yf(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(t){const e=this.members.findIndex(i=>t===i);if(e===0)return!1;let s;for(let i=e;i>=0;i--){const r=this.members[i];if(r.isPresent!==!1){s=r;break}}return s?(this.promote(s),!0):!1}promote(t,e){const s=this.lead;if(t!==s&&(this.prevLead=s,this.lead=t,t.show(),s)){s.instance&&s.scheduleRender(),t.scheduleRender(),t.resumeFrom=s,e&&(t.resumeFrom.preserveOpacity=!0),s.snapshot&&(t.snapshot=s.snapshot,t.snapshot.latestValues=s.animationValues||s.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:i}=t.options;i===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:e,resumingFrom:s}=t;e.onExitComplete&&e.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function PM(n,t,e){let s="";const i=n.x.translate/t.x,r=n.y.translate/t.y,o=e?.z||0;if((i||r||o)&&(s=`translate3d(${i}px, ${r}px, ${o}px) `),(t.x!==1||t.y!==1)&&(s+=`scale(${1/t.x}, ${1/t.y}) `),e){const{transformPerspective:l,rotate:u,rotateX:h,rotateY:d,skewX:f,skewY:m}=e;l&&(s=`perspective(${l}px) ${s}`),u&&(s+=`rotate(${u}deg) `),h&&(s+=`rotateX(${h}deg) `),d&&(s+=`rotateY(${d}deg) `),f&&(s+=`skewX(${f}deg) `),m&&(s+=`skewY(${m}deg) `)}const a=n.x.scale*t.x,c=n.y.scale*t.y;return(a!==1||c!==1)&&(s+=`scale(${a}, ${c})`),s||"none"}const Ol=["","X","Y","Z"],kM=1e3;let MM=0;function Dl(n,t,e,s){const{latestValues:i}=t;i[n]&&(e[n]=i[n],t.setStaticValue(n,0),s&&(s[n]=0))}function Xv(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:t}=n.options;if(!t)return;const e=Iv(t);if(window.MotionHasOptimisedAnimation(e,"transform")){const{layout:i,layoutId:r}=n.options;window.MotionCancelOptimisedAnimation(e,"transform",Tt,!(i||r))}const{parent:s}=n;s&&!s.hasCheckedOptimisedAppear&&Xv(s)}function Kv({attachResizeListener:n,defaultParent:t,measureScroll:e,checkIsScrollRoot:s,resetTransform:i}){return class{constructor(o={},a=t?.()){this.id=MM++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(DM),this.nodes.forEach(FM),this.nodes.forEach(BM),this.nodes.forEach(IM)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new yM)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new wf),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const c=this.eventHandlers.get(o);c&&c.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=hv(o)&&!AP(o),this.instance=o;const{layoutId:a,layout:c,visualElement:l}=this.options;if(l&&!l.current&&l.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||a)&&(this.isLayoutDirty=!0),n){let u,h=0;const d=()=>this.root.updateBlockedByResize=!1;Tt.read(()=>{h=window.innerWidth}),n(o,()=>{const f=window.innerWidth;f!==h&&(h=f,this.root.updateBlockedByResize=!0,u&&u(),u=bM(d,250),fa.hasAnimatedSinceResize&&(fa.hasAnimatedSinceResize=!1,this.nodes.forEach(ny)))})}a&&this.root.registerSharedNode(a,this),this.options.animate!==!1&&l&&(a||c)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:h,hasRelativeLayoutChanged:d,layout:f})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const m=this.options.transition||l.getDefaultTransition()||VM,{onLayoutAnimationStart:p,onLayoutAnimationComplete:g}=l.getProps(),y=!this.targetLayout||!Yv(this.targetLayout,f),_=!h&&d;if(this.options.layoutRoot||this.resumeFrom||_||h&&(y||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const b={...Of(m,"layout"),onPlay:p,onComplete:g};(l.shouldReduceMotion||this.options.layoutRoot)&&(b.delay=0,b.type=!1),this.startAnimation(b),this.setAnimationOrigin(u,_)}else h||ny(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=f})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),ts(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach($M),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Xv(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:a,layout:c}=this.options;if(a===void 0&&!c)return;const l=this.getTransformTemplate();this.prevTransformTemplateValue=l?l(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(ty);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(ey);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(NM),this.nodes.forEach(RM),this.nodes.forEach(OM)):this.nodes.forEach(ey),this.clearAllSnapshots();const a=Ee.now();ie.delta=Nn(0,1e3/60,a-ie.timestamp),ie.timestamp=a,ie.isProcessing=!0,vl.update.process(ie),vl.preRender.process(ie),vl.render.process(ie),ie.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,If.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(LM),this.sharedNodes.forEach(UM)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Tt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Tt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!be(this.snapshot.measuredBox.x)&&!be(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=Ht(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a&&this.instance){const c=s(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:c,offset:e(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!i)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!Gv(this.projectionDelta),c=this.getTransformTemplate(),l=c?c(this.latestValues,""):void 0,u=l!==this.prevTransformTemplateValue;o&&this.instance&&(a||hs(this.latestValues)||u)&&(i(this.instance,l),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let c=this.removeElementScroll(a);return o&&(c=this.removeTransform(c)),HM(c),{animationId:this.root.animationId,measuredBox:a,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return Ht();const a=o.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(qM))){const{scroll:l}=this.root;l&&(li(a.x,l.offset.x),li(a.y,l.offset.y))}return a}removeElementScroll(o){const a=Ht();if(en(a,o),this.scroll?.wasRoot)return a;for(let c=0;c<this.path.length;c++){const l=this.path[c],{scroll:u,options:h}=l;l!==this.root&&u&&h.layoutScroll&&(u.wasRoot&&en(a,o),li(a.x,u.offset.x),li(a.y,u.offset.y))}return a}applyTransform(o,a=!1){const c=Ht();en(c,o);for(let l=0;l<this.path.length;l++){const u=this.path[l];!a&&u.options.layoutScroll&&u.scroll&&u!==u.root&&ui(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),hs(u.latestValues)&&ui(c,u.latestValues)}return hs(this.latestValues)&&ui(c,this.latestValues),c}removeTransform(o){const a=Ht();en(a,o);for(let c=0;c<this.path.length;c++){const l=this.path[c];if(!l.instance||!hs(l.latestValues))continue;Wh(l.latestValues)&&l.updateSnapshot();const u=Ht(),h=l.measurePageBox();en(u,h),Yg(a,l.latestValues,l.snapshot?l.snapshot.layoutBox:void 0,u)}return hs(this.latestValues)&&Yg(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ie.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){const a=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=a.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=a.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=a.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==a;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:h}=this.options;if(!this.layout||!(u||h))return;this.resolvedRelativeTargetAt=ie.timestamp;const d=this.getClosestProjectingParent();d&&this.linkedParentVersion!==d.layoutVersion&&!d.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(d&&d.layout?this.createRelativeTarget(d,this.layout.layoutBox,d.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Ht(),this.targetWithTransforms=Ht()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Qk(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):en(this.target,this.layout.layoutBox),Pv(this.target,this.targetDelta)):en(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,d&&!!d.resumingFrom==!!this.resumingFrom&&!d.options.layoutScroll&&d.target&&this.animationProgress!==1?this.createRelativeTarget(d,this.target,d.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||Wh(this.parent.latestValues)||Cv(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(o,a,c){this.relativeParent=o,this.linkedParentVersion=o.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ht(),this.relativeTargetOrigin=Ht(),La(this.relativeTargetOrigin,a,c),en(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const o=this.getLead(),a=!!this.resumingFrom||this!==o;let c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),a&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===ie.timestamp&&(c=!1),c)return;const{layout:l,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(l||u))return;en(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,d=this.treeScale.y;hk(this.layoutCorrected,this.treeScale,this.path,a),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=Ht());const{target:f}=o;if(!f){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(qg(this.prevProjectionDelta.x,this.projectionDelta.x),qg(this.prevProjectionDelta.y,this.projectionDelta.y)),Sr(this.projectionDelta,this.layoutCorrected,f,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==d||!Qg(this.projectionDelta.x,this.prevProjectionDelta.x)||!Qg(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",f))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.visualElement?.scheduleRender(),o){const a=this.getStack();a&&a.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=hi(),this.projectionDelta=hi(),this.projectionDeltaWithTransform=hi()}setAnimationOrigin(o,a=!1){const c=this.snapshot,l=c?c.latestValues:{},u={...this.latestValues},h=hi();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const d=Ht(),f=c?c.source:void 0,m=this.layout?this.layout.source:void 0,p=f!==m,g=this.getStack(),y=!g||g.members.length<=1,_=!!(p&&!y&&this.options.crossfade===!0&&!this.path.some(zM));this.animationProgress=0;let b;this.mixTargetDelta=w=>{const v=w/1e3;sy(h.x,o.x,v),sy(h.y,o.y,v),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(La(d,this.layout.layoutBox,this.relativeParent.layout.layoutBox),jM(this.relativeTarget,this.relativeTargetOrigin,d,v),b&&xM(this.relativeTarget,b)&&(this.isProjectionDirty=!1),b||(b=Ht()),en(b,this.relativeTarget)),p&&(this.animationValues=u,wM(u,l,this.latestValues,v,_,y)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=v},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(ts(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Tt.update(()=>{fa.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Ti(0)),this.currentAnimation=mM(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:a=>{this.mixTargetDelta(a),o.onUpdate&&o.onUpdate(a)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(kM),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:c,layout:l,latestValues:u}=o;if(!(!a||!c||!l)){if(this!==o&&this.layout&&l&&Zv(this.options.animationType,this.layout.layoutBox,l.layoutBox)){c=this.target||Ht();const h=be(this.layout.layoutBox.x);c.x.min=o.target.x.min,c.x.max=c.x.min+h;const d=be(this.layout.layoutBox.y);c.y.min=o.target.y.min,c.y.max=c.y.min+d}en(a,c),ui(a,u),Sr(this.projectionDeltaWithTransform,this.layoutCorrected,a,u)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new CM),this.sharedNodes.get(o).add(a);const l=a.options.initialPromotionConfig;a.promote({transition:l?l.transition:void 0,preserveFollowOpacity:l&&l.shouldPreserveFollowOpacity?l.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){const{layoutId:o}=this.options;return o?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:o}=this.options;return o?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:c}={}){const l=this.getStack();l&&l.promote(this,c),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:c}=o;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(a=!0),!a)return;const l={};c.z&&Dl("z",o,l,this.animationValues);for(let u=0;u<Ol.length;u++)Dl(`rotate${Ol[u]}`,o,l,this.animationValues),Dl(`skew${Ol[u]}`,o,l,this.animationValues);o.render();for(const u in l)o.setStaticValue(u,l[u]),this.animationValues&&(this.animationValues[u]=l[u]);o.scheduleRender()}applyProjectionStyles(o,a){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=da(a?.pointerEvents)||"",o.transform=c?c(this.latestValues,""):"none";return}const l=this.getLead();if(!this.projectionDelta||!this.layout||!l.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=da(a?.pointerEvents)||""),this.hasProjected&&!hs(this.latestValues)&&(o.transform=c?c({},""):"none",this.hasProjected=!1);return}o.visibility="";const u=l.animationValues||l.latestValues;this.applyTransformsToTarget();let h=PM(this.projectionDeltaWithTransform,this.treeScale,u);c&&(h=c(u,h)),o.transform=h;const{x:d,y:f}=this.projectionDelta;o.transformOrigin=`${d.origin*100}% ${f.origin*100}% 0`,l.animationValues?o.opacity=l===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:o.opacity=l===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const m in qh){if(u[m]===void 0)continue;const{correct:p,applyTo:g,isCSSVariable:y}=qh[m],_=h==="none"?u[m]:p(u[m],l);if(g){const b=g.length;for(let w=0;w<b;w++)o[g[w]]=_}else y?this.options.visualElement.renderState.vars[m]=_:o[m]=_}this.options.layoutId&&(o.pointerEvents=l===this?da(a?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>o.currentAnimation?.stop()),this.root.nodes.forEach(ty),this.root.sharedNodes.clear()}}}function RM(n){n.updateLayout()}function OM(n){const t=n.resumeFrom?.snapshot||n.snapshot;if(n.isLead()&&n.layout&&t&&n.hasListeners("didUpdate")){const{layoutBox:e,measuredBox:s}=n.layout,{animationType:i}=n.options,r=t.source!==n.layout.source;i==="size"?Ve(u=>{const h=r?t.measuredBox[u]:t.layoutBox[u],d=be(h);h.min=e[u].min,h.max=h.min+d}):Zv(i,t.layoutBox,e)&&Ve(u=>{const h=r?t.measuredBox[u]:t.layoutBox[u],d=be(e[u]);h.max=h.min+d,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[u].max=n.relativeTarget[u].min+d)});const o=hi();Sr(o,e,t.layoutBox);const a=hi();r?Sr(a,n.applyTransform(s,!0),t.measuredBox):Sr(a,e,t.layoutBox);const c=!Gv(o);let l=!1;if(!n.resumeFrom){const u=n.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:h,layout:d}=u;if(h&&d){const f=Ht();La(f,t.layoutBox,h.layoutBox);const m=Ht();La(m,e,d.layoutBox),Yv(f,m)||(l=!0),u.options.layoutRoot&&(n.relativeTarget=m,n.relativeTargetOrigin=f,n.relativeParent=u)}}}n.notifyListeners("didUpdate",{layout:e,snapshot:t,delta:a,layoutDelta:o,hasLayoutChanged:c,hasRelativeLayoutChanged:l})}else if(n.isLead()){const{onExitComplete:e}=n.options;e&&e()}n.options.transition=void 0}function DM(n){n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function IM(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function LM(n){n.clearSnapshot()}function ty(n){n.clearMeasurements()}function ey(n){n.isLayoutDirty=!1}function NM(n){const{visualElement:t}=n.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),n.resetTransform()}function ny(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function FM(n){n.resolveTargetDelta()}function BM(n){n.calcProjection()}function $M(n){n.resetSkewAndRotation()}function UM(n){n.removeLeadSnapshot()}function sy(n,t,e){n.translate=Pt(t.translate,0,e),n.scale=Pt(t.scale,1,e),n.origin=t.origin,n.originPoint=t.originPoint}function iy(n,t,e,s){n.min=Pt(t.min,e.min,s),n.max=Pt(t.max,e.max,s)}function jM(n,t,e,s){iy(n.x,t.x,e.x,s),iy(n.y,t.y,e.y,s)}function zM(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const VM={duration:.45,ease:[.4,0,.1,1]},ry=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),oy=ry("applewebkit/")&&!ry("chrome/")?Math.round:Xe;function ay(n){n.min=oy(n.min),n.max=oy(n.max)}function HM(n){ay(n.x),ay(n.y)}function Zv(n,t,e){return n==="position"||n==="preserve-aspect"&&!Jk(Jg(t),Jg(e),.2)}function qM(n){return n!==n.root&&n.scroll?.wasRoot}const WM=Kv({attachResizeListener:(n,t)=>Lr(n,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Il={current:void 0},Jv=Kv({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!Il.current){const n=new WM({});n.mount(window),n.setOptions({layoutScroll:!0}),Il.current=n}return Il.current},resetTransform:(n,t)=>{n.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),GM={pan:{Feature:fM},drag:{Feature:dM,ProjectionNode:Jv,MeasureLayout:Hv}};function cy(n,t,e){const{props:s}=n;n.animationState&&s.whileHover&&n.animationState.setActive("whileHover",e==="Start");const i="onHover"+e,r=s[i];r&&Tt.postRender(()=>r(t,oo(t)))}class YM extends is{mount(){const{current:t}=this.node;t&&(this.unmount=yP(t,(e,s)=>(cy(this.node,s,"Start"),i=>cy(this.node,i,"End"))))}unmount(){}}class XM extends is{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=so(Lr(this.node.current,"focus",()=>this.onFocus()),Lr(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function ly(n,t,e){const{props:s}=n;if(n.current instanceof HTMLButtonElement&&n.current.disabled)return;n.animationState&&s.whileTap&&n.animationState.setActive("whileTap",e==="Start");const i="onTap"+(e==="End"?"":e),r=s[i];r&&Tt.postRender(()=>r(t,oo(t)))}class KM extends is{mount(){const{current:t}=this.node;t&&(this.unmount=vP(t,(e,s)=>(ly(this.node,s,"Start"),(i,{success:r})=>ly(this.node,i,r?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Qh=new WeakMap,Ll=new WeakMap,ZM=n=>{const t=Qh.get(n.target);t&&t(n)},JM=n=>{n.forEach(ZM)};function QM({root:n,...t}){const e=n||document;Ll.has(e)||Ll.set(e,{});const s=Ll.get(e),i=JSON.stringify(t);return s[i]||(s[i]=new IntersectionObserver(JM,{root:n,...t})),s[i]}function tR(n,t,e){const s=QM(t);return Qh.set(n,e),s.observe(n),()=>{Qh.delete(n),s.unobserve(n)}}const eR={some:0,all:1};class nR extends is{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:e,margin:s,amount:i="some",once:r}=t,o={root:e?e.current:void 0,rootMargin:s,threshold:typeof i=="number"?i:eR[i]},a=c=>{const{isIntersecting:l}=c;if(this.isInView===l||(this.isInView=l,r&&!l&&this.hasEnteredView))return;l&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",l);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),d=l?u:h;d&&d(c)};return tR(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:e}=this.node;["amount","margin","root"].some(sR(t,e))&&this.startObserver()}unmount(){}}function sR({viewport:n={}},{viewport:t={}}={}){return e=>n[e]!==t[e]}const iR={inView:{Feature:nR},tap:{Feature:KM},focus:{Feature:XM},hover:{Feature:YM}},rR={layout:{ProjectionNode:Jv,MeasureLayout:Hv}},oR={...Wk,...iR,...GM,...rR},IH=ck(oR,vk);function Qv(n){var t,e,s="";if(typeof n=="string"||typeof n=="number")s+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(t=0;t<i;t++)n[t]&&(e=Qv(n[t]))&&(s&&(s+=" "),s+=e)}else for(e in n)n[e]&&(s&&(s+=" "),s+=e);return s}function LH(){for(var n,t,e=0,s="",i=arguments.length;e<i;e++)(n=arguments[e])&&(t=Qv(n))&&(s&&(s+=" "),s+=t);return s}function wt(n){return function(){return n}}const tA=Math.cos,Na=Math.sin,un=Math.sqrt,Fa=Math.PI,Rc=2*Fa,td=Math.PI,ed=2*td,ds=1e-6,aR=ed-ds;function eA(n){this._+=n[0];for(let t=1,e=n.length;t<e;++t)this._+=arguments[t]+n[t]}function cR(n){let t=Math.floor(n);if(!(t>=0))throw new Error(`invalid digits: ${n}`);if(t>15)return eA;const e=10**t;return function(s){this._+=s[0];for(let i=1,r=s.length;i<r;++i)this._+=Math.round(arguments[i]*e)/e+s[i]}}class lR{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?eA:cR(t)}moveTo(t,e){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,e){this._append`L${this._x1=+t},${this._y1=+e}`}quadraticCurveTo(t,e,s,i){this._append`Q${+t},${+e},${this._x1=+s},${this._y1=+i}`}bezierCurveTo(t,e,s,i,r,o){this._append`C${+t},${+e},${+s},${+i},${this._x1=+r},${this._y1=+o}`}arcTo(t,e,s,i,r){if(t=+t,e=+e,s=+s,i=+i,r=+r,r<0)throw new Error(`negative radius: ${r}`);let o=this._x1,a=this._y1,c=s-t,l=i-e,u=o-t,h=a-e,d=u*u+h*h;if(this._x1===null)this._append`M${this._x1=t},${this._y1=e}`;else if(d>ds)if(!(Math.abs(h*c-l*u)>ds)||!r)this._append`L${this._x1=t},${this._y1=e}`;else{let f=s-o,m=i-a,p=c*c+l*l,g=f*f+m*m,y=Math.sqrt(p),_=Math.sqrt(d),b=r*Math.tan((td-Math.acos((p+d-g)/(2*y*_)))/2),w=b/_,v=b/y;Math.abs(w-1)>ds&&this._append`L${t+w*u},${e+w*h}`,this._append`A${r},${r},0,0,${+(h*f>u*m)},${this._x1=t+v*c},${this._y1=e+v*l}`}}arc(t,e,s,i,r,o){if(t=+t,e=+e,s=+s,o=!!o,s<0)throw new Error(`negative radius: ${s}`);let a=s*Math.cos(i),c=s*Math.sin(i),l=t+a,u=e+c,h=1^o,d=o?i-r:r-i;this._x1===null?this._append`M${l},${u}`:(Math.abs(this._x1-l)>ds||Math.abs(this._y1-u)>ds)&&this._append`L${l},${u}`,s&&(d<0&&(d=d%ed+ed),d>aR?this._append`A${s},${s},0,1,${h},${t-a},${e-c}A${s},${s},0,1,${h},${this._x1=l},${this._y1=u}`:d>ds&&this._append`A${s},${s},0,${+(d>=td)},${h},${this._x1=t+s*Math.cos(r)},${this._y1=e+s*Math.sin(r)}`)}rect(t,e,s,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${s=+s}v${+i}h${-s}Z`}toString(){return this._}}function Wf(n){let t=3;return n.digits=function(e){if(!arguments.length)return t;if(e==null)t=null;else{const s=Math.floor(e);if(!(s>=0))throw new RangeError(`invalid digits: ${e}`);t=s}return n},()=>new lR(t)}function Gf(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function nA(n){this._context=n}nA.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,t){switch(n=+n,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,t):this._context.moveTo(n,t);break;case 1:this._point=2;default:this._context.lineTo(n,t);break}}};function sA(n){return new nA(n)}function iA(n){return n[0]}function rA(n){return n[1]}function uR(n,t){var e=wt(!0),s=null,i=sA,r=null,o=Wf(a);n=typeof n=="function"?n:n===void 0?iA:wt(n),t=typeof t=="function"?t:t===void 0?rA:wt(t);function a(c){var l,u=(c=Gf(c)).length,h,d=!1,f;for(s==null&&(r=i(f=o())),l=0;l<=u;++l)!(l<u&&e(h=c[l],l,c))===d&&((d=!d)?r.lineStart():r.lineEnd()),d&&r.point(+n(h,l,c),+t(h,l,c));if(f)return r=null,f+""||null}return a.x=function(c){return arguments.length?(n=typeof c=="function"?c:wt(+c),a):n},a.y=function(c){return arguments.length?(t=typeof c=="function"?c:wt(+c),a):t},a.defined=function(c){return arguments.length?(e=typeof c=="function"?c:wt(!!c),a):e},a.curve=function(c){return arguments.length?(i=c,s!=null&&(r=i(s)),a):i},a.context=function(c){return arguments.length?(c==null?s=r=null:r=i(s=c),a):s},a}function NH(n,t,e){var s=null,i=wt(!0),r=null,o=sA,a=null,c=Wf(l);n=typeof n=="function"?n:n===void 0?iA:wt(+n),t=typeof t=="function"?t:wt(t===void 0?0:+t),e=typeof e=="function"?e:e===void 0?rA:wt(+e);function l(h){var d,f,m,p=(h=Gf(h)).length,g,y=!1,_,b=new Array(p),w=new Array(p);for(r==null&&(a=o(_=c())),d=0;d<=p;++d){if(!(d<p&&i(g=h[d],d,h))===y)if(y=!y)f=d,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),m=d-1;m>=f;--m)a.point(b[m],w[m]);a.lineEnd(),a.areaEnd()}y&&(b[d]=+n(g,d,h),w[d]=+t(g,d,h),a.point(s?+s(g,d,h):b[d],e?+e(g,d,h):w[d]))}if(_)return a=null,_+""||null}function u(){return uR().defined(i).curve(o).context(r)}return l.x=function(h){return arguments.length?(n=typeof h=="function"?h:wt(+h),s=null,l):n},l.x0=function(h){return arguments.length?(n=typeof h=="function"?h:wt(+h),l):n},l.x1=function(h){return arguments.length?(s=h==null?null:typeof h=="function"?h:wt(+h),l):s},l.y=function(h){return arguments.length?(t=typeof h=="function"?h:wt(+h),e=null,l):t},l.y0=function(h){return arguments.length?(t=typeof h=="function"?h:wt(+h),l):t},l.y1=function(h){return arguments.length?(e=h==null?null:typeof h=="function"?h:wt(+h),l):e},l.lineX0=l.lineY0=function(){return u().x(n).y(t)},l.lineY1=function(){return u().x(n).y(e)},l.lineX1=function(){return u().x(s).y(t)},l.defined=function(h){return arguments.length?(i=typeof h=="function"?h:wt(!!h),l):i},l.curve=function(h){return arguments.length?(o=h,r!=null&&(a=o(r)),l):o},l.context=function(h){return arguments.length?(h==null?r=a=null:a=o(r=h),l):r},l}class oA{constructor(t,e){this._context=t,this._x=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,e){switch(t=+t,e=+e,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,e,t,e):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+e)/2,t,this._y0,t,e);break}}this._x0=t,this._y0=e}}function FH(n){return new oA(n,!0)}function BH(n){return new oA(n,!1)}const hR={draw(n,t){const e=un(t/Fa);n.moveTo(e,0),n.arc(0,0,e,0,Rc)}},$H={draw(n,t){const e=un(t/5)/2;n.moveTo(-3*e,-e),n.lineTo(-e,-e),n.lineTo(-e,-3*e),n.lineTo(e,-3*e),n.lineTo(e,-e),n.lineTo(3*e,-e),n.lineTo(3*e,e),n.lineTo(e,e),n.lineTo(e,3*e),n.lineTo(-e,3*e),n.lineTo(-e,e),n.lineTo(-3*e,e),n.closePath()}},aA=un(1/3),dR=aA*2,UH={draw(n,t){const e=un(t/dR),s=e*aA;n.moveTo(0,-e),n.lineTo(s,0),n.lineTo(0,e),n.lineTo(-s,0),n.closePath()}},jH={draw(n,t){const e=un(t),s=-e/2;n.rect(s,s,e,e)}},fR=.8908130915292852,cA=Na(Fa/10)/Na(7*Fa/10),pR=Na(Rc/10)*cA,mR=-tA(Rc/10)*cA,zH={draw(n,t){const e=un(t*fR),s=pR*e,i=mR*e;n.moveTo(0,-e),n.lineTo(s,i);for(let r=1;r<5;++r){const o=Rc*r/5,a=tA(o),c=Na(o);n.lineTo(c*e,-a*e),n.lineTo(a*s-c*i,c*s+a*i)}n.closePath()}},Nl=un(3),VH={draw(n,t){const e=-un(t/(Nl*3));n.moveTo(0,e*2),n.lineTo(-Nl*e,-e),n.lineTo(Nl*e,-e),n.closePath()}},$e=-.5,Ue=un(3)/2,nd=1/un(12),gR=(nd/2+1)*3,HH={draw(n,t){const e=un(t/gR),s=e/2,i=e*nd,r=s,o=e*nd+e,a=-r,c=o;n.moveTo(s,i),n.lineTo(r,o),n.lineTo(a,c),n.lineTo($e*s-Ue*i,Ue*s+$e*i),n.lineTo($e*r-Ue*o,Ue*r+$e*o),n.lineTo($e*a-Ue*c,Ue*a+$e*c),n.lineTo($e*s+Ue*i,$e*i-Ue*s),n.lineTo($e*r+Ue*o,$e*o-Ue*r),n.lineTo($e*a+Ue*c,$e*c-Ue*a),n.closePath()}};function qH(n,t){let e=null,s=Wf(i);n=typeof n=="function"?n:wt(n||hR),t=typeof t=="function"?t:wt(t===void 0?64:+t);function i(){let r;if(e||(e=r=s()),n.apply(this,arguments).draw(e,+t.apply(this,arguments)),r)return e=null,r+""||null}return i.type=function(r){return arguments.length?(n=typeof r=="function"?r:wt(r),i):n},i.size=function(r){return arguments.length?(t=typeof r=="function"?r:wt(+r),i):t},i.context=function(r){return arguments.length?(e=r??null,i):e},i}function Ba(){}function $a(n,t,e){n._context.bezierCurveTo((2*n._x0+n._x1)/3,(2*n._y0+n._y1)/3,(n._x0+2*n._x1)/3,(n._y0+2*n._y1)/3,(n._x0+4*n._x1+t)/6,(n._y0+4*n._y1+e)/6)}function lA(n){this._context=n}lA.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:$a(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,t){switch(n=+n,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,t):this._context.moveTo(n,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:$a(this,n,t);break}this._x0=this._x1,this._x1=n,this._y0=this._y1,this._y1=t}};function WH(n){return new lA(n)}function uA(n){this._context=n}uA.prototype={areaStart:Ba,areaEnd:Ba,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(n,t){switch(n=+n,t=+t,this._point){case 0:this._point=1,this._x2=n,this._y2=t;break;case 1:this._point=2,this._x3=n,this._y3=t;break;case 2:this._point=3,this._x4=n,this._y4=t,this._context.moveTo((this._x0+4*this._x1+n)/6,(this._y0+4*this._y1+t)/6);break;default:$a(this,n,t);break}this._x0=this._x1,this._x1=n,this._y0=this._y1,this._y1=t}};function GH(n){return new uA(n)}function hA(n){this._context=n}hA.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(n,t){switch(n=+n,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var e=(this._x0+4*this._x1+n)/6,s=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(e,s):this._context.moveTo(e,s);break;case 3:this._point=4;default:$a(this,n,t);break}this._x0=this._x1,this._x1=n,this._y0=this._y1,this._y1=t}};function YH(n){return new hA(n)}function dA(n){this._context=n}dA.prototype={areaStart:Ba,areaEnd:Ba,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(n,t){n=+n,t=+t,this._point?this._context.lineTo(n,t):(this._point=1,this._context.moveTo(n,t))}};function XH(n){return new dA(n)}function uy(n){return n<0?-1:1}function hy(n,t,e){var s=n._x1-n._x0,i=t-n._x1,r=(n._y1-n._y0)/(s||i<0&&-0),o=(e-n._y1)/(i||s<0&&-0),a=(r*i+o*s)/(s+i);return(uy(r)+uy(o))*Math.min(Math.abs(r),Math.abs(o),.5*Math.abs(a))||0}function dy(n,t){var e=n._x1-n._x0;return e?(3*(n._y1-n._y0)/e-t)/2:t}function Fl(n,t,e){var s=n._x0,i=n._y0,r=n._x1,o=n._y1,a=(r-s)/3;n._context.bezierCurveTo(s+a,i+a*t,r-a,o-a*e,r,o)}function Ua(n){this._context=n}Ua.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Fl(this,this._t0,dy(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,t){var e=NaN;if(n=+n,t=+t,!(n===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(n,t):this._context.moveTo(n,t);break;case 1:this._point=2;break;case 2:this._point=3,Fl(this,dy(this,e=hy(this,n,t)),e);break;default:Fl(this,this._t0,e=hy(this,n,t));break}this._x0=this._x1,this._x1=n,this._y0=this._y1,this._y1=t,this._t0=e}}};function fA(n){this._context=new pA(n)}(fA.prototype=Object.create(Ua.prototype)).point=function(n,t){Ua.prototype.point.call(this,t,n)};function pA(n){this._context=n}pA.prototype={moveTo:function(n,t){this._context.moveTo(t,n)},closePath:function(){this._context.closePath()},lineTo:function(n,t){this._context.lineTo(t,n)},bezierCurveTo:function(n,t,e,s,i,r){this._context.bezierCurveTo(t,n,s,e,r,i)}};function KH(n){return new Ua(n)}function ZH(n){return new fA(n)}function mA(n){this._context=n}mA.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var n=this._x,t=this._y,e=n.length;if(e)if(this._line?this._context.lineTo(n[0],t[0]):this._context.moveTo(n[0],t[0]),e===2)this._context.lineTo(n[1],t[1]);else for(var s=fy(n),i=fy(t),r=0,o=1;o<e;++r,++o)this._context.bezierCurveTo(s[0][r],i[0][r],s[1][r],i[1][r],n[o],t[o]);(this._line||this._line!==0&&e===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(n,t){this._x.push(+n),this._y.push(+t)}};function fy(n){var t,e=n.length-1,s,i=new Array(e),r=new Array(e),o=new Array(e);for(i[0]=0,r[0]=2,o[0]=n[0]+2*n[1],t=1;t<e-1;++t)i[t]=1,r[t]=4,o[t]=4*n[t]+2*n[t+1];for(i[e-1]=2,r[e-1]=7,o[e-1]=8*n[e-1]+n[e],t=1;t<e;++t)s=i[t]/r[t-1],r[t]-=s,o[t]-=s*o[t-1];for(i[e-1]=o[e-1]/r[e-1],t=e-2;t>=0;--t)i[t]=(o[t]-i[t+1])/r[t];for(r[e-1]=(n[e]+i[e-1])/2,t=0;t<e-1;++t)r[t]=2*n[t+1]-i[t+1];return[i,r]}function JH(n){return new mA(n)}function Oc(n,t){this._context=n,this._t=t}Oc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(n,t){switch(n=+n,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,t):this._context.moveTo(n,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(n,t);else{var e=this._x*(1-this._t)+n*this._t;this._context.lineTo(e,this._y),this._context.lineTo(e,t)}break}}this._x=n,this._y=t}};function QH(n){return new Oc(n,.5)}function tq(n){return new Oc(n,0)}function eq(n){return new Oc(n,1)}function Nr(n,t){if((o=n.length)>1)for(var e=1,s,i,r=n[t[0]],o,a=r.length;e<o;++e)for(i=r,r=n[t[e]],s=0;s<a;++s)r[s][1]+=r[s][0]=isNaN(i[s][1])?i[s][0]:i[s][1]}function py(n){for(var t=n.length,e=new Array(t);--t>=0;)e[t]=t;return e}function yR(n,t){return n[t]}function bR(n){const t=[];return t.key=n,t}function nq(){var n=wt([]),t=py,e=Nr,s=yR;function i(r){var o=Array.from(n.apply(this,arguments),bR),a,c=o.length,l=-1,u;for(const h of r)for(a=0,++l;a<c;++a)(o[a][l]=[0,+s(h,o[a].key,l,r)]).data=h;for(a=0,u=Gf(t(o));a<c;++a)o[u[a]].index=a;return e(o,u),o}return i.keys=function(r){return arguments.length?(n=typeof r=="function"?r:wt(Array.from(r)),i):n},i.value=function(r){return arguments.length?(s=typeof r=="function"?r:wt(+r),i):s},i.order=function(r){return arguments.length?(t=r==null?py:typeof r=="function"?r:wt(Array.from(r)),i):t},i.offset=function(r){return arguments.length?(e=r??Nr,i):e},i}function sq(n,t){if((s=n.length)>0){for(var e,s,i=0,r=n[0].length,o;i<r;++i){for(o=e=0;e<s;++e)o+=n[e][i][1]||0;if(o)for(e=0;e<s;++e)n[e][i][1]/=o}Nr(n,t)}}function iq(n,t){if((i=n.length)>0){for(var e=0,s=n[t[0]],i,r=s.length;e<r;++e){for(var o=0,a=0;o<i;++o)a+=n[o][e][1]||0;s[e][1]+=s[e][0]=-a/2}Nr(n,t)}}function rq(n,t){if(!(!((o=n.length)>0)||!((r=(i=n[t[0]]).length)>0))){for(var e=0,s=1,i,r,o;s<r;++s){for(var a=0,c=0,l=0;a<o;++a){for(var u=n[t[a]],h=u[s][1]||0,d=u[s-1][1]||0,f=(h-d)/2,m=0;m<a;++m){var p=n[t[m]],g=p[s][1]||0,y=p[s-1][1]||0;f+=g-y}c+=h,l+=f*h}i[s-1][1]+=i[s-1][0]=e,c&&(e-=l/c)}i[s-1][1]+=i[s-1][0]=e,Nr(n,t)}}var Bl={},$l={},my;function _R(){return my||(my=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e){return e==="__proto__"}n.isUnsafeProperty=t})($l)),$l}var Ul={},gy;function gA(){return gy||(gy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e){switch(typeof e){case"number":case"symbol":return!1;case"string":return e.includes(".")||e.includes("[")||e.includes("]")}}n.isDeepKey=t})(Ul)),Ul}var jl={},yy;function Yf(){return yy||(yy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e){return typeof e=="string"||typeof e=="symbol"?e:Object.is(e?.valueOf?.(),-0)?"-0":String(e)}n.toKey=t})(jl)),jl}var zl={},Vl={},by;function wR(){return by||(by=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e){if(e==null)return"";if(typeof e=="string")return e;if(Array.isArray(e))return e.map(t).join(",");const s=String(e);return s==="0"&&Object.is(Number(e),-0)?"-0":s}n.toString=t})(Vl)),Vl}var _y;function Xf(){return _y||(_y=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=wR(),e=Yf();function s(i){if(Array.isArray(i))return i.map(e.toKey);if(typeof i=="symbol")return[i];i=t.toString(i);const r=[],o=i.length;if(o===0)return r;let a=0,c="",l="",u=!1;for(i.charCodeAt(0)===46&&(r.push(""),a++);a<o;){const h=i[a];l?h==="\\"&&a+1<o?(a++,c+=i[a]):h===l?l="":c+=h:u?h==='"'||h==="'"?l=h:h==="]"?(u=!1,r.push(c),c=""):c+=h:h==="["?(u=!0,c&&(r.push(c),c="")):h==="."?c&&(r.push(c),c=""):c+=h,a++}return c&&r.push(c),r}n.toPath=s})(zl)),zl}var wy;function Kf(){return wy||(wy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=_R(),e=gA(),s=Yf(),i=Xf();function r(a,c,l){if(a==null)return l;switch(typeof c){case"string":{if(t.isUnsafeProperty(c))return l;const u=a[c];return u===void 0?e.isDeepKey(c)?r(a,i.toPath(c),l):l:u}case"number":case"symbol":{typeof c=="number"&&(c=s.toKey(c));const u=a[c];return u===void 0?l:u}default:{if(Array.isArray(c))return o(a,c,l);if(Object.is(c?.valueOf(),-0)?c="-0":c=String(c),t.isUnsafeProperty(c))return l;const u=a[c];return u===void 0?l:u}}}function o(a,c,l){if(c.length===0)return l;let u=a;for(let h=0;h<c.length;h++){if(u==null||t.isUnsafeProperty(c[h]))return l;u=u[c[h]]}return u===void 0?l:u}n.get=r})(Bl)),Bl}var Hl,vy;function vR(){return vy||(vy=1,Hl=Kf().get),Hl}var AR=vR();const oq=Us(AR);var ql={},Wl={},Ay;function SR(){return Ay||(Ay=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e,s){const i=new Map;for(let r=0;r<e.length;r++){const o=e[r],a=s(o);i.has(a)||i.set(a,o)}return Array.from(i.values())}n.uniqBy=t})(Wl)),Wl}var Gl={},Sy;function yA(){return Sy||(Sy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e){return e}n.identity=t})(Gl)),Gl}var Yl={},Xl={},Kl={},Ty;function TR(){return Ty||(Ty=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e){return Number.isSafeInteger(e)&&e>=0}n.isLength=t})(Kl)),Kl}var Ey;function Zf(){return Ey||(Ey=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=TR();function e(s){return s!=null&&typeof s!="function"&&t.isLength(s.length)}n.isArrayLike=e})(Xl)),Xl}var Zl={},xy;function ER(){return xy||(xy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e){return typeof e=="object"&&e!==null}n.isObjectLike=t})(Zl)),Zl}var Cy;function xR(){return Cy||(Cy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=Zf(),e=ER();function s(i){return e.isObjectLike(i)&&t.isArrayLike(i)}n.isArrayLikeObject=s})(Yl)),Yl}var Jl={},Ql={},Py;function CR(){return Py||(Py=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=Kf();function e(s){return function(i){return t.get(i,s)}}n.property=e})(Ql)),Ql}var tu={},eu={},nu={},su={},ky;function bA(){return ky||(ky=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e){return e!==null&&(typeof e=="object"||typeof e=="function")}n.isObject=t})(su)),su}var iu={},My;function _A(){return My||(My=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e){return e==null||typeof e!="object"&&typeof e!="function"}n.isPrimitive=t})(iu)),iu}var ru={},Ry;function wA(){return Ry||(Ry=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e,s){return e===s||Number.isNaN(e)&&Number.isNaN(s)}n.eq=t})(ru)),ru}var Oy;function PR(){return Oy||(Oy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=bA(),e=_A(),s=wA();function i(u,h,d){return typeof d!="function"?i(u,h,()=>{}):r(u,h,function f(m,p,g,y,_,b){const w=d(m,p,g,y,_,b);return w!==void 0?!!w:r(m,p,f,b)},new Map)}function r(u,h,d,f){if(h===u)return!0;switch(typeof h){case"object":return o(u,h,d,f);case"function":return Object.keys(h).length>0?r(u,{...h},d,f):s.eq(u,h);default:return t.isObject(u)?typeof h=="string"?h==="":!0:s.eq(u,h)}}function o(u,h,d,f){if(h==null)return!0;if(Array.isArray(h))return c(u,h,d,f);if(h instanceof Map)return a(u,h,d,f);if(h instanceof Set)return l(u,h,d,f);const m=Object.keys(h);if(u==null||e.isPrimitive(u))return m.length===0;if(m.length===0)return!0;if(f?.has(h))return f.get(h)===u;f?.set(h,u);try{for(let p=0;p<m.length;p++){const g=m[p];if(!e.isPrimitive(u)&&!(g in u)||h[g]===void 0&&u[g]!==void 0||h[g]===null&&u[g]!==null||!d(u[g],h[g],g,u,h,f))return!1}return!0}finally{f?.delete(h)}}function a(u,h,d,f){if(h.size===0)return!0;if(!(u instanceof Map))return!1;for(const[m,p]of h.entries()){const g=u.get(m);if(d(g,p,m,u,h,f)===!1)return!1}return!0}function c(u,h,d,f){if(h.length===0)return!0;if(!Array.isArray(u))return!1;const m=new Set;for(let p=0;p<h.length;p++){const g=h[p];let y=!1;for(let _=0;_<u.length;_++){if(m.has(_))continue;const b=u[_];let w=!1;if(d(b,g,p,u,h,f)&&(w=!0),w){m.add(_),y=!0;break}}if(!y)return!1}return!0}function l(u,h,d,f){return h.size===0?!0:u instanceof Set?c([...u],[...h],d,f):!1}n.isMatchWith=i,n.isSetMatch=l})(nu)),nu}var Dy;function vA(){return Dy||(Dy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=PR();function e(s,i){return t.isMatchWith(s,i,()=>{})}n.isMatch=e})(eu)),eu}var ou={},au={},cu={},Iy;function kR(){return Iy||(Iy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e){return Object.getOwnPropertySymbols(e).filter(s=>Object.prototype.propertyIsEnumerable.call(e,s))}n.getSymbols=t})(cu)),cu}var lu={},Ly;function AA(){return Ly||(Ly=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}n.getTag=t})(lu)),lu}var uu={},Ny;function SA(){return Ny||(Ny=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t="[object RegExp]",e="[object String]",s="[object Number]",i="[object Boolean]",r="[object Arguments]",o="[object Symbol]",a="[object Date]",c="[object Map]",l="[object Set]",u="[object Array]",h="[object Function]",d="[object ArrayBuffer]",f="[object Object]",m="[object Error]",p="[object DataView]",g="[object Uint8Array]",y="[object Uint8ClampedArray]",_="[object Uint16Array]",b="[object Uint32Array]",w="[object BigUint64Array]",v="[object Int8Array]",A="[object Int16Array]",S="[object Int32Array]",T="[object BigInt64Array]",E="[object Float32Array]",P="[object Float64Array]";n.argumentsTag=r,n.arrayBufferTag=d,n.arrayTag=u,n.bigInt64ArrayTag=T,n.bigUint64ArrayTag=w,n.booleanTag=i,n.dataViewTag=p,n.dateTag=a,n.errorTag=m,n.float32ArrayTag=E,n.float64ArrayTag=P,n.functionTag=h,n.int16ArrayTag=A,n.int32ArrayTag=S,n.int8ArrayTag=v,n.mapTag=c,n.numberTag=s,n.objectTag=f,n.regexpTag=t,n.setTag=l,n.stringTag=e,n.symbolTag=o,n.uint16ArrayTag=_,n.uint32ArrayTag=b,n.uint8ArrayTag=g,n.uint8ClampedArrayTag=y})(uu)),uu}var hu={},Fy;function MR(){return Fy||(Fy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}n.isTypedArray=t})(hu)),hu}var By;function TA(){return By||(By=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=kR(),e=AA(),s=SA(),i=_A(),r=MR();function o(u,h){return a(u,void 0,u,new Map,h)}function a(u,h,d,f=new Map,m=void 0){const p=m?.(u,h,d,f);if(p!==void 0)return p;if(i.isPrimitive(u))return u;if(f.has(u))return f.get(u);if(Array.isArray(u)){const g=new Array(u.length);f.set(u,g);for(let y=0;y<u.length;y++)g[y]=a(u[y],y,d,f,m);return Object.hasOwn(u,"index")&&(g.index=u.index),Object.hasOwn(u,"input")&&(g.input=u.input),g}if(u instanceof Date)return new Date(u.getTime());if(u instanceof RegExp){const g=new RegExp(u.source,u.flags);return g.lastIndex=u.lastIndex,g}if(u instanceof Map){const g=new Map;f.set(u,g);for(const[y,_]of u)g.set(y,a(_,y,d,f,m));return g}if(u instanceof Set){const g=new Set;f.set(u,g);for(const y of u)g.add(a(y,void 0,d,f,m));return g}if(typeof Buffer<"u"&&Buffer.isBuffer(u))return u.subarray();if(r.isTypedArray(u)){const g=new(Object.getPrototypeOf(u)).constructor(u.length);f.set(u,g);for(let y=0;y<u.length;y++)g[y]=a(u[y],y,d,f,m);return g}if(u instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&u instanceof SharedArrayBuffer)return u.slice(0);if(u instanceof DataView){const g=new DataView(u.buffer.slice(0),u.byteOffset,u.byteLength);return f.set(u,g),c(g,u,d,f,m),g}if(typeof File<"u"&&u instanceof File){const g=new File([u],u.name,{type:u.type});return f.set(u,g),c(g,u,d,f,m),g}if(typeof Blob<"u"&&u instanceof Blob){const g=new Blob([u],{type:u.type});return f.set(u,g),c(g,u,d,f,m),g}if(u instanceof Error){const g=new u.constructor;return f.set(u,g),g.message=u.message,g.name=u.name,g.stack=u.stack,g.cause=u.cause,c(g,u,d,f,m),g}if(u instanceof Boolean){const g=new Boolean(u.valueOf());return f.set(u,g),c(g,u,d,f,m),g}if(u instanceof Number){const g=new Number(u.valueOf());return f.set(u,g),c(g,u,d,f,m),g}if(u instanceof String){const g=new String(u.valueOf());return f.set(u,g),c(g,u,d,f,m),g}if(typeof u=="object"&&l(u)){const g=Object.create(Object.getPrototypeOf(u));return f.set(u,g),c(g,u,d,f,m),g}return u}function c(u,h,d=u,f,m){const p=[...Object.keys(h),...t.getSymbols(h)];for(let g=0;g<p.length;g++){const y=p[g],_=Object.getOwnPropertyDescriptor(u,y);(_==null||_.writable)&&(u[y]=a(h[y],y,d,f,m))}}function l(u){switch(e.getTag(u)){case s.argumentsTag:case s.arrayTag:case s.arrayBufferTag:case s.dataViewTag:case s.booleanTag:case s.dateTag:case s.float32ArrayTag:case s.float64ArrayTag:case s.int8ArrayTag:case s.int16ArrayTag:case s.int32ArrayTag:case s.mapTag:case s.numberTag:case s.objectTag:case s.regexpTag:case s.setTag:case s.stringTag:case s.symbolTag:case s.uint8ArrayTag:case s.uint8ClampedArrayTag:case s.uint16ArrayTag:case s.uint32ArrayTag:return!0;default:return!1}}n.cloneDeepWith=o,n.cloneDeepWithImpl=a,n.copyProperties=c})(au)),au}var $y;function RR(){return $y||($y=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=TA();function e(s){return t.cloneDeepWithImpl(s,void 0,s,new Map,void 0)}n.cloneDeep=e})(ou)),ou}var Uy;function OR(){return Uy||(Uy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=vA(),e=RR();function s(i){return i=e.cloneDeep(i),r=>t.isMatch(r,i)}n.matches=s})(tu)),tu}var du={},fu={},pu={},jy;function DR(){return jy||(jy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=TA(),e=SA();function s(i,r){return t.cloneDeepWith(i,(o,a,c,l)=>{const u=r?.(o,a,c,l);if(u!==void 0)return u;if(typeof i=="object")switch(Object.prototype.toString.call(i)){case e.numberTag:case e.stringTag:case e.booleanTag:{const h=new i.constructor(i?.valueOf());return t.copyProperties(h,i),h}case e.argumentsTag:{const h={};return t.copyProperties(h,i),h.length=i.length,h[Symbol.iterator]=i[Symbol.iterator],h}default:return}})}n.cloneDeepWith=s})(pu)),pu}var zy;function IR(){return zy||(zy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=DR();function e(s){return t.cloneDeepWith(s)}n.cloneDeep=e})(fu)),fu}var mu={},gu={},Vy;function EA(){return Vy||(Vy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=/^(?:0|[1-9]\d*)$/;function e(s,i=Number.MAX_SAFE_INTEGER){switch(typeof s){case"number":return Number.isInteger(s)&&s>=0&&s<i;case"symbol":return!1;case"string":return t.test(s)}}n.isIndex=e})(gu)),gu}var yu={},Hy;function LR(){return Hy||(Hy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=AA();function e(s){return s!==null&&typeof s=="object"&&t.getTag(s)==="[object Arguments]"}n.isArguments=e})(yu)),yu}var qy;function NR(){return qy||(qy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=gA(),e=EA(),s=LR(),i=Xf();function r(o,a){let c;if(Array.isArray(a)?c=a:typeof a=="string"&&t.isDeepKey(a)&&o?.[a]==null?c=i.toPath(a):c=[a],c.length===0)return!1;let l=o;for(let u=0;u<c.length;u++){const h=c[u];if((l==null||!Object.hasOwn(l,h))&&!((Array.isArray(l)||s.isArguments(l))&&e.isIndex(h)&&h<l.length))return!1;l=l[h]}return!0}n.has=r})(mu)),mu}var Wy;function FR(){return Wy||(Wy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=vA(),e=Yf(),s=IR(),i=Kf(),r=NR();function o(a,c){switch(typeof a){case"object":{Object.is(a?.valueOf(),-0)&&(a="-0");break}case"number":{a=e.toKey(a);break}}return c=s.cloneDeep(c),function(l){const u=i.get(l,a);return u===void 0?r.has(l,a):c===void 0?u===void 0:t.isMatch(u,c)}}n.matchesProperty=o})(du)),du}var Gy;function BR(){return Gy||(Gy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=yA(),e=CR(),s=OR(),i=FR();function r(o){if(o==null)return t.identity;switch(typeof o){case"function":return o;case"object":return Array.isArray(o)&&o.length===2?i.matchesProperty(o[0],o[1]):s.matches(o);case"string":case"symbol":case"number":return e.property(o)}}n.iteratee=r})(Jl)),Jl}var Yy;function $R(){return Yy||(Yy=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=SR(),e=yA(),s=xR(),i=BR();function r(o,a=e.identity){return s.isArrayLikeObject(o)?t.uniqBy(Array.from(o),i.iteratee(a)):[]}n.uniqBy=r})(ql)),ql}var bu,Xy;function UR(){return Xy||(Xy=1,bu=$R().uniqBy),bu}var jR=UR();const aq=Us(jR);var _u={exports:{}},wu={},vu={exports:{}},Au={};var Ky;function zR(){if(Ky)return Au;Ky=1;var n=hf();function t(h,d){return h===d&&(h!==0||1/h===1/d)||h!==h&&d!==d}var e=typeof Object.is=="function"?Object.is:t,s=n.useState,i=n.useEffect,r=n.useLayoutEffect,o=n.useDebugValue;function a(h,d){var f=d(),m=s({inst:{value:f,getSnapshot:d}}),p=m[0].inst,g=m[1];return r(function(){p.value=f,p.getSnapshot=d,c(p)&&g({inst:p})},[h,f,d]),i(function(){return c(p)&&g({inst:p}),h(function(){c(p)&&g({inst:p})})},[h]),o(f),f}function c(h){var d=h.getSnapshot;h=h.value;try{var f=d();return!e(h,f)}catch{return!0}}function l(h,d){return d()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?l:a;return Au.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:u,Au}var Zy;function VR(){return Zy||(Zy=1,vu.exports=zR()),vu.exports}var Jy;function HR(){if(Jy)return wu;Jy=1;var n=hf(),t=VR();function e(l,u){return l===u&&(l!==0||1/l===1/u)||l!==l&&u!==u}var s=typeof Object.is=="function"?Object.is:e,i=t.useSyncExternalStore,r=n.useRef,o=n.useEffect,a=n.useMemo,c=n.useDebugValue;return wu.useSyncExternalStoreWithSelector=function(l,u,h,d,f){var m=r(null);if(m.current===null){var p={hasValue:!1,value:null};m.current=p}else p=m.current;m=a(function(){function y(A){if(!_){if(_=!0,b=A,A=d(A),f!==void 0&&p.hasValue){var S=p.value;if(f(S,A))return w=S}return w=A}if(S=w,s(b,A))return S;var T=d(A);return f!==void 0&&f(S,T)?(b=A,S):(b=A,w=T)}var _=!1,b,w,v=h===void 0?null:h;return[function(){return y(u())},v===null?void 0:function(){return y(v())}]},[u,h,d,f]);var g=i(l,m[0],m[1]);return o(function(){p.hasValue=!0,p.value=g},[g]),c(g),g},wu}var Qy;function qR(){return Qy||(Qy=1,_u.exports=HR()),_u.exports}var cq=qR();function WR(n,t=`expected a function, instead received ${typeof n}`){if(typeof n!="function")throw new TypeError(t)}function GR(n,t=`expected an object, instead received ${typeof n}`){if(typeof n!="object")throw new TypeError(t)}function YR(n,t="expected all items to be functions, instead received the following types: "){if(!n.every(e=>typeof e=="function")){const e=n.map(s=>typeof s=="function"?`function ${s.name||"unnamed"}()`:typeof s).join(", ");throw new TypeError(`${t}[${e}]`)}}var t0=n=>Array.isArray(n)?n:[n];function XR(n){const t=Array.isArray(n[0])?n[0]:n;return YR(t,"createSelector expects all input-selectors to be functions, but received the following types: "),t}function KR(n,t){const e=[],{length:s}=n;for(let i=0;i<s;i++)e.push(n[i].apply(null,t));return e}var ZR=class{constructor(n){this.value=n}deref(){return this.value}},JR=typeof WeakRef<"u"?WeakRef:ZR,QR=0,e0=1;function Ro(){return{s:QR,v:void 0,o:null,p:null}}function xA(n,t={}){let e=Ro();const{resultEqualityCheck:s}=t;let i,r=0;function o(){let a=e;const{length:c}=arguments;for(let h=0,d=c;h<d;h++){const f=arguments[h];if(typeof f=="function"||typeof f=="object"&&f!==null){let m=a.o;m===null&&(a.o=m=new WeakMap);const p=m.get(f);p===void 0?(a=Ro(),m.set(f,a)):a=p}else{let m=a.p;m===null&&(a.p=m=new Map);const p=m.get(f);p===void 0?(a=Ro(),m.set(f,a)):a=p}}const l=a;let u;if(a.s===e0)u=a.v;else if(u=n.apply(null,arguments),r++,s){const h=i?.deref?.()??i;h!=null&&s(h,u)&&(u=h,r!==0&&r--),i=typeof u=="object"&&u!==null||typeof u=="function"?new JR(u):u}return l.s=e0,l.v=u,u}return o.clearCache=()=>{e=Ro(),o.resetResultsCount()},o.resultsCount=()=>r,o.resetResultsCount=()=>{r=0},o}function tO(n,...t){const e=typeof n=="function"?{memoize:n,memoizeOptions:t}:n,s=(...i)=>{let r=0,o=0,a,c={},l=i.pop();typeof l=="object"&&(c=l,l=i.pop()),WR(l,`createSelector expects an output function after the inputs, but received: [${typeof l}]`);const u={...e,...c},{memoize:h,memoizeOptions:d=[],argsMemoize:f=xA,argsMemoizeOptions:m=[]}=u,p=t0(d),g=t0(m),y=XR(i),_=h(function(){return r++,l.apply(null,arguments)},...p),b=f(function(){o++;const v=KR(y,arguments);return a=_.apply(null,v),a},...g);return Object.assign(b,{resultFunc:l,memoizedResultFunc:_,dependencies:y,dependencyRecomputations:()=>o,resetDependencyRecomputations:()=>{o=0},lastResult:()=>a,recomputations:()=>r,resetRecomputations:()=>{r=0},memoize:h,argsMemoize:f})};return Object.assign(s,{withTypes:()=>s}),s}var eO=tO(xA),nO=Object.assign((n,t=eO)=>{GR(n,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof n}`);const e=Object.keys(n),s=e.map(r=>n[r]);return t(s,(...r)=>r.reduce((o,a,c)=>(o[e[c]]=a,o),{}))},{withTypes:()=>nO}),Su={},Tu={},Eu={},n0;function sO(){return n0||(n0=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(s){return typeof s=="symbol"?1:s===null?2:s===void 0?3:s!==s?4:0}const e=(s,i,r)=>{if(s!==i){const o=t(s),a=t(i);if(o===a&&o===0){if(s<i)return r==="desc"?1:-1;if(s>i)return r==="desc"?-1:1}return r==="desc"?a-o:o-a}return 0};n.compareValues=e})(Eu)),Eu}var xu={},Cu={},s0;function CA(){return s0||(s0=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e){return typeof e=="symbol"||e instanceof Symbol}n.isSymbol=t})(Cu)),Cu}var i0;function iO(){return i0||(i0=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=CA(),e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;function i(r,o){return Array.isArray(r)?!1:typeof r=="number"||typeof r=="boolean"||r==null||t.isSymbol(r)?!0:typeof r=="string"&&(s.test(r)||!e.test(r))||o!=null&&Object.hasOwn(o,r)}n.isKey=i})(xu)),xu}var r0;function rO(){return r0||(r0=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=sO(),e=iO(),s=Xf();function i(r,o,a,c){if(r==null)return[];a=c?void 0:a,Array.isArray(r)||(r=Object.values(r)),Array.isArray(o)||(o=o==null?[null]:[o]),o.length===0&&(o=[null]),Array.isArray(a)||(a=a==null?[]:[a]),a=a.map(f=>String(f));const l=(f,m)=>{let p=f;for(let g=0;g<m.length&&p!=null;++g)p=p[m[g]];return p},u=(f,m)=>m==null||f==null?m:typeof f=="object"&&"key"in f?Object.hasOwn(m,f.key)?m[f.key]:l(m,f.path):typeof f=="function"?f(m):Array.isArray(f)?l(m,f):typeof m=="object"?m[f]:m,h=o.map(f=>(Array.isArray(f)&&f.length===1&&(f=f[0]),f==null||typeof f=="function"||Array.isArray(f)||e.isKey(f)?f:{key:f,path:s.toPath(f)}));return r.map(f=>({original:f,criteria:h.map(m=>u(m,f))})).slice().sort((f,m)=>{for(let p=0;p<h.length;p++){const g=t.compareValues(f.criteria[p],m.criteria[p],a[p]);if(g!==0)return g}return 0}).map(f=>f.original)}n.orderBy=i})(Tu)),Tu}var Pu={},o0;function oO(){return o0||(o0=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e,s=1){const i=[],r=Math.floor(s),o=(a,c)=>{for(let l=0;l<a.length;l++){const u=a[l];Array.isArray(u)&&c<r?o(u,c+1):i.push(u)}};return o(e,0),i}n.flatten=t})(Pu)),Pu}var ku={},a0;function PA(){return a0||(a0=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=EA(),e=Zf(),s=bA(),i=wA();function r(o,a,c){return s.isObject(c)&&(typeof a=="number"&&e.isArrayLike(c)&&t.isIndex(a)&&a<c.length||typeof a=="string"&&a in c)?i.eq(c[a],o):!1}n.isIterateeCall=r})(ku)),ku}var c0;function aO(){return c0||(c0=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=rO(),e=oO(),s=PA();function i(r,...o){const a=o.length;return a>1&&s.isIterateeCall(r,o[0],o[1])?o=[]:a>2&&s.isIterateeCall(o[0],o[1],o[2])&&(o=[o[0]]),t.orderBy(r,e.flatten(o),["asc"])}n.sortBy=i})(Su)),Su}var Mu,l0;function cO(){return l0||(l0=1,Mu=aO().sortBy),Mu}var lO=cO();const lq=Us(lO);function ne(n){return`Minified Redux error #${n}; visit https://redux.js.org/Errors?code=${n} for the full message or use the non-minified dev environment for full errors. `}var uO=typeof Symbol=="function"&&Symbol.observable||"@@observable",u0=uO,Ru=()=>Math.random().toString(36).substring(7).split("").join("."),hO={INIT:`@@redux/INIT${Ru()}`,REPLACE:`@@redux/REPLACE${Ru()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Ru()}`},ja=hO;function Jf(n){if(typeof n!="object"||n===null)return!1;let t=n;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(n)===t||Object.getPrototypeOf(n)===null}function kA(n,t,e){if(typeof n!="function")throw new Error(ne(2));if(typeof t=="function"&&typeof e=="function"||typeof e=="function"&&typeof arguments[3]=="function")throw new Error(ne(0));if(typeof t=="function"&&typeof e>"u"&&(e=t,t=void 0),typeof e<"u"){if(typeof e!="function")throw new Error(ne(1));return e(kA)(n,t)}let s=n,i=t,r=new Map,o=r,a=0,c=!1;function l(){o===r&&(o=new Map,r.forEach((g,y)=>{o.set(y,g)}))}function u(){if(c)throw new Error(ne(3));return i}function h(g){if(typeof g!="function")throw new Error(ne(4));if(c)throw new Error(ne(5));let y=!0;l();const _=a++;return o.set(_,g),function(){if(y){if(c)throw new Error(ne(6));y=!1,l(),o.delete(_),r=null}}}function d(g){if(!Jf(g))throw new Error(ne(7));if(typeof g.type>"u")throw new Error(ne(8));if(typeof g.type!="string")throw new Error(ne(17));if(c)throw new Error(ne(9));try{c=!0,i=s(i,g)}finally{c=!1}return(r=o).forEach(_=>{_()}),g}function f(g){if(typeof g!="function")throw new Error(ne(10));s=g,d({type:ja.REPLACE})}function m(){const g=h;return{subscribe(y){if(typeof y!="object"||y===null)throw new Error(ne(11));function _(){const w=y;w.next&&w.next(u())}return _(),{unsubscribe:g(_)}},[u0](){return this}}}return d({type:ja.INIT}),{dispatch:d,subscribe:h,getState:u,replaceReducer:f,[u0]:m}}function dO(n){Object.keys(n).forEach(t=>{const e=n[t];if(typeof e(void 0,{type:ja.INIT})>"u")throw new Error(ne(12));if(typeof e(void 0,{type:ja.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(ne(13))})}function fO(n){const t=Object.keys(n),e={};for(let r=0;r<t.length;r++){const o=t[r];typeof n[o]=="function"&&(e[o]=n[o])}const s=Object.keys(e);let i;try{dO(e)}catch(r){i=r}return function(o={},a){if(i)throw i;let c=!1;const l={};for(let u=0;u<s.length;u++){const h=s[u],d=e[h],f=o[h],m=d(f,a);if(typeof m>"u")throw a&&a.type,new Error(ne(14));l[h]=m,c=c||m!==f}return c=c||s.length!==Object.keys(o).length,c?l:o}}function za(...n){return n.length===0?t=>t:n.length===1?n[0]:n.reduce((t,e)=>(...s)=>t(e(...s)))}function pO(...n){return t=>(e,s)=>{const i=t(e,s);let r=()=>{throw new Error(ne(15))};const o={getState:i.getState,dispatch:(c,...l)=>r(c,...l)},a=n.map(c=>c(o));return r=za(...a)(i.dispatch),{...i,dispatch:r}}}function MA(n){return Jf(n)&&"type"in n&&typeof n.type=="string"}var RA=Symbol.for("immer-nothing"),h0=Symbol.for("immer-draftable"),we=Symbol.for("immer-state");function on(n,...t){throw new Error(`[Immer] minified error nr: ${n}. Full error at: https://bit.ly/3cXEKWf`)}var Ne=Object,xi=Ne.getPrototypeOf,Va="constructor",Dc="prototype",sd="configurable",Ha="enumerable",pa="writable",Fr="value",Bn=n=>!!n&&!!n[we];function ln(n){return n?OA(n)||Ic(n)||!!n[h0]||!!n[Va]?.[h0]||Lc(n)||Nc(n):!1}var mO=Ne[Dc][Va].toString(),d0=new WeakMap;function OA(n){if(!n||!Qf(n))return!1;const t=xi(n);if(t===null||t===Ne[Dc])return!0;const e=Ne.hasOwnProperty.call(t,Va)&&t[Va];if(e===Object)return!0;if(!ti(e))return!1;let s=d0.get(e);return s===void 0&&(s=Function.toString.call(e),d0.set(e,s)),s===mO}function ao(n,t,e=!0){co(n)===0?(e?Reflect.ownKeys(n):Ne.keys(n)).forEach(i=>{t(i,n[i],n)}):n.forEach((s,i)=>t(i,s,n))}function co(n){const t=n[we];return t?t.type_:Ic(n)?1:Lc(n)?2:Nc(n)?3:0}var f0=(n,t,e=co(n))=>e===2?n.has(t):Ne[Dc].hasOwnProperty.call(n,t),id=(n,t,e=co(n))=>e===2?n.get(t):n[t],qa=(n,t,e,s=co(n))=>{s===2?n.set(t,e):s===3?n.add(e):n[t]=e};function gO(n,t){return n===t?n!==0||1/n===1/t:n!==n&&t!==t}var Ic=Array.isArray,Lc=n=>n instanceof Map,Nc=n=>n instanceof Set,Qf=n=>typeof n=="object",ti=n=>typeof n=="function",Ou=n=>typeof n=="boolean";function yO(n){const t=+n;return Number.isInteger(t)&&String(t)===n}var Rn=n=>n.copy_||n.base_,tp=n=>n.modified_?n.copy_:n.base_;function rd(n,t){if(Lc(n))return new Map(n);if(Nc(n))return new Set(n);if(Ic(n))return Array[Dc].slice.call(n);const e=OA(n);if(t===!0||t==="class_only"&&!e){const s=Ne.getOwnPropertyDescriptors(n);delete s[we];let i=Reflect.ownKeys(s);for(let r=0;r<i.length;r++){const o=i[r],a=s[o];a[pa]===!1&&(a[pa]=!0,a[sd]=!0),(a.get||a.set)&&(s[o]={[sd]:!0,[pa]:!0,[Ha]:a[Ha],[Fr]:n[o]})}return Ne.create(xi(n),s)}else{const s=xi(n);if(s!==null&&e)return{...n};const i=Ne.create(s);return Ne.assign(i,n)}}function ep(n,t=!1){return Fc(n)||Bn(n)||!ln(n)||(co(n)>1&&Ne.defineProperties(n,{set:Oo,add:Oo,clear:Oo,delete:Oo}),Ne.freeze(n),t&&ao(n,(e,s)=>{ep(s,!0)},!1)),n}function bO(){on(2)}var Oo={[Fr]:bO};function Fc(n){return n===null||!Qf(n)?!0:Ne.isFrozen(n)}var Wa="MapSet",od="Patches",p0="ArrayMethods",DA={};function Rs(n){const t=DA[n];return t||on(0,n),t}var m0=n=>!!DA[n],Br,IA=()=>Br,_O=(n,t)=>({drafts_:[],parent_:n,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0,handledSet_:new Set,processedForPatches_:new Set,mapSetPlugin_:m0(Wa)?Rs(Wa):void 0,arrayMethodsPlugin_:m0(p0)?Rs(p0):void 0});function g0(n,t){t&&(n.patchPlugin_=Rs(od),n.patches_=[],n.inversePatches_=[],n.patchListener_=t)}function ad(n){cd(n),n.drafts_.forEach(wO),n.drafts_=null}function cd(n){n===Br&&(Br=n.parent_)}var y0=n=>Br=_O(Br,n);function wO(n){const t=n[we];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function b0(n,t){t.unfinalizedDrafts_=t.drafts_.length;const e=t.drafts_[0];if(n!==void 0&&n!==e){e[we].modified_&&(ad(t),on(4)),ln(n)&&(n=_0(t,n));const{patchPlugin_:i}=t;i&&i.generateReplacementPatches_(e[we].base_,n,t)}else n=_0(t,e);return vO(t,n,!0),ad(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),n!==RA?n:void 0}function _0(n,t){if(Fc(t))return t;const e=t[we];if(!e)return np(t,n.handledSet_,n);if(!Bc(e,n))return t;if(!e.modified_)return e.base_;if(!e.finalized_){const{callbacks_:s}=e;if(s)for(;s.length>0;)s.pop()(n);FA(e,n)}return e.copy_}function vO(n,t,e=!1){!n.parent_&&n.immer_.autoFreeze_&&n.canAutoFreeze_&&ep(t,e)}function LA(n){n.finalized_=!0,n.scope_.unfinalizedDrafts_--}var Bc=(n,t)=>n.scope_===t,AO=[];function NA(n,t,e,s){const i=Rn(n),r=n.type_;if(s!==void 0&&id(i,s,r)===t){qa(i,s,e,r);return}if(!n.draftLocations_){const a=n.draftLocations_=new Map;ao(i,(c,l)=>{if(Bn(l)){const u=a.get(l)||[];u.push(c),a.set(l,u)}})}const o=n.draftLocations_.get(t)??AO;for(const a of o)qa(i,a,e,r)}function SO(n,t,e){n.callbacks_.push(function(i){const r=t;if(!r||!Bc(r,i))return;i.mapSetPlugin_?.fixSetContents(r);const o=tp(r);NA(n,r.draft_??r,o,e),FA(r,i)})}function FA(n,t){if(n.modified_&&!n.finalized_&&(n.type_===3||n.type_===1&&n.allIndicesReassigned_||(n.assigned_?.size??0)>0)){const{patchPlugin_:s}=t;if(s){const i=s.getPath(n);i&&s.generatePatches_(n,i,t)}LA(n)}}function TO(n,t,e){const{scope_:s}=n;if(Bn(e)){const i=e[we];Bc(i,s)&&i.callbacks_.push(function(){ma(n);const o=tp(i);NA(n,e,o,t)})}else ln(e)&&n.callbacks_.push(function(){const r=Rn(n);id(r,t,n.type_)===e&&s.drafts_.length>1&&(n.assigned_.get(t)??!1)===!0&&n.copy_&&np(id(n.copy_,t,n.type_),s.handledSet_,s)})}function np(n,t,e){return!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1||Bn(n)||t.has(n)||!ln(n)||Fc(n)||(t.add(n),ao(n,(s,i)=>{if(Bn(i)){const r=i[we];if(Bc(r,e)){const o=tp(r);qa(n,s,o,n.type_),LA(r)}}else ln(i)&&np(i,t,e)})),n}function EO(n,t){const e=Ic(n),s={type_:e?1:0,scope_:t?t.scope_:IA(),modified_:!1,finalized_:!1,assigned_:void 0,parent_:t,base_:n,draft_:null,copy_:null,revoke_:null,isManual_:!1,callbacks_:void 0};let i=s,r=sp;e&&(i=[s],r=$r);const{revoke:o,proxy:a}=Proxy.revocable(i,r);return s.draft_=a,s.revoke_=o,[a,s]}var sp={get(n,t){if(t===we)return n;let e=n.scope_.arrayMethodsPlugin_;const s=n.type_===1&&typeof t=="string";if(s&&e?.isArrayOperationMethod(t))return e.createMethodInterceptor(n,t);const i=Rn(n);if(!f0(i,t,n.type_))return xO(n,i,t);const r=i[t];if(n.finalized_||!ln(r)||s&&n.operationMethod&&e?.isMutatingArrayMethod(n.operationMethod)&&yO(t))return r;if(r===Du(n.base_,t)){ma(n);const o=n.type_===1?+t:t,a=ud(n.scope_,r,n,o);return n.copy_[o]=a}return r},has(n,t){return t in Rn(n)},ownKeys(n){return Reflect.ownKeys(Rn(n))},set(n,t,e){const s=BA(Rn(n),t);if(s?.set)return s.set.call(n.draft_,e),!0;if(!n.modified_){const i=Du(Rn(n),t),r=i?.[we];if(r&&r.base_===e)return n.copy_[t]=e,n.assigned_.set(t,!1),!0;if(gO(e,i)&&(e!==void 0||f0(n.base_,t,n.type_)))return!0;ma(n),ld(n)}return n.copy_[t]===e&&(e!==void 0||t in n.copy_)||Number.isNaN(e)&&Number.isNaN(n.copy_[t])||(n.copy_[t]=e,n.assigned_.set(t,!0),TO(n,t,e)),!0},deleteProperty(n,t){return ma(n),Du(n.base_,t)!==void 0||t in n.base_?(n.assigned_.set(t,!1),ld(n)):n.assigned_.delete(t),n.copy_&&delete n.copy_[t],!0},getOwnPropertyDescriptor(n,t){const e=Rn(n),s=Reflect.getOwnPropertyDescriptor(e,t);return s&&{[pa]:!0,[sd]:n.type_!==1||t!=="length",[Ha]:s[Ha],[Fr]:e[t]}},defineProperty(){on(11)},getPrototypeOf(n){return xi(n.base_)},setPrototypeOf(){on(12)}},$r={};ao(sp,(n,t)=>{$r[n]=function(){const e=arguments;return e[0]=e[0][0],t.apply(this,e)}});$r.deleteProperty=function(n,t){return $r.set.call(this,n,t,void 0)};$r.set=function(n,t,e){return sp.set.call(this,n[0],t,e,n[0])};function Du(n,t){const e=n[we];return(e?Rn(e):n)[t]}function xO(n,t,e){const s=BA(t,e);return s?Fr in s?s[Fr]:s.get?.call(n.draft_):void 0}function BA(n,t){if(!(t in n))return;let e=xi(n);for(;e;){const s=Object.getOwnPropertyDescriptor(e,t);if(s)return s;e=xi(e)}}function ld(n){n.modified_||(n.modified_=!0,n.parent_&&ld(n.parent_))}function ma(n){n.copy_||(n.assigned_=new Map,n.copy_=rd(n.base_,n.scope_.immer_.useStrictShallowCopy_))}var CO=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!1,this.produce=(e,s,i)=>{if(ti(e)&&!ti(s)){const o=s;s=e;const a=this;return function(l=o,...u){return a.produce(l,h=>s.call(this,h,...u))}}ti(s)||on(6),i!==void 0&&!ti(i)&&on(7);let r;if(ln(e)){const o=y0(this),a=ud(o,e,void 0);let c=!0;try{r=s(a),c=!1}finally{c?ad(o):cd(o)}return g0(o,i),b0(r,o)}else if(!e||!Qf(e)){if(r=s(e),r===void 0&&(r=e),r===RA&&(r=void 0),this.autoFreeze_&&ep(r,!0),i){const o=[],a=[];Rs(od).generateReplacementPatches_(e,r,{patches_:o,inversePatches_:a}),i(o,a)}return r}else on(1,e)},this.produceWithPatches=(e,s)=>{if(ti(e))return(a,...c)=>this.produceWithPatches(a,l=>e(l,...c));let i,r;return[this.produce(e,s,(a,c)=>{i=a,r=c}),i,r]},Ou(t?.autoFreeze)&&this.setAutoFreeze(t.autoFreeze),Ou(t?.useStrictShallowCopy)&&this.setUseStrictShallowCopy(t.useStrictShallowCopy),Ou(t?.useStrictIteration)&&this.setUseStrictIteration(t.useStrictIteration)}createDraft(t){ln(t)||on(8),Bn(t)&&(t=PO(t));const e=y0(this),s=ud(e,t,void 0);return s[we].isManual_=!0,cd(e),s}finishDraft(t,e){const s=t&&t[we];(!s||!s.isManual_)&&on(9);const{scope_:i}=s;return g0(i,e),b0(void 0,i)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}setUseStrictIteration(t){this.useStrictIteration_=t}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(t,e){let s;for(s=e.length-1;s>=0;s--){const r=e[s];if(r.path.length===0&&r.op==="replace"){t=r.value;break}}s>-1&&(e=e.slice(s+1));const i=Rs(od).applyPatches_;return Bn(t)?i(t,e):this.produce(t,r=>i(r,e))}};function ud(n,t,e,s){const[i,r]=Lc(t)?Rs(Wa).proxyMap_(t,e):Nc(t)?Rs(Wa).proxySet_(t,e):EO(t,e);return(e?.scope_??IA()).drafts_.push(i),r.callbacks_=e?.callbacks_??[],r.key_=s,e&&s!==void 0?SO(e,r,s):r.callbacks_.push(function(c){c.mapSetPlugin_?.fixSetContents(r);const{patchPlugin_:l}=c;r.modified_&&l&&l.generatePatches_(r,[],c)}),i}function PO(n){return Bn(n)||on(10,n),$A(n)}function $A(n){if(!ln(n)||Fc(n))return n;const t=n[we];let e,s=!0;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,e=rd(n,t.scope_.immer_.useStrictShallowCopy_),s=t.scope_.immer_.shouldUseStrictIteration()}else e=rd(n,!0);return ao(e,(i,r)=>{qa(e,i,$A(r))},s),t&&(t.finalized_=!1),e}var kO=new CO,UA=kO.produce;function jA(n){return({dispatch:e,getState:s})=>i=>r=>typeof r=="function"?r(e,s,n):i(r)}var MO=jA(),RO=jA,OO=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?za:za.apply(null,arguments)};function Ci(n,t){function e(...s){if(t){let i=t(...s);if(!i)throw new Error(Fe(0));return{type:n,payload:i.payload,..."meta"in i&&{meta:i.meta},..."error"in i&&{error:i.error}}}return{type:n,payload:s[0]}}return e.toString=()=>`${n}`,e.type=n,e.match=s=>MA(s)&&s.type===n,e}var zA=class rr extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,rr.prototype)}static get[Symbol.species](){return rr}concat(...t){return super.concat.apply(this,t)}prepend(...t){return t.length===1&&Array.isArray(t[0])?new rr(...t[0].concat(this)):new rr(...t.concat(this))}};function w0(n){return ln(n)?UA(n,()=>{}):n}function Do(n,t,e){return n.has(t)?n.get(t):n.set(t,e(t)).get(t)}function DO(n){return typeof n=="boolean"}var IO=()=>function(t){const{thunk:e=!0,immutableCheck:s=!0,serializableCheck:i=!0,actionCreatorCheck:r=!0}=t??{};let o=new zA;return e&&(DO(e)?o.push(MO):o.push(RO(e.extraArgument))),o},VA="RTK_autoBatch",hq=()=>n=>({payload:n,meta:{[VA]:!0}}),v0=n=>t=>{setTimeout(t,n)},LO=(n={type:"raf"})=>t=>(...e)=>{const s=t(...e);let i=!0,r=!1,o=!1;const a=new Set,c=n.type==="tick"?queueMicrotask:n.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:v0(10):n.type==="callback"?n.queueNotification:v0(n.timeout),l=()=>{o=!1,r&&(r=!1,a.forEach(u=>u()))};return Object.assign({},s,{subscribe(u){const h=()=>i&&u(),d=s.subscribe(h);return a.add(u),()=>{d(),a.delete(u)}},dispatch(u){try{return i=!u?.meta?.[VA],r=!i,r&&(o||(o=!0,c(l))),s.dispatch(u)}finally{i=!0}}})},NO=n=>function(e){const{autoBatch:s=!0}=e??{};let i=new zA(n);return s&&i.push(LO(typeof s=="object"?s:void 0)),i};function dq(n){const t=IO(),{reducer:e=void 0,middleware:s,devTools:i=!0,preloadedState:r=void 0,enhancers:o=void 0}=n||{};let a;if(typeof e=="function")a=e;else if(Jf(e))a=fO(e);else throw new Error(Fe(1));let c;typeof s=="function"?c=s(t):c=t();let l=za;i&&(l=OO({trace:!1,...typeof i=="object"&&i}));const u=pO(...c),h=NO(u);let d=typeof o=="function"?o(h):h();const f=l(...d);return kA(a,r,f)}function HA(n){const t={},e=[];let s;const i={addCase(r,o){const a=typeof r=="string"?r:r.type;if(!a)throw new Error(Fe(28));if(a in t)throw new Error(Fe(29));return t[a]=o,i},addAsyncThunk(r,o){return o.pending&&(t[r.pending.type]=o.pending),o.rejected&&(t[r.rejected.type]=o.rejected),o.fulfilled&&(t[r.fulfilled.type]=o.fulfilled),o.settled&&e.push({matcher:r.settled,reducer:o.settled}),i},addMatcher(r,o){return e.push({matcher:r,reducer:o}),i},addDefaultCase(r){return s=r,i}};return n(i),[t,e,s]}function FO(n){return typeof n=="function"}function BO(n,t){let[e,s,i]=HA(t),r;if(FO(n))r=()=>w0(n());else{const a=w0(n);r=()=>a}function o(a=r(),c){let l=[e[c.type],...s.filter(({matcher:u})=>u(c)).map(({reducer:u})=>u)];return l.filter(u=>!!u).length===0&&(l=[i]),l.reduce((u,h)=>{if(h)if(Bn(u)){const f=h(u,c);return f===void 0?u:f}else{if(ln(u))return UA(u,d=>h(d,c));{const d=h(u,c);if(d===void 0){if(u===null)return u;throw Error("A case reducer on a non-draftable value must not return undefined")}return d}}return u},a)}return o.getInitialState=r,o}var $O="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",UO=(n=21)=>{let t="",e=n;for(;e--;)t+=$O[Math.random()*64|0];return t},jO=Symbol.for("rtk-slice-createasyncthunk");function zO(n,t){return`${n}/${t}`}function VO({creators:n}={}){const t=n?.asyncThunk?.[jO];return function(s){const{name:i,reducerPath:r=i}=s;if(!i)throw new Error(Fe(11));const o=(typeof s.reducers=="function"?s.reducers(qO()):s.reducers)||{},a=Object.keys(o),c={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},l={addCase(b,w){const v=typeof b=="string"?b:b.type;if(!v)throw new Error(Fe(12));if(v in c.sliceCaseReducersByType)throw new Error(Fe(13));return c.sliceCaseReducersByType[v]=w,l},addMatcher(b,w){return c.sliceMatchers.push({matcher:b,reducer:w}),l},exposeAction(b,w){return c.actionCreators[b]=w,l},exposeCaseReducer(b,w){return c.sliceCaseReducersByName[b]=w,l}};a.forEach(b=>{const w=o[b],v={reducerName:b,type:zO(i,b),createNotation:typeof s.reducers=="function"};GO(w)?XO(v,w,l,t):WO(v,w,l)});function u(){const[b={},w=[],v=void 0]=typeof s.extraReducers=="function"?HA(s.extraReducers):[s.extraReducers],A={...b,...c.sliceCaseReducersByType};return BO(s.initialState,S=>{for(let T in A)S.addCase(T,A[T]);for(let T of c.sliceMatchers)S.addMatcher(T.matcher,T.reducer);for(let T of w)S.addMatcher(T.matcher,T.reducer);v&&S.addDefaultCase(v)})}const h=b=>b,d=new Map,f=new WeakMap;let m;function p(b,w){return m||(m=u()),m(b,w)}function g(){return m||(m=u()),m.getInitialState()}function y(b,w=!1){function v(S){let T=S[b];return typeof T>"u"&&w&&(T=Do(f,v,g)),T}function A(S=h){const T=Do(d,w,()=>new WeakMap);return Do(T,S,()=>{const E={};for(const[P,x]of Object.entries(s.selectors??{}))E[P]=HO(x,S,()=>Do(f,S,g),w);return E})}return{reducerPath:b,getSelectors:A,get selectors(){return A(v)},selectSlice:v}}const _={name:i,reducer:p,actions:c.actionCreators,caseReducers:c.sliceCaseReducersByName,getInitialState:g,...y(r),injectInto(b,{reducerPath:w,...v}={}){const A=w??r;return b.inject({reducerPath:A,reducer:p},v),{..._,...y(A,!0)}}};return _}}function HO(n,t,e,s){function i(r,...o){let a=t(r);return typeof a>"u"&&s&&(a=e()),n(a,...o)}return i.unwrapped=n,i}var fq=VO();function qO(){function n(t,e){return{_reducerDefinitionType:"asyncThunk",payloadCreator:t,...e}}return n.withTypes=()=>n,{reducer(t){return Object.assign({[t.name](...e){return t(...e)}}[t.name],{_reducerDefinitionType:"reducer"})},preparedReducer(t,e){return{_reducerDefinitionType:"reducerWithPrepare",prepare:t,reducer:e}},asyncThunk:n}}function WO({type:n,reducerName:t,createNotation:e},s,i){let r,o;if("reducer"in s){if(e&&!YO(s))throw new Error(Fe(17));r=s.reducer,o=s.prepare}else r=s;i.addCase(n,r).exposeCaseReducer(t,r).exposeAction(t,o?Ci(n,o):Ci(n))}function GO(n){return n._reducerDefinitionType==="asyncThunk"}function YO(n){return n._reducerDefinitionType==="reducerWithPrepare"}function XO({type:n,reducerName:t},e,s,i){if(!i)throw new Error(Fe(18));const{payloadCreator:r,fulfilled:o,pending:a,rejected:c,settled:l,options:u}=e,h=i(n,r,u);s.exposeAction(t,h),o&&s.addCase(h.fulfilled,o),a&&s.addCase(h.pending,a),c&&s.addCase(h.rejected,c),l&&s.addMatcher(h.settled,l),s.exposeCaseReducer(t,{fulfilled:o||Io,pending:a||Io,rejected:c||Io,settled:l||Io})}function Io(){}var KO="task",qA="listener",WA="completed",ip="cancelled",ZO=`task-${ip}`,JO=`task-${WA}`,hd=`${qA}-${ip}`,QO=`${qA}-${WA}`,$c=class{constructor(n){this.code=n,this.message=`${KO} ${ip} (reason: ${n})`}name="TaskAbortError";message},rp=(n,t)=>{if(typeof n!="function")throw new TypeError(Fe(32))},Ga=()=>{},GA=(n,t=Ga)=>(n.catch(t),n),YA=(n,t)=>(n.addEventListener("abort",t,{once:!0}),()=>n.removeEventListener("abort",t)),Cs=n=>{if(n.aborted)throw new $c(n.reason)};function XA(n,t){let e=Ga;return new Promise((s,i)=>{const r=()=>i(new $c(n.reason));if(n.aborted){r();return}e=YA(n,r),t.finally(()=>e()).then(s,i)}).finally(()=>{e=Ga})}var tD=async(n,t)=>{try{return await Promise.resolve(),{status:"ok",value:await n()}}catch(e){return{status:e instanceof $c?"cancelled":"rejected",error:e}}finally{t?.()}},Ya=n=>t=>GA(XA(n,t).then(e=>(Cs(n),e))),KA=n=>{const t=Ya(n);return e=>t(new Promise(s=>setTimeout(s,e)))},{assign:bi}=Object,A0={},Uc="listenerMiddleware",eD=(n,t)=>{const e=s=>YA(n,()=>s.abort(n.reason));return(s,i)=>{rp(s);const r=new AbortController;e(r);const o=tD(async()=>{Cs(n),Cs(r.signal);const a=await s({pause:Ya(r.signal),delay:KA(r.signal),signal:r.signal});return Cs(r.signal),a},()=>r.abort(JO));return i?.autoJoin&&t.push(o.catch(Ga)),{result:Ya(n)(o),cancel(){r.abort(ZO)}}}},nD=(n,t)=>{const e=async(s,i)=>{Cs(t);let r=()=>{};const a=[new Promise((c,l)=>{let u=n({predicate:s,effect:(h,d)=>{d.unsubscribe(),c([h,d.getState(),d.getOriginalState()])}});r=()=>{u(),l()}})];i!=null&&a.push(new Promise(c=>setTimeout(c,i,null)));try{const c=await XA(t,Promise.race(a));return Cs(t),c}finally{r()}};return(s,i)=>GA(e(s,i))},ZA=n=>{let{type:t,actionCreator:e,matcher:s,predicate:i,effect:r}=n;if(t)i=Ci(t).match;else if(e)t=e.type,i=e.match;else if(s)i=s;else if(!i)throw new Error(Fe(21));return rp(r),{predicate:i,type:t,effect:r}},JA=bi(n=>{const{type:t,predicate:e,effect:s}=ZA(n);return{id:UO(),effect:s,type:t,predicate:e,pending:new Set,unsubscribe:()=>{throw new Error(Fe(22))}}},{withTypes:()=>JA}),S0=(n,t)=>{const{type:e,effect:s,predicate:i}=ZA(t);return Array.from(n.values()).find(r=>(typeof e=="string"?r.type===e:r.predicate===i)&&r.effect===s)},dd=n=>{n.pending.forEach(t=>{t.abort(hd)})},sD=(n,t)=>()=>{for(const e of t.keys())dd(e);n.clear()},T0=(n,t,e)=>{try{n(t,e)}catch(s){setTimeout(()=>{throw s},0)}},QA=bi(Ci(`${Uc}/add`),{withTypes:()=>QA}),iD=Ci(`${Uc}/removeAll`),tS=bi(Ci(`${Uc}/remove`),{withTypes:()=>tS}),rD=(...n)=>{console.error(`${Uc}/error`,...n)},pq=(n={})=>{const t=new Map,e=new Map,s=f=>{const m=e.get(f)??0;e.set(f,m+1)},i=f=>{const m=e.get(f)??1;m===1?e.delete(f):e.set(f,m-1)},{extra:r,onError:o=rD}=n;rp(o);const a=f=>(f.unsubscribe=()=>t.delete(f.id),t.set(f.id,f),m=>{f.unsubscribe(),m?.cancelActive&&dd(f)}),c=f=>{const m=S0(t,f)??JA(f);return a(m)};bi(c,{withTypes:()=>c});const l=f=>{const m=S0(t,f);return m&&(m.unsubscribe(),f.cancelActive&&dd(m)),!!m};bi(l,{withTypes:()=>l});const u=async(f,m,p,g)=>{const y=new AbortController,_=nD(c,y.signal),b=[];try{f.pending.add(y),s(f),await Promise.resolve(f.effect(m,bi({},p,{getOriginalState:g,condition:(w,v)=>_(w,v).then(Boolean),take:_,delay:KA(y.signal),pause:Ya(y.signal),extra:r,signal:y.signal,fork:eD(y.signal,b),unsubscribe:f.unsubscribe,subscribe:()=>{t.set(f.id,f)},cancelActiveListeners:()=>{f.pending.forEach((w,v,A)=>{w!==y&&(w.abort(hd),A.delete(w))})},cancel:()=>{y.abort(hd),f.pending.delete(y)},throwIfCancelled:()=>{Cs(y.signal)}})))}catch(w){w instanceof $c||T0(o,w,{raisedBy:"effect"})}finally{await Promise.all(b),y.abort(QO),i(f),f.pending.delete(y)}},h=sD(t,e);return{middleware:f=>m=>p=>{if(!MA(p))return m(p);if(QA.match(p))return c(p.payload);if(iD.match(p)){h();return}if(tS.match(p))return l(p.payload);let g=f.getState();const y=()=>{if(g===A0)throw new Error(Fe(23));return g};let _;try{if(_=m(p),t.size>0){const b=f.getState(),w=Array.from(t.values());for(const v of w){let A=!1;try{A=v.predicate(p,b,g)}catch(S){A=!1,T0(o,S,{raisedBy:"predicate"})}A&&u(v,p,f,y)}}}finally{g=A0}return _},startListening:c,stopListening:l,clearListeners:h}};function Fe(n){return`Minified Redux Toolkit error #${n}; visit https://redux-toolkit.js.org/Errors?code=${n} for the full message or use the non-minified dev environment for full errors. `}var Iu={},Lu={},Nu={},E0;function oD(){return E0||(E0=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e,s,{signal:i,edges:r}={}){let o,a=null;const c=r!=null&&r.includes("leading"),l=r==null||r.includes("trailing"),u=()=>{a!==null&&(e.apply(o,a),o=void 0,a=null)},h=()=>{l&&u(),p()};let d=null;const f=()=>{d!=null&&clearTimeout(d),d=setTimeout(()=>{d=null,h()},s)},m=()=>{d!==null&&(clearTimeout(d),d=null)},p=()=>{m(),o=void 0,a=null},g=()=>{u()},y=function(..._){if(i?.aborted)return;o=this,a=_;const b=d==null;f(),c&&b&&u()};return y.schedule=f,y.cancel=p,y.flush=g,i?.addEventListener("abort",p,{once:!0}),y}n.debounce=t})(Nu)),Nu}var x0;function aD(){return x0||(x0=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=oD();function e(s,i=0,r={}){typeof r!="object"&&(r={});const{leading:o=!1,trailing:a=!0,maxWait:c}=r,l=Array(2);o&&(l[0]="leading"),a&&(l[1]="trailing");let u,h=null;const d=t.debounce(function(...p){u=s.apply(this,p),h=null},i,{edges:l}),f=function(...p){return c!=null&&(h===null&&(h=Date.now()),Date.now()-h>=c)?(u=s.apply(this,p),h=Date.now(),d.cancel(),d.schedule(),u):(d.apply(this,p),u)},m=()=>(d.flush(),u);return f.cancel=d.cancel,f.flush=m,f}n.debounce=e})(Lu)),Lu}var C0;function cD(){return C0||(C0=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=aD();function e(s,i=0,r={}){const{leading:o=!0,trailing:a=!0}=r;return t.debounce(s,i,{leading:o,maxWait:i,trailing:a})}n.throttle=e})(Iu)),Iu}var Fu,P0;function lD(){return P0||(P0=1,Fu=cD().throttle),Fu}var uD=lD();const mq=Us(uD);var eS=Symbol.for("immer-nothing"),k0=Symbol.for("immer-draftable"),Be=Symbol.for("immer-state");function an(n,...t){throw new Error(`[Immer] minified error nr: ${n}. Full error at: https://bit.ly/3cXEKWf`)}var Ur=Object.getPrototypeOf;function Pi(n){return!!n&&!!n[Be]}function Os(n){return n?nS(n)||Array.isArray(n)||!!n[k0]||!!n.constructor?.[k0]||lo(n)||zc(n):!1}var hD=Object.prototype.constructor.toString(),M0=new WeakMap;function nS(n){if(!n||typeof n!="object")return!1;const t=Object.getPrototypeOf(n);if(t===null||t===Object.prototype)return!0;const e=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;if(e===Object)return!0;if(typeof e!="function")return!1;let s=M0.get(e);return s===void 0&&(s=Function.toString.call(e),M0.set(e,s)),s===hD}function Xa(n,t,e=!0){jc(n)===0?(e?Reflect.ownKeys(n):Object.keys(n)).forEach(i=>{t(i,n[i],n)}):n.forEach((s,i)=>t(i,s,n))}function jc(n){const t=n[Be];return t?t.type_:Array.isArray(n)?1:lo(n)?2:zc(n)?3:0}function fd(n,t){return jc(n)===2?n.has(t):Object.prototype.hasOwnProperty.call(n,t)}function sS(n,t,e){const s=jc(n);s===2?n.set(t,e):s===3?n.add(e):n[t]=e}function dD(n,t){return n===t?n!==0||1/n===1/t:n!==n&&t!==t}function lo(n){return n instanceof Map}function zc(n){return n instanceof Set}function fs(n){return n.copy_||n.base_}function pd(n,t){if(lo(n))return new Map(n);if(zc(n))return new Set(n);if(Array.isArray(n))return Array.prototype.slice.call(n);const e=nS(n);if(t===!0||t==="class_only"&&!e){const s=Object.getOwnPropertyDescriptors(n);delete s[Be];let i=Reflect.ownKeys(s);for(let r=0;r<i.length;r++){const o=i[r],a=s[o];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(s[o]={configurable:!0,writable:!0,enumerable:a.enumerable,value:n[o]})}return Object.create(Ur(n),s)}else{const s=Ur(n);if(s!==null&&e)return{...n};const i=Object.create(s);return Object.assign(i,n)}}function op(n,t=!1){return Vc(n)||Pi(n)||!Os(n)||(jc(n)>1&&Object.defineProperties(n,{set:Lo,add:Lo,clear:Lo,delete:Lo}),Object.freeze(n),t&&Object.values(n).forEach(e=>op(e,!0))),n}function fD(){an(2)}var Lo={value:fD};function Vc(n){return n===null||typeof n!="object"?!0:Object.isFrozen(n)}var pD={};function Ds(n){const t=pD[n];return t||an(0,n),t}var jr;function iS(){return jr}function mD(n,t){return{drafts_:[],parent_:n,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function R0(n,t){t&&(Ds("Patches"),n.patches_=[],n.inversePatches_=[],n.patchListener_=t)}function md(n){gd(n),n.drafts_.forEach(gD),n.drafts_=null}function gd(n){n===jr&&(jr=n.parent_)}function O0(n){return jr=mD(jr,n)}function gD(n){const t=n[Be];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function D0(n,t){t.unfinalizedDrafts_=t.drafts_.length;const e=t.drafts_[0];return n!==void 0&&n!==e?(e[Be].modified_&&(md(t),an(4)),Os(n)&&(n=Ka(t,n),t.parent_||Za(t,n)),t.patches_&&Ds("Patches").generateReplacementPatches_(e[Be].base_,n,t.patches_,t.inversePatches_)):n=Ka(t,e,[]),md(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),n!==eS?n:void 0}function Ka(n,t,e){if(Vc(t))return t;const s=n.immer_.shouldUseStrictIteration(),i=t[Be];if(!i)return Xa(t,(r,o)=>I0(n,i,t,r,o,e),s),t;if(i.scope_!==n)return t;if(!i.modified_)return Za(n,i.base_,!0),i.base_;if(!i.finalized_){i.finalized_=!0,i.scope_.unfinalizedDrafts_--;const r=i.copy_;let o=r,a=!1;i.type_===3&&(o=new Set(r),r.clear(),a=!0),Xa(o,(c,l)=>I0(n,i,r,c,l,e,a),s),Za(n,r,!1),e&&n.patches_&&Ds("Patches").generatePatches_(i,e,n.patches_,n.inversePatches_)}return i.copy_}function I0(n,t,e,s,i,r,o){if(i==null||typeof i!="object"&&!o)return;const a=Vc(i);if(!(a&&!o)){if(Pi(i)){const c=r&&t&&t.type_!==3&&!fd(t.assigned_,s)?r.concat(s):void 0,l=Ka(n,i,c);if(sS(e,s,l),Pi(l))n.canAutoFreeze_=!1;else return}else o&&e.add(i);if(Os(i)&&!a){if(!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1||t&&t.base_&&t.base_[s]===i&&a)return;Ka(n,i),(!t||!t.scope_.parent_)&&typeof s!="symbol"&&(lo(e)?e.has(s):Object.prototype.propertyIsEnumerable.call(e,s))&&Za(n,i)}}}function Za(n,t,e=!1){!n.parent_&&n.immer_.autoFreeze_&&n.canAutoFreeze_&&op(t,e)}function yD(n,t){const e=Array.isArray(n),s={type_:e?1:0,scope_:t?t.scope_:iS(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:n,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=s,r=ap;e&&(i=[s],r=zr);const{revoke:o,proxy:a}=Proxy.revocable(i,r);return s.draft_=a,s.revoke_=o,a}var ap={get(n,t){if(t===Be)return n;const e=fs(n);if(!fd(e,t))return bD(n,e,t);const s=e[t];return n.finalized_||!Os(s)?s:s===Bu(n.base_,t)?($u(n),n.copy_[t]=bd(s,n)):s},has(n,t){return t in fs(n)},ownKeys(n){return Reflect.ownKeys(fs(n))},set(n,t,e){const s=rS(fs(n),t);if(s?.set)return s.set.call(n.draft_,e),!0;if(!n.modified_){const i=Bu(fs(n),t),r=i?.[Be];if(r&&r.base_===e)return n.copy_[t]=e,n.assigned_[t]=!1,!0;if(dD(e,i)&&(e!==void 0||fd(n.base_,t)))return!0;$u(n),yd(n)}return n.copy_[t]===e&&(e!==void 0||t in n.copy_)||Number.isNaN(e)&&Number.isNaN(n.copy_[t])||(n.copy_[t]=e,n.assigned_[t]=!0),!0},deleteProperty(n,t){return Bu(n.base_,t)!==void 0||t in n.base_?(n.assigned_[t]=!1,$u(n),yd(n)):delete n.assigned_[t],n.copy_&&delete n.copy_[t],!0},getOwnPropertyDescriptor(n,t){const e=fs(n),s=Reflect.getOwnPropertyDescriptor(e,t);return s&&{writable:!0,configurable:n.type_!==1||t!=="length",enumerable:s.enumerable,value:e[t]}},defineProperty(){an(11)},getPrototypeOf(n){return Ur(n.base_)},setPrototypeOf(){an(12)}},zr={};Xa(ap,(n,t)=>{zr[n]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});zr.deleteProperty=function(n,t){return zr.set.call(this,n,t,void 0)};zr.set=function(n,t,e){return ap.set.call(this,n[0],t,e,n[0])};function Bu(n,t){const e=n[Be];return(e?fs(e):n)[t]}function bD(n,t,e){const s=rS(t,e);return s?"value"in s?s.value:s.get?.call(n.draft_):void 0}function rS(n,t){if(!(t in n))return;let e=Ur(n);for(;e;){const s=Object.getOwnPropertyDescriptor(e,t);if(s)return s;e=Ur(e)}}function yd(n){n.modified_||(n.modified_=!0,n.parent_&&yd(n.parent_))}function $u(n){n.copy_||(n.copy_=pd(n.base_,n.scope_.immer_.useStrictShallowCopy_))}var _D=class{constructor(n){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(t,e,s)=>{if(typeof t=="function"&&typeof e!="function"){const r=e;e=t;const o=this;return function(c=r,...l){return o.produce(c,u=>e.call(this,u,...l))}}typeof e!="function"&&an(6),s!==void 0&&typeof s!="function"&&an(7);let i;if(Os(t)){const r=O0(this),o=bd(t,void 0);let a=!0;try{i=e(o),a=!1}finally{a?md(r):gd(r)}return R0(r,s),D0(i,r)}else if(!t||typeof t!="object"){if(i=e(t),i===void 0&&(i=t),i===eS&&(i=void 0),this.autoFreeze_&&op(i,!0),s){const r=[],o=[];Ds("Patches").generateReplacementPatches_(t,i,r,o),s(r,o)}return i}else an(1,t)},this.produceWithPatches=(t,e)=>{if(typeof t=="function")return(o,...a)=>this.produceWithPatches(o,c=>t(c,...a));let s,i;return[this.produce(t,e,(o,a)=>{s=o,i=a}),s,i]},typeof n?.autoFreeze=="boolean"&&this.setAutoFreeze(n.autoFreeze),typeof n?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(n.useStrictShallowCopy),typeof n?.useStrictIteration=="boolean"&&this.setUseStrictIteration(n.useStrictIteration)}createDraft(n){Os(n)||an(8),Pi(n)&&(n=wD(n));const t=O0(this),e=bd(n,void 0);return e[Be].isManual_=!0,gd(t),e}finishDraft(n,t){const e=n&&n[Be];(!e||!e.isManual_)&&an(9);const{scope_:s}=e;return R0(s,t),D0(void 0,s)}setAutoFreeze(n){this.autoFreeze_=n}setUseStrictShallowCopy(n){this.useStrictShallowCopy_=n}setUseStrictIteration(n){this.useStrictIteration_=n}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(n,t){let e;for(e=t.length-1;e>=0;e--){const i=t[e];if(i.path.length===0&&i.op==="replace"){n=i.value;break}}e>-1&&(t=t.slice(e+1));const s=Ds("Patches").applyPatches_;return Pi(n)?s(n,t):this.produce(n,i=>s(i,t))}};function bd(n,t){const e=lo(n)?Ds("MapSet").proxyMap_(n,t):zc(n)?Ds("MapSet").proxySet_(n,t):yD(n,t);return(t?t.scope_:iS()).drafts_.push(e),e}function wD(n){return Pi(n)||an(10,n),oS(n)}function oS(n){if(!Os(n)||Vc(n))return n;const t=n[Be];let e,s=!0;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,e=pd(n,t.scope_.immer_.useStrictShallowCopy_),s=t.scope_.immer_.shouldUseStrictIteration()}else e=pd(n,!0);return Xa(e,(i,r)=>{sS(e,i,oS(r))},s),t&&(t.finalized_=!1),e}var vD=new _D;vD.produce;function gq(n){return n}var Uu={},ju={},zu={},L0;function AD(){return L0||(L0=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=CA();function e(s){return t.isSymbol(s)?NaN:Number(s)}n.toNumber=e})(zu)),zu}var N0;function SD(){return N0||(N0=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=AD();function e(s){return s?(s=t.toNumber(s),s===1/0||s===-1/0?(s<0?-1:1)*Number.MAX_VALUE:s===s?s:0):s===0?s:0}n.toFinite=e})(ju)),ju}var F0;function TD(){return F0||(F0=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=PA(),e=SD();function s(i,r,o){o&&typeof o!="number"&&t.isIterateeCall(i,r,o)&&(r=o=void 0),i=e.toFinite(i),r===void 0?(r=i,i=0):r=e.toFinite(r),o=o===void 0?i<r?1:-1:e.toFinite(o);const a=Math.max(Math.ceil((r-i)/(o||1)),0),c=new Array(a);for(let l=0;l<a;l++)c[l]=i,i+=o;return c}n.range=s})(Uu)),Uu}var Vu,B0;function ED(){return B0||(B0=1,Vu=TD().range),Vu}var xD=ED();const yq=Us(xD);function Jn(n,t){return n==null||t==null?NaN:n<t?-1:n>t?1:n>=t?0:NaN}function CD(n,t){return n==null||t==null?NaN:t<n?-1:t>n?1:t>=n?0:NaN}function cp(n){let t,e,s;n.length!==2?(t=Jn,e=(a,c)=>Jn(n(a),c),s=(a,c)=>n(a)-c):(t=n===Jn||n===CD?n:PD,e=n,s=n);function i(a,c,l=0,u=a.length){if(l<u){if(t(c,c)!==0)return u;do{const h=l+u>>>1;e(a[h],c)<0?l=h+1:u=h}while(l<u)}return l}function r(a,c,l=0,u=a.length){if(l<u){if(t(c,c)!==0)return u;do{const h=l+u>>>1;e(a[h],c)<=0?l=h+1:u=h}while(l<u)}return l}function o(a,c,l=0,u=a.length){const h=i(a,c,l,u-1);return h>l&&s(a[h-1],c)>-s(a[h],c)?h-1:h}return{left:i,center:o,right:r}}function PD(){return 0}function aS(n){return n===null?NaN:+n}function*kD(n,t){for(let e of n)e!=null&&(e=+e)>=e&&(yield e)}const MD=cp(Jn),uo=MD.right;cp(aS).center;class $0 extends Map{constructor(t,e=DD){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),t!=null)for(const[s,i]of t)this.set(s,i)}get(t){return super.get(U0(this,t))}has(t){return super.has(U0(this,t))}set(t,e){return super.set(RD(this,t),e)}delete(t){return super.delete(OD(this,t))}}function U0({_intern:n,_key:t},e){const s=t(e);return n.has(s)?n.get(s):e}function RD({_intern:n,_key:t},e){const s=t(e);return n.has(s)?n.get(s):(n.set(s,e),e)}function OD({_intern:n,_key:t},e){const s=t(e);return n.has(s)&&(e=n.get(s),n.delete(s)),e}function DD(n){return n!==null&&typeof n=="object"?n.valueOf():n}function ID(n=Jn){if(n===Jn)return cS;if(typeof n!="function")throw new TypeError("compare is not a function");return(t,e)=>{const s=n(t,e);return s||s===0?s:(n(e,e)===0)-(n(t,t)===0)}}function cS(n,t){return(n==null||!(n>=n))-(t==null||!(t>=t))||(n<t?-1:n>t?1:0)}const LD=Math.sqrt(50),ND=Math.sqrt(10),FD=Math.sqrt(2);function Ja(n,t,e){const s=(t-n)/Math.max(0,e),i=Math.floor(Math.log10(s)),r=s/Math.pow(10,i),o=r>=LD?10:r>=ND?5:r>=FD?2:1;let a,c,l;return i<0?(l=Math.pow(10,-i)/o,a=Math.round(n*l),c=Math.round(t*l),a/l<n&&++a,c/l>t&&--c,l=-l):(l=Math.pow(10,i)*o,a=Math.round(n/l),c=Math.round(t/l),a*l<n&&++a,c*l>t&&--c),c<a&&.5<=e&&e<2?Ja(n,t,e*2):[a,c,l]}function _d(n,t,e){if(t=+t,n=+n,e=+e,!(e>0))return[];if(n===t)return[n];const s=t<n,[i,r,o]=s?Ja(t,n,e):Ja(n,t,e);if(!(r>=i))return[];const a=r-i+1,c=new Array(a);if(s)if(o<0)for(let l=0;l<a;++l)c[l]=(r-l)/-o;else for(let l=0;l<a;++l)c[l]=(r-l)*o;else if(o<0)for(let l=0;l<a;++l)c[l]=(i+l)/-o;else for(let l=0;l<a;++l)c[l]=(i+l)*o;return c}function wd(n,t,e){return t=+t,n=+n,e=+e,Ja(n,t,e)[2]}function vd(n,t,e){t=+t,n=+n,e=+e;const s=t<n,i=s?wd(t,n,e):wd(n,t,e);return(s?-1:1)*(i<0?1/-i:i)}function j0(n,t){let e;for(const s of n)s!=null&&(e<s||e===void 0&&s>=s)&&(e=s);return e}function z0(n,t){let e;for(const s of n)s!=null&&(e>s||e===void 0&&s>=s)&&(e=s);return e}function lS(n,t,e=0,s=1/0,i){if(t=Math.floor(t),e=Math.floor(Math.max(0,e)),s=Math.floor(Math.min(n.length-1,s)),!(e<=t&&t<=s))return n;for(i=i===void 0?cS:ID(i);s>e;){if(s-e>600){const c=s-e+1,l=t-e+1,u=Math.log(c),h=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*h*(c-h)/c)*(l-c/2<0?-1:1),f=Math.max(e,Math.floor(t-l*h/c+d)),m=Math.min(s,Math.floor(t+(c-l)*h/c+d));lS(n,t,f,m,i)}const r=n[t];let o=e,a=s;for(Hi(n,e,t),i(n[s],r)>0&&Hi(n,e,s);o<a;){for(Hi(n,o,a),++o,--a;i(n[o],r)<0;)++o;for(;i(n[a],r)>0;)--a}i(n[e],r)===0?Hi(n,e,a):(++a,Hi(n,a,s)),a<=t&&(e=a+1),t<=a&&(s=a-1)}return n}function Hi(n,t,e){const s=n[t];n[t]=n[e],n[e]=s}function BD(n,t,e){if(n=Float64Array.from(kD(n)),!(!(s=n.length)||isNaN(t=+t))){if(t<=0||s<2)return z0(n);if(t>=1)return j0(n);var s,i=(s-1)*t,r=Math.floor(i),o=j0(lS(n,r).subarray(0,r+1)),a=z0(n.subarray(r+1));return o+(a-o)*(i-r)}}function $D(n,t,e=aS){if(!(!(s=n.length)||isNaN(t=+t))){if(t<=0||s<2)return+e(n[0],0,n);if(t>=1)return+e(n[s-1],s-1,n);var s,i=(s-1)*t,r=Math.floor(i),o=+e(n[r],r,n),a=+e(n[r+1],r+1,n);return o+(a-o)*(i-r)}}function UD(n,t,e){n=+n,t=+t,e=(i=arguments.length)<2?(t=n,n=0,1):i<3?1:+e;for(var s=-1,i=Math.max(0,Math.ceil((t-n)/e))|0,r=new Array(i);++s<i;)r[s]=n+s*e;return r}function Qe(n,t){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(t).domain(n);break}return this}function zn(n,t){switch(arguments.length){case 0:break;case 1:{typeof n=="function"?this.interpolator(n):this.range(n);break}default:{this.domain(n),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const Ad=Symbol("implicit");function lp(){var n=new $0,t=[],e=[],s=Ad;function i(r){let o=n.get(r);if(o===void 0){if(s!==Ad)return s;n.set(r,o=t.push(r)-1)}return e[o%e.length]}return i.domain=function(r){if(!arguments.length)return t.slice();t=[],n=new $0;for(const o of r)n.has(o)||n.set(o,t.push(o)-1);return i},i.range=function(r){return arguments.length?(e=Array.from(r),i):e.slice()},i.unknown=function(r){return arguments.length?(s=r,i):s},i.copy=function(){return lp(t,e).unknown(s)},Qe.apply(i,arguments),i}function up(){var n=lp().unknown(void 0),t=n.domain,e=n.range,s=0,i=1,r,o,a=!1,c=0,l=0,u=.5;delete n.unknown;function h(){var d=t().length,f=i<s,m=f?i:s,p=f?s:i;r=(p-m)/Math.max(1,d-c+l*2),a&&(r=Math.floor(r)),m+=(p-m-r*(d-c))*u,o=r*(1-c),a&&(m=Math.round(m),o=Math.round(o));var g=UD(d).map(function(y){return m+r*y});return e(f?g.reverse():g)}return n.domain=function(d){return arguments.length?(t(d),h()):t()},n.range=function(d){return arguments.length?([s,i]=d,s=+s,i=+i,h()):[s,i]},n.rangeRound=function(d){return[s,i]=d,s=+s,i=+i,a=!0,h()},n.bandwidth=function(){return o},n.step=function(){return r},n.round=function(d){return arguments.length?(a=!!d,h()):a},n.padding=function(d){return arguments.length?(c=Math.min(1,l=+d),h()):c},n.paddingInner=function(d){return arguments.length?(c=Math.min(1,d),h()):c},n.paddingOuter=function(d){return arguments.length?(l=+d,h()):l},n.align=function(d){return arguments.length?(u=Math.max(0,Math.min(1,d)),h()):u},n.copy=function(){return up(t(),[s,i]).round(a).paddingInner(c).paddingOuter(l).align(u)},Qe.apply(h(),arguments)}function uS(n){var t=n.copy;return n.padding=n.paddingOuter,delete n.paddingInner,delete n.paddingOuter,n.copy=function(){return uS(t())},n}function jD(){return uS(up.apply(null,arguments).paddingInner(1))}function hp(n,t,e){n.prototype=t.prototype=e,e.constructor=n}function hS(n,t){var e=Object.create(n.prototype);for(var s in t)e[s]=t[s];return e}function ho(){}var Vr=.7,Qa=1/Vr,_i="\\s*([+-]?\\d+)\\s*",Hr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",vn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",zD=/^#([0-9a-f]{3,8})$/,VD=new RegExp(`^rgb\\(${_i},${_i},${_i}\\)$`),HD=new RegExp(`^rgb\\(${vn},${vn},${vn}\\)$`),qD=new RegExp(`^rgba\\(${_i},${_i},${_i},${Hr}\\)$`),WD=new RegExp(`^rgba\\(${vn},${vn},${vn},${Hr}\\)$`),GD=new RegExp(`^hsl\\(${Hr},${vn},${vn}\\)$`),YD=new RegExp(`^hsla\\(${Hr},${vn},${vn},${Hr}\\)$`),V0={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};hp(ho,qr,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:H0,formatHex:H0,formatHex8:XD,formatHsl:KD,formatRgb:q0,toString:q0});function H0(){return this.rgb().formatHex()}function XD(){return this.rgb().formatHex8()}function KD(){return dS(this).formatHsl()}function q0(){return this.rgb().formatRgb()}function qr(n){var t,e;return n=(n+"").trim().toLowerCase(),(t=zD.exec(n))?(e=t[1].length,t=parseInt(t[1],16),e===6?W0(t):e===3?new xe(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?No(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?No(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=VD.exec(n))?new xe(t[1],t[2],t[3],1):(t=HD.exec(n))?new xe(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=qD.exec(n))?No(t[1],t[2],t[3],t[4]):(t=WD.exec(n))?No(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=GD.exec(n))?X0(t[1],t[2]/100,t[3]/100,1):(t=YD.exec(n))?X0(t[1],t[2]/100,t[3]/100,t[4]):V0.hasOwnProperty(n)?W0(V0[n]):n==="transparent"?new xe(NaN,NaN,NaN,0):null}function W0(n){return new xe(n>>16&255,n>>8&255,n&255,1)}function No(n,t,e,s){return s<=0&&(n=t=e=NaN),new xe(n,t,e,s)}function ZD(n){return n instanceof ho||(n=qr(n)),n?(n=n.rgb(),new xe(n.r,n.g,n.b,n.opacity)):new xe}function Sd(n,t,e,s){return arguments.length===1?ZD(n):new xe(n,t,e,s??1)}function xe(n,t,e,s){this.r=+n,this.g=+t,this.b=+e,this.opacity=+s}hp(xe,Sd,hS(ho,{brighter(n){return n=n==null?Qa:Math.pow(Qa,n),new xe(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Vr:Math.pow(Vr,n),new xe(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new xe(Ps(this.r),Ps(this.g),Ps(this.b),tc(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:G0,formatHex:G0,formatHex8:JD,formatRgb:Y0,toString:Y0}));function G0(){return`#${ws(this.r)}${ws(this.g)}${ws(this.b)}`}function JD(){return`#${ws(this.r)}${ws(this.g)}${ws(this.b)}${ws((isNaN(this.opacity)?1:this.opacity)*255)}`}function Y0(){const n=tc(this.opacity);return`${n===1?"rgb(":"rgba("}${Ps(this.r)}, ${Ps(this.g)}, ${Ps(this.b)}${n===1?")":`, ${n})`}`}function tc(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Ps(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function ws(n){return n=Ps(n),(n<16?"0":"")+n.toString(16)}function X0(n,t,e,s){return s<=0?n=t=e=NaN:e<=0||e>=1?n=t=NaN:t<=0&&(n=NaN),new cn(n,t,e,s)}function dS(n){if(n instanceof cn)return new cn(n.h,n.s,n.l,n.opacity);if(n instanceof ho||(n=qr(n)),!n)return new cn;if(n instanceof cn)return n;n=n.rgb();var t=n.r/255,e=n.g/255,s=n.b/255,i=Math.min(t,e,s),r=Math.max(t,e,s),o=NaN,a=r-i,c=(r+i)/2;return a?(t===r?o=(e-s)/a+(e<s)*6:e===r?o=(s-t)/a+2:o=(t-e)/a+4,a/=c<.5?r+i:2-r-i,o*=60):a=c>0&&c<1?0:o,new cn(o,a,c,n.opacity)}function QD(n,t,e,s){return arguments.length===1?dS(n):new cn(n,t,e,s??1)}function cn(n,t,e,s){this.h=+n,this.s=+t,this.l=+e,this.opacity=+s}hp(cn,QD,hS(ho,{brighter(n){return n=n==null?Qa:Math.pow(Qa,n),new cn(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Vr:Math.pow(Vr,n),new cn(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,t=isNaN(n)||isNaN(this.s)?0:this.s,e=this.l,s=e+(e<.5?e:1-e)*t,i=2*e-s;return new xe(Hu(n>=240?n-240:n+120,i,s),Hu(n,i,s),Hu(n<120?n+240:n-120,i,s),this.opacity)},clamp(){return new cn(K0(this.h),Fo(this.s),Fo(this.l),tc(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=tc(this.opacity);return`${n===1?"hsl(":"hsla("}${K0(this.h)}, ${Fo(this.s)*100}%, ${Fo(this.l)*100}%${n===1?")":`, ${n})`}`}}));function K0(n){return n=(n||0)%360,n<0?n+360:n}function Fo(n){return Math.max(0,Math.min(1,n||0))}function Hu(n,t,e){return(n<60?t+(e-t)*n/60:n<180?e:n<240?t+(e-t)*(240-n)/60:t)*255}const dp=n=>()=>n;function tI(n,t){return function(e){return n+e*t}}function eI(n,t,e){return n=Math.pow(n,e),t=Math.pow(t,e)-n,e=1/e,function(s){return Math.pow(n+s*t,e)}}function nI(n){return(n=+n)==1?fS:function(t,e){return e-t?eI(t,e,n):dp(isNaN(t)?e:t)}}function fS(n,t){var e=t-n;return e?tI(n,e):dp(isNaN(n)?t:n)}const Z0=(function n(t){var e=nI(t);function s(i,r){var o=e((i=Sd(i)).r,(r=Sd(r)).r),a=e(i.g,r.g),c=e(i.b,r.b),l=fS(i.opacity,r.opacity);return function(u){return i.r=o(u),i.g=a(u),i.b=c(u),i.opacity=l(u),i+""}}return s.gamma=n,s})(1);function sI(n,t){t||(t=[]);var e=n?Math.min(t.length,n.length):0,s=t.slice(),i;return function(r){for(i=0;i<e;++i)s[i]=n[i]*(1-r)+t[i]*r;return s}}function iI(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function rI(n,t){var e=t?t.length:0,s=n?Math.min(e,n.length):0,i=new Array(s),r=new Array(e),o;for(o=0;o<s;++o)i[o]=Ni(n[o],t[o]);for(;o<e;++o)r[o]=t[o];return function(a){for(o=0;o<s;++o)r[o]=i[o](a);return r}}function oI(n,t){var e=new Date;return n=+n,t=+t,function(s){return e.setTime(n*(1-s)+t*s),e}}function ec(n,t){return n=+n,t=+t,function(e){return n*(1-e)+t*e}}function aI(n,t){var e={},s={},i;(n===null||typeof n!="object")&&(n={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in n?e[i]=Ni(n[i],t[i]):s[i]=t[i];return function(r){for(i in e)s[i]=e[i](r);return s}}var Td=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,qu=new RegExp(Td.source,"g");function cI(n){return function(){return n}}function lI(n){return function(t){return n(t)+""}}function uI(n,t){var e=Td.lastIndex=qu.lastIndex=0,s,i,r,o=-1,a=[],c=[];for(n=n+"",t=t+"";(s=Td.exec(n))&&(i=qu.exec(t));)(r=i.index)>e&&(r=t.slice(e,r),a[o]?a[o]+=r:a[++o]=r),(s=s[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,c.push({i:o,x:ec(s,i)})),e=qu.lastIndex;return e<t.length&&(r=t.slice(e),a[o]?a[o]+=r:a[++o]=r),a.length<2?c[0]?lI(c[0].x):cI(t):(t=c.length,function(l){for(var u=0,h;u<t;++u)a[(h=c[u]).i]=h.x(l);return a.join("")})}function Ni(n,t){var e=typeof t,s;return t==null||e==="boolean"?dp(t):(e==="number"?ec:e==="string"?(s=qr(t))?(t=s,Z0):uI:t instanceof qr?Z0:t instanceof Date?oI:iI(t)?sI:Array.isArray(t)?rI:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?aI:ec)(n,t)}function fp(n,t){return n=+n,t=+t,function(e){return Math.round(n*(1-e)+t*e)}}function hI(n,t){t===void 0&&(t=n,n=Ni);for(var e=0,s=t.length-1,i=t[0],r=new Array(s<0?0:s);e<s;)r[e]=n(i,i=t[++e]);return function(o){var a=Math.max(0,Math.min(s-1,Math.floor(o*=s)));return r[a](o-a)}}function dI(n){return function(){return n}}function nc(n){return+n}var J0=[0,1];function _e(n){return n}function Ed(n,t){return(t-=n=+n)?function(e){return(e-n)/t}:dI(isNaN(t)?NaN:.5)}function fI(n,t){var e;return n>t&&(e=n,n=t,t=e),function(s){return Math.max(n,Math.min(t,s))}}function pI(n,t,e){var s=n[0],i=n[1],r=t[0],o=t[1];return i<s?(s=Ed(i,s),r=e(o,r)):(s=Ed(s,i),r=e(r,o)),function(a){return r(s(a))}}function mI(n,t,e){var s=Math.min(n.length,t.length)-1,i=new Array(s),r=new Array(s),o=-1;for(n[s]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++o<s;)i[o]=Ed(n[o],n[o+1]),r[o]=e(t[o],t[o+1]);return function(a){var c=uo(n,a,1,s)-1;return r[c](i[c](a))}}function fo(n,t){return t.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function Hc(){var n=J0,t=J0,e=Ni,s,i,r,o=_e,a,c,l;function u(){var d=Math.min(n.length,t.length);return o!==_e&&(o=fI(n[0],n[d-1])),a=d>2?mI:pI,c=l=null,h}function h(d){return d==null||isNaN(d=+d)?r:(c||(c=a(n.map(s),t,e)))(s(o(d)))}return h.invert=function(d){return o(i((l||(l=a(t,n.map(s),ec)))(d)))},h.domain=function(d){return arguments.length?(n=Array.from(d,nc),u()):n.slice()},h.range=function(d){return arguments.length?(t=Array.from(d),u()):t.slice()},h.rangeRound=function(d){return t=Array.from(d),e=fp,u()},h.clamp=function(d){return arguments.length?(o=d?!0:_e,u()):o!==_e},h.interpolate=function(d){return arguments.length?(e=d,u()):e},h.unknown=function(d){return arguments.length?(r=d,h):r},function(d,f){return s=d,i=f,u()}}function pp(){return Hc()(_e,_e)}function gI(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function sc(n,t){if((e=(n=t?n.toExponential(t-1):n.toExponential()).indexOf("e"))<0)return null;var e,s=n.slice(0,e);return[s.length>1?s[0]+s.slice(2):s,+n.slice(e+1)]}function ki(n){return n=sc(Math.abs(n)),n?n[1]:NaN}function yI(n,t){return function(e,s){for(var i=e.length,r=[],o=0,a=n[0],c=0;i>0&&a>0&&(c+a+1>s&&(a=Math.max(1,s-c)),r.push(e.substring(i-=a,i+a)),!((c+=a+1)>s));)a=n[o=(o+1)%n.length];return r.reverse().join(t)}}function bI(n){return function(t){return t.replace(/[0-9]/g,function(e){return n[+e]})}}var _I=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Wr(n){if(!(t=_I.exec(n)))throw new Error("invalid format: "+n);var t;return new mp({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Wr.prototype=mp.prototype;function mp(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}mp.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function wI(n){t:for(var t=n.length,e=1,s=-1,i;e<t;++e)switch(n[e]){case".":s=i=e;break;case"0":s===0&&(s=e),i=e;break;default:if(!+n[e])break t;s>0&&(s=0);break}return s>0?n.slice(0,s)+n.slice(i+1):n}var pS;function vI(n,t){var e=sc(n,t);if(!e)return n+"";var s=e[0],i=e[1],r=i-(pS=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=s.length;return r===o?s:r>o?s+new Array(r-o+1).join("0"):r>0?s.slice(0,r)+"."+s.slice(r):"0."+new Array(1-r).join("0")+sc(n,Math.max(0,t+r-1))[0]}function Q0(n,t){var e=sc(n,t);if(!e)return n+"";var s=e[0],i=e[1];return i<0?"0."+new Array(-i).join("0")+s:s.length>i+1?s.slice(0,i+1)+"."+s.slice(i+1):s+new Array(i-s.length+2).join("0")}const tb={"%":(n,t)=>(n*100).toFixed(t),b:n=>Math.round(n).toString(2),c:n=>n+"",d:gI,e:(n,t)=>n.toExponential(t),f:(n,t)=>n.toFixed(t),g:(n,t)=>n.toPrecision(t),o:n=>Math.round(n).toString(8),p:(n,t)=>Q0(n*100,t),r:Q0,s:vI,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function eb(n){return n}var nb=Array.prototype.map,sb=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function AI(n){var t=n.grouping===void 0||n.thousands===void 0?eb:yI(nb.call(n.grouping,Number),n.thousands+""),e=n.currency===void 0?"":n.currency[0]+"",s=n.currency===void 0?"":n.currency[1]+"",i=n.decimal===void 0?".":n.decimal+"",r=n.numerals===void 0?eb:bI(nb.call(n.numerals,String)),o=n.percent===void 0?"%":n.percent+"",a=n.minus===void 0?"":n.minus+"",c=n.nan===void 0?"NaN":n.nan+"";function l(h){h=Wr(h);var d=h.fill,f=h.align,m=h.sign,p=h.symbol,g=h.zero,y=h.width,_=h.comma,b=h.precision,w=h.trim,v=h.type;v==="n"?(_=!0,v="g"):tb[v]||(b===void 0&&(b=12),w=!0,v="g"),(g||d==="0"&&f==="=")&&(g=!0,d="0",f="=");var A=p==="$"?e:p==="#"&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",S=p==="$"?s:/[%p]/.test(v)?o:"",T=tb[v],E=/[defgprs%]/.test(v);b=b===void 0?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function P(x){var I=A,V=S,X,st,$;if(v==="c")V=T(x)+V,x="";else{x=+x;var D=x<0||1/x<0;if(x=isNaN(x)?c:T(Math.abs(x),b),w&&(x=wI(x)),D&&+x==0&&m!=="+"&&(D=!1),I=(D?m==="("?m:a:m==="-"||m==="("?"":m)+I,V=(v==="s"?sb[8+pS/3]:"")+V+(D&&m==="("?")":""),E){for(X=-1,st=x.length;++X<st;)if($=x.charCodeAt(X),48>$||$>57){V=($===46?i+x.slice(X+1):x.slice(X))+V,x=x.slice(0,X);break}}}_&&!g&&(x=t(x,1/0));var k=I.length+x.length+V.length,L=k<y?new Array(y-k+1).join(d):"";switch(_&&g&&(x=t(L+x,L.length?y-V.length:1/0),L=""),f){case"<":x=I+x+V+L;break;case"=":x=I+L+x+V;break;case"^":x=L.slice(0,k=L.length>>1)+I+x+V+L.slice(k);break;default:x=L+I+x+V;break}return r(x)}return P.toString=function(){return h+""},P}function u(h,d){var f=l((h=Wr(h),h.type="f",h)),m=Math.max(-8,Math.min(8,Math.floor(ki(d)/3)))*3,p=Math.pow(10,-m),g=sb[8+m/3];return function(y){return f(p*y)+g}}return{format:l,formatPrefix:u}}var Bo,gp,mS;SI({thousands:",",grouping:[3],currency:["$",""]});function SI(n){return Bo=AI(n),gp=Bo.format,mS=Bo.formatPrefix,Bo}function TI(n){return Math.max(0,-ki(Math.abs(n)))}function EI(n,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(ki(t)/3)))*3-ki(Math.abs(n)))}function xI(n,t){return n=Math.abs(n),t=Math.abs(t)-n,Math.max(0,ki(t)-ki(n))+1}function gS(n,t,e,s){var i=vd(n,t,e),r;switch(s=Wr(s??",f"),s.type){case"s":{var o=Math.max(Math.abs(n),Math.abs(t));return s.precision==null&&!isNaN(r=EI(i,o))&&(s.precision=r),mS(s,o)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(r=xI(i,Math.max(Math.abs(n),Math.abs(t))))&&(s.precision=r-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(r=TI(i))&&(s.precision=r-(s.type==="%")*2);break}}return gp(s)}function rs(n){var t=n.domain;return n.ticks=function(e){var s=t();return _d(s[0],s[s.length-1],e??10)},n.tickFormat=function(e,s){var i=t();return gS(i[0],i[i.length-1],e??10,s)},n.nice=function(e){e==null&&(e=10);var s=t(),i=0,r=s.length-1,o=s[i],a=s[r],c,l,u=10;for(a<o&&(l=o,o=a,a=l,l=i,i=r,r=l);u-- >0;){if(l=wd(o,a,e),l===c)return s[i]=o,s[r]=a,t(s);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;c=l}return n},n}function yS(){var n=pp();return n.copy=function(){return fo(n,yS())},Qe.apply(n,arguments),rs(n)}function bS(n){var t;function e(s){return s==null||isNaN(s=+s)?t:s}return e.invert=e,e.domain=e.range=function(s){return arguments.length?(n=Array.from(s,nc),e):n.slice()},e.unknown=function(s){return arguments.length?(t=s,e):t},e.copy=function(){return bS(n).unknown(t)},n=arguments.length?Array.from(n,nc):[0,1],rs(e)}function _S(n,t){n=n.slice();var e=0,s=n.length-1,i=n[e],r=n[s],o;return r<i&&(o=e,e=s,s=o,o=i,i=r,r=o),n[e]=t.floor(i),n[s]=t.ceil(r),n}function ib(n){return Math.log(n)}function rb(n){return Math.exp(n)}function CI(n){return-Math.log(-n)}function PI(n){return-Math.exp(-n)}function kI(n){return isFinite(n)?+("1e"+n):n<0?0:n}function MI(n){return n===10?kI:n===Math.E?Math.exp:t=>Math.pow(n,t)}function RI(n){return n===Math.E?Math.log:n===10&&Math.log10||n===2&&Math.log2||(n=Math.log(n),t=>Math.log(t)/n)}function ob(n){return(t,e)=>-n(-t,e)}function yp(n){const t=n(ib,rb),e=t.domain;let s=10,i,r;function o(){return i=RI(s),r=MI(s),e()[0]<0?(i=ob(i),r=ob(r),n(CI,PI)):n(ib,rb),t}return t.base=function(a){return arguments.length?(s=+a,o()):s},t.domain=function(a){return arguments.length?(e(a),o()):e()},t.ticks=a=>{const c=e();let l=c[0],u=c[c.length-1];const h=u<l;h&&([l,u]=[u,l]);let d=i(l),f=i(u),m,p;const g=a==null?10:+a;let y=[];if(!(s%1)&&f-d<g){if(d=Math.floor(d),f=Math.ceil(f),l>0){for(;d<=f;++d)for(m=1;m<s;++m)if(p=d<0?m/r(-d):m*r(d),!(p<l)){if(p>u)break;y.push(p)}}else for(;d<=f;++d)for(m=s-1;m>=1;--m)if(p=d>0?m/r(-d):m*r(d),!(p<l)){if(p>u)break;y.push(p)}y.length*2<g&&(y=_d(l,u,g))}else y=_d(d,f,Math.min(f-d,g)).map(r);return h?y.reverse():y},t.tickFormat=(a,c)=>{if(a==null&&(a=10),c==null&&(c=s===10?"s":","),typeof c!="function"&&(!(s%1)&&(c=Wr(c)).precision==null&&(c.trim=!0),c=gp(c)),a===1/0)return c;const l=Math.max(1,s*a/t.ticks().length);return u=>{let h=u/r(Math.round(i(u)));return h*s<s-.5&&(h*=s),h<=l?c(u):""}},t.nice=()=>e(_S(e(),{floor:a=>r(Math.floor(i(a))),ceil:a=>r(Math.ceil(i(a)))})),t}function wS(){const n=yp(Hc()).domain([1,10]);return n.copy=()=>fo(n,wS()).base(n.base()),Qe.apply(n,arguments),n}function ab(n){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/n))}}function cb(n){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*n}}function bp(n){var t=1,e=n(ab(t),cb(t));return e.constant=function(s){return arguments.length?n(ab(t=+s),cb(t)):t},rs(e)}function vS(){var n=bp(Hc());return n.copy=function(){return fo(n,vS()).constant(n.constant())},Qe.apply(n,arguments)}function lb(n){return function(t){return t<0?-Math.pow(-t,n):Math.pow(t,n)}}function OI(n){return n<0?-Math.sqrt(-n):Math.sqrt(n)}function DI(n){return n<0?-n*n:n*n}function _p(n){var t=n(_e,_e),e=1;function s(){return e===1?n(_e,_e):e===.5?n(OI,DI):n(lb(e),lb(1/e))}return t.exponent=function(i){return arguments.length?(e=+i,s()):e},rs(t)}function wp(){var n=_p(Hc());return n.copy=function(){return fo(n,wp()).exponent(n.exponent())},Qe.apply(n,arguments),n}function II(){return wp.apply(null,arguments).exponent(.5)}function ub(n){return Math.sign(n)*n*n}function LI(n){return Math.sign(n)*Math.sqrt(Math.abs(n))}function AS(){var n=pp(),t=[0,1],e=!1,s;function i(r){var o=LI(n(r));return isNaN(o)?s:e?Math.round(o):o}return i.invert=function(r){return n.invert(ub(r))},i.domain=function(r){return arguments.length?(n.domain(r),i):n.domain()},i.range=function(r){return arguments.length?(n.range((t=Array.from(r,nc)).map(ub)),i):t.slice()},i.rangeRound=function(r){return i.range(r).round(!0)},i.round=function(r){return arguments.length?(e=!!r,i):e},i.clamp=function(r){return arguments.length?(n.clamp(r),i):n.clamp()},i.unknown=function(r){return arguments.length?(s=r,i):s},i.copy=function(){return AS(n.domain(),t).round(e).clamp(n.clamp()).unknown(s)},Qe.apply(i,arguments),rs(i)}function SS(){var n=[],t=[],e=[],s;function i(){var o=0,a=Math.max(1,t.length);for(e=new Array(a-1);++o<a;)e[o-1]=$D(n,o/a);return r}function r(o){return o==null||isNaN(o=+o)?s:t[uo(e,o)]}return r.invertExtent=function(o){var a=t.indexOf(o);return a<0?[NaN,NaN]:[a>0?e[a-1]:n[0],a<e.length?e[a]:n[n.length-1]]},r.domain=function(o){if(!arguments.length)return n.slice();n=[];for(let a of o)a!=null&&!isNaN(a=+a)&&n.push(a);return n.sort(Jn),i()},r.range=function(o){return arguments.length?(t=Array.from(o),i()):t.slice()},r.unknown=function(o){return arguments.length?(s=o,r):s},r.quantiles=function(){return e.slice()},r.copy=function(){return SS().domain(n).range(t).unknown(s)},Qe.apply(r,arguments)}function TS(){var n=0,t=1,e=1,s=[.5],i=[0,1],r;function o(c){return c!=null&&c<=c?i[uo(s,c,0,e)]:r}function a(){var c=-1;for(s=new Array(e);++c<e;)s[c]=((c+1)*t-(c-e)*n)/(e+1);return o}return o.domain=function(c){return arguments.length?([n,t]=c,n=+n,t=+t,a()):[n,t]},o.range=function(c){return arguments.length?(e=(i=Array.from(c)).length-1,a()):i.slice()},o.invertExtent=function(c){var l=i.indexOf(c);return l<0?[NaN,NaN]:l<1?[n,s[0]]:l>=e?[s[e-1],t]:[s[l-1],s[l]]},o.unknown=function(c){return arguments.length&&(r=c),o},o.thresholds=function(){return s.slice()},o.copy=function(){return TS().domain([n,t]).range(i).unknown(r)},Qe.apply(rs(o),arguments)}function ES(){var n=[.5],t=[0,1],e,s=1;function i(r){return r!=null&&r<=r?t[uo(n,r,0,s)]:e}return i.domain=function(r){return arguments.length?(n=Array.from(r),s=Math.min(n.length,t.length-1),i):n.slice()},i.range=function(r){return arguments.length?(t=Array.from(r),s=Math.min(n.length,t.length-1),i):t.slice()},i.invertExtent=function(r){var o=t.indexOf(r);return[n[o-1],n[o]]},i.unknown=function(r){return arguments.length?(e=r,i):e},i.copy=function(){return ES().domain(n).range(t).unknown(e)},Qe.apply(i,arguments)}const Wu=new Date,Gu=new Date;function qt(n,t,e,s){function i(r){return n(r=arguments.length===0?new Date:new Date(+r)),r}return i.floor=r=>(n(r=new Date(+r)),r),i.ceil=r=>(n(r=new Date(r-1)),t(r,1),n(r),r),i.round=r=>{const o=i(r),a=i.ceil(r);return r-o<a-r?o:a},i.offset=(r,o)=>(t(r=new Date(+r),o==null?1:Math.floor(o)),r),i.range=(r,o,a)=>{const c=[];if(r=i.ceil(r),a=a==null?1:Math.floor(a),!(r<o)||!(a>0))return c;let l;do c.push(l=new Date(+r)),t(r,a),n(r);while(l<r&&r<o);return c},i.filter=r=>qt(o=>{if(o>=o)for(;n(o),!r(o);)o.setTime(o-1)},(o,a)=>{if(o>=o)if(a<0)for(;++a<=0;)for(;t(o,-1),!r(o););else for(;--a>=0;)for(;t(o,1),!r(o););}),e&&(i.count=(r,o)=>(Wu.setTime(+r),Gu.setTime(+o),n(Wu),n(Gu),Math.floor(e(Wu,Gu))),i.every=r=>(r=Math.floor(r),!isFinite(r)||!(r>0)?null:r>1?i.filter(s?o=>s(o)%r===0:o=>i.count(0,o)%r===0):i)),i}const ic=qt(()=>{},(n,t)=>{n.setTime(+n+t)},(n,t)=>t-n);ic.every=n=>(n=Math.floor(n),!isFinite(n)||!(n>0)?null:n>1?qt(t=>{t.setTime(Math.floor(t/n)*n)},(t,e)=>{t.setTime(+t+e*n)},(t,e)=>(e-t)/n):ic);ic.range;const On=1e3,Ge=On*60,Dn=Ge*60,$n=Dn*24,vp=$n*7,hb=$n*30,Yu=$n*365,vs=qt(n=>{n.setTime(n-n.getMilliseconds())},(n,t)=>{n.setTime(+n+t*On)},(n,t)=>(t-n)/On,n=>n.getUTCSeconds());vs.range;const Ap=qt(n=>{n.setTime(n-n.getMilliseconds()-n.getSeconds()*On)},(n,t)=>{n.setTime(+n+t*Ge)},(n,t)=>(t-n)/Ge,n=>n.getMinutes());Ap.range;const Sp=qt(n=>{n.setUTCSeconds(0,0)},(n,t)=>{n.setTime(+n+t*Ge)},(n,t)=>(t-n)/Ge,n=>n.getUTCMinutes());Sp.range;const Tp=qt(n=>{n.setTime(n-n.getMilliseconds()-n.getSeconds()*On-n.getMinutes()*Ge)},(n,t)=>{n.setTime(+n+t*Dn)},(n,t)=>(t-n)/Dn,n=>n.getHours());Tp.range;const Ep=qt(n=>{n.setUTCMinutes(0,0,0)},(n,t)=>{n.setTime(+n+t*Dn)},(n,t)=>(t-n)/Dn,n=>n.getUTCHours());Ep.range;const po=qt(n=>n.setHours(0,0,0,0),(n,t)=>n.setDate(n.getDate()+t),(n,t)=>(t-n-(t.getTimezoneOffset()-n.getTimezoneOffset())*Ge)/$n,n=>n.getDate()-1);po.range;const qc=qt(n=>{n.setUTCHours(0,0,0,0)},(n,t)=>{n.setUTCDate(n.getUTCDate()+t)},(n,t)=>(t-n)/$n,n=>n.getUTCDate()-1);qc.range;const xS=qt(n=>{n.setUTCHours(0,0,0,0)},(n,t)=>{n.setUTCDate(n.getUTCDate()+t)},(n,t)=>(t-n)/$n,n=>Math.floor(n/$n));xS.range;function js(n){return qt(t=>{t.setDate(t.getDate()-(t.getDay()+7-n)%7),t.setHours(0,0,0,0)},(t,e)=>{t.setDate(t.getDate()+e*7)},(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Ge)/vp)}const Wc=js(0),rc=js(1),NI=js(2),FI=js(3),Mi=js(4),BI=js(5),$I=js(6);Wc.range;rc.range;NI.range;FI.range;Mi.range;BI.range;$I.range;function zs(n){return qt(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-n)%7),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e*7)},(t,e)=>(e-t)/vp)}const Gc=zs(0),oc=zs(1),UI=zs(2),jI=zs(3),Ri=zs(4),zI=zs(5),VI=zs(6);Gc.range;oc.range;UI.range;jI.range;Ri.range;zI.range;VI.range;const xp=qt(n=>{n.setDate(1),n.setHours(0,0,0,0)},(n,t)=>{n.setMonth(n.getMonth()+t)},(n,t)=>t.getMonth()-n.getMonth()+(t.getFullYear()-n.getFullYear())*12,n=>n.getMonth());xp.range;const Cp=qt(n=>{n.setUTCDate(1),n.setUTCHours(0,0,0,0)},(n,t)=>{n.setUTCMonth(n.getUTCMonth()+t)},(n,t)=>t.getUTCMonth()-n.getUTCMonth()+(t.getUTCFullYear()-n.getUTCFullYear())*12,n=>n.getUTCMonth());Cp.range;const Un=qt(n=>{n.setMonth(0,1),n.setHours(0,0,0,0)},(n,t)=>{n.setFullYear(n.getFullYear()+t)},(n,t)=>t.getFullYear()-n.getFullYear(),n=>n.getFullYear());Un.every=n=>!isFinite(n=Math.floor(n))||!(n>0)?null:qt(t=>{t.setFullYear(Math.floor(t.getFullYear()/n)*n),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e*n)});Un.range;const jn=qt(n=>{n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},(n,t)=>{n.setUTCFullYear(n.getUTCFullYear()+t)},(n,t)=>t.getUTCFullYear()-n.getUTCFullYear(),n=>n.getUTCFullYear());jn.every=n=>!isFinite(n=Math.floor(n))||!(n>0)?null:qt(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/n)*n),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e*n)});jn.range;function CS(n,t,e,s,i,r){const o=[[vs,1,On],[vs,5,5*On],[vs,15,15*On],[vs,30,30*On],[r,1,Ge],[r,5,5*Ge],[r,15,15*Ge],[r,30,30*Ge],[i,1,Dn],[i,3,3*Dn],[i,6,6*Dn],[i,12,12*Dn],[s,1,$n],[s,2,2*$n],[e,1,vp],[t,1,hb],[t,3,3*hb],[n,1,Yu]];function a(l,u,h){const d=u<l;d&&([l,u]=[u,l]);const f=h&&typeof h.range=="function"?h:c(l,u,h),m=f?f.range(l,+u+1):[];return d?m.reverse():m}function c(l,u,h){const d=Math.abs(u-l)/h,f=cp(([,,g])=>g).right(o,d);if(f===o.length)return n.every(vd(l/Yu,u/Yu,h));if(f===0)return ic.every(Math.max(vd(l,u,h),1));const[m,p]=o[d/o[f-1][2]<o[f][2]/d?f-1:f];return m.every(p)}return[a,c]}const[HI,qI]=CS(jn,Cp,Gc,xS,Ep,Sp),[WI,GI]=CS(Un,xp,Wc,po,Tp,Ap);function Xu(n){if(0<=n.y&&n.y<100){var t=new Date(-1,n.m,n.d,n.H,n.M,n.S,n.L);return t.setFullYear(n.y),t}return new Date(n.y,n.m,n.d,n.H,n.M,n.S,n.L)}function Ku(n){if(0<=n.y&&n.y<100){var t=new Date(Date.UTC(-1,n.m,n.d,n.H,n.M,n.S,n.L));return t.setUTCFullYear(n.y),t}return new Date(Date.UTC(n.y,n.m,n.d,n.H,n.M,n.S,n.L))}function qi(n,t,e){return{y:n,m:t,d:e,H:0,M:0,S:0,L:0}}function YI(n){var t=n.dateTime,e=n.date,s=n.time,i=n.periods,r=n.days,o=n.shortDays,a=n.months,c=n.shortMonths,l=Wi(i),u=Gi(i),h=Wi(r),d=Gi(r),f=Wi(o),m=Gi(o),p=Wi(a),g=Gi(a),y=Wi(c),_=Gi(c),b={a:D,A:k,b:L,B:H,c:null,d:yb,e:yb,f:yL,g:CL,G:kL,H:pL,I:mL,j:gL,L:PS,m:bL,M:_L,p:lt,q:et,Q:wb,s:vb,S:wL,u:vL,U:AL,V:SL,w:TL,W:EL,x:null,X:null,y:xL,Y:PL,Z:ML,"%":_b},w={a:ft,A:Jt,b:ve,B:Wt,c:null,d:bb,e:bb,f:IL,g:HL,G:WL,H:RL,I:OL,j:DL,L:MS,m:LL,M:NL,p:yt,q:cs,Q:wb,s:vb,S:FL,u:BL,U:$L,V:UL,w:jL,W:zL,x:null,X:null,y:VL,Y:qL,Z:GL,"%":_b},v={a:P,A:x,b:I,B:V,c:X,d:mb,e:mb,f:uL,g:pb,G:fb,H:gb,I:gb,j:oL,L:lL,m:rL,M:aL,p:E,q:iL,Q:dL,s:fL,S:cL,u:QI,U:tL,V:eL,w:JI,W:nL,x:st,X:$,y:pb,Y:fb,Z:sL,"%":hL};b.x=A(e,b),b.X=A(s,b),b.c=A(t,b),w.x=A(e,w),w.X=A(s,w),w.c=A(t,w);function A(N,it){return function(rt){var O=[],Qt=-1,mt=0,Pe=N.length,ke,ls,Mm;for(rt instanceof Date||(rt=new Date(+rt));++Qt<Pe;)N.charCodeAt(Qt)===37&&(O.push(N.slice(mt,Qt)),(ls=db[ke=N.charAt(++Qt)])!=null?ke=N.charAt(++Qt):ls=ke==="e"?" ":"0",(Mm=it[ke])&&(ke=Mm(rt,ls)),O.push(ke),mt=Qt+1);return O.push(N.slice(mt,Qt)),O.join("")}}function S(N,it){return function(rt){var O=qi(1900,void 0,1),Qt=T(O,N,rt+="",0),mt,Pe;if(Qt!=rt.length)return null;if("Q"in O)return new Date(O.Q);if("s"in O)return new Date(O.s*1e3+("L"in O?O.L:0));if(it&&!("Z"in O)&&(O.Z=0),"p"in O&&(O.H=O.H%12+O.p*12),O.m===void 0&&(O.m="q"in O?O.q:0),"V"in O){if(O.V<1||O.V>53)return null;"w"in O||(O.w=1),"Z"in O?(mt=Ku(qi(O.y,0,1)),Pe=mt.getUTCDay(),mt=Pe>4||Pe===0?oc.ceil(mt):oc(mt),mt=qc.offset(mt,(O.V-1)*7),O.y=mt.getUTCFullYear(),O.m=mt.getUTCMonth(),O.d=mt.getUTCDate()+(O.w+6)%7):(mt=Xu(qi(O.y,0,1)),Pe=mt.getDay(),mt=Pe>4||Pe===0?rc.ceil(mt):rc(mt),mt=po.offset(mt,(O.V-1)*7),O.y=mt.getFullYear(),O.m=mt.getMonth(),O.d=mt.getDate()+(O.w+6)%7)}else("W"in O||"U"in O)&&("w"in O||(O.w="u"in O?O.u%7:"W"in O?1:0),Pe="Z"in O?Ku(qi(O.y,0,1)).getUTCDay():Xu(qi(O.y,0,1)).getDay(),O.m=0,O.d="W"in O?(O.w+6)%7+O.W*7-(Pe+5)%7:O.w+O.U*7-(Pe+6)%7);return"Z"in O?(O.H+=O.Z/100|0,O.M+=O.Z%100,Ku(O)):Xu(O)}}function T(N,it,rt,O){for(var Qt=0,mt=it.length,Pe=rt.length,ke,ls;Qt<mt;){if(O>=Pe)return-1;if(ke=it.charCodeAt(Qt++),ke===37){if(ke=it.charAt(Qt++),ls=v[ke in db?it.charAt(Qt++):ke],!ls||(O=ls(N,rt,O))<0)return-1}else if(ke!=rt.charCodeAt(O++))return-1}return O}function E(N,it,rt){var O=l.exec(it.slice(rt));return O?(N.p=u.get(O[0].toLowerCase()),rt+O[0].length):-1}function P(N,it,rt){var O=f.exec(it.slice(rt));return O?(N.w=m.get(O[0].toLowerCase()),rt+O[0].length):-1}function x(N,it,rt){var O=h.exec(it.slice(rt));return O?(N.w=d.get(O[0].toLowerCase()),rt+O[0].length):-1}function I(N,it,rt){var O=y.exec(it.slice(rt));return O?(N.m=_.get(O[0].toLowerCase()),rt+O[0].length):-1}function V(N,it,rt){var O=p.exec(it.slice(rt));return O?(N.m=g.get(O[0].toLowerCase()),rt+O[0].length):-1}function X(N,it,rt){return T(N,t,it,rt)}function st(N,it,rt){return T(N,e,it,rt)}function $(N,it,rt){return T(N,s,it,rt)}function D(N){return o[N.getDay()]}function k(N){return r[N.getDay()]}function L(N){return c[N.getMonth()]}function H(N){return a[N.getMonth()]}function lt(N){return i[+(N.getHours()>=12)]}function et(N){return 1+~~(N.getMonth()/3)}function ft(N){return o[N.getUTCDay()]}function Jt(N){return r[N.getUTCDay()]}function ve(N){return c[N.getUTCMonth()]}function Wt(N){return a[N.getUTCMonth()]}function yt(N){return i[+(N.getUTCHours()>=12)]}function cs(N){return 1+~~(N.getUTCMonth()/3)}return{format:function(N){var it=A(N+="",b);return it.toString=function(){return N},it},parse:function(N){var it=S(N+="",!1);return it.toString=function(){return N},it},utcFormat:function(N){var it=A(N+="",w);return it.toString=function(){return N},it},utcParse:function(N){var it=S(N+="",!0);return it.toString=function(){return N},it}}}var db={"-":"",_:" ",0:"0"},Zt=/^\s*\d+/,XI=/^%/,KI=/[\\^$*+?|[\]().{}]/g;function ut(n,t,e){var s=n<0?"-":"",i=(s?-n:n)+"",r=i.length;return s+(r<e?new Array(e-r+1).join(t)+i:i)}function ZI(n){return n.replace(KI,"\\$&")}function Wi(n){return new RegExp("^(?:"+n.map(ZI).join("|")+")","i")}function Gi(n){return new Map(n.map((t,e)=>[t.toLowerCase(),e]))}function JI(n,t,e){var s=Zt.exec(t.slice(e,e+1));return s?(n.w=+s[0],e+s[0].length):-1}function QI(n,t,e){var s=Zt.exec(t.slice(e,e+1));return s?(n.u=+s[0],e+s[0].length):-1}function tL(n,t,e){var s=Zt.exec(t.slice(e,e+2));return s?(n.U=+s[0],e+s[0].length):-1}function eL(n,t,e){var s=Zt.exec(t.slice(e,e+2));return s?(n.V=+s[0],e+s[0].length):-1}function nL(n,t,e){var s=Zt.exec(t.slice(e,e+2));return s?(n.W=+s[0],e+s[0].length):-1}function fb(n,t,e){var s=Zt.exec(t.slice(e,e+4));return s?(n.y=+s[0],e+s[0].length):-1}function pb(n,t,e){var s=Zt.exec(t.slice(e,e+2));return s?(n.y=+s[0]+(+s[0]>68?1900:2e3),e+s[0].length):-1}function sL(n,t,e){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(e,e+6));return s?(n.Z=s[1]?0:-(s[2]+(s[3]||"00")),e+s[0].length):-1}function iL(n,t,e){var s=Zt.exec(t.slice(e,e+1));return s?(n.q=s[0]*3-3,e+s[0].length):-1}function rL(n,t,e){var s=Zt.exec(t.slice(e,e+2));return s?(n.m=s[0]-1,e+s[0].length):-1}function mb(n,t,e){var s=Zt.exec(t.slice(e,e+2));return s?(n.d=+s[0],e+s[0].length):-1}function oL(n,t,e){var s=Zt.exec(t.slice(e,e+3));return s?(n.m=0,n.d=+s[0],e+s[0].length):-1}function gb(n,t,e){var s=Zt.exec(t.slice(e,e+2));return s?(n.H=+s[0],e+s[0].length):-1}function aL(n,t,e){var s=Zt.exec(t.slice(e,e+2));return s?(n.M=+s[0],e+s[0].length):-1}function cL(n,t,e){var s=Zt.exec(t.slice(e,e+2));return s?(n.S=+s[0],e+s[0].length):-1}function lL(n,t,e){var s=Zt.exec(t.slice(e,e+3));return s?(n.L=+s[0],e+s[0].length):-1}function uL(n,t,e){var s=Zt.exec(t.slice(e,e+6));return s?(n.L=Math.floor(s[0]/1e3),e+s[0].length):-1}function hL(n,t,e){var s=XI.exec(t.slice(e,e+1));return s?e+s[0].length:-1}function dL(n,t,e){var s=Zt.exec(t.slice(e));return s?(n.Q=+s[0],e+s[0].length):-1}function fL(n,t,e){var s=Zt.exec(t.slice(e));return s?(n.s=+s[0],e+s[0].length):-1}function yb(n,t){return ut(n.getDate(),t,2)}function pL(n,t){return ut(n.getHours(),t,2)}function mL(n,t){return ut(n.getHours()%12||12,t,2)}function gL(n,t){return ut(1+po.count(Un(n),n),t,3)}function PS(n,t){return ut(n.getMilliseconds(),t,3)}function yL(n,t){return PS(n,t)+"000"}function bL(n,t){return ut(n.getMonth()+1,t,2)}function _L(n,t){return ut(n.getMinutes(),t,2)}function wL(n,t){return ut(n.getSeconds(),t,2)}function vL(n){var t=n.getDay();return t===0?7:t}function AL(n,t){return ut(Wc.count(Un(n)-1,n),t,2)}function kS(n){var t=n.getDay();return t>=4||t===0?Mi(n):Mi.ceil(n)}function SL(n,t){return n=kS(n),ut(Mi.count(Un(n),n)+(Un(n).getDay()===4),t,2)}function TL(n){return n.getDay()}function EL(n,t){return ut(rc.count(Un(n)-1,n),t,2)}function xL(n,t){return ut(n.getFullYear()%100,t,2)}function CL(n,t){return n=kS(n),ut(n.getFullYear()%100,t,2)}function PL(n,t){return ut(n.getFullYear()%1e4,t,4)}function kL(n,t){var e=n.getDay();return n=e>=4||e===0?Mi(n):Mi.ceil(n),ut(n.getFullYear()%1e4,t,4)}function ML(n){var t=n.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+ut(t/60|0,"0",2)+ut(t%60,"0",2)}function bb(n,t){return ut(n.getUTCDate(),t,2)}function RL(n,t){return ut(n.getUTCHours(),t,2)}function OL(n,t){return ut(n.getUTCHours()%12||12,t,2)}function DL(n,t){return ut(1+qc.count(jn(n),n),t,3)}function MS(n,t){return ut(n.getUTCMilliseconds(),t,3)}function IL(n,t){return MS(n,t)+"000"}function LL(n,t){return ut(n.getUTCMonth()+1,t,2)}function NL(n,t){return ut(n.getUTCMinutes(),t,2)}function FL(n,t){return ut(n.getUTCSeconds(),t,2)}function BL(n){var t=n.getUTCDay();return t===0?7:t}function $L(n,t){return ut(Gc.count(jn(n)-1,n),t,2)}function RS(n){var t=n.getUTCDay();return t>=4||t===0?Ri(n):Ri.ceil(n)}function UL(n,t){return n=RS(n),ut(Ri.count(jn(n),n)+(jn(n).getUTCDay()===4),t,2)}function jL(n){return n.getUTCDay()}function zL(n,t){return ut(oc.count(jn(n)-1,n),t,2)}function VL(n,t){return ut(n.getUTCFullYear()%100,t,2)}function HL(n,t){return n=RS(n),ut(n.getUTCFullYear()%100,t,2)}function qL(n,t){return ut(n.getUTCFullYear()%1e4,t,4)}function WL(n,t){var e=n.getUTCDay();return n=e>=4||e===0?Ri(n):Ri.ceil(n),ut(n.getUTCFullYear()%1e4,t,4)}function GL(){return"+0000"}function _b(){return"%"}function wb(n){return+n}function vb(n){return Math.floor(+n/1e3)}var Ys,OS,DS;YL({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function YL(n){return Ys=YI(n),OS=Ys.format,Ys.parse,DS=Ys.utcFormat,Ys.utcParse,Ys}function XL(n){return new Date(n)}function KL(n){return n instanceof Date?+n:+new Date(+n)}function Pp(n,t,e,s,i,r,o,a,c,l){var u=pp(),h=u.invert,d=u.domain,f=l(".%L"),m=l(":%S"),p=l("%I:%M"),g=l("%I %p"),y=l("%a %d"),_=l("%b %d"),b=l("%B"),w=l("%Y");function v(A){return(c(A)<A?f:a(A)<A?m:o(A)<A?p:r(A)<A?g:s(A)<A?i(A)<A?y:_:e(A)<A?b:w)(A)}return u.invert=function(A){return new Date(h(A))},u.domain=function(A){return arguments.length?d(Array.from(A,KL)):d().map(XL)},u.ticks=function(A){var S=d();return n(S[0],S[S.length-1],A??10)},u.tickFormat=function(A,S){return S==null?v:l(S)},u.nice=function(A){var S=d();return(!A||typeof A.range!="function")&&(A=t(S[0],S[S.length-1],A??10)),A?d(_S(S,A)):u},u.copy=function(){return fo(u,Pp(n,t,e,s,i,r,o,a,c,l))},u}function ZL(){return Qe.apply(Pp(WI,GI,Un,xp,Wc,po,Tp,Ap,vs,OS).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function JL(){return Qe.apply(Pp(HI,qI,jn,Cp,Gc,qc,Ep,Sp,vs,DS).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Yc(){var n=0,t=1,e,s,i,r,o=_e,a=!1,c;function l(h){return h==null||isNaN(h=+h)?c:o(i===0?.5:(h=(r(h)-e)*i,a?Math.max(0,Math.min(1,h)):h))}l.domain=function(h){return arguments.length?([n,t]=h,e=r(n=+n),s=r(t=+t),i=e===s?0:1/(s-e),l):[n,t]},l.clamp=function(h){return arguments.length?(a=!!h,l):a},l.interpolator=function(h){return arguments.length?(o=h,l):o};function u(h){return function(d){var f,m;return arguments.length?([f,m]=d,o=h(f,m),l):[o(0),o(1)]}}return l.range=u(Ni),l.rangeRound=u(fp),l.unknown=function(h){return arguments.length?(c=h,l):c},function(h){return r=h,e=h(n),s=h(t),i=e===s?0:1/(s-e),l}}function os(n,t){return t.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function IS(){var n=rs(Yc()(_e));return n.copy=function(){return os(n,IS())},zn.apply(n,arguments)}function LS(){var n=yp(Yc()).domain([1,10]);return n.copy=function(){return os(n,LS()).base(n.base())},zn.apply(n,arguments)}function NS(){var n=bp(Yc());return n.copy=function(){return os(n,NS()).constant(n.constant())},zn.apply(n,arguments)}function kp(){var n=_p(Yc());return n.copy=function(){return os(n,kp()).exponent(n.exponent())},zn.apply(n,arguments)}function QL(){return kp.apply(null,arguments).exponent(.5)}function FS(){var n=[],t=_e;function e(s){if(s!=null&&!isNaN(s=+s))return t((uo(n,s,1)-1)/(n.length-1))}return e.domain=function(s){if(!arguments.length)return n.slice();n=[];for(let i of s)i!=null&&!isNaN(i=+i)&&n.push(i);return n.sort(Jn),e},e.interpolator=function(s){return arguments.length?(t=s,e):t},e.range=function(){return n.map((s,i)=>t(i/(n.length-1)))},e.quantiles=function(s){return Array.from({length:s+1},(i,r)=>BD(n,r/s))},e.copy=function(){return FS(t).domain(n)},zn.apply(e,arguments)}function Xc(){var n=0,t=.5,e=1,s=1,i,r,o,a,c,l=_e,u,h=!1,d;function f(p){return isNaN(p=+p)?d:(p=.5+((p=+u(p))-r)*(s*p<s*r?a:c),l(h?Math.max(0,Math.min(1,p)):p))}f.domain=function(p){return arguments.length?([n,t,e]=p,i=u(n=+n),r=u(t=+t),o=u(e=+e),a=i===r?0:.5/(r-i),c=r===o?0:.5/(o-r),s=r<i?-1:1,f):[n,t,e]},f.clamp=function(p){return arguments.length?(h=!!p,f):h},f.interpolator=function(p){return arguments.length?(l=p,f):l};function m(p){return function(g){var y,_,b;return arguments.length?([y,_,b]=g,l=hI(p,[y,_,b]),f):[l(0),l(.5),l(1)]}}return f.range=m(Ni),f.rangeRound=m(fp),f.unknown=function(p){return arguments.length?(d=p,f):d},function(p){return u=p,i=p(n),r=p(t),o=p(e),a=i===r?0:.5/(r-i),c=r===o?0:.5/(o-r),s=r<i?-1:1,f}}function BS(){var n=rs(Xc()(_e));return n.copy=function(){return os(n,BS())},zn.apply(n,arguments)}function $S(){var n=yp(Xc()).domain([.1,1,10]);return n.copy=function(){return os(n,$S()).base(n.base())},zn.apply(n,arguments)}function US(){var n=bp(Xc());return n.copy=function(){return os(n,US()).constant(n.constant())},zn.apply(n,arguments)}function Mp(){var n=_p(Xc());return n.copy=function(){return os(n,Mp()).exponent(n.exponent())},zn.apply(n,arguments)}function tN(){return Mp.apply(null,arguments).exponent(.5)}const bq=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:up,scaleDiverging:BS,scaleDivergingLog:$S,scaleDivergingPow:Mp,scaleDivergingSqrt:tN,scaleDivergingSymlog:US,scaleIdentity:bS,scaleImplicit:Ad,scaleLinear:yS,scaleLog:wS,scaleOrdinal:lp,scalePoint:jD,scalePow:wp,scaleQuantile:SS,scaleQuantize:TS,scaleRadial:AS,scaleSequential:IS,scaleSequentialLog:LS,scaleSequentialPow:kp,scaleSequentialQuantile:FS,scaleSequentialSqrt:QL,scaleSequentialSymlog:NS,scaleSqrt:II,scaleSymlog:vS,scaleThreshold:ES,scaleTime:ZL,scaleUtc:JL,tickFormat:gS},Symbol.toStringTag,{value:"Module"}));var Fi=1e9,eN={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Op,Et=!0,Ke="[DecimalError] ",ks=Ke+"Invalid argument: ",Rp=Ke+"Exponent out of range: ",Bi=Math.floor,ps=Math.pow,nN=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Le,Kt=1e7,At=7,jS=9007199254740991,ac=Bi(jS/At),B={};B.absoluteValue=B.abs=function(){var n=new this.constructor(this);return n.s&&(n.s=1),n};B.comparedTo=B.cmp=function(n){var t,e,s,i,r=this;if(n=new r.constructor(n),r.s!==n.s)return r.s||-n.s;if(r.e!==n.e)return r.e>n.e^r.s<0?1:-1;for(s=r.d.length,i=n.d.length,t=0,e=s<i?s:i;t<e;++t)if(r.d[t]!==n.d[t])return r.d[t]>n.d[t]^r.s<0?1:-1;return s===i?0:s>i^r.s<0?1:-1};B.decimalPlaces=B.dp=function(){var n=this,t=n.d.length-1,e=(t-n.e)*At;if(t=n.d[t],t)for(;t%10==0;t/=10)e--;return e<0?0:e};B.dividedBy=B.div=function(n){return Ln(this,new this.constructor(n))};B.dividedToIntegerBy=B.idiv=function(n){var t=this,e=t.constructor;return bt(Ln(t,new e(n),0,1),e.precision)};B.equals=B.eq=function(n){return!this.cmp(n)};B.exponent=function(){return $t(this)};B.greaterThan=B.gt=function(n){return this.cmp(n)>0};B.greaterThanOrEqualTo=B.gte=function(n){return this.cmp(n)>=0};B.isInteger=B.isint=function(){return this.e>this.d.length-2};B.isNegative=B.isneg=function(){return this.s<0};B.isPositive=B.ispos=function(){return this.s>0};B.isZero=function(){return this.s===0};B.lessThan=B.lt=function(n){return this.cmp(n)<0};B.lessThanOrEqualTo=B.lte=function(n){return this.cmp(n)<1};B.logarithm=B.log=function(n){var t,e=this,s=e.constructor,i=s.precision,r=i+5;if(n===void 0)n=new s(10);else if(n=new s(n),n.s<1||n.eq(Le))throw Error(Ke+"NaN");if(e.s<1)throw Error(Ke+(e.s?"NaN":"-Infinity"));return e.eq(Le)?new s(0):(Et=!1,t=Ln(Gr(e,r),Gr(n,r),r),Et=!0,bt(t,i))};B.minus=B.sub=function(n){var t=this;return n=new t.constructor(n),t.s==n.s?HS(t,n):zS(t,(n.s=-n.s,n))};B.modulo=B.mod=function(n){var t,e=this,s=e.constructor,i=s.precision;if(n=new s(n),!n.s)throw Error(Ke+"NaN");return e.s?(Et=!1,t=Ln(e,n,0,1).times(n),Et=!0,e.minus(t)):bt(new s(e),i)};B.naturalExponential=B.exp=function(){return VS(this)};B.naturalLogarithm=B.ln=function(){return Gr(this)};B.negated=B.neg=function(){var n=new this.constructor(this);return n.s=-n.s||0,n};B.plus=B.add=function(n){var t=this;return n=new t.constructor(n),t.s==n.s?zS(t,n):HS(t,(n.s=-n.s,n))};B.precision=B.sd=function(n){var t,e,s,i=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(ks+n);if(t=$t(i)+1,s=i.d.length-1,e=s*At+1,s=i.d[s],s){for(;s%10==0;s/=10)e--;for(s=i.d[0];s>=10;s/=10)e++}return n&&t>e?t:e};B.squareRoot=B.sqrt=function(){var n,t,e,s,i,r,o,a=this,c=a.constructor;if(a.s<1){if(!a.s)return new c(0);throw Error(Ke+"NaN")}for(n=$t(a),Et=!1,i=Math.sqrt(+a),i==0||i==1/0?(t=yn(a.d),(t.length+n)%2==0&&(t+="0"),i=Math.sqrt(t),n=Bi((n+1)/2)-(n<0||n%2),i==1/0?t="5e"+n:(t=i.toExponential(),t=t.slice(0,t.indexOf("e")+1)+n),s=new c(t)):s=new c(i.toString()),e=c.precision,i=o=e+3;;)if(r=s,s=r.plus(Ln(a,r,o+2)).times(.5),yn(r.d).slice(0,o)===(t=yn(s.d)).slice(0,o)){if(t=t.slice(o-3,o+1),i==o&&t=="4999"){if(bt(r,e+1,0),r.times(r).eq(a)){s=r;break}}else if(t!="9999")break;o+=4}return Et=!0,bt(s,e)};B.times=B.mul=function(n){var t,e,s,i,r,o,a,c,l,u=this,h=u.constructor,d=u.d,f=(n=new h(n)).d;if(!u.s||!n.s)return new h(0);for(n.s*=u.s,e=u.e+n.e,c=d.length,l=f.length,c<l&&(r=d,d=f,f=r,o=c,c=l,l=o),r=[],o=c+l,s=o;s--;)r.push(0);for(s=l;--s>=0;){for(t=0,i=c+s;i>s;)a=r[i]+f[s]*d[i-s-1]+t,r[i--]=a%Kt|0,t=a/Kt|0;r[i]=(r[i]+t)%Kt|0}for(;!r[--o];)r.pop();return t?++e:r.shift(),n.d=r,n.e=e,Et?bt(n,h.precision):n};B.toDecimalPlaces=B.todp=function(n,t){var e=this,s=e.constructor;return e=new s(e),n===void 0?e:(Sn(n,0,Fi),t===void 0?t=s.rounding:Sn(t,0,8),bt(e,n+$t(e)+1,t))};B.toExponential=function(n,t){var e,s=this,i=s.constructor;return n===void 0?e=Is(s,!0):(Sn(n,0,Fi),t===void 0?t=i.rounding:Sn(t,0,8),s=bt(new i(s),n+1,t),e=Is(s,!0,n+1)),e};B.toFixed=function(n,t){var e,s,i=this,r=i.constructor;return n===void 0?Is(i):(Sn(n,0,Fi),t===void 0?t=r.rounding:Sn(t,0,8),s=bt(new r(i),n+$t(i)+1,t),e=Is(s.abs(),!1,n+$t(s)+1),i.isneg()&&!i.isZero()?"-"+e:e)};B.toInteger=B.toint=function(){var n=this,t=n.constructor;return bt(new t(n),$t(n)+1,t.rounding)};B.toNumber=function(){return+this};B.toPower=B.pow=function(n){var t,e,s,i,r,o,a=this,c=a.constructor,l=12,u=+(n=new c(n));if(!n.s)return new c(Le);if(a=new c(a),!a.s){if(n.s<1)throw Error(Ke+"Infinity");return a}if(a.eq(Le))return a;if(s=c.precision,n.eq(Le))return bt(a,s);if(t=n.e,e=n.d.length-1,o=t>=e,r=a.s,o){if((e=u<0?-u:u)<=jS){for(i=new c(Le),t=Math.ceil(s/At+4),Et=!1;e%2&&(i=i.times(a),Sb(i.d,t)),e=Bi(e/2),e!==0;)a=a.times(a),Sb(a.d,t);return Et=!0,n.s<0?new c(Le).div(i):bt(i,s)}}else if(r<0)throw Error(Ke+"NaN");return r=r<0&&n.d[Math.max(t,e)]&1?-1:1,a.s=1,Et=!1,i=n.times(Gr(a,s+l)),Et=!0,i=VS(i),i.s=r,i};B.toPrecision=function(n,t){var e,s,i=this,r=i.constructor;return n===void 0?(e=$t(i),s=Is(i,e<=r.toExpNeg||e>=r.toExpPos)):(Sn(n,1,Fi),t===void 0?t=r.rounding:Sn(t,0,8),i=bt(new r(i),n,t),e=$t(i),s=Is(i,n<=e||e<=r.toExpNeg,n)),s};B.toSignificantDigits=B.tosd=function(n,t){var e=this,s=e.constructor;return n===void 0?(n=s.precision,t=s.rounding):(Sn(n,1,Fi),t===void 0?t=s.rounding:Sn(t,0,8)),bt(new s(e),n,t)};B.toString=B.valueOf=B.val=B.toJSON=B[Symbol.for("nodejs.util.inspect.custom")]=function(){var n=this,t=$t(n),e=n.constructor;return Is(n,t<=e.toExpNeg||t>=e.toExpPos)};function zS(n,t){var e,s,i,r,o,a,c,l,u=n.constructor,h=u.precision;if(!n.s||!t.s)return t.s||(t=new u(n)),Et?bt(t,h):t;if(c=n.d,l=t.d,o=n.e,i=t.e,c=c.slice(),r=o-i,r){for(r<0?(s=c,r=-r,a=l.length):(s=l,i=o,a=c.length),o=Math.ceil(h/At),a=o>a?o+1:a+1,r>a&&(r=a,s.length=1),s.reverse();r--;)s.push(0);s.reverse()}for(a=c.length,r=l.length,a-r<0&&(r=a,s=l,l=c,c=s),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/Kt|0,c[r]%=Kt;for(e&&(c.unshift(e),++i),a=c.length;c[--a]==0;)c.pop();return t.d=c,t.e=i,Et?bt(t,h):t}function Sn(n,t,e){if(n!==~~n||n<t||n>e)throw Error(ks+n)}function yn(n){var t,e,s,i=n.length-1,r="",o=n[0];if(i>0){for(r+=o,t=1;t<i;t++)s=n[t]+"",e=At-s.length,e&&(r+=Yn(e)),r+=s;o=n[t],s=o+"",e=At-s.length,e&&(r+=Yn(e))}else if(o===0)return"0";for(;o%10===0;)o/=10;return r+o}var Ln=(function(){function n(s,i){var r,o=0,a=s.length;for(s=s.slice();a--;)r=s[a]*i+o,s[a]=r%Kt|0,o=r/Kt|0;return o&&s.unshift(o),s}function t(s,i,r,o){var a,c;if(r!=o)c=r>o?1:-1;else for(a=c=0;a<r;a++)if(s[a]!=i[a]){c=s[a]>i[a]?1:-1;break}return c}function e(s,i,r){for(var o=0;r--;)s[r]-=o,o=s[r]<i[r]?1:0,s[r]=o*Kt+s[r]-i[r];for(;!s[0]&&s.length>1;)s.shift()}return function(s,i,r,o){var a,c,l,u,h,d,f,m,p,g,y,_,b,w,v,A,S,T,E=s.constructor,P=s.s==i.s?1:-1,x=s.d,I=i.d;if(!s.s)return new E(s);if(!i.s)throw Error(Ke+"Division by zero");for(c=s.e-i.e,S=I.length,v=x.length,f=new E(P),m=f.d=[],l=0;I[l]==(x[l]||0);)++l;if(I[l]>(x[l]||0)&&--c,r==null?_=r=E.precision:o?_=r+($t(s)-$t(i))+1:_=r,_<0)return new E(0);if(_=_/At+2|0,l=0,S==1)for(u=0,I=I[0],_++;(l<v||u)&&_--;l++)b=u*Kt+(x[l]||0),m[l]=b/I|0,u=b%I|0;else{for(u=Kt/(I[0]+1)|0,u>1&&(I=n(I,u),x=n(x,u),S=I.length,v=x.length),w=S,p=x.slice(0,S),g=p.length;g<S;)p[g++]=0;T=I.slice(),T.unshift(0),A=I[0],I[1]>=Kt/2&&++A;do u=0,a=t(I,p,S,g),a<0?(y=p[0],S!=g&&(y=y*Kt+(p[1]||0)),u=y/A|0,u>1?(u>=Kt&&(u=Kt-1),h=n(I,u),d=h.length,g=p.length,a=t(h,p,d,g),a==1&&(u--,e(h,S<d?T:I,d))):(u==0&&(a=u=1),h=I.slice()),d=h.length,d<g&&h.unshift(0),e(p,h,g),a==-1&&(g=p.length,a=t(I,p,S,g),a<1&&(u++,e(p,S<g?T:I,g))),g=p.length):a===0&&(u++,p=[0]),m[l++]=u,a&&p[0]?p[g++]=x[w]||0:(p=[x[w]],g=1);while((w++<v||p[0]!==void 0)&&_--)}return m[0]||m.shift(),f.e=c,bt(f,o?r+$t(f)+1:r)}})();function VS(n,t){var e,s,i,r,o,a,c=0,l=0,u=n.constructor,h=u.precision;if($t(n)>16)throw Error(Rp+$t(n));if(!n.s)return new u(Le);for(Et=!1,a=h,o=new u(.03125);n.abs().gte(.1);)n=n.times(o),l+=5;for(s=Math.log(ps(2,l))/Math.LN10*2+5|0,a+=s,e=i=r=new u(Le),u.precision=a;;){if(i=bt(i.times(n),a),e=e.times(++c),o=r.plus(Ln(i,e,a)),yn(o.d).slice(0,a)===yn(r.d).slice(0,a)){for(;l--;)r=bt(r.times(r),a);return u.precision=h,t==null?(Et=!0,bt(r,h)):r}r=o}}function $t(n){for(var t=n.e*At,e=n.d[0];e>=10;e/=10)t++;return t}function Zu(n,t,e){if(t>n.LN10.sd())throw Et=!0,e&&(n.precision=e),Error(Ke+"LN10 precision limit exceeded");return bt(new n(n.LN10),t)}function Yn(n){for(var t="";n--;)t+="0";return t}function Gr(n,t){var e,s,i,r,o,a,c,l,u,h=1,d=10,f=n,m=f.d,p=f.constructor,g=p.precision;if(f.s<1)throw Error(Ke+(f.s?"NaN":"-Infinity"));if(f.eq(Le))return new p(0);if(t==null?(Et=!1,l=g):l=t,f.eq(10))return t==null&&(Et=!0),Zu(p,l);if(l+=d,p.precision=l,e=yn(m),s=e.charAt(0),r=$t(f),Math.abs(r)<15e14){for(;s<7&&s!=1||s==1&&e.charAt(1)>3;)f=f.times(n),e=yn(f.d),s=e.charAt(0),h++;r=$t(f),s>1?(f=new p("0."+e),r++):f=new p(s+"."+e.slice(1))}else return c=Zu(p,l+2,g).times(r+""),f=Gr(new p(s+"."+e.slice(1)),l-d).plus(c),p.precision=g,t==null?(Et=!0,bt(f,g)):f;for(a=o=f=Ln(f.minus(Le),f.plus(Le),l),u=bt(f.times(f),l),i=3;;){if(o=bt(o.times(u),l),c=a.plus(Ln(o,new p(i),l)),yn(c.d).slice(0,l)===yn(a.d).slice(0,l))return a=a.times(2),r!==0&&(a=a.plus(Zu(p,l+2,g).times(r+""))),a=Ln(a,new p(h),l),p.precision=g,t==null?(Et=!0,bt(a,g)):a;a=c,i+=2}}function Ab(n,t){var e,s,i;for((e=t.indexOf("."))>-1&&(t=t.replace(".","")),(s=t.search(/e/i))>0?(e<0&&(e=s),e+=+t.slice(s+1),t=t.substring(0,s)):e<0&&(e=t.length),s=0;t.charCodeAt(s)===48;)++s;for(i=t.length;t.charCodeAt(i-1)===48;)--i;if(t=t.slice(s,i),t){if(i-=s,e=e-s-1,n.e=Bi(e/At),n.d=[],s=(e+1)%At,e<0&&(s+=At),s<i){for(s&&n.d.push(+t.slice(0,s)),i-=At;s<i;)n.d.push(+t.slice(s,s+=At));t=t.slice(s),s=At-t.length}else s-=i;for(;s--;)t+="0";if(n.d.push(+t),Et&&(n.e>ac||n.e<-ac))throw Error(Rp+e)}else n.s=0,n.e=0,n.d=[0];return n}function bt(n,t,e){var s,i,r,o,a,c,l,u,h=n.d;for(o=1,r=h[0];r>=10;r/=10)o++;if(s=t-o,s<0)s+=At,i=t,l=h[u=0];else{if(u=Math.ceil((s+1)/At),r=h.length,u>=r)return n;for(l=r=h[u],o=1;r>=10;r/=10)o++;s%=At,i=s-At+o}if(e!==void 0&&(r=ps(10,o-i-1),a=l/r%10|0,c=t<0||h[u+1]!==void 0||l%r,c=e<4?(a||c)&&(e==0||e==(n.s<0?3:2)):a>5||a==5&&(e==4||c||e==6&&(s>0?i>0?l/ps(10,o-i):0:h[u-1])%10&1||e==(n.s<0?8:7))),t<1||!h[0])return c?(r=$t(n),h.length=1,t=t-r-1,h[0]=ps(10,(At-t%At)%At),n.e=Bi(-t/At)||0):(h.length=1,h[0]=n.e=n.s=0),n;if(s==0?(h.length=u,r=1,u--):(h.length=u+1,r=ps(10,At-s),h[u]=i>0?(l/ps(10,o-i)%ps(10,i)|0)*r:0),c)for(;;)if(u==0){(h[0]+=r)==Kt&&(h[0]=1,++n.e);break}else{if(h[u]+=r,h[u]!=Kt)break;h[u--]=0,r=1}for(s=h.length;h[--s]===0;)h.pop();if(Et&&(n.e>ac||n.e<-ac))throw Error(Rp+$t(n));return n}function HS(n,t){var e,s,i,r,o,a,c,l,u,h,d=n.constructor,f=d.precision;if(!n.s||!t.s)return t.s?t.s=-t.s:t=new d(n),Et?bt(t,f):t;if(c=n.d,h=t.d,s=t.e,l=n.e,c=c.slice(),o=l-s,o){for(u=o<0,u?(e=c,o=-o,a=h.length):(e=h,s=l,a=c.length),i=Math.max(Math.ceil(f/At),a)+2,o>i&&(o=i,e.length=1),e.reverse(),i=o;i--;)e.push(0);e.reverse()}else{for(i=c.length,a=h.length,u=i<a,u&&(a=i),i=0;i<a;i++)if(c[i]!=h[i]){u=c[i]<h[i];break}o=0}for(u&&(e=c,c=h,h=e,t.s=-t.s),a=c.length,i=h.length-a;i>0;--i)c[a++]=0;for(i=h.length;i>o;){if(c[--i]<h[i]){for(r=i;r&&c[--r]===0;)c[r]=Kt-1;--c[r],c[i]+=Kt}c[i]-=h[i]}for(;c[--a]===0;)c.pop();for(;c[0]===0;c.shift())--s;return c[0]?(t.d=c,t.e=s,Et?bt(t,f):t):new d(0)}function Is(n,t,e){var s,i=$t(n),r=yn(n.d),o=r.length;return t?(e&&(s=e-o)>0?r=r.charAt(0)+"."+r.slice(1)+Yn(s):o>1&&(r=r.charAt(0)+"."+r.slice(1)),r=r+(i<0?"e":"e+")+i):i<0?(r="0."+Yn(-i-1)+r,e&&(s=e-o)>0&&(r+=Yn(s))):i>=o?(r+=Yn(i+1-o),e&&(s=e-i-1)>0&&(r=r+"."+Yn(s))):((s=i+1)<o&&(r=r.slice(0,s)+"."+r.slice(s)),e&&(s=e-o)>0&&(i+1===o&&(r+="."),r+=Yn(s))),n.s<0?"-"+r:r}function Sb(n,t){if(n.length>t)return n.length=t,!0}function qS(n){var t,e,s;function i(r){var o=this;if(!(o instanceof i))return new i(r);if(o.constructor=i,r instanceof i){o.s=r.s,o.e=r.e,o.d=(r=r.d)?r.slice():r;return}if(typeof r=="number"){if(r*0!==0)throw Error(ks+r);if(r>0)o.s=1;else if(r<0)r=-r,o.s=-1;else{o.s=0,o.e=0,o.d=[0];return}if(r===~~r&&r<1e7){o.e=0,o.d=[r];return}return Ab(o,r.toString())}else if(typeof r!="string")throw Error(ks+r);if(r.charCodeAt(0)===45?(r=r.slice(1),o.s=-1):o.s=1,nN.test(r))Ab(o,r);else throw Error(ks+r)}if(i.prototype=B,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.clone=qS,i.config=i.set=sN,n===void 0&&(n={}),n)for(s=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<s.length;)n.hasOwnProperty(e=s[t++])||(n[e]=this[e]);return i.config(n),i}function sN(n){if(!n||typeof n!="object")throw Error(Ke+"Object expected");var t,e,s,i=["precision",1,Fi,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<i.length;t+=3)if((s=n[e=i[t]])!==void 0)if(Bi(s)===s&&s>=i[t+1]&&s<=i[t+2])this[e]=s;else throw Error(ks+e+": "+s);if((s=n[e="LN10"])!==void 0)if(s==Math.LN10)this[e]=new this(s);else throw Error(ks+e+": "+s);return this}var Op=qS(eN);Le=new Op(1);const _q=Op;var Ju={},Qu={},Tb;function iN(){return Tb||(Tb=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e){return e[e.length-1]}n.last=t})(Qu)),Qu}var th={},Eb;function rN(){return Eb||(Eb=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e){return Array.isArray(e)?e:Array.from(e)}n.toArray=t})(th)),th}var xb;function oN(){return xb||(xb=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const t=iN(),e=rN(),s=Zf();function i(r){if(s.isArrayLike(r))return t.last(e.toArray(r))}n.last=i})(Ju)),Ju}var eh,Cb;function aN(){return Cb||(Cb=1,eh=oN().last),eh}var cN=aN();const wq=Us(cN);var nh={},Pb;function lN(){return Pb||(Pb=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function t(e){if(typeof e!="object"||e==null)return!1;if(Object.getPrototypeOf(e)===null)return!0;if(Object.prototype.toString.call(e)!=="[object Object]"){const i=e[Symbol.toStringTag];return i==null||!Object.getOwnPropertyDescriptor(e,Symbol.toStringTag)?.writable?!1:e.toString()===`[object ${i}]`}let s=e;for(;Object.getPrototypeOf(s)!==null;)s=Object.getPrototypeOf(s);return Object.getPrototypeOf(e)===s}n.isPlainObject=t})(nh)),nh}var sh,kb;function uN(){return kb||(kb=1,sh=lN().isPlainObject),sh}var hN=uN();const vq=Us(hN);var ih={exports:{}},rh={};var Mb;function dN(){if(Mb)return rh;Mb=1;var n=hf();function t(c,l){return c===l&&(c!==0||1/c===1/l)||c!==c&&l!==l}var e=typeof Object.is=="function"?Object.is:t,s=n.useSyncExternalStore,i=n.useRef,r=n.useEffect,o=n.useMemo,a=n.useDebugValue;return rh.useSyncExternalStoreWithSelector=function(c,l,u,h,d){var f=i(null);if(f.current===null){var m={hasValue:!1,value:null};f.current=m}else m=f.current;f=o(function(){function g(v){if(!y){if(y=!0,_=v,v=h(v),d!==void 0&&m.hasValue){var A=m.value;if(d(A,v))return b=A}return b=v}if(A=b,e(_,v))return A;var S=h(v);return d!==void 0&&d(A,S)?(_=v,A):(_=v,b=S)}var y=!1,_,b,w=u===void 0?null:u;return[function(){return g(l())},w===null?void 0:function(){return g(w())}]},[l,u,h,d]);var p=s(c,f[0],f[1]);return r(function(){m.hasValue=!0,m.value=p},[p]),a(p),p},rh}var Rb;function fN(){return Rb||(Rb=1,ih.exports=dN()),ih.exports}fN();var pN="Invariant failed";function Aq(n,t){throw new Error(pN)}const WS=6048e5,mN=864e5,GS=6e4,YS=36e5,$o=43200,Ob=1440,Db=Symbol.for("constructDateFrom");function Ze(n,t){return typeof n=="function"?n(t):n&&typeof n=="object"&&Db in n?n[Db](t):n instanceof Date?new n.constructor(t):new Date(t)}function St(n,t){return Ze(t||n,n)}function Sq(n,t,e){const s=St(n,e?.in);return isNaN(t)?Ze(n,NaN):(t&&s.setDate(s.getDate()+t),s)}function gN(n,t){return St(n,t?.in).getDay()===6}function yN(n,t){return St(n,t?.in).getDay()===0}function oh(n,t){const e=St(n,t?.in).getDay();return e===0||e===6}function Tq(n,t,e){const s=St(n,e?.in),i=oh(s,e);if(isNaN(t))return Ze(e?.in,NaN);const r=s.getHours(),o=t<0?-1:1,a=Math.trunc(t/5);s.setDate(s.getDate()+a*7);let c=Math.abs(t%5);for(;c>0;)s.setDate(s.getDate()+o),oh(s,e)||(c-=1);return i&&oh(s,e)&&t!==0&&(gN(s,e)&&s.setDate(s.getDate()+(o<0?2:-1)),yN(s,e)&&s.setDate(s.getDate()+(o<0?1:-2))),s.setHours(r),s}let bN={};function mo(){return bN}function Yr(n,t){const e=mo(),s=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??e.weekStartsOn??e.locale?.options?.weekStartsOn??0,i=St(n,t?.in),r=i.getDay(),o=(r<s?7:0)+r-s;return i.setDate(i.getDate()-o),i.setHours(0,0,0,0),i}function cc(n,t){return Yr(n,{...t,weekStartsOn:1})}function XS(n,t){const e=St(n,t?.in),s=e.getFullYear(),i=Ze(e,0);i.setFullYear(s+1,0,4),i.setHours(0,0,0,0);const r=cc(i),o=Ze(e,0);o.setFullYear(s,0,4),o.setHours(0,0,0,0);const a=cc(o);return e.getTime()>=r.getTime()?s+1:e.getTime()>=a.getTime()?s:s-1}function lc(n){const t=St(n),e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),+n-+e}function go(n,...t){const e=Ze.bind(null,n||t.find(s=>typeof s=="object"));return t.map(e)}function Ib(n,t){const e=St(n,t?.in);return e.setHours(0,0,0,0),e}function KS(n,t,e){const[s,i]=go(e?.in,n,t),r=Ib(s),o=Ib(i),a=+r-lc(r),c=+o-lc(o);return Math.round((a-c)/mN)}function _N(n,t){const e=XS(n,t),s=Ze(n,0);return s.setFullYear(e,0,4),s.setHours(0,0,0,0),cc(s)}function ga(n,t){const e=+St(n)-+St(t);return e<0?-1:e>0?1:e}function wN(n){return Ze(n,Date.now())}function vN(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function AN(n){return!(!vN(n)&&typeof n!="number"||isNaN(+St(n)))}function SN(n,t,e){const[s,i]=go(e?.in,n,t),r=s.getFullYear()-i.getFullYear(),o=s.getMonth()-i.getMonth();return r*12+o}function Eq(n,t,e){const[s,i]=go(e?.in,n,t),r=Lb(s,i),o=Math.abs(KS(s,i));s.setDate(s.getDate()-r*o);const a=+(Lb(s,i)===-r),c=r*(o-a);return c===0?0:c}function Lb(n,t){const e=n.getFullYear()-t.getFullYear()||n.getMonth()-t.getMonth()||n.getDate()-t.getDate()||n.getHours()-t.getHours()||n.getMinutes()-t.getMinutes()||n.getSeconds()-t.getSeconds()||n.getMilliseconds()-t.getMilliseconds();return e<0?-1:e>0?1:e}function TN(n){return t=>{const s=(n?Math[n]:Math.trunc)(t);return s===0?0:s}}function EN(n,t){return+St(n)-+St(t)}function xN(n,t){const e=St(n,t?.in);return e.setHours(23,59,59,999),e}function CN(n,t){const e=St(n,t?.in),s=e.getMonth();return e.setFullYear(e.getFullYear(),s+1,0),e.setHours(23,59,59,999),e}function PN(n,t){const e=St(n,t?.in);return+xN(e,t)==+CN(e,t)}function kN(n,t,e){const[s,i,r]=go(e?.in,n,n,t),o=ga(i,r),a=Math.abs(SN(i,r));if(a<1)return 0;i.getMonth()===1&&i.getDate()>27&&i.setDate(30),i.setMonth(i.getMonth()-o*a);let c=ga(i,r)===-o;PN(s)&&a===1&&ga(s,r)===1&&(c=!1);const l=o*(a-+c);return l===0?0:l}function MN(n,t,e){const s=EN(n,t)/1e3;return TN(e?.roundingMethod)(s)}function RN(n,t){const e=St(n,t?.in);return e.setFullYear(e.getFullYear(),0,1),e.setHours(0,0,0,0),e}const ON={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},DN=(n,t,e)=>{let s;const i=ON[n];return typeof i=="string"?s=i:t===1?s=i.one:s=i.other.replace("{{count}}",t.toString()),e?.addSuffix?e.comparison&&e.comparison>0?"in "+s:s+" ago":s};function ah(n){return(t={})=>{const e=t.width?String(t.width):n.defaultWidth;return n.formats[e]||n.formats[n.defaultWidth]}}const IN={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},LN={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},NN={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},FN={date:ah({formats:IN,defaultWidth:"full"}),time:ah({formats:LN,defaultWidth:"full"}),dateTime:ah({formats:NN,defaultWidth:"full"})},BN={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},$N=(n,t,e,s)=>BN[n];function Yi(n){return(t,e)=>{const s=e?.context?String(e.context):"standalone";let i;if(s==="formatting"&&n.formattingValues){const o=n.defaultFormattingWidth||n.defaultWidth,a=e?.width?String(e.width):o;i=n.formattingValues[a]||n.formattingValues[o]}else{const o=n.defaultWidth,a=e?.width?String(e.width):n.defaultWidth;i=n.values[a]||n.values[o]}const r=n.argumentCallback?n.argumentCallback(t):t;return i[r]}}const UN={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},jN={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},zN={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},VN={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},HN={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},qN={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},WN=(n,t)=>{const e=Number(n),s=e%100;if(s>20||s<10)switch(s%10){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd"}return e+"th"},GN={ordinalNumber:WN,era:Yi({values:UN,defaultWidth:"wide"}),quarter:Yi({values:jN,defaultWidth:"wide",argumentCallback:n=>n-1}),month:Yi({values:zN,defaultWidth:"wide"}),day:Yi({values:VN,defaultWidth:"wide"}),dayPeriod:Yi({values:HN,defaultWidth:"wide",formattingValues:qN,defaultFormattingWidth:"wide"})};function Xi(n){return(t,e={})=>{const s=e.width,i=s&&n.matchPatterns[s]||n.matchPatterns[n.defaultMatchWidth],r=t.match(i);if(!r)return null;const o=r[0],a=s&&n.parsePatterns[s]||n.parsePatterns[n.defaultParseWidth],c=Array.isArray(a)?XN(a,h=>h.test(o)):YN(a,h=>h.test(o));let l;l=n.valueCallback?n.valueCallback(c):c,l=e.valueCallback?e.valueCallback(l):l;const u=t.slice(o.length);return{value:l,rest:u}}}function YN(n,t){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)&&t(n[e]))return e}function XN(n,t){for(let e=0;e<n.length;e++)if(t(n[e]))return e}function KN(n){return(t,e={})=>{const s=t.match(n.matchPattern);if(!s)return null;const i=s[0],r=t.match(n.parsePattern);if(!r)return null;let o=n.valueCallback?n.valueCallback(r[0]):r[0];o=e.valueCallback?e.valueCallback(o):o;const a=t.slice(i.length);return{value:o,rest:a}}}const ZN=/^(\d+)(th|st|nd|rd)?/i,JN=/\d+/i,QN={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},tF={any:[/^b/i,/^(a|c)/i]},eF={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},nF={any:[/1/i,/2/i,/3/i,/4/i]},sF={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},iF={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},rF={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},oF={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},aF={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},cF={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},lF={ordinalNumber:KN({matchPattern:ZN,parsePattern:JN,valueCallback:n=>parseInt(n,10)}),era:Xi({matchPatterns:QN,defaultMatchWidth:"wide",parsePatterns:tF,defaultParseWidth:"any"}),quarter:Xi({matchPatterns:eF,defaultMatchWidth:"wide",parsePatterns:nF,defaultParseWidth:"any",valueCallback:n=>n+1}),month:Xi({matchPatterns:sF,defaultMatchWidth:"wide",parsePatterns:iF,defaultParseWidth:"any"}),day:Xi({matchPatterns:rF,defaultMatchWidth:"wide",parsePatterns:oF,defaultParseWidth:"any"}),dayPeriod:Xi({matchPatterns:aF,defaultMatchWidth:"any",parsePatterns:cF,defaultParseWidth:"any"})},ZS={code:"en-US",formatDistance:DN,formatLong:FN,formatRelative:$N,localize:GN,match:lF,options:{weekStartsOn:0,firstWeekContainsDate:1}};function uF(n,t){const e=St(n,t?.in);return KS(e,RN(e))+1}function hF(n,t){const e=St(n,t?.in),s=+cc(e)-+_N(e);return Math.round(s/WS)+1}function JS(n,t){const e=St(n,t?.in),s=e.getFullYear(),i=mo(),r=t?.firstWeekContainsDate??t?.locale?.options?.firstWeekContainsDate??i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1,o=Ze(t?.in||n,0);o.setFullYear(s+1,0,r),o.setHours(0,0,0,0);const a=Yr(o,t),c=Ze(t?.in||n,0);c.setFullYear(s,0,r),c.setHours(0,0,0,0);const l=Yr(c,t);return+e>=+a?s+1:+e>=+l?s:s-1}function dF(n,t){const e=mo(),s=t?.firstWeekContainsDate??t?.locale?.options?.firstWeekContainsDate??e.firstWeekContainsDate??e.locale?.options?.firstWeekContainsDate??1,i=JS(n,t),r=Ze(t?.in||n,0);return r.setFullYear(i,0,s),r.setHours(0,0,0,0),Yr(r,t)}function fF(n,t){const e=St(n,t?.in),s=+Yr(e,t)-+dF(e,t);return Math.round(s/WS)+1}function pt(n,t){const e=n<0?"-":"",s=Math.abs(n).toString().padStart(t,"0");return e+s}const Vn={y(n,t){const e=n.getFullYear(),s=e>0?e:1-e;return pt(t==="yy"?s%100:s,t.length)},M(n,t){const e=n.getMonth();return t==="M"?String(e+1):pt(e+1,2)},d(n,t){return pt(n.getDate(),t.length)},a(n,t){const e=n.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return e.toUpperCase();case"aaa":return e;case"aaaaa":return e[0];default:return e==="am"?"a.m.":"p.m."}},h(n,t){return pt(n.getHours()%12||12,t.length)},H(n,t){return pt(n.getHours(),t.length)},m(n,t){return pt(n.getMinutes(),t.length)},s(n,t){return pt(n.getSeconds(),t.length)},S(n,t){const e=t.length,s=n.getMilliseconds(),i=Math.trunc(s*Math.pow(10,e-3));return pt(i,t.length)}},Xs={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Nb={G:function(n,t,e){const s=n.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return e.era(s,{width:"abbreviated"});case"GGGGG":return e.era(s,{width:"narrow"});default:return e.era(s,{width:"wide"})}},y:function(n,t,e){if(t==="yo"){const s=n.getFullYear(),i=s>0?s:1-s;return e.ordinalNumber(i,{unit:"year"})}return Vn.y(n,t)},Y:function(n,t,e,s){const i=JS(n,s),r=i>0?i:1-i;if(t==="YY"){const o=r%100;return pt(o,2)}return t==="Yo"?e.ordinalNumber(r,{unit:"year"}):pt(r,t.length)},R:function(n,t){const e=XS(n);return pt(e,t.length)},u:function(n,t){const e=n.getFullYear();return pt(e,t.length)},Q:function(n,t,e){const s=Math.ceil((n.getMonth()+1)/3);switch(t){case"Q":return String(s);case"QQ":return pt(s,2);case"Qo":return e.ordinalNumber(s,{unit:"quarter"});case"QQQ":return e.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return e.quarter(s,{width:"narrow",context:"formatting"});default:return e.quarter(s,{width:"wide",context:"formatting"})}},q:function(n,t,e){const s=Math.ceil((n.getMonth()+1)/3);switch(t){case"q":return String(s);case"qq":return pt(s,2);case"qo":return e.ordinalNumber(s,{unit:"quarter"});case"qqq":return e.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return e.quarter(s,{width:"narrow",context:"standalone"});default:return e.quarter(s,{width:"wide",context:"standalone"})}},M:function(n,t,e){const s=n.getMonth();switch(t){case"M":case"MM":return Vn.M(n,t);case"Mo":return e.ordinalNumber(s+1,{unit:"month"});case"MMM":return e.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return e.month(s,{width:"narrow",context:"formatting"});default:return e.month(s,{width:"wide",context:"formatting"})}},L:function(n,t,e){const s=n.getMonth();switch(t){case"L":return String(s+1);case"LL":return pt(s+1,2);case"Lo":return e.ordinalNumber(s+1,{unit:"month"});case"LLL":return e.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return e.month(s,{width:"narrow",context:"standalone"});default:return e.month(s,{width:"wide",context:"standalone"})}},w:function(n,t,e,s){const i=fF(n,s);return t==="wo"?e.ordinalNumber(i,{unit:"week"}):pt(i,t.length)},I:function(n,t,e){const s=hF(n);return t==="Io"?e.ordinalNumber(s,{unit:"week"}):pt(s,t.length)},d:function(n,t,e){return t==="do"?e.ordinalNumber(n.getDate(),{unit:"date"}):Vn.d(n,t)},D:function(n,t,e){const s=uF(n);return t==="Do"?e.ordinalNumber(s,{unit:"dayOfYear"}):pt(s,t.length)},E:function(n,t,e){const s=n.getDay();switch(t){case"E":case"EE":case"EEE":return e.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return e.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return e.day(s,{width:"short",context:"formatting"});default:return e.day(s,{width:"wide",context:"formatting"})}},e:function(n,t,e,s){const i=n.getDay(),r=(i-s.weekStartsOn+8)%7||7;switch(t){case"e":return String(r);case"ee":return pt(r,2);case"eo":return e.ordinalNumber(r,{unit:"day"});case"eee":return e.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return e.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return e.day(i,{width:"short",context:"formatting"});default:return e.day(i,{width:"wide",context:"formatting"})}},c:function(n,t,e,s){const i=n.getDay(),r=(i-s.weekStartsOn+8)%7||7;switch(t){case"c":return String(r);case"cc":return pt(r,t.length);case"co":return e.ordinalNumber(r,{unit:"day"});case"ccc":return e.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return e.day(i,{width:"narrow",context:"standalone"});case"cccccc":return e.day(i,{width:"short",context:"standalone"});default:return e.day(i,{width:"wide",context:"standalone"})}},i:function(n,t,e){const s=n.getDay(),i=s===0?7:s;switch(t){case"i":return String(i);case"ii":return pt(i,t.length);case"io":return e.ordinalNumber(i,{unit:"day"});case"iii":return e.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return e.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return e.day(s,{width:"short",context:"formatting"});default:return e.day(s,{width:"wide",context:"formatting"})}},a:function(n,t,e){const i=n.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return e.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return e.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return e.dayPeriod(i,{width:"narrow",context:"formatting"});default:return e.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(n,t,e){const s=n.getHours();let i;switch(s===12?i=Xs.noon:s===0?i=Xs.midnight:i=s/12>=1?"pm":"am",t){case"b":case"bb":return e.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return e.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return e.dayPeriod(i,{width:"narrow",context:"formatting"});default:return e.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(n,t,e){const s=n.getHours();let i;switch(s>=17?i=Xs.evening:s>=12?i=Xs.afternoon:s>=4?i=Xs.morning:i=Xs.night,t){case"B":case"BB":case"BBB":return e.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return e.dayPeriod(i,{width:"narrow",context:"formatting"});default:return e.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(n,t,e){if(t==="ho"){let s=n.getHours()%12;return s===0&&(s=12),e.ordinalNumber(s,{unit:"hour"})}return Vn.h(n,t)},H:function(n,t,e){return t==="Ho"?e.ordinalNumber(n.getHours(),{unit:"hour"}):Vn.H(n,t)},K:function(n,t,e){const s=n.getHours()%12;return t==="Ko"?e.ordinalNumber(s,{unit:"hour"}):pt(s,t.length)},k:function(n,t,e){let s=n.getHours();return s===0&&(s=24),t==="ko"?e.ordinalNumber(s,{unit:"hour"}):pt(s,t.length)},m:function(n,t,e){return t==="mo"?e.ordinalNumber(n.getMinutes(),{unit:"minute"}):Vn.m(n,t)},s:function(n,t,e){return t==="so"?e.ordinalNumber(n.getSeconds(),{unit:"second"}):Vn.s(n,t)},S:function(n,t){return Vn.S(n,t)},X:function(n,t,e){const s=n.getTimezoneOffset();if(s===0)return"Z";switch(t){case"X":return Bb(s);case"XXXX":case"XX":return ms(s);default:return ms(s,":")}},x:function(n,t,e){const s=n.getTimezoneOffset();switch(t){case"x":return Bb(s);case"xxxx":case"xx":return ms(s);default:return ms(s,":")}},O:function(n,t,e){const s=n.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Fb(s,":");default:return"GMT"+ms(s,":")}},z:function(n,t,e){const s=n.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Fb(s,":");default:return"GMT"+ms(s,":")}},t:function(n,t,e){const s=Math.trunc(+n/1e3);return pt(s,t.length)},T:function(n,t,e){return pt(+n,t.length)}};function Fb(n,t=""){const e=n>0?"-":"+",s=Math.abs(n),i=Math.trunc(s/60),r=s%60;return r===0?e+String(i):e+String(i)+t+pt(r,2)}function Bb(n,t){return n%60===0?(n>0?"-":"+")+pt(Math.abs(n)/60,2):ms(n,t)}function ms(n,t=""){const e=n>0?"-":"+",s=Math.abs(n),i=pt(Math.trunc(s/60),2),r=pt(s%60,2);return e+i+t+r}const $b=(n,t)=>{switch(n){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},QS=(n,t)=>{switch(n){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},pF=(n,t)=>{const e=n.match(/(P+)(p+)?/)||[],s=e[1],i=e[2];if(!i)return $b(n,t);let r;switch(s){case"P":r=t.dateTime({width:"short"});break;case"PP":r=t.dateTime({width:"medium"});break;case"PPP":r=t.dateTime({width:"long"});break;default:r=t.dateTime({width:"full"});break}return r.replace("{{date}}",$b(s,t)).replace("{{time}}",QS(i,t))},mF={p:QS,P:pF},gF=/^D+$/,yF=/^Y+$/,bF=["D","DD","YY","YYYY"];function _F(n){return gF.test(n)}function wF(n){return yF.test(n)}function vF(n,t,e){const s=AF(n,t,e);if(console.warn(s),bF.includes(n))throw new RangeError(s)}function AF(n,t,e){const s=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${t}\`) for formatting ${s} to the input \`${e}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const SF=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,TF=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,EF=/^'([^]*?)'?$/,xF=/''/g,CF=/[a-zA-Z]/;function xq(n,t,e){const s=mo(),i=s.locale??ZS,r=s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,o=s.weekStartsOn??s.locale?.options?.weekStartsOn??0,a=St(n,e?.in);if(!AN(a))throw new RangeError("Invalid time value");let c=t.match(TF).map(u=>{const h=u[0];if(h==="p"||h==="P"){const d=mF[h];return d(u,i.formatLong)}return u}).join("").match(SF).map(u=>{if(u==="''")return{isToken:!1,value:"'"};const h=u[0];if(h==="'")return{isToken:!1,value:PF(u)};if(Nb[h])return{isToken:!0,value:u};if(h.match(CF))throw new RangeError("Format string contains an unescaped latin alphabet character `"+h+"`");return{isToken:!1,value:u}});i.localize.preprocessor&&(c=i.localize.preprocessor(a,c));const l={firstWeekContainsDate:r,weekStartsOn:o,locale:i};return c.map(u=>{if(!u.isToken)return u.value;const h=u.value;(wF(h)||_F(h))&&vF(h,t,String(n));const d=Nb[h[0]];return d(a,h,i.localize,l)}).join("")}function PF(n){const t=n.match(EF);return t?t[1].replace(xF,"'"):n}function kF(n,t,e){const s=mo(),i=e?.locale??s.locale??ZS,r=2520,o=ga(n,t);if(isNaN(o))throw new RangeError("Invalid time value");const a=Object.assign({},e,{addSuffix:e?.addSuffix,comparison:o}),[c,l]=go(e?.in,...o>0?[t,n]:[n,t]),u=MN(l,c),h=(lc(l)-lc(c))/1e3,d=Math.round((u-h)/60);let f;if(d<2)return e?.includeSeconds?u<5?i.formatDistance("lessThanXSeconds",5,a):u<10?i.formatDistance("lessThanXSeconds",10,a):u<20?i.formatDistance("lessThanXSeconds",20,a):u<40?i.formatDistance("halfAMinute",0,a):u<60?i.formatDistance("lessThanXMinutes",1,a):i.formatDistance("xMinutes",1,a):d===0?i.formatDistance("lessThanXMinutes",1,a):i.formatDistance("xMinutes",d,a);if(d<45)return i.formatDistance("xMinutes",d,a);if(d<90)return i.formatDistance("aboutXHours",1,a);if(d<Ob){const m=Math.round(d/60);return i.formatDistance("aboutXHours",m,a)}else{if(d<r)return i.formatDistance("xDays",1,a);if(d<$o){const m=Math.round(d/Ob);return i.formatDistance("xDays",m,a)}else if(d<$o*2)return f=Math.round(d/$o),i.formatDistance("aboutXMonths",f,a)}if(f=kN(l,c),f<12){const m=Math.round(d/$o);return i.formatDistance("xMonths",m,a)}else{const m=f%12,p=Math.trunc(f/12);return m<3?i.formatDistance("aboutXYears",p,a):m<9?i.formatDistance("overXYears",p,a):i.formatDistance("almostXYears",p+1,a)}}function Cq(n,t){return kF(n,wN(n),t)}function Pq(n,t){const e=()=>Ze(t?.in,NaN),i=DF(n);let r;if(i.date){const l=IF(i.date,2);r=LF(l.restDateString,l.year)}if(!r||isNaN(+r))return e();const o=+r;let a=0,c;if(i.time&&(a=NF(i.time),isNaN(a)))return e();if(i.timezone){if(c=FF(i.timezone),isNaN(c))return e()}else{const l=new Date(o+a),u=St(0,t?.in);return u.setFullYear(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()),u.setHours(l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds(),l.getUTCMilliseconds()),u}return St(o+a+c,t?.in)}const Uo={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},MF=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,RF=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,OF=/^([+-])(\d{2})(?::?(\d{2}))?$/;function DF(n){const t={},e=n.split(Uo.dateTimeDelimiter);let s;if(e.length>2)return t;if(/:/.test(e[0])?s=e[0]:(t.date=e[0],s=e[1],Uo.timeZoneDelimiter.test(t.date)&&(t.date=n.split(Uo.timeZoneDelimiter)[0],s=n.substr(t.date.length,n.length))),s){const i=Uo.timezone.exec(s);i?(t.time=s.replace(i[1],""),t.timezone=i[1]):t.time=s}return t}function IF(n,t){const e=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),s=n.match(e);if(!s)return{year:NaN,restDateString:""};const i=s[1]?parseInt(s[1]):null,r=s[2]?parseInt(s[2]):null;return{year:r===null?i:r*100,restDateString:n.slice((s[1]||s[2]).length)}}function LF(n,t){if(t===null)return new Date(NaN);const e=n.match(MF);if(!e)return new Date(NaN);const s=!!e[4],i=Ki(e[1]),r=Ki(e[2])-1,o=Ki(e[3]),a=Ki(e[4]),c=Ki(e[5])-1;if(s)return zF(t,a,c)?BF(t,a,c):new Date(NaN);{const l=new Date(0);return!UF(t,r,o)||!jF(t,i)?new Date(NaN):(l.setUTCFullYear(t,r,Math.max(i,o)),l)}}function Ki(n){return n?parseInt(n):1}function NF(n){const t=n.match(RF);if(!t)return NaN;const e=ch(t[1]),s=ch(t[2]),i=ch(t[3]);return VF(e,s,i)?e*YS+s*GS+i*1e3:NaN}function ch(n){return n&&parseFloat(n.replace(",","."))||0}function FF(n){if(n==="Z")return 0;const t=n.match(OF);if(!t)return 0;const e=t[1]==="+"?-1:1,s=parseInt(t[2]),i=t[3]&&parseInt(t[3])||0;return HF(s,i)?e*(s*YS+i*GS):NaN}function BF(n,t,e){const s=new Date(0);s.setUTCFullYear(n,0,4);const i=s.getUTCDay()||7,r=(t-1)*7+e+1-i;return s.setUTCDate(s.getUTCDate()+r),s}const $F=[31,null,31,30,31,30,31,31,30,31,30,31];function t1(n){return n%400===0||n%4===0&&n%100!==0}function UF(n,t,e){return t>=0&&t<=11&&e>=1&&e<=($F[t]||(t1(n)?29:28))}function jF(n,t){return t>=1&&t<=(t1(n)?366:365)}function zF(n,t,e){return t>=1&&t<=53&&e>=0&&e<=6}function VF(n,t,e){return n===24?t===0&&e===0:e>=0&&e<60&&t>=0&&t<60&&n>=0&&n<25}function HF(n,t){return t>=0&&t<=59}const Tn=Object.create(null);Tn.open="0";Tn.close="1";Tn.ping="2";Tn.pong="3";Tn.message="4";Tn.upgrade="5";Tn.noop="6";const ya=Object.create(null);Object.keys(Tn).forEach(n=>{ya[Tn[n]]=n});const xd={type:"error",data:"parser error"},e1=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",n1=typeof ArrayBuffer=="function",s1=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,Dp=({type:n,data:t},e,s)=>e1&&t instanceof Blob?e?s(t):Ub(t,s):n1&&(t instanceof ArrayBuffer||s1(t))?e?s(t):Ub(new Blob([t]),s):s(Tn[n]+(t||"")),Ub=(n,t)=>{const e=new FileReader;return e.onload=function(){const s=e.result.split(",")[1];t("b"+(s||""))},e.readAsDataURL(n)};function jb(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let lh;function qF(n,t){if(e1&&n.data instanceof Blob)return n.data.arrayBuffer().then(jb).then(t);if(n1&&(n.data instanceof ArrayBuffer||s1(n.data)))return t(jb(n.data));Dp(n,!1,e=>{lh||(lh=new TextEncoder),t(lh.encode(e))})}const zb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",or=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<zb.length;n++)or[zb.charCodeAt(n)]=n;const WF=n=>{let t=n.length*.75,e=n.length,s,i=0,r,o,a,c;n[n.length-1]==="="&&(t--,n[n.length-2]==="="&&t--);const l=new ArrayBuffer(t),u=new Uint8Array(l);for(s=0;s<e;s+=4)r=or[n.charCodeAt(s)],o=or[n.charCodeAt(s+1)],a=or[n.charCodeAt(s+2)],c=or[n.charCodeAt(s+3)],u[i++]=r<<2|o>>4,u[i++]=(o&15)<<4|a>>2,u[i++]=(a&3)<<6|c&63;return l},GF=typeof ArrayBuffer=="function",Ip=(n,t)=>{if(typeof n!="string")return{type:"message",data:i1(n,t)};const e=n.charAt(0);return e==="b"?{type:"message",data:YF(n.substring(1),t)}:ya[e]?n.length>1?{type:ya[e],data:n.substring(1)}:{type:ya[e]}:xd},YF=(n,t)=>{if(GF){const e=WF(n);return i1(e,t)}else return{base64:!0,data:n}},i1=(n,t)=>t==="blob"?n instanceof Blob?n:new Blob([n]):n instanceof ArrayBuffer?n:n.buffer,r1="",XF=(n,t)=>{const e=n.length,s=new Array(e);let i=0;n.forEach((r,o)=>{Dp(r,!1,a=>{s[o]=a,++i===e&&t(s.join(r1))})})},KF=(n,t)=>{const e=n.split(r1),s=[];for(let i=0;i<e.length;i++){const r=Ip(e[i],t);if(s.push(r),r.type==="error")break}return s};function ZF(){return new TransformStream({transform(n,t){qF(n,e=>{const s=e.length;let i;if(s<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,s);else if(s<65536){i=new Uint8Array(3);const r=new DataView(i.buffer);r.setUint8(0,126),r.setUint16(1,s)}else{i=new Uint8Array(9);const r=new DataView(i.buffer);r.setUint8(0,127),r.setBigUint64(1,BigInt(s))}n.data&&typeof n.data!="string"&&(i[0]|=128),t.enqueue(i),t.enqueue(e)})}})}let uh;function jo(n){return n.reduce((t,e)=>t+e.length,0)}function zo(n,t){if(n[0].length===t)return n.shift();const e=new Uint8Array(t);let s=0;for(let i=0;i<t;i++)e[i]=n[0][s++],s===n[0].length&&(n.shift(),s=0);return n.length&&s<n[0].length&&(n[0]=n[0].slice(s)),e}function JF(n,t){uh||(uh=new TextDecoder);const e=[];let s=0,i=-1,r=!1;return new TransformStream({transform(o,a){for(e.push(o);;){if(s===0){if(jo(e)<1)break;const c=zo(e,1);r=(c[0]&128)===128,i=c[0]&127,i<126?s=3:i===126?s=1:s=2}else if(s===1){if(jo(e)<2)break;const c=zo(e,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),s=3}else if(s===2){if(jo(e)<8)break;const c=zo(e,8),l=new DataView(c.buffer,c.byteOffset,c.length),u=l.getUint32(0);if(u>Math.pow(2,21)-1){a.enqueue(xd);break}i=u*Math.pow(2,32)+l.getUint32(4),s=3}else{if(jo(e)<i)break;const c=zo(e,i);a.enqueue(Ip(r?c:uh.decode(c),t)),s=0}if(i===0||i>n){a.enqueue(xd);break}}}})}const o1=4;function Bt(n){if(n)return QF(n)}function QF(n){for(var t in Bt.prototype)n[t]=Bt.prototype[t];return n}Bt.prototype.on=Bt.prototype.addEventListener=function(n,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(t),this};Bt.prototype.once=function(n,t){function e(){this.off(n,e),t.apply(this,arguments)}return e.fn=t,this.on(n,e),this};Bt.prototype.off=Bt.prototype.removeListener=Bt.prototype.removeAllListeners=Bt.prototype.removeEventListener=function(n,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var e=this._callbacks["$"+n];if(!e)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var s,i=0;i<e.length;i++)if(s=e[i],s===t||s.fn===t){e.splice(i,1);break}return e.length===0&&delete this._callbacks["$"+n],this};Bt.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),e=this._callbacks["$"+n],s=1;s<arguments.length;s++)t[s-1]=arguments[s];if(e){e=e.slice(0);for(var s=0,i=e.length;s<i;++s)e[s].apply(this,t)}return this};Bt.prototype.emitReserved=Bt.prototype.emit;Bt.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};Bt.prototype.hasListeners=function(n){return!!this.listeners(n).length};const Kc=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,e)=>e(t,0),qe=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),t2="arraybuffer";function a1(n,...t){return t.reduce((e,s)=>(n.hasOwnProperty(s)&&(e[s]=n[s]),e),{})}const e2=qe.setTimeout,n2=qe.clearTimeout;function Zc(n,t){t.useNativeTimers?(n.setTimeoutFn=e2.bind(qe),n.clearTimeoutFn=n2.bind(qe)):(n.setTimeoutFn=qe.setTimeout.bind(qe),n.clearTimeoutFn=qe.clearTimeout.bind(qe))}const s2=1.33;function i2(n){return typeof n=="string"?r2(n):Math.ceil((n.byteLength||n.size)*s2)}function r2(n){let t=0,e=0;for(let s=0,i=n.length;s<i;s++)t=n.charCodeAt(s),t<128?e+=1:t<2048?e+=2:t<55296||t>=57344?e+=3:(s++,e+=4);return e}function c1(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function o2(n){let t="";for(let e in n)n.hasOwnProperty(e)&&(t.length&&(t+="&"),t+=encodeURIComponent(e)+"="+encodeURIComponent(n[e]));return t}function a2(n){let t={},e=n.split("&");for(let s=0,i=e.length;s<i;s++){let r=e[s].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t}class c2 extends Error{constructor(t,e,s){super(t),this.description=e,this.context=s,this.type="TransportError"}}class Lp extends Bt{constructor(t){super(),this.writable=!1,Zc(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,e,s){return super.emitReserved("error",new c2(t,e,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=Ip(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,e={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port)!==443||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const e=o2(t);return e.length?"?"+e:""}}class l2 extends Lp{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||e()})),this.writable||(s++,this.once("drain",function(){--s||e()}))}else e()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const e=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};KF(t,this.socket.binaryType).forEach(e),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,XF(t,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",e=this.query||{};return this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=c1()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.createUri(t,e)}}let l1=!1;try{l1=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const u2=l1;function h2(){}class d2 extends l2{constructor(t){if(super(t),typeof location<"u"){const e=location.protocol==="https:";let s=location.port;s||(s=e?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||s!==t.port}}doWrite(t,e){const s=this.request({method:"POST",data:t});s.on("success",e),s.on("error",(i,r)=>{this.onError("xhr post error",i,r)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(e,s)=>{this.onError("xhr poll error",e,s)}),this.pollXhr=t}}class An extends Bt{constructor(t,e,s){super(),this.createRequest=t,Zc(this,s),this._opts=s,this._method=s.method||"GET",this._uri=e,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var t;const e=a1(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(e);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&s.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var i;s.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=An.requestsCount++,An.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=h2,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete An.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}An.requestsCount=0;An.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Vb);else if(typeof addEventListener=="function"){const n="onpagehide"in qe?"pagehide":"unload";addEventListener(n,Vb,!1)}}function Vb(){for(let n in An.requests)An.requests.hasOwnProperty(n)&&An.requests[n].abort()}const f2=(function(){const n=u1({xdomain:!1});return n&&n.responseType!==null})();class p2 extends d2{constructor(t){super(t);const e=t&&t.forceBase64;this.supportsBinary=f2&&!e}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new An(u1,this.uri(),t)}}function u1(n){const t=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||u2))return new XMLHttpRequest}catch{}if(!t)try{return new qe[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const h1=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class m2 extends Lp{get name(){return"websocket"}doOpen(){const t=this.uri(),e=this.opts.protocols,s=h1?{}:a1(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,e,s)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const s=t[e],i=e===t.length-1;Dp(s,this.supportsBinary,r=>{try{this.doWrite(s,r)}catch{}i&&Kc(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=c1()),this.supportsBinary||(e.b64=1),this.createUri(t,e)}}const hh=qe.WebSocket||qe.MozWebSocket;class g2 extends m2{createSocket(t,e,s){return h1?new hh(t,e,s):e?new hh(t,e):new hh(t)}doWrite(t,e){this.ws.send(e)}}class y2 extends Lp{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const e=JF(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=t.readable.pipeThrough(e).getReader(),i=ZF();i.readable.pipeTo(t.writable),this._writer=i.writable.getWriter();const r=()=>{s.read().then(({done:a,value:c})=>{a||(this.onPacket(c),r())}).catch(a=>{})};r();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const s=t[e],i=e===t.length-1;this._writer.write(s).then(()=>{i&&Kc(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const b2={websocket:g2,webtransport:y2,polling:p2},_2=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,w2=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Cd(n){if(n.length>8e3)throw"URI too long";const t=n,e=n.indexOf("["),s=n.indexOf("]");e!=-1&&s!=-1&&(n=n.substring(0,e)+n.substring(e,s).replace(/:/g,";")+n.substring(s,n.length));let i=_2.exec(n||""),r={},o=14;for(;o--;)r[w2[o]]=i[o]||"";return e!=-1&&s!=-1&&(r.source=t,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=v2(r,r.path),r.queryKey=A2(r,r.query),r}function v2(n,t){const e=/\/{2,9}/g,s=t.replace(e,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&s.splice(0,1),t.slice(-1)=="/"&&s.splice(s.length-1,1),s}function A2(n,t){const e={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,i,r){i&&(e[i]=r)}),e}const Pd=typeof addEventListener=="function"&&typeof removeEventListener=="function",ba=[];Pd&&addEventListener("offline",()=>{ba.forEach(n=>n())},!1);class Qn extends Bt{constructor(t,e){if(super(),this.binaryType=t2,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(e=t,t=null),t){const s=Cd(t);e.hostname=s.host,e.secure=s.protocol==="https"||s.protocol==="wss",e.port=s.port,s.query&&(e.query=s.query)}else e.host&&(e.hostname=Cd(e.host).host);Zc(this,e),this.secure=e.secure!=null?e.secure:typeof location<"u"&&location.protocol==="https:",e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=e.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},e.transports.forEach(s=>{const i=s.prototype.name;this.transports.push(i),this._transportsByName[i]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},e),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=a2(this.opts.query)),Pd&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},ba.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const e=Object.assign({},this.opts.query);e.EIO=o1,e.transport=t,this.id&&(e.sid=this.id);const s=Object.assign({},this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&Qn.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const e=this.createTransport(t);e.open(),this.setTransport(e)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){this.readyState="open",Qn.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const e=new Error("server error");e.code=t.data,this._onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let s=0;s<this.writeBuffer.length;s++){const i=this.writeBuffer[s].data;if(i&&(e+=i2(i)),s>0&&e>this._maxPayload)return this.writeBuffer.slice(0,s);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,Kc(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,e,s){return this._sendPacket("message",t,e,s),this}send(t,e,s){return this._sendPacket("message",t,e,s),this}_sendPacket(t,e,s,i){if(typeof e=="function"&&(i=e,e=void 0),typeof s=="function"&&(i=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const r={type:t,data:e,options:s};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},s=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():t()}):this.upgrading?s():t()),this}_onError(t){if(Qn.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Pd&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=ba.indexOf(this._offlineEventListener);s!==-1&&ba.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this._prevBufferLen=0}}}Qn.protocol=o1;class S2 extends Qn{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let e=this.createTransport(t),s=!1;Qn.priorWebsocketSuccess=!1;const i=()=>{s||(e.send([{type:"ping",data:"probe"}]),e.once("packet",h=>{if(!s)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;Qn.priorWebsocketSuccess=e.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(u(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())})}else{const d=new Error("probe error");d.transport=e.name,this.emitReserved("upgradeError",d)}}))};function r(){s||(s=!0,u(),e.close(),e=null)}const o=h=>{const d=new Error("probe error: "+h);d.transport=e.name,r(),this.emitReserved("upgradeError",d)};function a(){o("transport closed")}function c(){o("socket closed")}function l(h){e&&h.name!==e.name&&r()}const u=()=>{e.removeListener("open",i),e.removeListener("error",o),e.removeListener("close",a),this.off("close",c),this.off("upgrading",l)};e.once("open",i),e.once("error",o),e.once("close",a),this.once("close",c),this.once("upgrading",l),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{s||e.open()},200):e.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const e=[];for(let s=0;s<t.length;s++)~this.transports.indexOf(t[s])&&e.push(t[s]);return e}}let T2=class extends S2{constructor(t,e={}){const s=typeof t=="object"?t:e;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(i=>b2[i]).filter(i=>!!i)),super(t,s)}};function E2(n,t="",e){let s=n;e=e||typeof location<"u"&&location,n==null&&(n=e.protocol+"//"+e.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=e.protocol+n:n=e.host+n),/^(https?|wss?):\/\//.test(n)||(typeof e<"u"?n=e.protocol+"//"+n:n="https://"+n),s=Cd(n)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const r=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+r+":"+s.port+t,s.href=s.protocol+"://"+r+(e&&e.port===s.port?"":":"+s.port),s}const x2=typeof ArrayBuffer=="function",C2=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,d1=Object.prototype.toString,P2=typeof Blob=="function"||typeof Blob<"u"&&d1.call(Blob)==="[object BlobConstructor]",k2=typeof File=="function"||typeof File<"u"&&d1.call(File)==="[object FileConstructor]";function Np(n){return x2&&(n instanceof ArrayBuffer||C2(n))||P2&&n instanceof Blob||k2&&n instanceof File}function _a(n,t){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let e=0,s=n.length;e<s;e++)if(_a(n[e]))return!0;return!1}if(Np(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return _a(n.toJSON(),!0);for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)&&_a(n[e]))return!0;return!1}function M2(n){const t=[],e=n.data,s=n;return s.data=kd(e,t),s.attachments=t.length,{packet:s,buffers:t}}function kd(n,t){if(!n)return n;if(Np(n)){const e={_placeholder:!0,num:t.length};return t.push(n),e}else if(Array.isArray(n)){const e=new Array(n.length);for(let s=0;s<n.length;s++)e[s]=kd(n[s],t);return e}else if(typeof n=="object"&&!(n instanceof Date)){const e={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=kd(n[s],t));return e}return n}function R2(n,t){return n.data=Md(n.data,t),delete n.attachments,n}function Md(n,t){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<t.length)return t[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let e=0;e<n.length;e++)n[e]=Md(n[e],t);else if(typeof n=="object")for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&(n[e]=Md(n[e],t));return n}const O2=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],D2=5;var ot;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(ot||(ot={}));class I2{constructor(t){this.replacer=t}encode(t){return(t.type===ot.EVENT||t.type===ot.ACK)&&_a(t)?this.encodeAsBinary({type:t.type===ot.EVENT?ot.BINARY_EVENT:ot.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let e=""+t.type;return(t.type===ot.BINARY_EVENT||t.type===ot.BINARY_ACK)&&(e+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(e+=t.nsp+","),t.id!=null&&(e+=t.id),t.data!=null&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=M2(t),s=this.encodeAsString(e.packet),i=e.buffers;return i.unshift(s),i}}function Hb(n){return Object.prototype.toString.call(n)==="[object Object]"}class Fp extends Bt{constructor(t){super(),this.reviver=t}add(t){let e;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);const s=e.type===ot.BINARY_EVENT;s||e.type===ot.BINARY_ACK?(e.type=s?ot.EVENT:ot.ACK,this.reconstructor=new L2(e),e.attachments===0&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else if(Np(t)||t.base64)if(this.reconstructor)e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let e=0;const s={type:Number(t.charAt(0))};if(ot[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===ot.BINARY_EVENT||s.type===ot.BINARY_ACK){const r=e+1;for(;t.charAt(++e)!=="-"&&e!=t.length;);const o=t.substring(r,e);if(o!=Number(o)||t.charAt(e)!=="-")throw new Error("Illegal attachments");s.attachments=Number(o)}if(t.charAt(e+1)==="/"){const r=e+1;for(;++e&&!(t.charAt(e)===","||e===t.length););s.nsp=t.substring(r,e)}else s.nsp="/";const i=t.charAt(e+1);if(i!==""&&Number(i)==i){const r=e+1;for(;++e;){const o=t.charAt(e);if(o==null||Number(o)!=o){--e;break}if(e===t.length)break}s.id=Number(t.substring(r,e+1))}if(t.charAt(++e)){const r=this.tryParse(t.substr(e));if(Fp.isPayloadValid(s.type,r))s.data=r;else throw new Error("invalid payload")}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,e){switch(t){case ot.CONNECT:return Hb(e);case ot.DISCONNECT:return e===void 0;case ot.CONNECT_ERROR:return typeof e=="string"||Hb(e);case ot.EVENT:case ot.BINARY_EVENT:return Array.isArray(e)&&(typeof e[0]=="number"||typeof e[0]=="string"&&O2.indexOf(e[0])===-1);case ot.ACK:case ot.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class L2{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const e=R2(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const N2=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Fp,Encoder:I2,get PacketType(){return ot},protocol:D2},Symbol.toStringTag,{value:"Module"}));function rn(n,t,e){return n.on(t,e),function(){n.off(t,e)}}const F2=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class f1 extends Bt{constructor(t,e,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[rn(t,"open",this.onopen.bind(this)),rn(t,"packet",this.onpacket.bind(this)),rn(t,"error",this.onerror.bind(this)),rn(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){var s,i,r;if(F2.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(e.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;const o={type:ot.EVENT,data:e};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof e[e.length-1]=="function"){const u=this.ids++,h=e.pop();this._registerAckCallback(u,h),o.id=u}const a=(i=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||i===void 0?void 0:i.writable,c=this.connected&&!(!((r=this.io.engine)===null||r===void 0)&&r._hasPingExpired());return this.flags.volatile&&!a||(c?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(t,e){var s;const i=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(i===void 0){this.acks[t]=e;return}const r=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===t&&this.sendBuffer.splice(a,1);e.call(this,new Error("operation has timed out"))},i),o=(...a)=>{this.io.clearTimeoutFn(r),e.apply(this,a)};o.withError=!0,this.acks[t]=o}emitWithAck(t,...e){return new Promise((s,i)=>{const r=(o,a)=>o?i(o):s(a);r.withError=!0,e.push(r),this.emit(t,...e)})}_addToQueue(t){let e;typeof t[t.length-1]=="function"&&(e=t.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...r)=>(this._queue[0],i!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(i)):(this._queue.shift(),e&&e(null,...r)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const e=this._queue[0];e.pending&&!t||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:ot.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(s=>String(s.id)===t)){const s=this.acks[t];delete this.acks[t],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case ot.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ot.EVENT:case ot.BINARY_EVENT:this.onevent(t);break;case ot.ACK:case ot.BINARY_ACK:this.onack(t);break;case ot.DISCONNECT:this.ondisconnect();break;case ot.CONNECT_ERROR:this.destroy();const s=new Error(t.data.message);s.data=t.data.data,this.emitReserved("connect_error",s);break}}onevent(t){const e=t.data||[];t.id!=null&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const s of e)s.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const e=this;let s=!1;return function(...i){s||(s=!0,e.packet({type:ot.ACK,id:t,data:i}))}}onack(t){const e=this.acks[t.id];typeof e=="function"&&(delete this.acks[t.id],e.withError&&t.data.unshift(null),e.apply(this,t.data))}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ot.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const s of e)s.apply(this,t.data)}}}function $i(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}$i.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),e=Math.floor(t*this.jitter*n);n=(Math.floor(t*10)&1)==0?n-e:n+e}return Math.min(n,this.max)|0};$i.prototype.reset=function(){this.attempts=0};$i.prototype.setMin=function(n){this.ms=n};$i.prototype.setMax=function(n){this.max=n};$i.prototype.setJitter=function(n){this.jitter=n};class Rd extends Bt{constructor(t,e){var s;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.opts=e,Zc(this,e),this.reconnection(e.reconnection!==!1),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor((s=e.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new $i({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(e.timeout==null?2e4:e.timeout),this._readyState="closed",this.uri=t;const i=e.parser||N2;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=e.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(e=this.backoff)===null||e===void 0||e.setMin(t),this)}randomizationFactor(t){var e;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(e=this.backoff)===null||e===void 0||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(e=this.backoff)===null||e===void 0||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new T2(this.uri,this.opts);const e=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const i=rn(e,"open",function(){s.onopen(),t&&t()}),r=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),t?t(a):this.maybeReconnectOnOpen()},o=rn(e,"error",r);if(this._timeout!==!1){const a=this._timeout,c=this.setTimeoutFn(()=>{i(),r(new Error("timeout")),e.close()},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(o),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(rn(t,"ping",this.onping.bind(this)),rn(t,"data",this.ondata.bind(this)),rn(t,"error",this.onerror.bind(this)),rn(t,"close",this.onclose.bind(this)),rn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(e){this.onclose("parse error",e)}}ondecoded(t){Kc(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let s=this.nsps[t];return s?this._autoConnect&&!s.active&&s.connect():(s=new f1(this,t,e),this.nsps[t]=s),s}_destroy(t){const e=Object.keys(this.nsps);for(const s of e)if(this.nsps[s].active)return;this._close()}_packet(t){const e=this.encoder.encode(t);for(let s=0;s<e.length;s++)this.engine.write(e[s],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,e){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},e);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const Zi={};function dh(n,t){typeof n=="object"&&(t=n,n=void 0),t=t||{};const e=E2(n,t.path||"/socket.io"),s=e.source,i=e.id,r=e.path,o=Zi[i]&&r in Zi[i].nsps,a=t.forceNew||t["force new connection"]||t.multiplex===!1||o;let c;return a?c=new Rd(s,t):(Zi[i]||(Zi[i]=new Rd(s,t)),c=Zi[i]),e.query&&!t.query&&(t.query=e.queryKey),c.socket(e.path,t)}Object.assign(dh,{Manager:Rd,Socket:f1,io:dh,connect:dh});let B2={data:""},$2=n=>{if(typeof window=="object"){let t=(n?n.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return t.nonce=window.__nonce__,t.parentNode||(n||document.head).appendChild(t),t.firstChild}return n||B2},U2=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,j2=/\/\*[^]*?\*\/|  +/g,qb=/\n+/g,Xn=(n,t)=>{let e="",s="",i="";for(let r in n){let o=n[r];r[0]=="@"?r[1]=="i"?e=r+" "+o+";":s+=r[1]=="f"?Xn(o,r):r+"{"+Xn(o,r[1]=="k"?"":t)+"}":typeof o=="object"?s+=Xn(o,t?t.replace(/([^,])+/g,a=>r.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,c=>/&/.test(c)?c.replace(/&/g,a):a?a+" "+c:c)):r):o!=null&&(r=/^--/.test(r)?r:r.replace(/[A-Z]/g,"-$&").toLowerCase(),i+=Xn.p?Xn.p(r,o):r+":"+o+";")}return e+(t&&i?t+"{"+i+"}":i)+s},xn={},p1=n=>{if(typeof n=="object"){let t="";for(let e in n)t+=e+p1(n[e]);return t}return n},z2=(n,t,e,s,i)=>{let r=p1(n),o=xn[r]||(xn[r]=(c=>{let l=0,u=11;for(;l<c.length;)u=101*u+c.charCodeAt(l++)>>>0;return"go"+u})(r));if(!xn[o]){let c=r!==n?n:(l=>{let u,h,d=[{}];for(;u=U2.exec(l.replace(j2,""));)u[4]?d.shift():u[3]?(h=u[3].replace(qb," ").trim(),d.unshift(d[0][h]=d[0][h]||{})):d[0][u[1]]=u[2].replace(qb," ").trim();return d[0]})(n);xn[o]=Xn(i?{["@keyframes "+o]:c}:c,e?"":"."+o)}let a=e&&xn.g?xn.g:null;return e&&(xn.g=xn[o]),((c,l,u,h)=>{h?l.data=l.data.replace(h,c):l.data.indexOf(c)===-1&&(l.data=u?c+l.data:l.data+c)})(xn[o],t,s,a),o},V2=(n,t,e)=>n.reduce((s,i,r)=>{let o=t[r];if(o&&o.call){let a=o(e),c=a&&a.props&&a.props.className||/^go/.test(a)&&a;o=c?"."+c:a&&typeof a=="object"?a.props?"":Xn(a,""):a===!1?"":a}return s+i+(o??"")},"");function Bp(n){let t=this||{},e=n.call?n(t.p):n;return z2(e.unshift?e.raw?V2(e,[].slice.call(arguments,1),t.p):e.reduce((s,i)=>Object.assign(s,i&&i.call?i(t.p):i),{}):e,$2(t.target),t.g,t.o,t.k)}let m1,Od,Dd;Bp.bind({g:1});let Mq=Bp.bind({k:1});function Rq(n,t,e,s){Xn.p=t,m1=n,Od=e,Dd=s}function Oq(n,t){let e=this||{};return function(){let s=arguments;function i(r,o){let a=Object.assign({},r),c=a.className||i.className;e.p=Object.assign({theme:Od&&Od()},a),e.o=/ *go\d+/.test(c),a.className=Bp.apply(e,s)+(c?" "+c:"");let l=n;return n[0]&&(l=a.as||n,delete a.as),Dd&&l[0]&&Dd(a),m1(l,a)}return i}}const ge=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Id=[.001,0,0,.001,0,0],fh=1.35,De={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Kn={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Xr="pdfjs_internal_editor_",tt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},at={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},H2={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Ld={TRIANGLES:1,LATTICE:2},te={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},wa={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Nt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},ei={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Jc={ERRORS:0,WARNINGS:1,INFOS:5},Kr={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Ji={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},q2={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Qc=Jc.WARNINGS;function W2(n){Number.isInteger(n)&&(Qc=n)}function G2(){return Qc}function tl(n){Qc>=Jc.INFOS&&console.info(`Info: ${n}`)}function J(n){Qc>=Jc.WARNINGS&&console.warn(`Warning: ${n}`)}function _t(n){throw new Error(n)}function ct(n,t){n||_t(t)}function Y2(n){switch(n?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function g1(n,t=null,e=null){if(!n)return null;if(e&&typeof n=="string"&&(e.addDefaultProtocol&&n.startsWith("www.")&&n.match(/\./g)?.length>=2&&(n=`http://${n}`),e.tryConvertEncoding))try{n=Q2(n)}catch{}const s=t?URL.parse(n,t):URL.parse(n);return Y2(s)?s:null}function y1(n,t,e=!1){const s=URL.parse(n);return s?(s.hash=t,s.href):e&&g1(n,"http://example.com")?n.split("#",1)[0]+`${t?`#${t}`:""}`:""}function Q(n,t,e,s=!1){return Object.defineProperty(n,t,{value:e,enumerable:!s,configurable:!0,writable:!1}),e}const Vs=(function(){function t(e,s){this.message=e,this.name=s}return t.prototype=new Error,t.constructor=t,t})();class Wb extends Vs{constructor(t,e){super(t,"PasswordException"),this.code=e}}class ph extends Vs{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class Nd extends Vs{constructor(t){super(t,"InvalidPDFException")}}class uc extends Vs{constructor(t,e,s){super(t,"ResponseException"),this.status=e,this.missing=s}}class X2 extends Vs{constructor(t){super(t,"FormatError")}}class ns extends Vs{constructor(t){super(t,"AbortException")}}function b1(n){(typeof n!="object"||n?.length===void 0)&&_t("Invalid argument for bytesToString");const t=n.length,e=8192;if(t<e)return String.fromCharCode.apply(null,n);const s=[];for(let i=0;i<t;i+=e){const r=Math.min(i+e,t),o=n.subarray(i,r);s.push(String.fromCharCode.apply(null,o))}return s.join("")}function yo(n){typeof n!="string"&&_t("Invalid argument for stringToBytes");const t=n.length,e=new Uint8Array(t);for(let s=0;s<t;++s)e[s]=n.charCodeAt(s)&255;return e}function K2(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function Z2(){const n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function J2(){try{return new Function(""),!0}catch{return!1}}class ce{static get isLittleEndian(){return Q(this,"isLittleEndian",Z2())}static get isEvalSupported(){return Q(this,"isEvalSupported",J2())}static get isOffscreenCanvasSupported(){return Q(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Q(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return Q(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return Q(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return Q(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return Q(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const mh=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0"));class U{static makeHexColor(t,e,s){return`#${mh[t]}${mh[e]}${mh[s]}`}static domMatrixToTransform(t){return[t.a,t.b,t.c,t.d,t.e,t.f]}static scaleMinMax(t,e){let s;t[0]?(t[0]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[3],e[3]*=t[3]):(s=e[0],e[0]=e[1],e[1]=s,s=e[2],e[2]=e[3],e[3]=s,t[1]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static multiplyByDOMMatrix(t,e){return[t[0]*e.a+t[2]*e.b,t[1]*e.a+t[3]*e.b,t[0]*e.c+t[2]*e.d,t[1]*e.c+t[3]*e.d,t[0]*e.e+t[2]*e.f+t[4],t[1]*e.e+t[3]*e.f+t[5]]}static applyTransform(t,e,s=0){const i=t[s],r=t[s+1];t[s]=i*e[0]+r*e[2]+e[4],t[s+1]=i*e[1]+r*e[3]+e[5]}static applyTransformToBezier(t,e,s=0){const i=e[0],r=e[1],o=e[2],a=e[3],c=e[4],l=e[5];for(let u=0;u<6;u+=2){const h=t[s+u],d=t[s+u+1];t[s+u]=h*i+d*o+c,t[s+u+1]=h*r+d*a+l}}static applyInverseTransform(t,e){const s=t[0],i=t[1],r=e[0]*e[3]-e[1]*e[2];t[0]=(s*e[3]-i*e[2]+e[2]*e[5]-e[4]*e[3])/r,t[1]=(-s*e[1]+i*e[0]+e[4]*e[1]-e[5]*e[0])/r}static axialAlignedBoundingBox(t,e,s){const i=e[0],r=e[1],o=e[2],a=e[3],c=e[4],l=e[5],u=t[0],h=t[1],d=t[2],f=t[3];let m=i*u+c,p=m,g=i*d+c,y=g,_=a*h+l,b=_,w=a*f+l,v=w;if(r!==0||o!==0){const A=r*u,S=r*d,T=o*h,E=o*f;m+=T,y+=T,g+=E,p+=E,_+=A,v+=A,w+=S,b+=S}s[0]=Math.min(s[0],m,g,p,y),s[1]=Math.min(s[1],_,w,b,v),s[2]=Math.max(s[2],m,g,p,y),s[3]=Math.max(s[3],_,w,b,v)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const s=t[0],i=t[1],r=t[2],o=t[3],a=s**2+i**2,c=s*r+i*o,l=r**2+o**2,u=(a+l)/2,h=Math.sqrt(u**2-(a*l-c**2));e[0]=Math.sqrt(u+h||1),e[1]=Math.sqrt(u-h||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const s=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),i=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(s>i)return null;const r=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),o=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return r>o?null:[s,r,i,o]}static pointBoundingBox(t,e,s){s[0]=Math.min(s[0],t),s[1]=Math.min(s[1],e),s[2]=Math.max(s[2],t),s[3]=Math.max(s[3],e)}static rectBoundingBox(t,e,s,i,r){r[0]=Math.min(r[0],t,s),r[1]=Math.min(r[1],e,i),r[2]=Math.max(r[2],t,s),r[3]=Math.max(r[3],e,i)}static#t(t,e,s,i,r,o,a,c,l,u){if(l<=0||l>=1)return;const h=1-l,d=l*l,f=d*l,m=h*(h*(h*t+3*l*e)+3*d*s)+f*i,p=h*(h*(h*r+3*l*o)+3*d*a)+f*c;u[0]=Math.min(u[0],m),u[1]=Math.min(u[1],p),u[2]=Math.max(u[2],m),u[3]=Math.max(u[3],p)}static#e(t,e,s,i,r,o,a,c,l,u,h,d){if(Math.abs(l)<1e-12){Math.abs(u)>=1e-12&&this.#t(t,e,s,i,r,o,a,c,-h/u,d);return}const f=u**2-4*h*l;if(f<0)return;const m=Math.sqrt(f),p=2*l;this.#t(t,e,s,i,r,o,a,c,(-u+m)/p,d),this.#t(t,e,s,i,r,o,a,c,(-u-m)/p,d)}static bezierBoundingBox(t,e,s,i,r,o,a,c,l){l[0]=Math.min(l[0],t,a),l[1]=Math.min(l[1],e,c),l[2]=Math.max(l[2],t,a),l[3]=Math.max(l[3],e,c),this.#e(t,s,r,a,e,i,o,c,3*(-t+3*(s-r)+a),6*(t-2*s+r),3*(s-t),l),this.#e(t,s,r,a,e,i,o,c,3*(-e+3*(i-o)+c),6*(e-2*i+o),3*(i-e),l)}}function Q2(n){return decodeURIComponent(escape(n))}let gh=null,Gb=null;function tB(n){return gh||(gh=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Gb=new Map([["","t"]])),n.replaceAll(gh,(t,e,s)=>e?e.normalize("NFKC"):Gb.get(s))}function _1(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const n=new Uint8Array(32);return crypto.getRandomValues(n),b1(n)}const di="pdfjs_internal_id_";function eB(n,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[s,i,...r]=e;if(!n(s)&&!Number.isInteger(s)||!t(i))return!1;const o=r.length;let a=!0;switch(i.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return o===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(o!==4)return!1;a=!1;break;default:return!1}for(const c of r)if(!(typeof c=="number"||a&&c===null))return!1;return!0}function ye(n,t,e){return Math.min(Math.max(n,t),e)}function w1(n){return Uint8Array.prototype.toBase64?n.toBase64():btoa(b1(n))}function nB(n){return Uint8Array.fromBase64?Uint8Array.fromBase64(n):yo(atob(n))}typeof Promise.try!="function"&&(Promise.try=function(n,...t){return new Promise(e=>{e(n(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(n){return n.reduce((t,e)=>t+e,0)});class Zr{static textContent(t){const e=[],s={items:e,styles:Object.create(null)};function i(r){if(!r)return;let o=null;const a=r.name;if(a==="#text")o=r.value;else if(Zr.shouldBuildText(a))r?.attributes?.textContent?o=r.attributes.textContent:r.value&&(o=r.value);else return;if(o!==null&&e.push({str:o}),!!r.children)for(const c of r.children)i(c)}return i(t),s}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}class v1{static setupStorage(t,e,s,i,r){const o=i.getValue(e,{value:null});switch(s.name){case"textarea":if(o.value!==null&&(t.textContent=o.value),r==="print")break;t.addEventListener("input",a=>{i.setValue(e,{value:a.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(o.value===s.attributes.xfaOn?t.setAttribute("checked",!0):o.value===s.attributes.xfaOff&&t.removeAttribute("checked"),r==="print")break;t.addEventListener("change",a=>{i.setValue(e,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&t.setAttribute("value",o.value),r==="print")break;t.addEventListener("input",a=>{i.setValue(e,{value:a.target.value})})}break;case"select":if(o.value!==null){t.setAttribute("value",o.value);for(const a of s.children)a.attributes.value===o.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}t.addEventListener("input",a=>{const c=a.target.options,l=c.selectedIndex===-1?"":c[c.selectedIndex].value;i.setValue(e,{value:l})});break}}static setAttributes({html:t,element:e,storage:s=null,intent:i,linkService:r}){const{attributes:o}=e,a=t instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${i}`);for(const[c,l]of Object.entries(o))if(l!=null)switch(c){case"class":l.length&&t.setAttribute(c,l.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",l);break;case"style":Object.assign(t.style,l);break;case"textContent":t.textContent=l;break;default:(!a||c!=="href"&&c!=="newWindow")&&t.setAttribute(c,l)}a&&r.addLinkAttributes(t,o.href,o.newWindow),s&&o.dataId&&this.setupStorage(t,o.dataId,e,s)}static render(t){const e=t.annotationStorage,s=t.linkService,i=t.xfaHtml,r=t.intent||"display",o=document.createElement(i.name);i.attributes&&this.setAttributes({html:o,element:i,intent:r,linkService:s});const a=r!=="richText",c=t.div;if(c.append(o),t.viewport){const h=`matrix(${t.viewport.transform.join(",")})`;c.style.transform=h}a&&c.setAttribute("class","xfaLayer xfaFont");const l=[];if(i.children.length===0){if(i.value){const h=document.createTextNode(i.value);o.append(h),a&&Zr.shouldBuildText(i.name)&&l.push(h)}return{textDivs:l}}const u=[[i,-1,o]];for(;u.length>0;){const[h,d,f]=u.at(-1);if(d+1===h.children.length){u.pop();continue}const m=h.children[++u.at(-1)[1]];if(m===null)continue;const{name:p}=m;if(p==="#text"){const y=document.createTextNode(m.value);l.push(y),f.append(y);continue}const g=m?.attributes?.xmlns?document.createElementNS(m.attributes.xmlns,p):document.createElement(p);if(f.append(g),m.attributes&&this.setAttributes({html:g,element:m,storage:e,intent:r,linkService:s}),m.children?.length>0)u.push([m,-1,g]);else if(m.value){const y=document.createTextNode(m.value);a&&Zr.shouldBuildText(p)&&l.push(y),g.append(y)}}for(const h of c.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))h.setAttribute("readOnly",!0);return{textDivs:l}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const Pn="http://www.w3.org/2000/svg";class Oi{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function bo(n,t="text"){if(ar(n,document.baseURI)){const e=await fetch(n);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,s)=>{const i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType=t,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(i.response);return}e(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class _o{constructor({viewBox:t,userUnit:e,scale:s,rotation:i,offsetX:r=0,offsetY:o=0,dontFlip:a=!1}){this.viewBox=t,this.userUnit=e,this.scale=s,this.rotation=i,this.offsetX=r,this.offsetY=o,s*=e;const c=(t[2]+t[0])/2,l=(t[3]+t[1])/2;let u,h,d,f;switch(i%=360,i<0&&(i+=360),i){case 180:u=-1,h=0,d=0,f=1;break;case 90:u=0,h=1,d=1,f=0;break;case 270:u=0,h=-1,d=-1,f=0;break;case 0:u=1,h=0,d=0,f=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(d=-d,f=-f);let m,p,g,y;u===0?(m=Math.abs(l-t[1])*s+r,p=Math.abs(c-t[0])*s+o,g=(t[3]-t[1])*s,y=(t[2]-t[0])*s):(m=Math.abs(c-t[0])*s+r,p=Math.abs(l-t[1])*s+o,g=(t[2]-t[0])*s,y=(t[3]-t[1])*s),this.transform=[u*s,h*s,d*s,f*s,m-u*s*c-d*s*l,p-h*s*c-f*s*l],this.width=g,this.height=y}get rawDims(){const t=this.viewBox;return Q(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:r=!1}={}){return new _o({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:r})}convertToViewportPoint(t,e){const s=[t,e];return U.applyTransform(s,this.transform),s}convertToViewportRectangle(t){const e=[t[0],t[1]];U.applyTransform(e,this.transform);const s=[t[2],t[3]];return U.applyTransform(s,this.transform),[e[0],e[1],s[0],s[1]]}convertToPdfPoint(t,e){const s=[t,e];return U.applyInverseTransform(s,this.transform),s}}class $p extends Vs{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function el(n){const t=n.length;let e=0;for(;e<t&&n[e].trim()==="";)e++;return n.substring(e,e+5).toLowerCase()==="data:"}function Up(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function sB(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function iB(n,t="document.pdf"){if(typeof n!="string")return t;if(el(n))return J('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const s=(a=>{try{return new URL(a)}catch{try{return new URL(decodeURIComponent(a))}catch{try{return new URL(a,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(a),"https://foo.bar")}catch{return null}}}}})(n);if(!s)return t;const i=a=>{try{let c=decodeURIComponent(a);return c.includes("/")?(c=c.split("/").at(-1),c.test(/^\.pdf$/i)?c:a):c}catch{return a}},r=/\.pdf$/i,o=s.pathname.split("/").at(-1);if(r.test(o))return i(o);if(s.searchParams.size>0){const a=Array.from(s.searchParams.values()).reverse();for(const l of a)if(r.test(l))return i(l);const c=Array.from(s.searchParams.keys()).reverse();for(const l of c)if(r.test(l))return i(l)}if(s.hash){const c=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(s.hash);if(c)return i(c[0])}return t}class Yb{started=Object.create(null);times=[];time(t){t in this.started&&J(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||J(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:s}of this.times)e=Math.max(s.length,e);for(const{name:s,start:i,end:r}of this.times)t.push(`${s.padEnd(e)} ${r-i}ms
`);return t.join("")}}function ar(n,t){const e=t?URL.parse(n,t):URL.parse(n);return e?.protocol==="http:"||e?.protocol==="https:"}function Je(n){n.preventDefault()}function Ot(n){n.preventDefault(),n.stopPropagation()}function rB(n){console.log("Deprecated API usage: "+n)}class Fd{static#t;static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#t.exec(t);if(!e)return null;const s=parseInt(e[1],10);let i=parseInt(e[2],10);i=i>=1&&i<=12?i-1:0;let r=parseInt(e[3],10);r=r>=1&&r<=31?r:1;let o=parseInt(e[4],10);o=o>=0&&o<=23?o:0;let a=parseInt(e[5],10);a=a>=0&&a<=59?a:0;let c=parseInt(e[6],10);c=c>=0&&c<=59?c:0;const l=e[7]||"Z";let u=parseInt(e[8],10);u=u>=0&&u<=23?u:0;let h=parseInt(e[9],10)||0;return h=h>=0&&h<=59?h:0,l==="-"?(o+=u,a+=h):l==="+"&&(o-=u,a-=h),new Date(Date.UTC(s,i,r,o,a,c))}}function oB(n,{scale:t=1,rotation:e=0}){const{width:s,height:i}=n.attributes.style,r=[0,0,parseInt(s),parseInt(i)];return new _o({viewBox:r,userUnit:1,scale:t,rotation:e})}function wo(n){if(n.startsWith("#")){const t=parseInt(n.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(t=>parseInt(t)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(J(`Not a valid color format: "${n}"`),[0,0,0])}function aB(n){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of n.keys()){t.style.color=e;const s=window.getComputedStyle(t).color;n.set(e,wo(s))}t.remove()}function Ct(n){const{a:t,b:e,c:s,d:i,e:r,f:o}=n.getTransform();return[t,e,s,i,r,o]}function hn(n){const{a:t,b:e,c:s,d:i,e:r,f:o}=n.getTransform().invertSelf();return[t,e,s,i,r,o]}function Ls(n,t,e=!1,s=!0){if(t instanceof _o){const{pageWidth:i,pageHeight:r}=t.rawDims,{style:o}=n,a=ce.isCSSRoundSupported,c=`var(--total-scale-factor) * ${i}px`,l=`var(--total-scale-factor) * ${r}px`,u=a?`round(down, ${c}, var(--scale-round-x))`:`calc(${c})`,h=a?`round(down, ${l}, var(--scale-round-y))`:`calc(${l})`;!e||t.rotation%180===0?(o.width=u,o.height=h):(o.width=h,o.height=u)}s&&n.setAttribute("data-main-rotation",t.rotation)}class En{constructor(){const{pixelRatio:t}=En;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,s,i,r=-1){let o=1/0,a=1/0,c=1/0;s=En.capPixels(s,r),s>0&&(o=Math.sqrt(s/(t*e))),i!==-1&&(a=i/t,c=i/e);const l=Math.min(o,a,c);return this.sx>l||this.sy>l?(this.sx=l,this.sy=l,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,s):s}return t}}const Bd=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class cB{static get isDarkMode(){return Q(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class lB{static get commentForegroundColor(){const t=document.createElement("span");t.classList.add("comment","sidebar");const{style:e}=t;e.width=e.height="0",e.display="none",e.color="var(--comment-fg-color)",document.body.append(t);const{color:s}=window.getComputedStyle(t);return t.remove(),Q(this,"commentForegroundColor",wo(s))}}function uB(n,t,e,s){s=Math.min(Math.max(s??1,0),1);const i=255*(1-s);return n=Math.round(n*s+i),t=Math.round(t*s+i),e=Math.round(e*s+i),[n,t,e]}function Xb(n,t){const e=n[0]/255,s=n[1]/255,i=n[2]/255,r=Math.max(e,s,i),o=Math.min(e,s,i),a=(r+o)/2;if(r===o)t[0]=t[1]=0;else{const c=r-o;switch(t[1]=a<.5?c/(r+o):c/(2-r-o),r){case e:t[0]=((s-i)/c+(s<i?6:0))*60;break;case s:t[0]=((i-e)/c+2)*60;break;case i:t[0]=((e-s)/c+4)*60;break}}t[2]=a}function $d(n,t){const e=n[0],s=n[1],i=n[2],r=(1-Math.abs(2*i-1))*s,o=r*(1-Math.abs(e/60%2-1)),a=i-r/2;switch(Math.floor(e/60)){case 0:t[0]=r+a,t[1]=o+a,t[2]=a;break;case 1:t[0]=o+a,t[1]=r+a,t[2]=a;break;case 2:t[0]=a,t[1]=r+a,t[2]=o+a;break;case 3:t[0]=a,t[1]=o+a,t[2]=r+a;break;case 4:t[0]=o+a,t[1]=a,t[2]=r+a;break;case 5:case 6:t[0]=r+a,t[1]=a,t[2]=o+a;break}}function Kb(n){return n<=.03928?n/12.92:((n+.055)/1.055)**2.4}function Zb(n,t,e){$d(n,e),e.map(Kb);const s=.2126*e[0]+.7152*e[1]+.0722*e[2];$d(t,e),e.map(Kb);const i=.2126*e[0]+.7152*e[1]+.0722*e[2];return s>i?(s+.05)/(i+.05):(i+.05)/(s+.05)}const Jb=new Map;function hB(n,t){const e=n[0]+n[1]*256+n[2]*65536+t[0]*16777216+t[1]*4294967296+t[2]*1099511627776;let s=Jb.get(e);if(s)return s;const i=new Float32Array(9),r=i.subarray(0,3),o=i.subarray(3,6);Xb(n,o);const a=i.subarray(6,9);Xb(t,a);const c=a[2]<.5,l=c?12:4.5;if(o[2]=c?Math.sqrt(o[2]):1-Math.sqrt(1-o[2]),Zb(o,a,r)<l){let u,h;c?(u=o[2],h=1):(u=0,h=o[2]);const d=.005;for(;h-u>d;){const f=o[2]=(u+h)/2;c===Zb(o,a,r)<l?u=f:h=f}o[2]=c?h:u}return $d(o,r),s=U.makeHexColor(Math.round(r[0]*255),Math.round(r[1]*255),Math.round(r[2]*255)),Jb.set(e,s),s}function A1({html:n,dir:t,className:e},s){const i=document.createDocumentFragment();if(typeof n=="string"){const r=document.createElement("p");r.dir=t||"auto";const o=n.split(/(?:\r\n?|\n)/);for(let a=0,c=o.length;a<c;++a){const l=o[a];r.append(document.createTextNode(l)),a<c-1&&r.append(document.createElement("br"))}i.append(r)}else v1.render({xfaHtml:n,div:i,intent:"richText"});i.firstElementChild.classList.add("richText",e),s.append(i)}function S1(n){const t=new Path2D;if(!n)return t;for(let e=0,s=n.length;e<s;)switch(n[e++]){case Ji.moveTo:t.moveTo(n[e++],n[e++]);break;case Ji.lineTo:t.lineTo(n[e++],n[e++]);break;case Ji.curveTo:t.bezierCurveTo(n[e++],n[e++],n[e++],n[e++],n[e++],n[e++]);break;case Ji.quadraticCurveTo:t.quadraticCurveTo(n[e++],n[e++],n[e++],n[e++]);break;case Ji.closePath:t.closePath();break;default:J(`Unrecognized drawing path operator: ${n[e-1]}`);break}return t}class Tr{#t=null;#e=null;#s;#n=null;#o=null;#r=null;#i=null;#a=null;static#l=null;constructor(t){this.#s=t,Tr.#l||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#s._uiManager._signal;e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("contextmenu",Je,{signal:e}),t.addEventListener("pointerdown",Tr.#c,{signal:e}));const s=this.#n=document.createElement("div");s.className="buttons",t.append(s);const i=this.#s.toolbarPosition;if(i){const{style:r}=t,o=this.#s._uiManager.direction==="ltr"?1-i[0]:i[0];r.insetInlineEnd=`${100*o}%`,r.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#t}static#c(t){t.stopPropagation()}#d(t){this.#s._focusEventsAllowed=!1,Ot(t)}#h(t){this.#s._focusEventsAllowed=!0,Ot(t)}#f(t){const e=this.#s._uiManager._signal;return!(e instanceof AbortSignal)||e.aborted?!1:(t.addEventListener("focusin",this.#d.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#h.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",Je,{signal:e}),!0)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#o?.shown(),this.#r?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#s,s=document.createElement("button");s.classList.add("basic","deleteButton"),s.tabIndex=0,s.setAttribute("data-l10n-id",Tr.#l[t]),this.#f(s)&&s.addEventListener("click",i=>{e.delete()},{signal:e._signal}),this.#n.append(s)}get#g(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#f(e),this.#n.append(e,this.#g),this.#o=t}addComment(t,e=null){if(this.#r)return;const s=t.renderForToolbar();if(!s)return;this.#f(s);const i=this.#i=this.#g;e?(this.#n.insertBefore(s,e),this.#n.insertBefore(i,e)):this.#n.append(s,i),this.#r=t,t.toolbar=this}addColorPicker(t){if(this.#e)return;this.#e=t;const e=t.renderButton();this.#f(e),this.#n.append(e,this.#g)}async addEditSignatureButton(t){const e=this.#a=await t.renderEditButton(this.#s);this.#f(e),this.#n.append(e,this.#g)}removeButton(t){t==="comment"&&(this.#r?.removeToolbarCommentButton(),this.#r=null,this.#i?.remove(),this.#i=null)}async addButton(t,e){switch(t){case"colorPicker":e&&this.addColorPicker(e);break;case"altText":e&&await this.addAltText(e);break;case"editSignature":e&&await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":e&&this.addComment(e);break}}async addButtonBefore(t,e,s){if(!e&&t==="comment")return;const i=this.#n.querySelector(s);i&&t==="comment"&&this.addComment(e,i)}updateEditSignatureButton(t){this.#a&&(this.#a.title=t)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class dB{#t=null;#e=null;#s;constructor(t){this.#s=t}#n(){const t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar");const e=this.#s._signal;e instanceof AbortSignal&&!e.aborted&&t.addEventListener("contextmenu",Je,{signal:e});const s=this.#t=document.createElement("div");return s.className="buttons",t.append(s),this.#s.hasCommentManager()&&this.#r("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#s.commentSelection("floating_button")}),this.#r("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#s.highlightSelection("floating_button")}),t}#o(t,e){let s=0,i=0;for(const r of t){const o=r.y+r.height;if(o<s)continue;const a=r.x+(e?r.width:0);if(o>s){i=a,s=o;continue}e?a>i&&(i=a):a<i&&(i=a)}return[e?1-i:i,s]}show(t,e,s){const[i,r]=this.#o(e,s),{style:o}=this.#e||=this.#n();t.append(this.#e),o.insetInlineEnd=`${100*i}%`,o.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#r(t,e,s,i){const r=document.createElement("button");r.classList.add("basic",t),r.tabIndex=0,r.setAttribute("data-l10n-id",e);const o=document.createElement("span");r.append(o),o.className="visuallyHidden",o.setAttribute("data-l10n-id",s);const a=this.#s._signal;a instanceof AbortSignal&&!a.aborted&&(r.addEventListener("contextmenu",Je,{signal:a}),r.addEventListener("click",i,{signal:a})),this.#t.append(r)}}function T1(n,t,e){for(const s of e)t.addEventListener(s,n[s].bind(n))}class dt{static#t=NaN;static#e=null;static#s=NaN;static#n=null;static initializeAndAddPointerId(t){(dt.#e||=new Set).add(t)}static setPointer(t,e){dt.#t||=e,dt.#n??=t}static setTimeStamp(t){dt.#s=t}static isSamePointerId(t){return dt.#t===t}static isSamePointerIdOrRemove(t){return dt.#t===t?!0:(dt.#e?.delete(t),!1)}static isSamePointerType(t){return dt.#n===t}static isInitializedAndDifferentPointerType(t){return dt.#n!==null&&!dt.isSamePointerType(t)}static isSameTimeStamp(t){return dt.#s===t}static isUsingMultiplePointers(){return dt.#e?.size>=1}static clearPointerType(){dt.#n=null}static clearPointerIds(){dt.#t=NaN,dt.#e=null}static clearTimeStamp(){dt.#s=NaN}}class fB{#t=0;get id(){return`${Xr}${this.#t++}`}}class jp{#t=_1();#e=0;#s=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=t;const r=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return Q(this,"_isSVGFittingCanvas",r)}async#n(t,e){this.#s||=new Map;let s=this.#s.get(t);if(s===null)return null;if(s?.bitmap)return s.refCounter+=1,s;try{s||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let i;if(typeof e=="string"?(s.url=e,i=await bo(e,"blob")):e instanceof File?i=s.file=e:e instanceof Blob&&(i=e),i.type==="image/svg+xml"){const r=jp._isSVGFittingCanvas,o=new FileReader,a=new Image,c=new Promise((l,u)=>{a.onload=()=>{s.bitmap=a,s.isSvg=!0,l()},o.onload=async()=>{const h=s.svgUrl=o.result;a.src=await r?`${h}#svgView(preserveAspectRatio(none))`:h},a.onerror=o.onerror=u});o.readAsDataURL(i),await c}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){J(i),s=null}return this.#s.set(t,s),s&&this.#s.set(s.id,s),s}async getFromFile(t){const{lastModified:e,name:s,size:i,type:r}=t;return this.#n(`${e}_${s}_${i}_${r}`,t)}async getFromUrl(t){return this.#n(t,t)}async getFromBlob(t,e){const s=await e;return this.#n(t,s)}async getFromId(t){this.#s||=new Map;const e=this.#s.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:s}=e;return delete e.blobPromise,this.getFromBlob(e.id,s)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#s||=new Map;let s=this.#s.get(t);if(s?.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(e.width,e.height);return i.getContext("2d").drawImage(e,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#s.set(t,s),this.#s.set(s.id,s),s}getSvgUrl(t){const e=this.#s.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#s||=new Map;const e=this.#s.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:s}=e;if(!e.url&&!e.file){const i=new OffscreenCanvas(s.width,s.height);i.getContext("bitmaprenderer").transferFromImageBitmap(s),e.blobPromise=i.convertToBlob()}s.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}}class pB{#t=[];#e=!1;#s;#n=-1;constructor(t=128){this.#s=t}add({cmd:t,undo:e,post:s,mustExec:i,type:r=NaN,overwriteIfSameType:o=!1,keepUndo:a=!1}){if(i&&t(),this.#e)return;const c={cmd:t,undo:e,post:s,type:r};if(this.#n===-1){this.#t.length>0&&(this.#t.length=0),this.#n=0,this.#t.push(c);return}if(o&&this.#t[this.#n].type===r){a&&(c.undo=this.#t[this.#n].undo),this.#t[this.#n]=c;return}const l=this.#n+1;l===this.#s?this.#t.splice(0,1):(this.#n=l,l<this.#t.length&&this.#t.splice(l)),this.#t.push(c)}undo(){if(this.#n===-1)return;this.#e=!0;const{undo:t,post:e}=this.#t[this.#n];t(),e?.(),this.#e=!1,this.#n-=1}redo(){if(this.#n<this.#t.length-1){this.#n+=1,this.#e=!0;const{cmd:t,post:e}=this.#t[this.#n];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#t.length-1}cleanType(t){if(this.#n!==-1){for(let e=this.#n;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#n-e),this.#n=e;return}this.#t.length=0,this.#n=-1}}destroy(){this.#t=null}}class vo{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=ce.platform;for(const[s,i,r={}]of t)for(const o of s){const a=o.startsWith("mac+");e&&a?(this.callbacks.set(o.slice(4),{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1))):!e&&!a&&(this.callbacks.set(o,{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const s=this.callbacks.get(this.#t(e));if(!s)return;const{callback:i,options:{bubbles:r=!1,args:o=[],checker:a=null}}=s;a&&!a(t,e)||(i.bind(t,...o,e)(),r||Ot(e))}}class zp{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return aB(t),Q(this,"_colors",t)}convert(t){const e=wo(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[s,i]of this._colors)if(i.every((r,o)=>r===e[o]))return zp._colorsMapping.get(s);return e}getHexCode(t){const e=this._colors.get(t);return e?U.makeHexColor(...e):t}}class ss{#t=new AbortController;#e=null;#s=null;#n=new Map;#o=new Map;#r=null;#i=null;#a=null;#l=new pB;#c=null;#d=null;#h=null;#f=0;#g=new Set;#m=null;#u=null;#p=new Set;_editorUndoBar=null;#y=!1;#_=!1;#b=!1;#E=null;#S=null;#v=null;#C=null;#w=!1;#T=null;#M=new fB;#P=!1;#k=!1;#F=!1;#O=null;#I=null;#B=null;#L=null;#H=null;#x=tt.NONE;#A=new Set;#D=null;#$=null;#j=null;#G=null;#W=null;#Y={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#z=[0,0];#N=null;#q=null;#J=null;#Q=null;#U=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=ss.prototype,e=o=>o.#q.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),s=(o,{target:a})=>{if(a instanceof HTMLInputElement){const{type:c}=a;return c!=="text"&&c!=="number"}return!0},i=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return Q(this,"_keyboardManager",new vo([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],t.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:s}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&o.#q.contains(a)&&!o.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&o.#q.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-r,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[r,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-r],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,r],checker:e}]]))}constructor(t,e,s,i,r,o,a,c,l,u,h,d,f,m,p,g){const y=this._signal=this.#t.signal;this.#q=t,this.#J=e,this.#Q=s,this.#r=i,this.#c=r,this.#$=o,this.#W=c,this._eventBus=a,a._on("editingaction",this.onEditingAction.bind(this),{signal:y}),a._on("pagechanging",this.onPageChanging.bind(this),{signal:y}),a._on("scalechanging",this.onScaleChanging.bind(this),{signal:y}),a._on("rotationchanging",this.onRotationChanging.bind(this),{signal:y}),a._on("setpreference",this.onSetPreference.bind(this),{signal:y}),a._on("switchannotationeditorparams",_=>this.updateParams(_.type,_.value),{signal:y}),window.addEventListener("pointerdown",()=>{this.#k=!0},{capture:!0,signal:y}),window.addEventListener("pointerup",()=>{this.#k=!1},{capture:!0,signal:y}),this.#ot(),this.#dt(),this.#et(),this.#i=c.annotationStorage,this.#E=c.filterFactory,this.#j=l,this.#C=u||null,this.#y=h,this.#_=d,this.#b=f,this.#H=m||null,this.viewParameters={realScale:Oi.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=p||null,this._supportsPinchToZoom=g!==!1,r?.setSidebarUiManager(this)}destroy(){this.#U?.resolve(),this.#U=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#o.values())t.destroy();this.#o.clear(),this.#n.clear(),this.#p.clear(),this.#L?.clear(),this.#e=null,this.#A.clear(),this.#l.destroy(),this.#r?.destroy(),this.#c?.destroy(),this.#$?.destroy(),this.#T?.hide(),this.#T=null,this.#B?.destroy(),this.#B=null,this.#s=null,this.#S&&(clearTimeout(this.#S),this.#S=null),this.#N&&(clearTimeout(this.#N),this.#N=null),this._editorUndoBar?.destroy(),this.#W=null}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#H}get useNewAltTextFlow(){return this.#_}get useNewAltTextWhenAddingImage(){return this.#b}get hcmFilter(){return Q(this,"hcmFilter",this.#j?this.#E.addHCMFilter(this.#j.foreground,this.#j.background):"none")}get direction(){return Q(this,"direction",getComputedStyle(this.#q).direction)}get _highlightColors(){return Q(this,"_highlightColors",this.#C?new Map(this.#C.split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return Q(this,"highlightColors",null);const e=new Map,s=!!this.#j;for(const[i,r]of t){const o=i.endsWith("_HCM");if(s&&o){e.set(i.replace("_HCM",""),r);continue}!s&&!o&&e.set(i,r)}return Q(this,"highlightColors",e)}get highlightColorNames(){return Q(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#h=t}setMainHighlightColorPicker(t){this.#B=t}editAltText(t,e=!1){this.#r?.editAltText(this,t,e)}hasCommentManager(){return!!this.#c}editComment(t,e,s,i){this.#c?.showDialog(this,t,e,s,i)}selectComment(t,e){this.#o.get(t)?.getEditorByUID(e)?.toggleComment(!0,!0)}updateComment(t){this.#c?.updateComment(t.getData())}updatePopupColor(t){this.#c?.updatePopupColor(t)}removeComment(t){this.#c?.removeComments([t.uid])}toggleComment(t,e,s=void 0){this.#c?.toggleCommentPopup(t,e,s)}makeCommentColor(t,e){return t&&this.#c?.makeCommentColor(t,e)||null}getCommentDialogElement(){return this.#c?.dialogElement||null}async waitForEditorsRendered(t){if(this.#o.has(t-1))return;const{resolve:e,promise:s}=Promise.withResolvers(),i=r=>{r.pageNumber===t&&(this._eventBus._off("editorsrendered",i),e())};this._eventBus.on("editorsrendered",i),await s}getSignature(t){this.#$?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#$}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){t==="enableNewAltTextWhenAddingImage"&&(this.#b=e)}onPageChanging({pageNumber:t}){this.#f=t-1}focusMainContainer(){this.#q.focus()}findParent(t,e){for(const s of this.#o.values()){const{x:i,y:r,width:o,height:a}=s.div.getBoundingClientRect();if(t>=i&&t<=i+o&&e>=r&&e<=r+a)return s}return null}disableUserSelect(t=!1){this.#J.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#p.add(t)}removeShouldRescale(t){this.#p.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*Oi.PDF_TO_CSS_UNITS;for(const e of this.#p)e.onScaleChanging();this.#h?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#Z({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#tt(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const s of this.#o.values())if(s.hasTextLayer(t))return s;return null}highlightSelection(t="",e=!1){const s=document.getSelection();if(!s||s.isCollapsed)return;const{anchorNode:i,anchorOffset:r,focusNode:o,focusOffset:a}=s,c=s.toString(),u=this.#Z(s).closest(".textLayer"),h=this.getSelectionBoxes(u);if(!h)return;s.empty();const d=this.#tt(u),f=this.#x===tt.NONE,m=()=>{const p=d?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:h,anchorNode:i,anchorOffset:r,focusNode:o,focusOffset:a,text:c});f&&this.showAllEditors("highlight",!0,!0),e&&p?.editComment()};if(f){this.switchToMode(tt.HIGHLIGHT,m);return}m()}commentSelection(t=""){this.highlightSelection(t,!0)}#it(){const t=document.getSelection();if(!t||t.isCollapsed)return;const s=this.#Z(t).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(this.#T||=new dB(this),this.#T.show(s,i,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(t){if(!this.#i)return null;const e=`${Xr}${t}`,s=this.#i.getRawValue(e);return s&&this.#i.remove(e),s}addToAnnotationStorage(t){!t.isEmpty()&&this.#i&&!this.#i.has(t.id)&&this.#i.setValue(t.id,t)}a11yAlert(t,e=null){const s=this.#Q;s&&(s.setAttribute("data-l10n-id",t),e?s.setAttribute("data-l10n-args",JSON.stringify(e)):s.removeAttribute("data-l10n-args"))}#rt(){const t=document.getSelection();if(!t||t.isCollapsed){this.#D&&(this.#T?.hide(),this.#D=null,this.#R({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#D)return;const i=this.#Z(t).closest(".textLayer");if(!i){this.#D&&(this.#T?.hide(),this.#D=null,this.#R({hasSelectedText:!1}));return}if(this.#T?.hide(),this.#D=e,this.#R({hasSelectedText:!0}),!(this.#x!==tt.HIGHLIGHT&&this.#x!==tt.NONE)&&(this.#x===tt.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#w=this.isShiftKeyDown,!this.isShiftKeyDown)){const r=this.#x===tt.HIGHLIGHT?this.#tt(i):null;if(r?.toggleDrawing(),this.#k){const o=new AbortController,a=this.combinedSignal(o),c=l=>{l.type==="pointerup"&&l.button!==0||(o.abort(),r?.toggleDrawing(!0),l.type==="pointerup"&&this.#X("main_toolbar"))};window.addEventListener("pointerup",c,{signal:a}),window.addEventListener("blur",c,{signal:a})}else r?.toggleDrawing(!0),this.#X("main_toolbar")}}#X(t=""){this.#x===tt.HIGHLIGHT?this.highlightSelection(t):this.#y&&this.#it()}#ot(){document.addEventListener("selectionchange",this.#rt.bind(this),{signal:this._signal})}#at(){if(this.#v)return;this.#v=new AbortController;const t=this.combinedSignal(this.#v);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#ct(){this.#v?.abort(),this.#v=null}blur(){if(this.isShiftKeyDown=!1,this.#w&&(this.#w=!1,this.#X("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#A)if(e.div.contains(t)){this.#I=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#I)return;const[t,e]=this.#I;this.#I=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#et(){if(this.#O)return;this.#O=new AbortController;const t=this.combinedSignal(this.#O);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#lt(){this.#O?.abort(),this.#O=null}#ut(){if(this.#d)return;this.#d=new AbortController;const t=this.combinedSignal(this.#d);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#ht(){this.#d?.abort(),this.#d=null}#dt(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#et(),this.setEditingState(!0)}removeEditListeners(){this.#lt(),this.setEditingState(!1)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const s of this.#u)if(s.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const s of this.#u)if(s.isHandlingMimeForPasting(e.type)){s.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const s of this.#A){const i=s.serialize(!0);i&&e.push(i)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const r of e.items)for(const o of this.#u)if(o.isHandlingMimeForPasting(r.type)){o.paste(r,this.currentLayer);return}let s=e.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(r){J(`paste: "${r.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const r=[];for(const c of s){const l=await i.deserialize(c);if(!l)return;r.push(l)}const o=()=>{for(const c of r)this.#nt(c);this.#st(r)},a=()=>{for(const c of r)c.remove()};this.addCommands({cmd:o,undo:a,mustExec:!0})}catch(r){J(`paste: "${r.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#x!==tt.NONE&&!this.isEditorHandlingKeyboard&&ss._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#w&&(this.#w=!1,this.#X("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#R(t){Object.entries(t).some(([s,i])=>this.#Y[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#Y,t)}),this.#x===tt.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#V([[at.HIGHLIGHT_FREE,!0]]))}#V(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#at(),this.#ut(),this.#R({isEditing:this.#x!==tt.NONE,isEmpty:this.#K(),hasSomethingToUndo:this.#l.hasSomethingToUndo(),hasSomethingToRedo:this.#l.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#ct(),this.#ht(),this.#R({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#u){this.#u=t;for(const e of this.#u)this.#V(e.defaultPropertiesToUpdate)}}getId(){return this.#M.id}get currentLayer(){return this.#o.get(this.#f)}getLayer(t){return this.#o.get(t)}get currentPageIndex(){return this.#f}addLayer(t){this.#o.set(t.pageIndex,t),this.#P?t.enable():t.disable()}removeLayer(t){this.#o.delete(t.pageIndex)}async updateMode(t,e=null,s=!1,i=!1,r=!1){if(this.#x!==t&&!(this.#U&&(await this.#U.promise,!this.#U))){if(this.#U=Promise.withResolvers(),this.#h?.commitOrRemove(),this.#x===tt.POPUP&&this.#c?.hideSidebar(),this.#c?.destroyPopup(),this.#x=t,t===tt.NONE){this.setEditingState(!1),this.#pt();for(const o of this.#n.values())o.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#U.resolve();return}for(const o of this.#n.values())o.addStandaloneCommentButton();t===tt.SIGNATURE&&await this.#$?.loadSignatures(),this.setEditingState(!0),await this.#ft(),this.unselectAll();for(const o of this.#o.values())o.updateMode(t);if(t===tt.POPUP){this.#s||=await this.#W.getAnnotationsByType(new Set(this.#u.map(c=>c._editorType)));const o=new Set,a=[];for(const c of this.#n.values()){const{annotationElementId:l,hasComment:u,deleted:h}=c;l&&o.add(l),u&&!h&&a.push(c.getData())}for(const c of this.#s){const{id:l,popupRef:u,contentsObj:h}=c;u&&h?.str&&!o.has(l)&&!this.#g.has(l)&&a.push(c)}this.#c?.showSidebar(a)}if(!e){s&&this.addNewEditorFromKeyboard(),this.#U.resolve();return}for(const o of this.#n.values())o.uid===e?(this.setSelected(o),r?o.editComment():i?o.enterInEditMode():o.focus()):o.unselect();this.#U.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#x&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#u){switch(t){case at.CREATE:this.currentLayer.addNewEditor(e);return;case at.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#G||=new Map).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const s of this.#A)s.updateParams(t,e);else for(const s of this.#u)s.updateDefaultParams(t,e)}}showAllEditors(t,e,s=!1){for(const r of this.#n.values())r.editorType===t&&r.show(e);(this.#G?.get(at.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#V([[at.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#F!==t){this.#F=t;for(const e of this.#o.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#ft(){if(!this.#P){this.#P=!0;const t=[];for(const e of this.#o.values())t.push(e.enable());await Promise.all(t);for(const e of this.#n.values())e.enable()}}#pt(){if(this.unselectAll(),this.#P){this.#P=!1;for(const t of this.#o.values())t.disable();for(const t of this.#n.values())t.disable()}}*getEditors(t){for(const e of this.#n.values())e.pageIndex===t&&(yield e)}getEditor(t){return this.#n.get(t)}addEditor(t){this.#n.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#S&&clearTimeout(this.#S),this.#S=setTimeout(()=>{this.focusMainContainer(),this.#S=null},0)),this.#n.delete(t.id),t.annotationElementId&&this.#L?.delete(t.annotationElementId),this.unselect(t),(!t.annotationElementId||!this.#g.has(t.annotationElementId))&&this.#i?.remove(t.id)}addDeletedAnnotationElement(t){this.#g.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#g.has(t)}removeDeletedAnnotationElement(t){this.#g.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#nt(t){const e=this.#o.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#V(t.propertiesToUpdate))}get#mt(){let t=null;for(t of this.#A);return t}updateUI(t){this.#mt===t&&this.#V(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#V(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#A.has(t)){this.#A.delete(t),t.unselect(),this.#R({hasSelectedEditor:this.hasSelection});return}this.#A.add(t),t.select(),this.#V(t.propertiesToUpdate),this.#R({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.uid}),this.#h?.commitOrRemove();for(const e of this.#A)e!==t&&e.unselect();this.#A.clear(),this.#A.add(t),t.select(),this.#V(t.propertiesToUpdate),this.#R({hasSelectedEditor:!0})}isSelected(t){return this.#A.has(t)}get firstSelectedEditor(){return this.#A.values().next().value}unselect(t){t.unselect(),this.#A.delete(t),this.#R({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#A.size!==0}get isEnterHandled(){return this.#A.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#l.undo(),this.#R({hasSomethingToUndo:this.#l.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#K()}),this._editorUndoBar?.hide()}redo(){this.#l.redo(),this.#R({hasSomethingToUndo:!0,hasSomethingToRedo:this.#l.hasSomethingToRedo(),isEmpty:this.#K()})}addCommands(t){this.#l.add(t),this.#R({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#K()})}cleanUndoStack(t){this.#l.cleanType(t)}#K(){if(this.#n.size===0)return!0;if(this.#n.size===1)for(const t of this.#n.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#A],s=()=>{this._editorUndoBar?.show(i,e.length===1?e[0].editorType:e.length);for(const r of e)r.remove()},i=()=>{for(const r of e)this.#nt(r)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#st(t){for(const e of this.#A)e.unselect();this.#A.clear();for(const e of t)e.isEmpty()||(this.#A.add(e),e.select());this.#R({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#A)t.commit();this.#st(this.#n.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#x!==tt.NONE))&&!this.#h?.commitOrRemove()&&this.hasSelection){for(const t of this.#A)t.unselect();this.#A.clear(),this.#R({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;this.#z[0]+=t,this.#z[1]+=e;const[i,r]=this.#z,o=[...this.#A],a=1e3;this.#N&&clearTimeout(this.#N),this.#N=setTimeout(()=>{this.#N=null,this.#z[0]=this.#z[1]=0,this.addCommands({cmd:()=>{for(const c of o)this.#n.has(c.id)&&(c.translateInPage(i,r),c.translationDone())},undo:()=>{for(const c of o)this.#n.has(c.id)&&(c.translateInPage(-i,-r),c.translationDone())},mustExec:!1})},a);for(const c of o)c.translateInPage(t,e),c.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#m=new Map;for(const t of this.#A)this.#m.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#m)return!1;this.disableUserSelect(!1);const t=this.#m;this.#m=null;let e=!1;for(const[{x:i,y:r,pageIndex:o},a]of t)a.newX=i,a.newY=r,a.newPageIndex=o,e||=i!==a.savedX||r!==a.savedY||o!==a.savedPageIndex;if(!e)return!1;const s=(i,r,o,a)=>{if(this.#n.has(i.id)){const c=this.#o.get(a);c?i._setParentAndPosition(c,r,o):(i.pageIndex=a,i.x=r,i.y=o)}};return this.addCommands({cmd:()=>{for(const[i,{newX:r,newY:o,newPageIndex:a}]of t)s(i,r,o,a)},undo:()=>{for(const[i,{savedX:r,savedY:o,savedPageIndex:a}]of t)s(i,r,o,a)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#m)for(const s of this.#m.keys())s.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#A.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#x}isEditingMode(){return this.#x!==tt.NONE}get imageManager(){return Q(this,"imageManager",new jp)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let l=0,u=e.rangeCount;l<u;l++)if(!t.contains(e.getRangeAt(l).commonAncestorContainer))return null;const{x:s,y:i,width:r,height:o}=t.getBoundingClientRect();let a;switch(t.getAttribute("data-main-rotation")){case"90":a=(l,u,h,d)=>({x:(u-i)/o,y:1-(l+h-s)/r,width:d/o,height:h/r});break;case"180":a=(l,u,h,d)=>({x:1-(l+h-s)/r,y:1-(u+d-i)/o,width:h/r,height:d/o});break;case"270":a=(l,u,h,d)=>({x:1-(u+d-i)/o,y:(l-s)/r,width:d/o,height:h/r});break;default:a=(l,u,h,d)=>({x:(l-s)/r,y:(u-i)/o,width:h/r,height:d/o});break}const c=[];for(let l=0,u=e.rangeCount;l<u;l++){const h=e.getRangeAt(l);if(!h.collapsed)for(const{x:d,y:f,width:m,height:p}of h.getClientRects())m===0||p===0||c.push(a(d,f,m,p))}return c.length===0?null:c}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#a||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#a?.delete(t)}renderAnnotationElement(t){const e=this.#a?.get(t.data.id);if(!e)return;const s=this.#i.getRawValue(e);s&&(this.#x===tt.NONE&&!s.hasBeenModified||s.renderAnnotationElement(t))}setMissingCanvas(t,e,s){const i=this.#L?.get(t);i&&(i.setCanvas(e,s),this.#L.delete(t))}addMissingCanvas(t,e){(this.#L||=new Map).set(t,e)}}class mn{#t=null;#e=!1;#s=null;#n=null;#o=null;#r=null;#i=!1;#a=null;#l=null;#c=null;#d=null;#h=!1;static#f=null;static _l10n=null;constructor(t){this.#l=t,this.#h=t._uiManager.useNewAltTextFlow,mn.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){mn._l10n??=t}async render(){const t=this.#s=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#n=document.createElement("span");t.append(e),this.#h?(t.classList.add("new"),t.setAttribute("data-l10n-id",mn.#f.missing),e.setAttribute("data-l10n-id",mn.#f["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=this.#l._uiManager._signal;t.addEventListener("contextmenu",Je,{signal:s}),t.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const i=r=>{r.preventDefault(),this.#l._uiManager.editAltText(this.#l),this.#h&&this.#l._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#g}})};return t.addEventListener("click",i,{capture:!0,signal:s}),t.addEventListener("keydown",r=>{r.target===t&&r.key==="Enter"&&(this.#i=!0,i(r))},{signal:s}),await this.#m(),t}get#g(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#s&&(this.#s.focus({focusVisible:this.#i}),this.#i=!1)}isEmpty(){return this.#h?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#h?this.#t!==null||!!this.#c:this.isEmpty()}get guessedText(){return this.#c}async setGuessedText(t){this.#t===null&&(this.#c=t,this.#d=await mn._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#m())}toggleAltTextBadge(t=!1){if(!this.#h||this.#t){this.#a?.remove(),this.#a=null;return}if(!this.#a){const e=this.#a=document.createElement("div");e.className="noAltTextBadge",this.#l.div.append(e)}this.#a.classList.toggle("hidden",!t)}serialize(t){let e=this.#t;return!t&&this.#c===e&&(e=this.#d),{altText:e,decorative:this.#e,guessedText:this.#c,textWithDisclaimer:this.#d}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:e,guessedText:s,textWithDisclaimer:i,cancel:r=!1}){s&&(this.#c=s,this.#d=i),!(this.#t===t&&this.#e===e)&&(r||(this.#t=t,this.#e=e),this.#m())}toggle(t=!1){this.#s&&(!t&&this.#r&&(clearTimeout(this.#r),this.#r=null),this.#s.disabled=!t)}shown(){this.#l._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#g}})}destroy(){this.#s?.remove(),this.#s=null,this.#n=null,this.#o=null,this.#a?.remove(),this.#a=null}async#m(){const t=this.#s;if(!t)return;if(this.#h){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",mn.#f[this.#g]),this.#n?.setAttribute("data-l10n-id",mn.#f[`${this.#g}-label`]),!this.#t){this.#o?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#o?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#o;if(!e){this.#o=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#l.id}`;const i=100,r=this.#l._uiManager._signal;r.addEventListener("abort",()=>{clearTimeout(this.#r),this.#r=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#r=setTimeout(()=>{this.#r=null,this.#o.classList.add("show"),this.#l._reportTelemetry({action:"alt_text_tooltip"})},i)},{signal:r}),t.addEventListener("mouseleave",()=>{this.#r&&(clearTimeout(this.#r),this.#r=null),this.#o?.classList.remove("show")},{signal:r})}this.#e?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#t),e.parentNode||t.append(e),this.#l.getElementForAltText()?.setAttribute("aria-describedby",e.id)}}class Vo{#t=null;#e=null;#s=!1;#n=null;#o=null;#r=null;#i=null;#a=null;#l=!1;#c=null;constructor(t){this.#n=t}renderForToolbar(){const t=this.#e=document.createElement("button");return t.className="comment",this.#d(t,!1)}renderForStandalone(){const t=this.#t=document.createElement("button");t.className="annotationCommentButton";const e=this.#n.commentButtonPosition;if(e){const{style:s}=t;s.insetInlineEnd=`calc(${100*(this.#n._uiManager.direction==="ltr"?1-e[0]:e[0])}% - var(--comment-button-dim))`,s.top=`calc(${100*e[1]}% - var(--comment-button-dim))`;const i=this.#n.commentButtonColor;i&&(s.backgroundColor=i)}return this.#d(t,!0)}focusButton(){setTimeout(()=>{(this.#t??this.#e)?.focus()},0)}onUpdatedColor(){if(!this.#t)return;const t=this.#n.commentButtonColor;t&&(this.#t.style.backgroundColor=t),this.#n._uiManager.updatePopupColor(this.#n)}get commentButtonWidth(){return(this.#t?.getBoundingClientRect().width??0)/this.#n.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#c)return this.#c;if(!this.#t)return null;const{x:t,y:e,height:s}=this.#t.getBoundingClientRect(),{x:i,y:r,width:o,height:a}=this.#n.parent.boundingClientRect;return[(t-i)/o,(e+s-r)/a]}set commentPopupPositionInLayer(t){this.#c=t}hasDefaultPopupPosition(){return this.#c===null}removeStandaloneCommentButton(){this.#t?.remove(),this.#t=null}removeToolbarCommentButton(){this.#e?.remove(),this.#e=null}setCommentButtonStates({selected:t,hasPopup:e}){this.#t&&(this.#t.classList.toggle("selected",t),this.#t.ariaExpanded=e)}#d(t,e){if(!this.#n._uiManager.hasCommentManager())return null;t.tabIndex="0",t.ariaHasPopup="dialog",e?(t.ariaControls="commentPopup",t.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(t.ariaControlsElements=[this.#n._uiManager.getCommentDialogElement()],t.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const s=this.#n._uiManager._signal;if(!(s instanceof AbortSignal)||s.aborted)return t;t.addEventListener("contextmenu",Je,{signal:s}),e&&(t.addEventListener("focusin",r=>{this.#n._focusEventsAllowed=!1,Ot(r)},{capture:!0,signal:s}),t.addEventListener("focusout",r=>{this.#n._focusEventsAllowed=!0,Ot(r)},{capture:!0,signal:s})),t.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const i=r=>{r.preventDefault(),t===this.#e?this.edit():this.#n.toggleComment(!0)};return t.addEventListener("click",i,{capture:!0,signal:s}),t.addEventListener("keydown",r=>{r.target===t&&r.key==="Enter"&&(this.#s=!0,i(r))},{signal:s}),t.addEventListener("pointerenter",()=>{this.#n.toggleComment(!1,!0)},{signal:s}),t.addEventListener("pointerleave",()=>{this.#n.toggleComment(!1,!1)},{signal:s}),t}edit(t){const e=this.commentPopupPositionInLayer;let s,i;if(e)[s,i]=e;else{[s,i]=this.#n.commentButtonPosition;const{width:u,height:h,x:d,y:f}=this.#n;s=d+s*u,i=f+i*h}const r=this.#n.parent.boundingClientRect,{x:o,y:a,width:c,height:l}=r;this.#n._uiManager.editComment(this.#n,o+s*c,a+i*l,{...t,parentDimensions:r})}finish(){this.#e&&(this.#e.focus({focusVisible:this.#s}),this.#s=!1)}isDeleted(){return this.#l||this.#i===""}isEmpty(){return this.#i===null}hasBeenEdited(){return this.isDeleted()||this.#i!==this.#o}serialize(){return this.data}get data(){return{text:this.#i,richText:this.#r,date:this.#a,deleted:this.isDeleted()}}set data(t){if(t!==this.#i&&(this.#r=null),t===null){this.#i="",this.#l=!0;return}this.#i=t,this.#a=new Date,this.#l=!1}setInitialText(t,e=null){this.#o=t,this.data=t,this.#a=null,this.#r=e}shown(){}destroy(){this.#e?.remove(),this.#e=null,this.#t?.remove(),this.#t=null,this.#i="",this.#r=null,this.#a=null,this.#n=null,this.#s=!1,this.#l=!1}}class nl{#t;#e=!1;#s=null;#n;#o;#r;#i;#a=null;#l;#c=null;#d;#h=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:r=null,onPinchEnd:o=null,signal:a}){this.#t=t,this.#s=s,this.#n=e,this.#o=i,this.#r=r,this.#i=o,this.#d=new AbortController,this.#l=AbortSignal.any([a,this.#d.signal]),t.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#l})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/En.pixelRatio}#f(t){if(this.#n?.())return;if(t.touches.length===1){if(this.#a)return;const i=this.#a=new AbortController,r=AbortSignal.any([this.#l,i.signal]),o=this.#t,a={capture:!0,signal:r,passive:!1},c=l=>{l.pointerType==="touch"&&(this.#a?.abort(),this.#a=null)};o.addEventListener("pointerdown",l=>{l.pointerType==="touch"&&(Ot(l),c(l))},a),o.addEventListener("pointerup",c,a),o.addEventListener("pointercancel",c,a);return}if(!this.#h){this.#h=new AbortController;const i=AbortSignal.any([this.#l,this.#h.signal]),r=this.#t,o={signal:i,capture:!1,passive:!1};r.addEventListener("touchmove",this.#g.bind(this),o);const a=this.#m.bind(this);r.addEventListener("touchend",a,o),r.addEventListener("touchcancel",a,o),o.capture=!0,r.addEventListener("pointerdown",Ot,o),r.addEventListener("pointermove",Ot,o),r.addEventListener("pointercancel",Ot,o),r.addEventListener("pointerup",Ot,o),this.#o?.()}if(Ot(t),t.touches.length!==2||this.#s?.()){this.#c=null;return}let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]),this.#c={touch0X:e.screenX,touch0Y:e.screenY,touch1X:s.screenX,touch1Y:s.screenY}}#g(t){if(!this.#c||t.touches.length!==2)return;Ot(t);let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]);const{screenX:i,screenY:r}=e,{screenX:o,screenY:a}=s,c=this.#c,{touch0X:l,touch0Y:u,touch1X:h,touch1Y:d}=c,f=h-l,m=d-u,p=o-i,g=a-r,y=Math.hypot(p,g)||1,_=Math.hypot(f,m)||1;if(!this.#e&&Math.abs(_-y)<=nl.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(c.touch0X=i,c.touch0Y=r,c.touch1X=o,c.touch1Y=a,!this.#e){this.#e=!0;return}const b=[(i+o)/2,(r+a)/2];this.#r?.(b,_,y)}#m(t){t.touches.length>=2||(this.#h&&(this.#h.abort(),this.#h=null,this.#i?.()),this.#c&&(Ot(t),this.#c=null,this.#e=!1))}destroy(){this.#d?.abort(),this.#d=null,this.#a?.abort(),this.#a=null}}class W{#t=null;#e=null;#s=null;#n=null;#o=null;#r=!1;#i=null;#a="";#l=null;#c=null;#d=null;#h=null;#f=null;#g="";#m=!1;#u=null;#p=!1;#y=!1;#_=!1;#b=null;#E=0;#S=0;#v=null;#C=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#w=!1;#T=W._zIndex++;static _borderLineWidth=-1;static _colorManager=new zp;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=W.prototype._resizeWithKeyboard,e=ss.TRANSLATE_SMALL,s=ss.TRANSLATE_BIG;return Q(this,"_resizerKeyboardManager",new vo([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,s]}],[["Escape","mac+Escape"],W.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null,this.creationDate=t.creationDate||new Date,this.modificationDate=t.modificationDate||null,this.canAddComment=!0;const{rotation:e,rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:o}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[r,o];const[a,c]=this.parentDimensions;this.x=t.x/a,this.y=t.y/c,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return Q(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new mB({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(W._l10n??=t,W._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),W._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);W._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){_t("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#w}set _isDraggable(t){this.#w=t,this.div?.classList.toggle("draggable",t)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#T}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):(this.#N(),this.#h?.remove(),this.#h=null),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#m?this.#m=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,s,i){const[r,o]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(t+s)/r,this.y=(e+i)/o,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[s,i]=this.parentDimensions;this.setAt(t*s,e*i,this.width*s,this.height*i),this._onTranslated()}#M([t,e],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/t,this.y+=i/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#M(this.parentDimensions,t,e)}translateInPage(t,e){this.#u||=[this.x,this.y,this.width,this.height],this.#M(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#u||=[this.x,this.y,this.width,this.height];const{div:s,parentDimensions:[i,r]}=this;if(this.x+=t/i,this.y+=e/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:h,y:d}=this.div.getBoundingClientRect();this.parent.findNewParent(this,h,d)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:a}=this;const[c,l]=this.getBaseTranslation();o+=c,a+=l;const{style:u}=s;u.left=`${(100*o).toFixed(2)}%`,u.top=`${(100*a).toFixed(2)}%`,this._onTranslating(o,a),s.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#u&&(this.#u[0]!==this.x||this.#u[1]!==this.y)}get _hasBeenResized(){return!!this.#u&&(this.#u[2]!==this.width||this.#u[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:s}=W,i=s/t,r=s/e;switch(this.rotation){case 90:return[-i,r];case 180:return[i,r];case 270:return[i,-r];default:return[-i,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[s,i]}=this;let{x:r,y:o,width:a,height:c}=this;if(a*=s,c*=i,r*=s,o*=i,this._mustFixPosition)switch(t){case 0:r=ye(r,0,s-a),o=ye(o,0,i-c);break;case 90:r=ye(r,0,s-c),o=ye(o,a,i);break;case 180:r=ye(r,a,s),o=ye(o,c,i);break;case 270:r=ye(r,c,s),o=ye(o,0,i-a);break}this.x=r/=s,this.y=o/=i;const[l,u]=this.getBaseTranslation();r+=l,o+=u,e.left=`${(100*r).toFixed(2)}%`,e.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}static#P(t,e,s){switch(s){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return W.#P(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return W.#P(t,e,360-this.parentRotation)}#k(t){switch(t){case 90:{const[e,s]=this.pageDimensions;return[0,-e/s,s/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,s]=this.pageDimensions;return[0,e/s,-s/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,s]}=this;return[e*t,s*t]}setDims(){const{div:{style:t},width:e,height:s}=this;t.width=`${(100*e).toFixed(2)}%`,t.height=`${(100*s).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#F(){if(this.#l)return;this.#l=document.createElement("div"),this.#l.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const s of t){const i=document.createElement("div");this.#l.append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",this.#O.bind(this,s),{signal:e}),i.addEventListener("contextmenu",Je,{signal:e}),i.tabIndex=-1}this.div.prepend(this.#l)}#O(t,e){e.preventDefault();const{isMac:s}=ce.platform;if(e.button!==0||e.ctrlKey&&s)return;this.#s?.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,this.#c=[e.screenX,e.screenY];const r=new AbortController,o=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#L.bind(this,t),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",Ot,{passive:!1,signal:o}),window.addEventListener("contextmenu",Je,{signal:o}),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const a=this.parent.div.style.cursor,c=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const l=()=>{r.abort(),this.parent.togglePointerEvents(!0),this.#s?.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=a,this.div.style.cursor=c,this.#B()};window.addEventListener("pointerup",l,{signal:o}),window.addEventListener("blur",l,{signal:o})}#I(t,e,s,i){this.width=s,this.height=i,this.x=t,this.y=e,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#B(){if(!this.#d)return;const{savedX:t,savedY:e,savedWidth:s,savedHeight:i}=this.#d;this.#d=null;const r=this.x,o=this.y,a=this.width,c=this.height;r===t&&o===e&&a===s&&c===i||this.addCommands({cmd:this.#I.bind(this,r,o,a,c),undo:this.#I.bind(this,t,e,s,i),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#L(t,e){const[s,i]=this.parentDimensions,r=this.x,o=this.y,a=this.width,c=this.height,l=W.MIN_SIZE/s,u=W.MIN_SIZE/i,h=this.#k(this.rotation),d=($,D)=>[h[0]*$+h[2]*D,h[1]*$+h[3]*D],f=this.#k(360-this.rotation),m=($,D)=>[f[0]*$+f[2]*D,f[1]*$+f[3]*D];let p,g,y=!1,_=!1;switch(t){case"topLeft":y=!0,p=($,D)=>[0,0],g=($,D)=>[$,D];break;case"topMiddle":p=($,D)=>[$/2,0],g=($,D)=>[$/2,D];break;case"topRight":y=!0,p=($,D)=>[$,0],g=($,D)=>[0,D];break;case"middleRight":_=!0,p=($,D)=>[$,D/2],g=($,D)=>[0,D/2];break;case"bottomRight":y=!0,p=($,D)=>[$,D],g=($,D)=>[0,0];break;case"bottomMiddle":p=($,D)=>[$/2,D],g=($,D)=>[$/2,0];break;case"bottomLeft":y=!0,p=($,D)=>[0,D],g=($,D)=>[$,0];break;case"middleLeft":_=!0,p=($,D)=>[0,D/2],g=($,D)=>[$,D/2];break}const b=p(a,c),w=g(a,c);let v=d(...w);const A=W._round(r+v[0]),S=W._round(o+v[1]);let T=1,E=1,P,x;if(e.fromKeyboard)({deltaX:P,deltaY:x}=e);else{const{screenX:$,screenY:D}=e,[k,L]=this.#c;[P,x]=this.screenToPageTranslation($-k,D-L),this.#c[0]=$,this.#c[1]=D}if([P,x]=m(P/s,x/i),y){const $=Math.hypot(a,c);T=E=Math.max(Math.min(Math.hypot(w[0]-b[0]-P,w[1]-b[1]-x)/$,1/a,1/c),l/a,u/c)}else _?T=ye(Math.abs(w[0]-b[0]-P),l,1)/a:E=ye(Math.abs(w[1]-b[1]-x),u,1)/c;const I=W._round(a*T),V=W._round(c*E);v=d(...g(I,V));const X=A-v[0],st=S-v[1];this.#u||=[this.x,this.y,this.width,this.height],this.width=I,this.height=V,this.x=X,this.y=st,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#s?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#y)return this._editToolbar;this._editToolbar=new Tr(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,s]of t)await this._editToolbar.addButton(e,s);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#s?.destroy()}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#s||(mn.initialize(W._l10n),this.#s=new mn(this),this.#t&&(this.#s.data=this.#t,this.#t=null)),this.#s}get altTextData(){return this.#s?.data}set altTextData(t){this.#s&&(this.#s.data=t)}get guessedAltText(){return this.#s?.guessedText}async setGuessedAltText(t){await this.#s?.setGuessedText(t)}serializeAltText(t){return this.#s?.serialize(t)}hasAltText(){return!!this.#s&&!this.#s.isEmpty()}hasAltTextData(){return this.#s?.hasData()??!1}focusCommentButton(){this.#n?.focusButton()}addCommentButton(){return this.canAddComment?this.#n||=new Vo(this):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(this.#o){this._uiManager.isEditingMode()&&this.#o.classList.remove("hidden");return}this.hasComment&&(this.#o=this.#n.renderForStandalone(),this.div.append(this.#o))}}removeStandaloneCommentButton(){this.#n.removeStandaloneCommentButton(),this.#o=null}hideStandaloneCommentButton(){this.#o?.classList.add("hidden")}get comment(){const{data:{richText:t,text:e,date:s,deleted:i}}=this.#n;return{text:e,richText:t,date:s,deleted:i,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(t){this.#n||=new Vo(this),this.#n.data=t,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:t,popupRef:e,richText:s}){if(!e||(this.#n||=new Vo(this),this.#n.setInitialText(t,s),!this.annotationElementId))return;const i=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);i&&this.updateFromAnnotationLayer(i)}get hasEditedComment(){return this.#n?.hasBeenEdited()}get hasDeletedComment(){return this.#n?.isDeleted()}get hasComment(){return!!this.#n&&!this.#n.isEmpty()&&!this.#n.isDeleted()}async editComment(t){this.#n||=new Vo(this),this.#n.edit(t)}toggleComment(t,e=void 0){this.hasComment&&this._uiManager.toggleComment(this,t,e)}setSelectedCommentButton(t){this.#n.setSelectedButton(t)}addComment(t){if(this.hasEditedComment){const[,,,i]=t.rect,[r]=this.pageDimensions,[o]=this.pageTranslation,a=o+r+1,c=i-100,l=a+180;t.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[a,c,l,i]}}}updateFromAnnotationLayer({popup:{contents:t,deleted:e}}){this.#n.data=e?null:t}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#r?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#j();const[e,s]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*s/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/s).toFixed(2)}%`);const[i,r]=this.getInitialTranslation();return this.translate(i,r),T1(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#C||=new nl({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#H.bind(this),onPinching:this.#x.bind(this),onPinchEnd:this.#A.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),t}#H(){this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#s?.toggle(!1),this.parent.togglePointerEvents(!1)}#x(t,e,s){let r=.7*(s/e)+1-.7;if(r===1)return;const o=this.#k(this.rotation),a=(A,S)=>[o[0]*A+o[2]*S,o[1]*A+o[3]*S],[c,l]=this.parentDimensions,u=this.x,h=this.y,d=this.width,f=this.height,m=W.MIN_SIZE/c,p=W.MIN_SIZE/l;r=Math.max(Math.min(r,1/d,1/f),m/d,p/f);const g=W._round(d*r),y=W._round(f*r);if(g===d&&y===f)return;this.#u||=[u,h,d,f];const _=a(d/2,f/2),b=W._round(u+_[0]),w=W._round(h+_[1]),v=a(g/2,y/2);this.x=b-v[0],this.y=w-v[1],this.width=g,this.height=y,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#A(){this.#s?.toggle(!0),this.parent.togglePointerEvents(!0),this.#B()}pointerdown(t){const{isMac:e}=ce.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#m=!0,this._isDraggable){this.#$(t);return}this.#D(t)}#D(t){const{isMac:e}=ce.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#$(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,r=this._uiManager.combinedSignal(i),o={capture:!0,passive:!1,signal:r},a=l=>{i.abort(),this.#i=null,this.#m=!1,this._uiManager.endDragSession()||this.#D(l),s&&this._onStopDragging()};e&&(this.#E=t.clientX,this.#S=t.clientY,this.#i=t.pointerId,this.#a=t.pointerType,window.addEventListener("pointermove",l=>{s||(s=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:u,clientY:h,pointerId:d}=l;if(d!==this.#i){Ot(l);return}const[f,m]=this.screenToPageTranslation(u-this.#E,h-this.#S);this.#E=u,this.#S=h,this._uiManager.dragSelectedEditors(f,m)},o),window.addEventListener("touchmove",Ot,o),window.addEventListener("pointerdown",l=>{l.pointerType===this.#a&&(this.#C||l.isPrimary)&&a(l),Ot(l)},o));const c=l=>{if(!this.#i||this.#i===l.pointerId){a(l);return}Ot(l)};window.addEventListener("pointerup",c,{signal:r}),window.addEventListener("blur",c,{signal:r})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#b&&clearTimeout(this.#b),this.#b=setTimeout(()=>{this.#b=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,s){t.changeParent(this),this.x=e,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,s=this.rotation){const i=this.parentScale,[r,o]=this.pageDimensions,[a,c]=this.pageTranslation,l=t/i,u=e/i,h=this.x*r,d=this.y*o,f=this.width*r,m=this.height*o;switch(s){case 0:return[h+l+a,o-d-u-m+c,h+l+f+a,o-d-u+c];case 90:return[h+u+a,o-d+l+c,h+u+m+a,o-d+l+f+c];case 180:return[h-l-f+a,o-d+u+c,h-l+a,o-d+u+m+c];case 270:return[h-u-m+a,o-d-l-f+c,h-u+a,o-d-l+c];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[s,i,r,o]=t,a=r-s,c=o-i;switch(this.rotation){case 0:return[s,e-o,a,c];case 90:return[s,e-i,c,a];case 180:return[r,e-i,a,c];case 270:return[r,e-o,c,a];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&W._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#n?.onUpdatedColor()}getData(){const{comment:{text:t,color:e,date:s,opacity:i,deleted:r,richText:o},uid:a,pageIndex:c,creationDate:l,modificationDate:u}=this;return{id:a,pageIndex:c,rect:this.getPDFRect(),richText:o,contentsObj:{str:t},creationDate:l,modificationDate:s||u,popupRef:!r,color:e,opacity:i}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#y=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#y=!1,!0):!1}isInEditMode(){return this.#y}shouldGetKeyboardEvents(){return this.#_}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:r,innerWidth:o}=window;return e<o&&i>0&&t<r&&s>0}#j(){if(this.#f||!this.div)return;this.#f=new AbortController;const t=this._uiManager.combinedSignal(this.#f);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#j()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(t,e,s){const i=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:s,annotationElementId:t.annotationElementId,creationDate:t.creationDate,modificationDate:t.modificationDate});i.rotation=t.rotation,i.#t=t.accessibilityData,i._isCopy=t.isCopy||!1;const[r,o]=i.pageDimensions,[a,c,l,u]=i.getRectInCurrentCoords(t.rect,o);return i.x=a/r,i.y=c/o,i.width=l/r,i.height=u/o,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#f?.abort(),this.#f=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),this.#b&&(clearTimeout(this.#b),this.#b=null),this.#N(),this.removeEditToolbar(),this.#v){for(const t of this.#v.values())clearTimeout(t);this.#v=null}this.parent=null,this.#C?.destroy(),this.#C=null,this.#h?.remove(),this.#h=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#F(),this.#l.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[t,e]}=this,[s,i,r,o]=this.getPDFRect();return[W._round(s+(r-s)*t),W._round(i+(o-i)*(1-e))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#n.commentPopupPositionInLayer}set commentPopupPosition(t){this.#n.commentPopupPositionInLayer=t}hasDefaultPopupPosition(){return this.#n.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#n.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(t){this.#n?.setCommentButtonStates(t)}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#l.children;if(!this.#e){this.#e=Array.from(e);const o=this.#G.bind(this),a=this.#W.bind(this),c=this._uiManager._signal;for(const l of this.#e){const u=l.getAttribute("data-resizer-name");l.setAttribute("role","spinbutton"),l.addEventListener("keydown",o,{signal:c}),l.addEventListener("blur",a,{signal:c}),l.addEventListener("focus",this.#Y.bind(this,u),{signal:c}),l.setAttribute("data-l10n-id",W._l10nResizer[u])}}const s=this.#e[0];let i=0;for(const o of e){if(o===s)break;i++}const r=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(r!==i){if(r<i)for(let a=0;a<i-r;a++)this.#l.append(this.#l.firstElementChild);else if(r>i)for(let a=0;a<r-i;a++)this.#l.firstElementChild.before(this.#l.lastElementChild);let o=0;for(const a of e){const l=this.#e[o++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",W._l10nResizer[l])}}this.#z(0),this.#_=!0,this.#l.firstElementChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#G(t){W._resizerKeyboardManager.exec(this,t)}#W(t){this.#_&&t.relatedTarget?.parentNode!==this.#l&&this.#N()}#Y(t){this.#g=this.#_?t:""}#z(t){if(this.#e)for(const e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#_&&this.#L(this.#g,{deltaX:t,deltaY:e,fromKeyboard:!0})}#N(){this.#_=!1,this.#z(-1),this.#B()}_stopResizingWithKeyboard(){this.#N(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#s?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#l?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#s?.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){t.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(t){this.#p=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#v||=new Map;const{action:s}=t;let i=this.#v.get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(t),this.#v.delete(s),this.#v.size===0&&(this.#v=null)},W._telemetryTimeout),this.#v.set(s,i);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#r=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#r=!0}updateFakeAnnotationElement(t){if(!this.#h&&!this.deleted){this.#h=t.addFakeAnnotation(this);return}if(this.deleted){this.#h.remove(),this.#h=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#h.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const s=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),s.before(e)}return e}resetAnnotationElement(t){const{firstElementChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class mB extends W{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Qb=3285377520,je=4294901760,dn=65535;class E1{constructor(t){this.h1=t?t&4294967295:Qb,this.h2=t?t&4294967295:Qb}update(t){let e,s;if(typeof t=="string"){e=new Uint8Array(t.length*2),s=0;for(let p=0,g=t.length;p<g;p++){const y=t.charCodeAt(p);y<=255?e[s++]=y:(e[s++]=y>>>8,e[s++]=y&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),s=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,r=s-i*4,o=new Uint32Array(e.buffer,0,i);let a=0,c=0,l=this.h1,u=this.h2;const h=3432918353,d=461845907,f=h&dn,m=d&dn;for(let p=0;p<i;p++)p&1?(a=o[p],a=a*h&je|a*f&dn,a=a<<15|a>>>17,a=a*d&je|a*m&dn,l^=a,l=l<<13|l>>>19,l=l*5+3864292196):(c=o[p],c=c*h&je|c*f&dn,c=c<<15|c>>>17,c=c*d&je|c*m&dn,u^=c,u=u<<13|u>>>19,u=u*5+3864292196);switch(a=0,r){case 3:a^=e[i*4+2]<<16;case 2:a^=e[i*4+1]<<8;case 1:a^=e[i*4],a=a*h&je|a*f&dn,a=a<<15|a>>>17,a=a*d&je|a*m&dn,i&1?l^=a:u^=a}this.h1=l,this.h2=u}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&je|t*36045&dn,e=e*4283543511&je|((e<<16|t>>>16)*2950163797&je)>>>16,t^=e>>>1,t=t*444984403&je|t*60499&dn,e=e*3301882366&je|((e<<16|t>>>16)*3120437893&je)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const Ud=Object.freeze({map:null,hash:"",transfer:void 0});class Vp{#t=!1;#e=null;#s=null;#n=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const s=this.#n.get(t);return s===void 0?e:Object.assign(e,s)}getRawValue(t){return this.#n.get(t)}remove(t){const e=this.#n.get(t);if(e!==void 0&&(e instanceof W&&this.#s.delete(e.annotationElementId),this.#n.delete(t),this.#n.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const s of this.#n.values())if(s instanceof W)return;this.onAnnotationEditor(null)}}setValue(t,e){const s=this.#n.get(t);let i=!1;if(s!==void 0)for(const[r,o]of Object.entries(e))s[r]!==o&&(i=!0,s[r]=o);else i=!0,this.#n.set(t,e);i&&this.#o(),e instanceof W&&((this.#s||=new Map).set(e.annotationElementId,e),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type))}has(t){return this.#n.has(t)}get size(){return this.#n.size}#o(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new x1(this)}get serializable(){if(this.#n.size===0)return Ud;const t=new Map,e=new E1,s=[],i=Object.create(null);let r=!1;for(const[o,a]of this.#n){const c=a instanceof W?a.serialize(!1,i):a;c&&(t.set(o,c),e.update(`${o}:${JSON.stringify(c)}`),r||=!!c.bitmap)}if(r)for(const o of t.values())o.bitmap&&s.push(o.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:s}:Ud}get editorStats(){let t=null;const e=new Map;let s=0,i=0;for(const r of this.#n.values()){if(!(r instanceof W)){r.popup&&(r.popup.deleted?i+=1:s+=1);continue}r.isCommentDeleted?i+=1:r.hasEditedComment&&(s+=1);const o=r.telemetryFinalData;if(!o)continue;const{type:a}=o;e.has(a)||e.set(a,Object.getPrototypeOf(r).constructor),t||=Object.create(null);const c=t[a]||=new Map;for(const[l,u]of Object.entries(o)){if(l==="type")continue;let h=c.get(l);h||(h=new Map,c.set(l,h));const d=h.get(u)??0;h.set(u,d+1)}}if((i>0||s>0)&&(t||=Object.create(null),t.comments={deleted:i,edited:s}),!t)return null;for(const[r,o]of e)t[r]=o.computeTelemetryFinalData(t[r]);return t}resetModifiedIds(){this.#e=null}updateEditor(t,e){const s=this.#s?.get(t);return s?(s.updateFromAnnotationLayer(e),!0):!1}getEditor(t){return this.#s?.get(t)||null}get modifiedIds(){if(this.#e)return this.#e;const t=[];if(this.#s)for(const e of this.#s.values())e.serialize()&&t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#n.entries()}}class x1 extends Vp{#t;constructor(t){super();const{map:e,hash:s,transfer:i}=t.serializable,r=structuredClone(e,i?{transfer:i}:null);this.#t={map:r,hash:s,transfer:i}}get print(){_t("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return Q(this,"modifiedIds",{ids:new Set,hash:""})}}class gB{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:s}){if(!(!t||this.#t.has(t.loadedName))){if(ct(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:r,style:o}=t,a=new FontFace(i,r,o);this.addNativeFontFace(a);try{await a.load(),this.#t.add(i),s?.(t)}catch{J(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}_t("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const s=t.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw J(`Failed to load font '${s.family}': '${i}'.`),t.disableFontFace=!0,i}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(t,i)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return Q(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return Q(this,"isSyncFontLoadingSupported",ge||ce.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(ct(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const r=s.shift();setTimeout(r.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:e,callback:t};return s.push(i),i}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Q(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function s(w,v){return w.charCodeAt(v)<<24|w.charCodeAt(v+1)<<16|w.charCodeAt(v+2)<<8|w.charCodeAt(v+3)&255}function i(w,v,A,S){const T=w.substring(0,v),E=w.substring(v+A);return T+S+E}let r,o;const a=this._document.createElement("canvas");a.width=1,a.height=1;const c=a.getContext("2d");let l=0;function u(w,v){if(++l>30){J("Load test font never loaded."),v();return}if(c.font="30px "+w,c.fillText(".",0,20),c.getImageData(0,0,1,1).data[3]>0){v();return}setTimeout(u.bind(null,w,v))}const h=`lt${Date.now()}${this.loadTestFontId++}`;let d=this._loadTestFont;d=i(d,976,h.length,h);const m=16,p=1482184792;let g=s(d,m);for(r=0,o=h.length-3;r<o;r+=4)g=g-p+s(h,r)|0;r<h.length&&(g=g-p+s(h+"XXX",r)|0),d=i(d,m,4,K2(g));const y=`url(data:font/opentype;base64,${btoa(d)});`,_=`@font-face {font-family:"${h}";src:${y}}`;this.insertRule(_);const b=this._document.createElement("div");b.style.visibility="hidden",b.style.width=b.style.height="10px",b.style.position="absolute",b.style.top=b.style.left="0px";for(const w of[t.loadedName,h]){const v=this._document.createElement("span");v.textContent="Hi",v.style.fontFamily=w,b.append(v)}this._document.body.append(b),u(h,()=>{b.remove(),e.complete()})}}class yB{#t;constructor(t,e=null,s,i){this.compiledGlyphs=Object.create(null),this.#t=t,this._inspectFont=e,s&&Object.assign(this,s),i&&(this.charProcOperatorList=i)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${w1(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const s=this.loadedName+"_path_"+e;let i;try{i=t.get(s)}catch(o){J(`getPathGenerator - ignoring character: "${o}".`)}const r=S1(i);return this.fontExtraProperties||t.delete(s),this.compiledGlyphs[e]=r}get black(){return this.#t.black}get bold(){return this.#t.bold}get disableFontFace(){return this.#t.disableFontFace??!1}set disableFontFace(t){Q(this,"disableFontFace",!!t)}get fontExtraProperties(){return this.#t.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#t.isInvalidPDFjsFont}get isType3Font(){return this.#t.isType3Font}get italic(){return this.#t.italic}get missingFile(){return this.#t.missingFile}get remeasure(){return this.#t.remeasure}get vertical(){return this.#t.vertical}get ascent(){return this.#t.ascent}get defaultWidth(){return this.#t.defaultWidth}get descent(){return this.#t.descent}get bbox(){return this.#t.bbox}set bbox(t){Q(this,"bbox",t)}get fontMatrix(){return this.#t.fontMatrix}get fallbackName(){return this.#t.fallbackName}get loadedName(){return this.#t.loadedName}get mimetype(){return this.#t.mimetype}get name(){return this.#t.name}get data(){return this.#t.data}clearData(){this.#t.clearData()}get cssFontInfo(){return this.#t.cssFontInfo}get systemFontInfo(){return this.#t.systemFontInfo}get defaultVMetrics(){return this.#t.defaultVMetrics}}class wi{#t;#e;#s;static strings=["fontFamily","fontWeight","italicAngle"];static write(t){const e=new TextEncoder,s={};let i=0;for(const l of wi.strings){const u=e.encode(t[l]);s[l]=u,i+=4+u.length}const r=new ArrayBuffer(i),o=new Uint8Array(r),a=new DataView(r);let c=0;for(const l of wi.strings){const u=s[l],h=u.length;a.setUint32(c,h),o.set(u,c+4),c+=4+h}return ct(c===r.byteLength,"CssFontInfo.write: Buffer overflow"),r}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#s=new TextDecoder}#n(t){ct(t<wi.strings.length,"Invalid string index");let e=0;for(let i=0;i<t;i++)e+=this.#e.getUint32(e)+4;const s=this.#e.getUint32(e);return this.#s.decode(new Uint8Array(this.#t,e+4,s))}get fontFamily(){return this.#n(0)}get fontWeight(){return this.#n(1)}get italicAngle(){return this.#n(2)}}class vi{#t;#e;#s;static strings=["css","loadedName","baseFontName","src"];static write(t){const e=new TextEncoder,s={};let i=0;for(const d of vi.strings){const f=e.encode(t[d]);s[d]=f,i+=4+f.length}i+=4;let r,o,a=1+i;t.style&&(r=e.encode(t.style.style),o=e.encode(t.style.weight),a+=4+r.length+4+o.length);const c=new ArrayBuffer(a),l=new Uint8Array(c),u=new DataView(c);let h=0;u.setUint8(h++,t.guessFallback?1:0),u.setUint32(h,0),h+=4,i=0;for(const d of vi.strings){const f=s[d],m=f.length;i+=4+m,u.setUint32(h,m),l.set(f,h+4),h+=4+m}return u.setUint32(h-i-4,i),t.style&&(u.setUint32(h,r.length),l.set(r,h+4),h+=4+r.length,u.setUint32(h,o.length),l.set(o,h+4),h+=4+o.length),ct(h<=c.byteLength,"SubstitionInfo.write: Buffer overflow"),c.transferToFixedLength(h)}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#s=new TextDecoder}get guessFallback(){return this.#e.getUint8(0)!==0}#n(t){ct(t<vi.strings.length,"Invalid string index");let e=5;for(let i=0;i<t;i++)e+=this.#e.getUint32(e)+4;const s=this.#e.getUint32(e);return this.#s.decode(new Uint8Array(this.#t,e+4,s))}get css(){return this.#n(0)}get loadedName(){return this.#n(1)}get baseFontName(){return this.#n(2)}get src(){return this.#n(3)}get style(){let t=1;t+=4+this.#e.getUint32(t);const e=this.#e.getUint32(t),s=this.#s.decode(new Uint8Array(this.#t,t+4,e));t+=4+e;const i=this.#e.getUint32(t),r=this.#s.decode(new Uint8Array(this.#t,t+4,i));return{style:s,weight:r}}}class gt{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#t=Math.ceil(this.bools.length*2/8);static#e=this.#t+this.numbers.length*8;static#s=this.#e+1+8;static#n=this.#s+1+48;static#o=this.#n+1+6;#r;#i;#a;constructor({data:t,extra:e}){this.#r=t,this.#i=new TextDecoder,this.#a=new DataView(this.#r),e&&Object.assign(this,e)}#l(t){ct(t<gt.bools.length,"Invalid boolean index");const e=Math.floor(t/4),s=t*2%8,i=this.#a.getUint8(e)>>s&3;return i===0?void 0:i===2}get black(){return this.#l(0)}get bold(){return this.#l(1)}get disableFontFace(){return this.#l(2)}get fontExtraProperties(){return this.#l(3)}get isInvalidPDFjsFont(){return this.#l(4)}get isType3Font(){return this.#l(5)}get italic(){return this.#l(6)}get missingFile(){return this.#l(7)}get remeasure(){return this.#l(8)}get vertical(){return this.#l(9)}#c(t){return ct(t<gt.numbers.length,"Invalid number index"),this.#a.getFloat64(gt.#t+t*8)}get ascent(){return this.#c(0)}get defaultWidth(){return this.#c(1)}get descent(){return this.#c(2)}get bbox(){let t=gt.#e;if(this.#a.getUint8(t)===0)return;t+=1;const s=[];for(let i=0;i<4;i++)s.push(this.#a.getInt16(t,!0)),t+=2;return s}get fontMatrix(){let t=gt.#s;if(this.#a.getUint8(t)===0)return;t+=1;const s=[];for(let i=0;i<6;i++)s.push(this.#a.getFloat64(t,!0)),t+=8;return s}get defaultVMetrics(){let t=gt.#n;if(this.#a.getUint8(t)===0)return;t+=1;const s=[];for(let i=0;i<3;i++)s.push(this.#a.getInt16(t,!0)),t+=2;return s}#d(t){ct(t<gt.strings.length,"Invalid string index");let e=gt.#o+4;for(let r=0;r<t;r++)e+=this.#a.getUint32(e)+4;const s=this.#a.getUint32(e),i=new Uint8Array(s);return i.set(new Uint8Array(this.#r,e+4,s)),this.#i.decode(i)}get fallbackName(){return this.#d(0)}get loadedName(){return this.#d(1)}get mimetype(){return this.#d(2)}get name(){return this.#d(3)}get data(){let t=gt.#o;const e=this.#a.getUint32(t);t+=4+e;const s=this.#a.getUint32(t);t+=4+s;const i=this.#a.getUint32(t);t+=4+i;const r=this.#a.getUint32(t);if(r!==0)return new Uint8Array(this.#r,t+4,r)}clearData(){let t=gt.#o;const e=this.#a.getUint32(t);t+=4+e;const s=this.#a.getUint32(t);t+=4+s;const i=this.#a.getUint32(t);t+=4+i;const r=this.#a.getUint32(t);new Uint8Array(this.#r,t+4,r).fill(0),this.#a.setUint32(t,0)}get cssFontInfo(){let t=gt.#o;const e=this.#a.getUint32(t);t+=4+e;const s=this.#a.getUint32(t);t+=4+s;const i=this.#a.getUint32(t);if(i===0)return null;const r=new Uint8Array(i);return r.set(new Uint8Array(this.#r,t+4,i)),new wi(r.buffer)}get systemFontInfo(){let t=gt.#o;const e=this.#a.getUint32(t);t+=4+e;const s=this.#a.getUint32(t);if(s===0)return null;const i=new Uint8Array(s);return i.set(new Uint8Array(this.#r,t+4,s)),new vi(i.buffer)}static write(t){const e=t.systemFontInfo?vi.write(t.systemFontInfo):null,s=t.cssFontInfo?wi.write(t.cssFontInfo):null,i=new TextEncoder,r={};let o=0;for(const p of gt.strings)r[p]=i.encode(t[p]),o+=4+r[p].length;const a=gt.#o+4+o+4+(e?e.byteLength:0)+4+(s?s.byteLength:0)+4+(t.data?t.data.length:0),c=new ArrayBuffer(a),l=new Uint8Array(c),u=new DataView(c);let h=0;const d=gt.bools.length;let f=0,m=0;for(let p=0;p<d;p++){const g=t[gt.bools[p]];f|=(g===void 0?0:g?2:1)<<m,m+=2,(m===8||p===d-1)&&(u.setUint8(h++,f),f=0,m=0)}ct(h===gt.#t,"FontInfo.write: Boolean properties offset mismatch");for(const p of gt.numbers)u.setFloat64(h,t[p]),h+=8;if(ct(h===gt.#e,"FontInfo.write: Number properties offset mismatch"),t.bbox){u.setUint8(h++,4);for(const p of t.bbox)u.setInt16(h,p,!0),h+=2}else u.setUint8(h++,0),h+=8;if(ct(h===gt.#s,"FontInfo.write: BBox properties offset mismatch"),t.fontMatrix){u.setUint8(h++,6);for(const p of t.fontMatrix)u.setFloat64(h,p,!0),h+=8}else u.setUint8(h++,0),h+=48;if(ct(h===gt.#n,"FontInfo.write: FontMatrix properties offset mismatch"),t.defaultVMetrics){u.setUint8(h++,1);for(const p of t.defaultVMetrics)u.setInt16(h,p,!0),h+=2}else u.setUint8(h++,0),h+=6;ct(h===gt.#o,"FontInfo.write: DefaultVMetrics properties offset mismatch"),u.setUint32(gt.#o,0),h+=4;for(const p of gt.strings){const g=r[p],y=g.length;u.setUint32(h,y),l.set(g,h+4),h+=4+y}if(u.setUint32(gt.#o,h-gt.#o-4),!e)u.setUint32(h,0),h+=4;else{const p=e.byteLength;u.setUint32(h,p),ct(h+4+p<=c.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),l.set(new Uint8Array(e),h+4),h+=4+p}if(!s)u.setUint32(h,0),h+=4;else{const p=s.byteLength;u.setUint32(h,p),ct(h+4+p<=c.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),l.set(new Uint8Array(s),h+4),h+=4+p}return t.data===void 0?(u.setUint32(h,0),h+=4):(u.setUint32(h,t.data.length),l.set(t.data,h+4),h+=4+t.data.length),ct(h<=c.byteLength,"FontInfo.write: Buffer overflow"),c.transferToFixedLength(h)}}class Gt{static#t=0;static#e=1;static#s=2;static#n=3;static#o=4;static#r=8;static#i=12;static#a=16;constructor(t){this.buffer=t,this.view=new DataView(t),this.data=new Uint8Array(t)}static write(t){let e,s=null,i=[],r=[],o=[],a=[],c=null,l=null;switch(t[0]){case"RadialAxial":e=t[1]==="axial"?1:2,s=t[2],o=t[3],e===1?i.push(...t[4],...t[5]):i.push(t[4][0],t[4][1],t[6],t[5][0],t[5][1],t[7]);break;case"Mesh":e=3,c=t[1],i=t[2],r=t[3],a=t[4]||[],s=t[6],l=t[7];break;default:throw new Error(`Unsupported pattern type: ${t[0]}`)}const u=Math.floor(i.length/2),h=Math.floor(r.length/3),d=o.length,f=a.length;let m=0;for(const v of a)m+=1,m=Math.ceil(m/4)*4,m+=4+v.coords.length*4,m+=4+v.colors.length*4,v.verticesPerRow!==void 0&&(m+=4);const p=20+u*8+h*3+d*8+(s?16:0)+(l?3:0)+m,g=new ArrayBuffer(p),y=new DataView(g),_=new Uint8Array(g);y.setUint8(Gt.#t,e),y.setUint8(Gt.#e,s?1:0),y.setUint8(Gt.#s,l?1:0),y.setUint8(Gt.#n,c),y.setUint32(Gt.#o,u,!0),y.setUint32(Gt.#r,h,!0),y.setUint32(Gt.#i,d,!0),y.setUint32(Gt.#a,f,!0);let b=20;new Float32Array(g,b,u*2).set(i),b+=u*8,_.set(r,b),b+=h*3;for(const[v,A]of o)y.setFloat32(b,v,!0),b+=4,y.setUint32(b,parseInt(A.slice(1),16),!0),b+=4;if(s)for(const v of s)y.setFloat32(b,v,!0),b+=4;l&&(_.set(l,b),b+=3);for(let v=0;v<a.length;v++){const A=a[v];y.setUint8(b,A.type),b+=1,b=Math.ceil(b/4)*4,y.setUint32(b,A.coords.length,!0),b+=4,new Int32Array(g,b,A.coords.length).set(A.coords),b+=A.coords.length*4,y.setUint32(b,A.colors.length,!0),b+=4,new Int32Array(g,b,A.colors.length).set(A.colors),b+=A.colors.length*4,A.verticesPerRow!==void 0&&(y.setUint32(b,A.verticesPerRow,!0),b+=4)}return g}getIR(){const t=this.view,e=this.data[Gt.#t],s=!!this.data[Gt.#e],i=!!this.data[Gt.#s],r=t.getUint32(Gt.#o,!0),o=t.getUint32(Gt.#r,!0),a=t.getUint32(Gt.#i,!0),c=t.getUint32(Gt.#a,!0);let l=20;const u=new Float32Array(this.buffer,l,r*2);l+=r*8;const h=new Uint8Array(this.buffer,l,o*3);l+=o*3;const d=[];for(let g=0;g<a;++g){const y=t.getFloat32(l,!0);l+=4;const _=t.getUint32(l,!0);l+=4,d.push([y,`#${_.toString(16).padStart(6,"0")}`])}let f=null;if(s){f=[];for(let g=0;g<4;++g)f.push(t.getFloat32(l,!0)),l+=4}let m=null;i&&(m=new Uint8Array(this.buffer,l,3),l+=3);const p=[];for(let g=0;g<c;++g){const y=t.getUint8(l);l+=1,l=Math.ceil(l/4)*4;const _=t.getUint32(l,!0);l+=4;const b=new Int32Array(this.buffer,l,_);l+=_*4;const w=t.getUint32(l,!0);l+=4;const v=new Int32Array(this.buffer,l,w);l+=w*4;const A={type:y,coords:b,colors:v};y===Ld.LATTICE&&(A.verticesPerRow=t.getUint32(l,!0),l+=4),p.push(A)}if(e===1)return["RadialAxial","axial",f,d,Array.from(u.slice(0,2)),Array.from(u.slice(2,4)),null,null];if(e===2)return["RadialAxial","radial",f,d,[u[0],u[1]],[u[3],u[4]],u[2],u[5]];if(e===3){const g=this.data[Gt.#n];let y=null;if(u.length>0){let _=u[0],b=u[0],w=u[1],v=u[1];for(let A=0;A<u.length;A+=2){const S=u[A],T=u[A+1];_=_>S?S:_,w=w>T?T:w,b=b<S?S:b,v=v<T?T:v}y=[_,w,b,v]}return["Mesh",g,u,h,p,y,f,m]}throw new Error(`Unsupported pattern kind: ${e}`)}}function bB(n){if(n instanceof URL)return n.href;if(typeof n=="string"){if(ge)return n;const t=URL.parse(n,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function _B(n){if(ge&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return yo(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n?.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Ho(n){if(typeof n!="string")return null;if(n.endsWith("/"))return n;throw new Error(`Invalid factory url: "${n}" must include trailing slash.`)}const jd=n=>typeof n=="object"&&Number.isInteger(n?.num)&&n.num>=0&&Number.isInteger(n?.gen)&&n.gen>=0,wB=n=>typeof n=="object"&&typeof n?.name=="string",vB=eB.bind(null,jd,wB);class AB{#t=new Map;#e=Promise.resolve();postMessage(t,e){const s={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(const[i]of this.#t)i.call(this,s)})}addEventListener(t,e,s=null){let i=null;if(s?.signal instanceof AbortSignal){const{signal:r}=s;if(r.aborted){J("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(t,e);i=()=>r.removeEventListener("abort",o),r.addEventListener("abort",o)}this.#t.set(e,i)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(const[,t]of this.#t)t?.();this.#t.clear()}}const qo={DATA:1,ERROR:2},Lt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function t_(){}function Ae(n){if(n instanceof ns||n instanceof Nd||n instanceof Wb||n instanceof uc||n instanceof ph)return n;switch(n instanceof Error||typeof n=="object"&&n!==null||_t('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new ns(n.message);case"InvalidPDFException":return new Nd(n.message);case"PasswordException":return new Wb(n.message,n.code);case"ResponseException":return new uc(n.message,n.status,n.missing);case"UnknownErrorException":return new ph(n.message,n.details)}return new ph(n.message,n.toString())}class cr{#t=new AbortController;constructor(t,e,s){this.sourceName=t,this.targetName=e,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#n(t);return}if(t.callback){const s=t.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],t.callback===qo.DATA)i.resolve(t.data);else if(t.callback===qo.ERROR)i.reject(Ae(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const s=this.sourceName,i=t.sourceName,r=this.comObj;Promise.try(e,t.data).then(function(o){r.postMessage({sourceName:s,targetName:i,callback:qo.DATA,callbackId:t.callbackId,data:o})},function(o){r.postMessage({sourceName:s,targetName:i,callback:qo.ERROR,callbackId:t.callbackId,reason:Ae(o)})});return}if(t.streamId){this.#s(t);return}e(t.data)}on(t,e){const s=this.actionHandler;if(s[t])throw new Error(`There is already an actionName called "${t}"`);s[t]=e}send(t,e,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},s)}sendWithPromise(t,e,s){const i=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[i]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},s)}catch(o){r.reject(o)}return r.promise}sendWithStream(t,e,s,i){const r=this.streamId++,o=this.sourceName,a=this.targetName,c=this.comObj;return new ReadableStream({start:l=>{const u=Promise.withResolvers();return this.streamControllers[r]={controller:l,startCall:u,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:o,targetName:a,action:t,streamId:r,data:e,desiredSize:l.desiredSize},i),u.promise},pull:l=>{const u=Promise.withResolvers();return this.streamControllers[r].pullCall=u,c.postMessage({sourceName:o,targetName:a,stream:Lt.PULL,streamId:r,desiredSize:l.desiredSize}),u.promise},cancel:l=>{ct(l instanceof Error,"cancel must have a valid reason");const u=Promise.withResolvers();return this.streamControllers[r].cancelCall=u,this.streamControllers[r].isClosed=!0,c.postMessage({sourceName:o,targetName:a,stream:Lt.CANCEL,streamId:r,reason:Ae(l)}),u.promise}},s)}#s(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,r=this.comObj,o=this,a=this.actionHandler[t.action],c={enqueue(l,u=1,h){if(this.isCancelled)return;const d=this.desiredSize;this.desiredSize-=u,d>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:s,targetName:i,stream:Lt.ENQUEUE,streamId:e,chunk:l},h)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:Lt.CLOSE,streamId:e}),delete o.streamSinks[e])},error(l){ct(l instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:Lt.ERROR,streamId:e,reason:Ae(l)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};c.sinkCapability.resolve(),c.ready=c.sinkCapability.promise,this.streamSinks[e]=c,Promise.try(a,t.data,c).then(function(){r.postMessage({sourceName:s,targetName:i,stream:Lt.START_COMPLETE,streamId:e,success:!0})},function(l){r.postMessage({sourceName:s,targetName:i,stream:Lt.START_COMPLETE,streamId:e,reason:Ae(l)})})}#n(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,r=this.comObj,o=this.streamControllers[e],a=this.streamSinks[e];switch(t.stream){case Lt.START_COMPLETE:t.success?o.startCall.resolve():o.startCall.reject(Ae(t.reason));break;case Lt.PULL_COMPLETE:t.success?o.pullCall.resolve():o.pullCall.reject(Ae(t.reason));break;case Lt.PULL:if(!a){r.postMessage({sourceName:s,targetName:i,stream:Lt.PULL_COMPLETE,streamId:e,success:!0});break}a.desiredSize<=0&&t.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=t.desiredSize,Promise.try(a.onPull||t_).then(function(){r.postMessage({sourceName:s,targetName:i,stream:Lt.PULL_COMPLETE,streamId:e,success:!0})},function(l){r.postMessage({sourceName:s,targetName:i,stream:Lt.PULL_COMPLETE,streamId:e,reason:Ae(l)})});break;case Lt.ENQUEUE:if(ct(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(t.chunk);break;case Lt.CLOSE:if(ct(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),this.#o(o,e);break;case Lt.ERROR:ct(o,"error should have stream controller"),o.controller.error(Ae(t.reason)),this.#o(o,e);break;case Lt.CANCEL_COMPLETE:t.success?o.cancelCall.resolve():o.cancelCall.reject(Ae(t.reason)),this.#o(o,e);break;case Lt.CANCEL:if(!a)break;const c=Ae(t.reason);Promise.try(a.onCancel||t_,c).then(function(){r.postMessage({sourceName:s,targetName:i,stream:Lt.CANCEL_COMPLETE,streamId:e,success:!0})},function(l){r.postMessage({sourceName:s,targetName:i,stream:Lt.CANCEL_COMPLETE,streamId:e,reason:Ae(l)})}),a.sinkCapability.reject(c),a.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#o(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#t?.abort(),this.#t=null}}class C1{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(t,e);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,s){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||s<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=s}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){_t("Abstract method `_createCanvas` called.")}}class SB extends C1{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const s=this._document.createElement("canvas");return s.width=t,s.height=e,s}}class P1{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){_t("Abstract method `_fetch` called.")}}class e_ extends P1{async _fetch(t){const e=await bo(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):yo(e)}}class k1{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,s,i,r){return"none"}destroy(t=!1){}}class TB extends k1{#t;#e;#s;#n;#o;#r;#i=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#n=t,this.#o=e}get#a(){return this.#e||=new Map}get#l(){return this.#r||=new Map}get#c(){if(!this.#s){const t=this.#o.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const s=this.#o.createElementNS(Pn,"svg");s.setAttribute("width",0),s.setAttribute("height",0),this.#s=this.#o.createElementNS(Pn,"defs"),t.append(s),s.append(this.#s),this.#o.body.append(t)}return this.#s}#d(t){if(t.length===1){const c=t[0],l=new Array(256);for(let h=0;h<256;h++)l[h]=c[h]/255;const u=l.join(",");return[u,u,u]}const[e,s,i]=t,r=new Array(256),o=new Array(256),a=new Array(256);for(let c=0;c<256;c++)r[c]=e[c]/255,o[c]=s[c]/255,a[c]=i[c]/255;return[r.join(","),o.join(","),a.join(",")]}#h(t){if(this.#t===void 0){this.#t="";const e=this.#o.URL;e!==this.#o.baseURI&&(el(e)?J('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=y1(e,""))}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#a.get(t);if(e)return e;const[s,i,r]=this.#d(t),o=t.length===1?s:`${s}${i}${r}`;if(e=this.#a.get(o),e)return this.#a.set(t,e),e;const a=`g_${this.#n}_transfer_map_${this.#i++}`,c=this.#h(a);this.#a.set(t,c),this.#a.set(o,c);const l=this.#m(a);return this.#p(s,i,r,l),c}addHCMFilter(t,e){const s=`${t}-${e}`,i="base";let r=this.#l.get(i);if(r?.key===s||(r?(r.filter?.remove(),r.key=s,r.url="none",r.filter=null):(r={key:s,url:"none",filter:null},this.#l.set(i,r)),!t||!e))return r.url;const o=this.#_(t);t=U.makeHexColor(...o);const a=this.#_(e);if(e=U.makeHexColor(...a),this.#c.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return r.url;const c=new Array(256);for(let f=0;f<=255;f++){const m=f/255;c[f]=m<=.03928?m/12.92:((m+.055)/1.055)**2.4}const l=c.join(","),u=`g_${this.#n}_hcm_filter`,h=r.filter=this.#m(u);this.#p(l,l,l,h),this.#g(h);const d=(f,m)=>{const p=o[f]/255,g=a[f]/255,y=new Array(m+1);for(let _=0;_<=m;_++)y[_]=p+_/m*(g-p);return y.join(",")};return this.#p(d(0,5),d(1,5),d(2,5),h),r.url=this.#h(u),r.url}addAlphaFilter(t){let e=this.#a.get(t);if(e)return e;const[s]=this.#d([t]),i=`alpha_${s}`;if(e=this.#a.get(i),e)return this.#a.set(t,e),e;const r=`g_${this.#n}_alpha_map_${this.#i++}`,o=this.#h(r);this.#a.set(t,o),this.#a.set(i,o);const a=this.#m(r);return this.#y(s,a),o}addLuminosityFilter(t){let e=this.#a.get(t||"luminosity");if(e)return e;let s,i;if(t?([s]=this.#d([t]),i=`luminosity_${s}`):i="luminosity",e=this.#a.get(i),e)return this.#a.set(t,e),e;const r=`g_${this.#n}_luminosity_map_${this.#i++}`,o=this.#h(r);this.#a.set(t,o),this.#a.set(i,o);const a=this.#m(r);return this.#f(a),t&&this.#y(s,a),o}addHighlightHCMFilter(t,e,s,i,r){const o=`${e}-${s}-${i}-${r}`;let a=this.#l.get(t);if(a?.key===o||(a?(a.filter?.remove(),a.key=o,a.url="none",a.filter=null):(a={key:o,url:"none",filter:null},this.#l.set(t,a)),!e||!s))return a.url;const[c,l]=[e,s].map(this.#_.bind(this));let u=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),h=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),[d,f]=[i,r].map(this.#_.bind(this));h<u&&([u,h,d,f]=[h,u,f,d]),this.#c.style.color="";const m=(y,_,b)=>{const w=new Array(256),v=(h-u)/b,A=y/255,S=(_-y)/(255*b);let T=0;for(let E=0;E<=b;E++){const P=Math.round(u+E*v),x=A+E*S;for(let I=T;I<=P;I++)w[I]=x;T=P+1}for(let E=T;E<256;E++)w[E]=w[T-1];return w.join(",")},p=`g_${this.#n}_hcm_${t}_filter`,g=a.filter=this.#m(p);return this.#g(g),this.#p(m(d[0],f[0],5),m(d[1],f[1],5),m(d[2],f[2],5),g),a.url=this.#h(p),a.url}destroy(t=!1){t&&this.#r?.size||(this.#s?.parentNode.parentNode.remove(),this.#s=null,this.#e?.clear(),this.#e=null,this.#r?.clear(),this.#r=null,this.#i=0)}#f(t){const e=this.#o.createElementNS(Pn,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#g(t){const e=this.#o.createElementNS(Pn,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#m(t){const e=this.#o.createElementNS(Pn,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#c.append(e),e}#u(t,e,s){const i=this.#o.createElementNS(Pn,e);i.setAttribute("type","discrete"),i.setAttribute("tableValues",s),t.append(i)}#p(t,e,s,i){const r=this.#o.createElementNS(Pn,"feComponentTransfer");i.append(r),this.#u(r,"feFuncR",t),this.#u(r,"feFuncG",e),this.#u(r,"feFuncB",s)}#y(t,e){const s=this.#o.createElementNS(Pn,"feComponentTransfer");e.append(s),this.#u(s,"feFuncA",t)}#_(t){return this.#c.style.color=t,wo(getComputedStyle(this.#c).getPropertyValue("color"))}}class M1{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){_t("Abstract method `_fetch` called.")}}class n_ extends M1{async _fetch(t){const e=await bo(t,"arraybuffer");return new Uint8Array(e)}}class R1{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){_t("Abstract method `_fetch` called.")}}class s_ extends R1{async _fetch(t){const e=await bo(t,"arraybuffer");return new Uint8Array(e)}}ge&&J("Please use the `legacy` build in Node.js environments.");async function Hp(n){const e=await process.getBuiltinModule("fs").promises.readFile(n);return new Uint8Array(e)}class EB extends k1{}class xB extends C1{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class CB extends P1{async _fetch(t){return Hp(t)}}class PB extends M1{async _fetch(t){return Hp(t)}}class kB extends R1{async _fetch(t){return Hp(t)}}const Ks="__forcedDependency",{floor:i_,ceil:r_}=Math;function Wo(n,t,e,s,i,r){n[t*4+0]=Math.min(n[t*4+0],e),n[t*4+1]=Math.min(n[t*4+1],s),n[t*4+2]=Math.max(n[t*4+2],i),n[t*4+3]=Math.max(n[t*4+3],r)}const zd=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class MB{#t;#e;constructor(t,e){this.#t=t,this.#e=e}get length(){return this.#t.length}isEmpty(t){return this.#t[t]===zd}minX(t){return this.#e[t*4+0]/256}minY(t){return this.#e[t*4+1]/256}maxX(t){return(this.#e[t*4+2]+1)/256}maxY(t){return(this.#e[t*4+3]+1)/256}}const Go=(n,t)=>{if(!n)return;let e=n.get(t);return e||(e={dependencies:new Set,isRenderingOperation:!1},n.set(t,e)),e};class RB{#t={__proto__:null};#e={__proto__:null,transform:[],moveText:[],sameLineText:[],[Ks]:[]};#s=new Map;#n=[];#o=[];#r=[[1,0,0,1,0,0]];#i=[-1/0,-1/0,1/0,1/0];#a=new Float64Array([1/0,1/0,-1/0,-1/0]);#l=-1;#c=new Set;#d=new Map;#h=new Map;#f;#g;#m;#u;#p;constructor(t,e,s=!1){this.#f=t.width,this.#g=t.height,this.#y(e),s&&(this.#p=new Map)}growOperationsCount(t){t>=this.#u.length&&this.#y(t,this.#u)}#y(t,e){const s=new ArrayBuffer(t*4);this.#m=new Uint8ClampedArray(s),this.#u=new Uint32Array(s),e&&e.length>0?(this.#u.set(e),this.#u.fill(zd,e.length)):this.#u.fill(zd)}save(t){return this.#t={__proto__:this.#t},this.#e={__proto__:this.#e,transform:{__proto__:this.#e.transform},moveText:{__proto__:this.#e.moveText},sameLineText:{__proto__:this.#e.sameLineText},[Ks]:{__proto__:this.#e[Ks]}},this.#i={__proto__:this.#i},this.#n.push(t),this}restore(t){const e=Object.getPrototypeOf(this.#t);if(e===null)return this;this.#t=e,this.#e=Object.getPrototypeOf(this.#e),this.#i=Object.getPrototypeOf(this.#i);const s=this.#n.pop();return s!==void 0&&(Go(this.#p,t)?.dependencies.add(s),this.#u[t]=this.#u[s]),this}recordOpenMarker(t){return this.#n.push(t),this}getOpenMarker(){return this.#n.length===0?null:this.#n.at(-1)}recordCloseMarker(t){const e=this.#n.pop();return e!==void 0&&(Go(this.#p,t)?.dependencies.add(e),this.#u[t]=this.#u[e]),this}beginMarkedContent(t){return this.#o.push(t),this}endMarkedContent(t){const e=this.#o.pop();return e!==void 0&&(Go(this.#p,t)?.dependencies.add(e),this.#u[t]=this.#u[e]),this}pushBaseTransform(t){return this.#r.push(U.multiplyByDOMMatrix(this.#r.at(-1),t.getTransform())),this}popBaseTransform(){return this.#r.length>1&&this.#r.pop(),this}recordSimpleData(t,e){return this.#t[t]=e,this}recordIncrementalData(t,e){return this.#e[t].push(e),this}resetIncrementalData(t,e){return this.#e[t].length=0,this}recordNamedData(t,e){return this.#s.set(t,e),this}recordSimpleDataFromNamed(t,e,s){this.#t[t]=this.#s.get(e)??s}recordFutureForcedDependency(t,e){return this.recordIncrementalData(Ks,e),this}inheritSimpleDataAsFutureForcedDependencies(t){for(const e of t)e in this.#t&&this.recordFutureForcedDependency(e,this.#t[e]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const t of this.#c)this.recordFutureForcedDependency(Ks,t);return this}resetBBox(t){return this.#l!==t&&(this.#l=t,this.#a[0]=1/0,this.#a[1]=1/0,this.#a[2]=-1/0,this.#a[3]=-1/0),this}recordClipBox(t,e,s,i,r,o){const a=U.multiplyByDOMMatrix(this.#r.at(-1),e.getTransform()),c=[1/0,1/0,-1/0,-1/0];U.axialAlignedBoundingBox([s,r,i,o],a,c);const l=U.intersect(this.#i,c);return l?(this.#i[0]=l[0],this.#i[1]=l[1],this.#i[2]=l[2],this.#i[3]=l[3]):(this.#i[0]=this.#i[1]=1/0,this.#i[2]=this.#i[3]=-1/0),this}recordBBox(t,e,s,i,r,o){const a=this.#i;if(a[0]===1/0)return this;const c=U.multiplyByDOMMatrix(this.#r.at(-1),e.getTransform());if(a[0]===-1/0)return U.axialAlignedBoundingBox([s,r,i,o],c,this.#a),this;const l=[1/0,1/0,-1/0,-1/0];return U.axialAlignedBoundingBox([s,r,i,o],c,l),this.#a[0]=Math.min(this.#a[0],Math.max(l[0],a[0])),this.#a[1]=Math.min(this.#a[1],Math.max(l[1],a[1])),this.#a[2]=Math.max(this.#a[2],Math.min(l[2],a[2])),this.#a[3]=Math.max(this.#a[3],Math.min(l[3],a[3])),this}recordCharacterBBox(t,e,s,i=1,r=0,o=0,a){const c=s.bbox;let l,u;if(c&&(l=c[2]!==c[0]&&c[3]!==c[1]&&this.#h.get(s),l!==!1&&(u=[0,0,0,0],U.axialAlignedBoundingBox(c,s.fontMatrix,u),(i!==1||r!==0||o!==0)&&U.scaleMinMax([i,0,0,-i,r,o],u),l)))return this.recordBBox(t,e,u[0],u[2],u[1],u[3]);if(!a)return this.recordFullPageBBox(t);const h=a();return c&&u&&l===void 0&&(l=u[0]<=r-h.actualBoundingBoxLeft&&u[2]>=r+h.actualBoundingBoxRight&&u[1]<=o-h.actualBoundingBoxAscent&&u[3]>=o+h.actualBoundingBoxDescent,this.#h.set(s,l),l)?this.recordBBox(t,e,u[0],u[2],u[1],u[3]):this.recordBBox(t,e,r-h.actualBoundingBoxLeft,r+h.actualBoundingBoxRight,o-h.actualBoundingBoxAscent,o+h.actualBoundingBoxDescent)}recordFullPageBBox(t){return this.#a[0]=Math.max(0,this.#i[0]),this.#a[1]=Math.max(0,this.#i[1]),this.#a[2]=Math.min(this.#f,this.#i[2]),this.#a[3]=Math.min(this.#g,this.#i[3]),this}getSimpleIndex(t){return this.#t[t]}recordDependencies(t,e){const s=this.#c,i=this.#t,r=this.#e;for(const o of e)o in this.#t?s.add(i[o]):o in r&&r[o].forEach(s.add,s);return this}recordNamedDependency(t,e){return this.#s.has(e)&&this.#c.add(this.#s.get(e)),this}recordOperation(t,e=!1){if(this.recordDependencies(t,[Ks]),this.#p){const s=Go(this.#p,t),{dependencies:i}=s;this.#c.forEach(i.add,i),this.#n.forEach(i.add,i),this.#o.forEach(i.add,i),i.delete(t),s.isRenderingOperation=!0}if(this.#l===t){const s=i_(this.#a[0]*256/this.#f),i=i_(this.#a[1]*256/this.#g),r=r_(this.#a[2]*256/this.#f),o=r_(this.#a[3]*256/this.#g);Wo(this.#m,t,s,i,r,o);for(const a of this.#c)a!==t&&Wo(this.#m,a,s,i,r,o);for(const a of this.#n)a!==t&&Wo(this.#m,a,s,i,r,o);for(const a of this.#o)a!==t&&Wo(this.#m,a,s,i,r,o);e||(this.#c.clear(),this.#l=-1)}return this}recordShowTextOperation(t,e=!1){const s=Array.from(this.#c);this.recordOperation(t,e),this.recordIncrementalData("sameLineText",t);for(const i of s)this.recordIncrementalData("sameLineText",i);return this}bboxToClipBoxDropOperation(t,e=!1){return this.#l===t&&(this.#l=-1,this.#i[0]=Math.max(this.#i[0],this.#a[0]),this.#i[1]=Math.max(this.#i[1],this.#a[1]),this.#i[2]=Math.min(this.#i[2],this.#a[2]),this.#i[3]=Math.min(this.#i[3],this.#a[3]),e||this.#c.clear()),this}_takePendingDependencies(){const t=this.#c;return this.#c=new Set,t}_extractOperation(t){const e=this.#d.get(t);return this.#d.delete(t),e}_pushPendingDependencies(t){for(const e of t)this.#c.add(e)}take(){return this.#h.clear(),new MB(this.#u,this.#m)}takeDebugMetadata(){return this.#p}}class hc{#t;#e;#s;#n=0;#o=0;constructor(t,e,s){if(t instanceof hc&&t.#s===!!s)return t;this.#t=t,this.#e=e,this.#s=!!s}growOperationsCount(){throw new Error("Unreachable")}save(t){return this.#o++,this.#t.save(this.#e),this}restore(t){return this.#o>0&&(this.#t.restore(this.#e),this.#o--),this}recordOpenMarker(t){return this.#n++,this}getOpenMarker(){return this.#n>0?this.#e:this.#t.getOpenMarker()}recordCloseMarker(t){return this.#n--,this}beginMarkedContent(t){return this}endMarkedContent(t){return this}pushBaseTransform(t){return this.#t.pushBaseTransform(t),this}popBaseTransform(){return this.#t.popBaseTransform(),this}recordSimpleData(t,e){return this.#t.recordSimpleData(t,this.#e),this}recordIncrementalData(t,e){return this.#t.recordIncrementalData(t,this.#e),this}resetIncrementalData(t,e){return this.#t.resetIncrementalData(t,this.#e),this}recordNamedData(t,e){return this}recordSimpleDataFromNamed(t,e,s){return this.#t.recordSimpleDataFromNamed(t,e,this.#e),this}recordFutureForcedDependency(t,e){return this.#t.recordFutureForcedDependency(t,this.#e),this}inheritSimpleDataAsFutureForcedDependencies(t){return this.#t.inheritSimpleDataAsFutureForcedDependencies(t),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#t.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(t){return this.#s||this.#t.resetBBox(this.#e),this}recordClipBox(t,e,s,i,r,o){return this.#s||this.#t.recordClipBox(this.#e,e,s,i,r,o),this}recordBBox(t,e,s,i,r,o){return this.#s||this.#t.recordBBox(this.#e,e,s,i,r,o),this}recordCharacterBBox(t,e,s,i,r,o,a){return this.#s||this.#t.recordCharacterBBox(this.#e,e,s,i,r,o,a),this}recordFullPageBBox(t){return this.#s||this.#t.recordFullPageBBox(this.#e),this}getSimpleIndex(t){return this.#t.getSimpleIndex(t)}recordDependencies(t,e){return this.#t.recordDependencies(this.#e,e),this}recordNamedDependency(t,e){return this.#t.recordNamedDependency(this.#e,e),this}recordOperation(t){return this.#t.recordOperation(this.#e,!0),this}recordShowTextOperation(t){return this.#t.recordShowTextOperation(this.#e,!0),this}bboxToClipBoxDropOperation(t){return this.#s||this.#t.bboxToClipBoxDropOperation(this.#e,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const ze={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},ae={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Vd(n,t){if(!t)return;const e=t[2]-t[0],s=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],e,s),n.clip(i)}class qp{isModifyingCurrentTransform(){return!1}getPattern(){_t("Abstract method `getPattern` called.")}}class OB extends qp{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)e.addColorStop(s[0],s[1]);return e}getPattern(t,e,s,i){let r;if(i===ae.STROKE||i===ae.FILL){const o=e.current.getClippedPathBoundingBox(i,Ct(t))||[0,0,0,0],a=Math.ceil(o[2]-o[0])||1,c=Math.ceil(o[3]-o[1])||1,l=e.cachedCanvases.getCanvas("pattern",a,c),u=l.context;u.clearRect(0,0,u.canvas.width,u.canvas.height),u.beginPath(),u.rect(0,0,u.canvas.width,u.canvas.height),u.translate(-o[0],-o[1]),s=U.transform(s,[1,0,0,1,o[0],o[1]]),u.transform(...e.baseTransform),this.matrix&&u.transform(...this.matrix),Vd(u,this._bbox),u.fillStyle=this._createGradient(u),u.fill(),r=t.createPattern(l.canvas,"no-repeat");const h=new DOMMatrix(s);r.setTransform(h)}else Vd(t,this._bbox),r=this._createGradient(t);return r}}function yh(n,t,e,s,i,r,o,a){const c=t.coords,l=t.colors,u=n.data,h=n.width*4;let d;c[e+1]>c[s+1]&&(d=e,e=s,s=d,d=r,r=o,o=d),c[s+1]>c[i+1]&&(d=s,s=i,i=d,d=o,o=a,a=d),c[e+1]>c[s+1]&&(d=e,e=s,s=d,d=r,r=o,o=d);const f=(c[e]+t.offsetX)*t.scaleX,m=(c[e+1]+t.offsetY)*t.scaleY,p=(c[s]+t.offsetX)*t.scaleX,g=(c[s+1]+t.offsetY)*t.scaleY,y=(c[i]+t.offsetX)*t.scaleX,_=(c[i+1]+t.offsetY)*t.scaleY;if(m>=_)return;const b=l[r],w=l[r+1],v=l[r+2],A=l[o],S=l[o+1],T=l[o+2],E=l[a],P=l[a+1],x=l[a+2],I=Math.round(m),V=Math.round(_);let X,st,$,D,k,L,H,lt;for(let et=I;et<=V;et++){if(et<g){const yt=et<m?0:(m-et)/(m-g);X=f-(f-p)*yt,st=b-(b-A)*yt,$=w-(w-S)*yt,D=v-(v-T)*yt}else{let yt;et>_?yt=1:g===_?yt=0:yt=(g-et)/(g-_),X=p-(p-y)*yt,st=A-(A-E)*yt,$=S-(S-P)*yt,D=T-(T-x)*yt}let ft;et<m?ft=0:et>_?ft=1:ft=(m-et)/(m-_),k=f-(f-y)*ft,L=b-(b-E)*ft,H=w-(w-P)*ft,lt=v-(v-x)*ft;const Jt=Math.round(Math.min(X,k)),ve=Math.round(Math.max(X,k));let Wt=h*et+Jt*4;for(let yt=Jt;yt<=ve;yt++)ft=(X-yt)/(X-k),ft<0?ft=0:ft>1&&(ft=1),u[Wt++]=st-(st-L)*ft|0,u[Wt++]=$-($-H)*ft|0,u[Wt++]=D-(D-lt)*ft|0,u[Wt++]=255}}function DB(n,t,e){const s=t.coords,i=t.colors;let r,o;switch(t.type){case Ld.LATTICE:const a=t.verticesPerRow,c=Math.floor(s.length/a)-1,l=a-1;for(r=0;r<c;r++){let u=r*a;for(let h=0;h<l;h++,u++)yh(n,e,s[u],s[u+1],s[u+a],i[u],i[u+1],i[u+a]),yh(n,e,s[u+a+1],s[u+1],s[u+a],i[u+a+1],i[u+1],i[u+a])}break;case Ld.TRIANGLES:for(r=0,o=s.length;r<o;r+=3)yh(n,e,s[r],s[r+1],s[r+2],i[r],i[r+1],i[r+2]);break;default:throw new Error("illegal figure")}}class IB extends qp{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,s){const a=Math.floor(this._bounds[0]),c=Math.floor(this._bounds[1]),l=Math.ceil(this._bounds[2])-a,u=Math.ceil(this._bounds[3])-c,h=Math.min(Math.ceil(Math.abs(l*t[0]*1.1)),3e3),d=Math.min(Math.ceil(Math.abs(u*t[1]*1.1)),3e3),f=l/h,m=u/d,p={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-c,scaleX:1/f,scaleY:1/m},g=h+4,y=d+4,_=s.getCanvas("mesh",g,y),b=_.context,w=b.createImageData(h,d);if(e){const A=w.data;for(let S=0,T=A.length;S<T;S+=4)A[S]=e[0],A[S+1]=e[1],A[S+2]=e[2],A[S+3]=255}for(const A of this._figures)DB(w,A,p);return b.putImageData(w,2,2),{canvas:_.canvas,offsetX:a-2*f,offsetY:c-2*m,scaleX:f,scaleY:m}}isModifyingCurrentTransform(){return!0}getPattern(t,e,s,i){Vd(t,this._bbox);const r=new Float32Array(2);if(i===ae.SHADING)U.singularValueDecompose2dScale(Ct(t),r);else if(this.matrix){U.singularValueDecompose2dScale(this.matrix,r);const[a,c]=r;U.singularValueDecompose2dScale(e.baseTransform,r),r[0]*=a,r[1]*=c}else U.singularValueDecompose2dScale(e.baseTransform,r);const o=this._createMeshCanvas(r,i===ae.SHADING?null:this._background,e.cachedCanvases);return i!==ae.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(o.offsetX,o.offsetY),t.scale(o.scaleX,o.scaleY),t.createPattern(o.canvas,"no-repeat")}}class LB extends qp{getPattern(){return"hotpink"}}function NB(n){switch(n[0]){case"RadialAxial":return new OB(n);case"Mesh":return new IB(n);case"Dummy":return new LB}throw new Error(`Unknown IR type: ${n[0]}`)}const o_={COLORED:1,UNCOLORED:2};class Wp{static MAX_PATTERN_SIZE=3e3;constructor(t,e,s,i){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(t,e){const{bbox:s,operatorList:i,paintType:r,tilingType:o,color:a,canvasGraphicsFactory:c}=this;let{xstep:l,ystep:u}=this;l=Math.abs(l),u=Math.abs(u),tl("TilingType: "+o);const h=s[0],d=s[1],f=s[2],m=s[3],p=f-h,g=m-d,y=new Float32Array(2);U.singularValueDecompose2dScale(this.matrix,y);const[_,b]=y;U.singularValueDecompose2dScale(this.baseTransform,y);const w=_*y[0],v=b*y[1];let A=p,S=g,T=!1,E=!1;const P=Math.ceil(l*w),x=Math.ceil(u*v),I=Math.ceil(p*w),V=Math.ceil(g*v);P>=I?A=l:T=!0,x>=V?S=u:E=!0;const X=this.getSizeAndScale(A,this.ctx.canvas.width,w),st=this.getSizeAndScale(S,this.ctx.canvas.height,v),$=t.cachedCanvases.getCanvas("pattern",X.size,st.size),D=$.context,k=c.createCanvasGraphics(D,e);if(k.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(k,r,a),D.translate(-X.scale*h,-st.scale*d),k.transform(0,X.scale,0,0,st.scale,0,0),D.save(),k.dependencyTracker?.save(),this.clipBbox(k,h,d,f,m),k.baseTransform=Ct(k.ctx),k.executeOperatorList(i),k.endDrawing(),k.dependencyTracker?.restore(),D.restore(),T||E){const L=$.canvas;T&&(A=l),E&&(S=u);const H=this.getSizeAndScale(A,this.ctx.canvas.width,w),lt=this.getSizeAndScale(S,this.ctx.canvas.height,v),et=H.size,ft=lt.size,Jt=t.cachedCanvases.getCanvas("pattern-workaround",et,ft),ve=Jt.context,Wt=T?Math.floor(p/l):0,yt=E?Math.floor(g/u):0;for(let cs=0;cs<=Wt;cs++)for(let N=0;N<=yt;N++)ve.drawImage(L,et*cs,ft*N,et,ft,0,0,et,ft);return{canvas:Jt.canvas,scaleX:H.scale,scaleY:lt.scale,offsetX:h,offsetY:d}}return{canvas:$.canvas,scaleX:X.scale,scaleY:st.scale,offsetX:h,offsetY:d}}getSizeAndScale(t,e,s){const i=Math.max(Wp.MAX_PATTERN_SIZE,e);let r=Math.ceil(t*s);return r>=i?r=i:s=r/t,{scale:s,size:r}}clipBbox(t,e,s,i,r){const o=i-e,a=r-s;t.ctx.rect(e,s,o,a),U.axialAlignedBoundingBox([e,s,i,r],Ct(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,s){const i=t.ctx,r=t.current;switch(e){case o_.COLORED:const{fillStyle:o,strokeStyle:a}=this.ctx;i.fillStyle=r.fillColor=o,i.strokeStyle=r.strokeColor=a;break;case o_.UNCOLORED:i.fillStyle=i.strokeStyle=s,r.fillColor=r.strokeColor=s;break;default:throw new X2(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,s,i,r){let o=s;i!==ae.SHADING&&(o=U.transform(o,e.baseTransform),this.matrix&&(o=U.transform(o,this.matrix)));const a=this.createPatternCanvas(e,r);let c=new DOMMatrix(o);c=c.translate(a.offsetX,a.offsetY),c=c.scale(1/a.scaleX,1/a.scaleY);const l=t.createPattern(a.canvas,"repeat");return l.setTransform(c),l}}function FB({src:n,srcPos:t=0,dest:e,width:s,height:i,nonBlackColor:r=4294967295,inverseDecode:o=!1}){const a=ce.isLittleEndian?4278190080:255,[c,l]=o?[r,a]:[a,r],u=s>>3,h=s&7,d=n.length;e=new Uint32Array(e.buffer);let f=0;for(let m=0;m<i;m++){for(const g=t+u;t<g;t++){const y=t<d?n[t]:255;e[f++]=y&128?l:c,e[f++]=y&64?l:c,e[f++]=y&32?l:c,e[f++]=y&16?l:c,e[f++]=y&8?l:c,e[f++]=y&4?l:c,e[f++]=y&2?l:c,e[f++]=y&1?l:c}if(h===0)continue;const p=t<d?n[t++]:255;for(let g=0;g<h;g++)e[f++]=p&1<<7-g?l:c}return{srcPos:t,destPos:f}}const a_=16,c_=100,BB=15,l_=10,Se=16,bh=new DOMMatrix,Ie=new Float32Array(2),fi=new Float32Array([1/0,1/0,-1/0,-1/0]);function $B(n,t){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){t.save(),this.__originalSave()},n.restore=function(){t.restore(),this.__originalRestore()},n.translate=function(e,s){t.translate(e,s),this.__originalTranslate(e,s)},n.scale=function(e,s){t.scale(e,s),this.__originalScale(e,s)},n.transform=function(e,s,i,r,o,a){t.transform(e,s,i,r,o,a),this.__originalTransform(e,s,i,r,o,a)},n.setTransform=function(e,s,i,r,o,a){t.setTransform(e,s,i,r,o,a),this.__originalSetTransform(e,s,i,r,o,a)},n.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},n.rotate=function(e){t.rotate(e),this.__originalRotate(e)},n.clip=function(e){t.clip(e),this.__originalClip(e)},n.moveTo=function(e,s){t.moveTo(e,s),this.__originalMoveTo(e,s)},n.lineTo=function(e,s){t.lineTo(e,s),this.__originalLineTo(e,s)},n.bezierCurveTo=function(e,s,i,r,o,a){t.bezierCurveTo(e,s,i,r,o,a),this.__originalBezierCurveTo(e,s,i,r,o,a)},n.rect=function(e,s,i,r){t.rect(e,s,i,r),this.__originalRect(e,s,i,r)},n.closePath=function(){t.closePath(),this.__originalClosePath()},n.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class UB{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,s){let i;return this.cache[t]!==void 0?(i=this.cache[t],this.canvasFactory.reset(i,e,s)):(i=this.canvasFactory.create(e,s),this.cache[t]=i),i}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function Yo(n,t,e,s,i,r,o,a,c,l){const[u,h,d,f,m,p]=Ct(n);if(h===0&&d===0){const _=o*u+m,b=Math.round(_),w=a*f+p,v=Math.round(w),A=(o+c)*u+m,S=Math.abs(Math.round(A)-b)||1,T=(a+l)*f+p,E=Math.abs(Math.round(T)-v)||1;return n.setTransform(Math.sign(u),0,0,Math.sign(f),b,v),n.drawImage(t,e,s,i,r,0,0,S,E),n.setTransform(u,h,d,f,m,p),[S,E]}if(u===0&&f===0){const _=a*d+m,b=Math.round(_),w=o*h+p,v=Math.round(w),A=(a+l)*d+m,S=Math.abs(Math.round(A)-b)||1,T=(o+c)*h+p,E=Math.abs(Math.round(T)-v)||1;return n.setTransform(0,Math.sign(h),Math.sign(d),0,b,v),n.drawImage(t,e,s,i,r,0,0,E,S),n.setTransform(u,h,d,f,m,p),[E,S]}n.drawImage(t,e,s,i,r,o,a,c,l);const g=Math.hypot(u,h),y=Math.hypot(d,f);return[g*c,y*l]}class u_{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=Id;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=te.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e,s){s?.(this),this.clipBox=new Float32Array([0,0,t,e]),this.minMax=fi.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=ae.FILL,e=null){const s=this.minMax.slice();if(t===ae.STROKE){e||_t("Stroke bounding box must include transform."),U.singularValueDecompose2dScale(e,Ie);const i=Ie[0]*this.lineWidth/2,r=Ie[1]*this.lineWidth/2;s[0]-=i,s[1]-=r,s[2]+=i,s[3]+=r}return s}updateClipFromPath(){const t=U.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(fi,0)}getClippedPathBoundingBox(t=ae.FILL,e=null){return U.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function h_(n,t){if(t instanceof ImageData){n.putImageData(t,0,0);return}const e=t.height,s=t.width,i=e%Se,r=(e-i)/Se,o=i===0?r:r+1,a=n.createImageData(s,Se);let c=0,l;const u=t.data,h=a.data;let d,f,m,p;if(t.kind===wa.GRAYSCALE_1BPP){const g=u.byteLength,y=new Uint32Array(h.buffer,0,h.byteLength>>2),_=y.length,b=s+7>>3,w=4294967295,v=ce.isLittleEndian?4278190080:255;for(d=0;d<o;d++){for(m=d<r?Se:i,l=0,f=0;f<m;f++){const A=g-c;let S=0;const T=A>b?s:A*8-7,E=T&-8;let P=0,x=0;for(;S<E;S+=8)x=u[c++],y[l++]=x&128?w:v,y[l++]=x&64?w:v,y[l++]=x&32?w:v,y[l++]=x&16?w:v,y[l++]=x&8?w:v,y[l++]=x&4?w:v,y[l++]=x&2?w:v,y[l++]=x&1?w:v;for(;S<T;S++)P===0&&(x=u[c++],P=128),y[l++]=x&P?w:v,P>>=1}for(;l<_;)y[l++]=0;n.putImageData(a,0,d*Se)}}else if(t.kind===wa.RGBA_32BPP){for(f=0,p=s*Se*4,d=0;d<r;d++)h.set(u.subarray(c,c+p)),c+=p,n.putImageData(a,0,f),f+=Se;d<o&&(p=s*i*4,h.set(u.subarray(c,c+p)),n.putImageData(a,0,f))}else if(t.kind===wa.RGB_24BPP)for(m=Se,p=s*m,d=0;d<o;d++){for(d>=r&&(m=i,p=s*m),l=0,f=p;f--;)h[l++]=u[c++],h[l++]=u[c++],h[l++]=u[c++],h[l++]=255;n.putImageData(a,0,d*Se)}else throw new Error(`bad image kind: ${t.kind}`)}function d_(n,t){if(t.bitmap){n.drawImage(t.bitmap,0,0);return}const e=t.height,s=t.width,i=e%Se,r=(e-i)/Se,o=i===0?r:r+1,a=n.createImageData(s,Se);let c=0;const l=t.data,u=a.data;for(let h=0;h<o;h++){const d=h<r?Se:i;({srcPos:c}=FB({src:l,srcPos:c,dest:u,width:s,height:d,nonBlackColor:0})),n.putImageData(a,0,h*Se)}}function Qi(n,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of e)n[s]!==void 0&&(t[s]=n[s]);n.setLineDash!==void 0&&(t.setLineDash(n.getLineDash()),t.lineDashOffset=n.lineDashOffset)}function Xo(n){n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0);const{filter:t}=n;t!=="none"&&t!==""&&(n.filter="none")}function f_(n,t){if(t)return!0;U.singularValueDecompose2dScale(n,Ie);const e=Math.fround(En.pixelRatio*Oi.PDF_TO_CSS_UNITS);return Ie[0]<=e&&Ie[1]<=e}const jB=["butt","round","square"],zB=["miter","round","bevel"],VB={},p_={};class Ai{constructor(t,e,s,i,r,{optionalContentConfig:o,markedContentStack:a=null},c,l,u){this.ctx=t,this.current=new u_(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=s,this.canvasFactory=i,this.filterFactory=r,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=o,this.cachedCanvases=new UB(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=c,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=l,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=u??null}getObject(t,e,s=null){return typeof e=="string"?(this.dependencyTracker?.recordNamedDependency(t,e),e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e)):s}beginDrawing({transform:t,viewport:e,transparency:s=!1,background:i=null}){const r=this.ctx.canvas.width,o=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,r,o),this.ctx.fillStyle=a,s){const c=this.cachedCanvases.getCanvas("transparent",r,o);this.compositeCtx=this.ctx,this.transparentCanvas=c.canvas,this.ctx=c.context,this.ctx.save(),this.ctx.transform(...Ct(this.compositeCtx))}this.ctx.save(),Xo(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=Ct(this.ctx)}executeOperatorList(t,e,s,i,r){const o=t.argsArray,a=t.fnArray;let c=e||0;const l=o.length;if(l===c)return c;const u=l-c>l_&&typeof s=="function",h=u?Date.now()+BB:0;let d=0;const f=this.commonObjs,m=this.objs;let p,g;for(;;){if(i!==void 0&&c===i.nextBreakPoint)return i.breakIt(c,s),c;if(!r||r(c))if(p=a[c],g=o[c]??null,p!==Kr.dependency)g===null?this[p](c):this[p](c,...g);else for(const y of g){this.dependencyTracker?.recordNamedData(y,c);const _=y.startsWith("g_")?f:m;if(!_.has(y))return _.get(y,s),c}if(c++,c===l)return c;if(u&&++d>l_){if(Date.now()>h)return s(),c;d=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const s=t.width??t.displayWidth,i=t.height??t.displayHeight;let r=Math.max(Math.hypot(e[0],e[1]),1),o=Math.max(Math.hypot(e[2],e[3]),1),a=s,c=i,l="prescale1",u,h;for(;r>2&&a>1||o>2&&c>1;){let d=a,f=c;r>2&&a>1&&(d=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),r/=a/d),o>2&&c>1&&(f=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,o/=c/f),u=this.cachedCanvases.getCanvas(l,d,f),h=u.context,h.clearRect(0,0,d,f),h.drawImage(t,0,0,a,c,0,0,d,f),t=u.canvas,a=d,c=f,l=l==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:a,paintHeight:c}}_createMaskCanvas(t,e){const s=this.ctx,{width:i,height:r}=e,o=this.current.fillColor,a=this.current.patternFill,c=Ct(s);let l,u,h,d;if((e.bitmap||e.data)&&e.count>1){const P=e.bitmap||e.data.buffer;u=JSON.stringify(a?c:[c.slice(0,4),o]),l=this._cachedBitmapsMap.get(P),l||(l=new Map,this._cachedBitmapsMap.set(P,l));const x=l.get(u);if(x&&!a){const I=Math.round(Math.min(c[0],c[2])+c[4]),V=Math.round(Math.min(c[1],c[3])+c[5]);return this.dependencyTracker?.recordDependencies(t,ze.transformAndFill),{canvas:x,offsetX:I,offsetY:V}}h=x}h||(d=this.cachedCanvases.getCanvas("maskCanvas",i,r),d_(d.context,e));let f=U.transform(c,[1/i,0,0,-1/r,0,0]);f=U.transform(f,[1,0,0,1,0,-r]);const m=fi.slice();U.axialAlignedBoundingBox([0,0,i,r],f,m);const[p,g,y,_]=m,b=Math.round(y-p)||1,w=Math.round(_-g)||1,v=this.cachedCanvases.getCanvas("fillCanvas",b,w),A=v.context,S=p,T=g;A.translate(-S,-T),A.transform(...f),h||(h=this._scaleImage(d.canvas,hn(A)),h=h.img,l&&a&&l.set(u,h)),A.imageSmoothingEnabled=f_(Ct(A),e.interpolate),Yo(A,h,0,0,h.width,h.height,0,0,i,r),A.globalCompositeOperation="source-in";const E=U.transform(hn(A),[1,0,0,1,-S,-T]);return A.fillStyle=a?o.getPattern(s,this,E,ae.FILL,t):o,A.fillRect(0,0,i,r),l&&!a&&(this.cachedCanvases.delete("fillCanvas"),l.set(u,v.canvas)),this.dependencyTracker?.recordDependencies(t,ze.transformAndFill),{canvas:v.canvas,offsetX:Math.round(S),offsetY:Math.round(T)}}setLineWidth(t,e){this.dependencyTracker?.recordSimpleData("lineWidth",t),e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(t,e){this.dependencyTracker?.recordSimpleData("lineCap",t),this.ctx.lineCap=jB[e]}setLineJoin(t,e){this.dependencyTracker?.recordSimpleData("lineJoin",t),this.ctx.lineJoin=zB[e]}setMiterLimit(t,e){this.dependencyTracker?.recordSimpleData("miterLimit",t),this.ctx.miterLimit=e}setDash(t,e,s){this.dependencyTracker?.recordSimpleData("dash",t);const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(e),i.lineDashOffset=s)}setRenderingIntent(t,e){}setFlatness(t,e){}setGState(t,e){for(const[s,i]of e)switch(s){case"LW":this.setLineWidth(t,i);break;case"LC":this.setLineCap(t,i);break;case"LJ":this.setLineJoin(t,i);break;case"ML":this.setMiterLimit(t,i);break;case"D":this.setDash(t,i[0],i[1]);break;case"RI":this.setRenderingIntent(t,i);break;case"FL":this.setFlatness(t,i);break;case"Font":this.setFont(t,i[0],i[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",t),this.current.strokeAlpha=i;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",t),this.ctx.globalAlpha=this.current.fillAlpha=i;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",t),this.ctx.globalCompositeOperation=i;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",t),this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",t),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(t){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,s=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(i,e,s);this.suspendedCtx=this.ctx;const o=this.ctx=r.context;o.setTransform(this.suspendedCtx.getTransform()),Qi(this.suspendedCtx,o),$B(o,this.suspendedCtx),this.setGState(t,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Qi(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,s,i){const r=i[0],o=i[1],a=i[2]-r,c=i[3]-o;a===0||c===0||(this.genericComposeSMask(e.context,s,a,c,e.subtype,e.backdrop,e.transferMap,r,o,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(s.canvas,0,0),t.restore())}genericComposeSMask(t,e,s,i,r,o,a,c,l,u,h){let d=t.canvas,f=c-u,m=l-h;if(o)if(f<0||m<0||f+s>d.width||m+i>d.height){const g=this.cachedCanvases.getCanvas("maskExtension",s,i),y=g.context;y.drawImage(d,-f,-m),y.globalCompositeOperation="destination-atop",y.fillStyle=o,y.fillRect(0,0,s,i),y.globalCompositeOperation="source-over",d=g.canvas,f=m=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const g=new Path2D;g.rect(f,m,s,i),t.clip(g),t.globalCompositeOperation="destination-atop",t.fillStyle=o,t.fillRect(f,m,s,i),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),r==="Alpha"&&a?e.filter=this.filterFactory.addAlphaFilter(a):r==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(a));const p=new Path2D;p.rect(c,l,s,i),e.clip(p),e.globalCompositeOperation="destination-in",e.drawImage(d,f,m,s,i,c,l,s,i),e.restore()}save(t){this.inSMaskMode&&Qi(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),this.dependencyTracker?.save(t)}restore(t){if(this.dependencyTracker?.restore(t),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Qi(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,s,i,r,o,a){this.dependencyTracker?.recordIncrementalData("transform",t),this.ctx.transform(e,s,i,r,o,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,s,i){let[r]=s;if(!i){r||=s[0]=new Path2D,this[e](t,r);return}if(this.dependencyTracker!==null){const o=e===Kr.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(t).recordBBox(t,this.ctx,i[0]-o,i[2]+o,i[1]-o,i[3]+o).recordDependencies(t,["transform"])}r instanceof Path2D||(r=s[0]=S1(r)),U.axialAlignedBoundingBox(i,Ct(this.ctx),this.current.minMax),this[e](t,r),this._pathStartIdx=t}closePath(t){this.ctx.closePath()}stroke(t,e,s=!0){const i=this.ctx,r=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof r=="object"&&r?.getPattern){const o=r.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=r.getPattern(i,this,hn(i),ae.STROKE,t),o){const a=new Path2D;a.addPath(e,i.getTransform().invertSelf().multiplySelf(o)),e=a}this.rescaleAndStroke(e,!1),i.restore()}else this.rescaleAndStroke(e,!0);this.dependencyTracker?.recordDependencies(t,ze.stroke),s&&this.consumePath(t,e,this.current.getClippedPathBoundingBox(ae.STROKE,Ct(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(t,e){this.stroke(t,e)}fill(t,e,s=!0){const i=this.ctx,r=this.current.fillColor,o=this.current.patternFill;let a=!1;if(o){const l=r.isModifyingCurrentTransform()?i.getTransform():null;if(this.dependencyTracker?.save(t),i.save(),i.fillStyle=r.getPattern(i,this,hn(i),ae.FILL,t),l){const u=new Path2D;u.addPath(e,i.getTransform().invertSelf().multiplySelf(l)),e=u}a=!0}const c=this.current.getClippedPathBoundingBox();this.contentVisible&&c!==null&&(this.pendingEOFill?(i.fill(e,"evenodd"),this.pendingEOFill=!1):i.fill(e)),this.dependencyTracker?.recordDependencies(t,ze.fill),a&&(i.restore(),this.dependencyTracker?.restore(t)),s&&this.consumePath(t,e,c)}eoFill(t,e){this.pendingEOFill=!0,this.fill(t,e)}fillStroke(t,e){this.fill(t,e,!1),this.stroke(t,e,!1),this.consumePath(t,e)}eoFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}closeFillStroke(t,e){this.fillStroke(t,e)}closeEOFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}endPath(t,e){this.consumePath(t,e)}rawFillPath(t,e){this.ctx.fill(e),this.dependencyTracker?.recordDependencies(t,ze.rawFillPath).recordOperation(t)}clip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=VB}eoClip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=p_}beginText(t){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(t).resetIncrementalData("sameLineText").resetIncrementalData("moveText",t)}endText(t){const e=this.pendingTextPaths,s=this.ctx;if(this.dependencyTracker){const{dependencyTracker:i}=this;e!==void 0&&i.recordFutureForcedDependency("textClip",i.getOpenMarker()).recordFutureForcedDependency("textClip",t),i.recordCloseMarker(t)}if(e!==void 0){const i=new Path2D,r=s.getTransform().invertSelf();for(const{transform:o,x:a,y:c,fontSize:l,path:u}of e)u&&i.addPath(u,new DOMMatrix(o).preMultiplySelf(r).translate(a,c).scale(l,-l));s.clip(i)}delete this.pendingTextPaths}setCharSpacing(t,e){this.dependencyTracker?.recordSimpleData("charSpacing",t),this.current.charSpacing=e}setWordSpacing(t,e){this.dependencyTracker?.recordSimpleData("wordSpacing",t),this.current.wordSpacing=e}setHScale(t,e){this.dependencyTracker?.recordSimpleData("hScale",t),this.current.textHScale=e/100}setLeading(t,e){this.dependencyTracker?.recordSimpleData("leading",t),this.current.leading=-e}setFont(t,e,s){this.dependencyTracker?.recordSimpleData("font",t).recordSimpleDataFromNamed("fontObj",e,t);const i=this.commonObjs.get(e),r=this.current;if(!i)throw new Error(`Can't find font for ${e}`);if(r.fontMatrix=i.fontMatrix||Id,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&J("Invalid font matrix for font "+e),s<0?(s=-s,r.fontDirection=-1):r.fontDirection=1,this.current.font=i,this.current.fontSize=s,i.isType3Font)return;const o=i.loadedName||"sans-serif",a=i.systemFontInfo?.css||`"${o}", ${i.fallbackName}`;let c="normal";i.black?c="900":i.bold&&(c="bold");const l=i.italic?"italic":"normal";let u=s;s<a_?u=a_:s>c_&&(u=c_),this.current.fontSizeScale=s/u,this.ctx.font=`${l} ${c} ${u}px ${a}`}setTextRenderingMode(t,e){this.dependencyTracker?.recordSimpleData("textRenderingMode",t),this.current.textRenderingMode=e}setTextRise(t,e){this.dependencyTracker?.recordSimpleData("textRise",t),this.current.textRise=e}moveText(t,e,s){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",t),this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=s}setLeadingMoveText(t,e,s){this.setLeading(t,-s),this.moveText(t,e,s)}setTextMatrix(t,e){this.dependencyTracker?.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",t);const{current:s}=this;s.textMatrix=e,s.textMatrixScale=Math.hypot(e[0],e[1]),s.x=s.lineX=0,s.y=s.lineY=0}nextLine(t){this.moveText(t,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??t)}#s(t,e,s){const i=new Path2D;return i.addPath(t,new DOMMatrix(s).invertSelf().multiplySelf(e)),i}paintChar(t,e,s,i,r,o){const a=this.ctx,c=this.current,l=c.font,u=c.textRenderingMode,h=c.fontSize/c.fontSizeScale,d=u&te.FILL_STROKE_MASK,f=!!(u&te.ADD_TO_PATH_FLAG),m=c.patternFill&&!l.missingFile,p=c.patternStroke&&!l.missingFile;let g;if((l.disableFontFace||f||m||p)&&!l.missingFile&&(g=l.getPathGenerator(this.commonObjs,e)),g&&(l.disableFontFace||m||p)){a.save(),a.translate(s,i),a.scale(h,-h),this.dependencyTracker?.recordCharacterBBox(t,a,l);let y;if(d===te.FILL||d===te.FILL_STROKE)if(r){y=a.getTransform(),a.setTransform(...r);const _=this.#s(g,y,r);a.fill(_)}else a.fill(g);if(d===te.STROKE||d===te.FILL_STROKE)if(o){y||=a.getTransform(),a.setTransform(...o);const{a:_,b,c:w,d:v}=y,A=U.inverseTransform(o),S=U.transform([_,b,w,v,0,0],A);U.singularValueDecompose2dScale(S,Ie),a.lineWidth*=Math.max(Ie[0],Ie[1])/h,a.stroke(this.#s(g,y,o))}else a.lineWidth/=h,a.stroke(g);a.restore()}else(d===te.FILL||d===te.FILL_STROKE)&&(a.fillText(e,s,i),this.dependencyTracker?.recordCharacterBBox(t,a,l,h,s,i,()=>a.measureText(e))),(d===te.STROKE||d===te.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(t,a,l,h,s,i,()=>a.measureText(e)).recordDependencies(t,ze.stroke),a.strokeText(e,s,i));f&&((this.pendingTextPaths||=[]).push({transform:Ct(a),x:s,y:i,fontSize:h,path:g}),this.dependencyTracker?.recordCharacterBBox(t,a,l,h,s,i))}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<e.length;i+=4)if(e[i]>0&&e[i]<255){s=!0;break}return Q(this,"isFontSubpixelAAEnabled",s)}showText(t,e){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(t,ze.showText).resetBBox(t),this.current.textRenderingMode&te.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",t).inheritPendingDependenciesAsFutureForcedDependencies());const s=this.current,i=s.font;if(i.isType3Font){this.showType3Text(t,e),this.dependencyTracker?.recordShowTextOperation(t);return}const r=s.fontSize;if(r===0){this.dependencyTracker?.recordOperation(t);return}const o=this.ctx,a=s.fontSizeScale,c=s.charSpacing,l=s.wordSpacing,u=s.fontDirection,h=s.textHScale*u,d=e.length,f=i.vertical,m=f?1:-1,p=i.defaultVMetrics,g=r*s.fontMatrix[0],y=s.textRenderingMode===te.FILL&&!i.disableFontFace&&!s.patternFill;o.save(),s.textMatrix&&o.transform(...s.textMatrix),o.translate(s.x,s.y+s.textRise),u>0?o.scale(h,-1):o.scale(h,1);let _,b;if(s.patternFill){o.save();const T=s.fillColor.getPattern(o,this,hn(o),ae.FILL,t);_=Ct(o),o.restore(),o.fillStyle=T}if(s.patternStroke){o.save();const T=s.strokeColor.getPattern(o,this,hn(o),ae.STROKE,t);b=Ct(o),o.restore(),o.strokeStyle=T}let w=s.lineWidth;const v=s.textMatrixScale;if(v===0||w===0){const T=s.textRenderingMode&te.FILL_STROKE_MASK;(T===te.STROKE||T===te.FILL_STROKE)&&(w=this.getSinglePixelWidth())}else w/=v;if(a!==1&&(o.scale(a,a),w/=a),o.lineWidth=w,i.isInvalidPDFjsFont){const T=[];let E=0;for(const x of e)T.push(x.unicode),E+=x.width;const P=T.join("");if(o.fillText(P,0,0),this.dependencyTracker!==null){const x=o.measureText(P);this.dependencyTracker.recordBBox(t,this.ctx,-x.actualBoundingBoxLeft,x.actualBoundingBoxRight,-x.actualBoundingBoxAscent,x.actualBoundingBoxDescent).recordShowTextOperation(t)}s.x+=E*g*h,o.restore(),this.compose();return}let A=0,S;for(S=0;S<d;++S){const T=e[S];if(typeof T=="number"){A+=m*T*r/1e3;continue}let E=!1;const P=(T.isSpace?l:0)+c,x=T.fontChar,I=T.accent;let V,X,st=T.width;if(f){const k=T.vmetric||p,L=-(T.vmetric?k[1]:st*.5)*g,H=k[2]*g;st=k?-k[0]:st,V=L/a,X=(A+H)/a}else V=A/a,X=0;let $;if(i.remeasure&&st>0){$=o.measureText(x);const k=$.width*1e3/r*a;if(st<k&&this.isFontSubpixelAAEnabled){const L=st/k;E=!0,o.save(),o.scale(L,1),V/=L}else st!==k&&(V+=(st-k)/2e3*r/a)}if(this.contentVisible&&(T.isInFont||i.missingFile)){if(y&&!I)o.fillText(x,V,X),this.dependencyTracker?.recordCharacterBBox(t,o,$?{bbox:null}:i,r/a,V,X,()=>$??o.measureText(x));else if(this.paintChar(t,x,V,X,_,b),I){const k=V+r*I.offset.x/a,L=X-r*I.offset.y/a;this.paintChar(t,I.fontChar,k,L,_,b)}}const D=f?st*g-P*u:st*g+P*u;A+=D,E&&o.restore()}f?s.y-=A:s.x+=A*h,o.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(t)}showType3Text(t,e){const s=this.ctx,i=this.current,r=i.font,o=i.fontSize,a=i.fontDirection,c=r.vertical?1:-1,l=i.charSpacing,u=i.wordSpacing,h=i.textHScale*a,d=i.fontMatrix||Id,f=e.length,m=i.textRenderingMode===te.INVISIBLE;let p,g,y,_;if(m||o===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,s.save(),i.textMatrix&&s.transform(...i.textMatrix),s.translate(i.x,i.y+i.textRise),s.scale(h,a);const b=this.dependencyTracker;for(this.dependencyTracker=b?new hc(b,t):null,p=0;p<f;++p){if(g=e[p],typeof g=="number"){_=c*g*o/1e3,this.ctx.translate(_,0),i.x+=_*h;continue}const w=(g.isSpace?u:0)+l,v=r.charProcOperatorList[g.operatorListId];v?this.contentVisible&&(this.save(),s.scale(o,o),s.transform(...d),this.executeOperatorList(v),this.restore()):J(`Type3 character "${g.operatorListId}" is not available.`);const A=[g.width,0];U.applyTransform(A,d),y=A[0]*o+w,s.translate(y,0),i.x+=y*h}s.restore(),b&&(this.dependencyTracker=b)}setCharWidth(t,e,s){}setCharWidthAndBounds(t,e,s,i,r,o,a){const c=new Path2D;c.rect(i,r,o-i,a-r),this.ctx.clip(c),this.dependencyTracker?.recordBBox(t,this.ctx,i,o,r,a).recordClipBox(t,this.ctx,i,o,r,a),this.endPath(t)}getColorN_Pattern(t,e){let s;if(e[0]==="TilingPattern"){const i=this.baseTransform||Ct(this.ctx),r={createCanvasGraphics:(o,a)=>new Ai(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new hc(this.dependencyTracker,a,!0):null)};s=new Wp(e,this.ctx,r,i)}else s=this._getPattern(t,e[1],e[2]);return s}setStrokeColorN(t,...e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.current.strokeColor=this.getColorN_Pattern(t,e),this.current.patternStroke=!0}setFillColorN(t,...e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.current.fillColor=this.getColorN_Pattern(t,e),this.current.patternFill=!0}setStrokeRGBColor(t,e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(t){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(t){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e,s=null){let i;return this.cachedPatterns.has(e)?i=this.cachedPatterns.get(e):(i=NB(this.getObject(t,e)),this.cachedPatterns.set(e,i)),s&&(i.matrix=s),i}shadingFill(t,e){if(!this.contentVisible)return;const s=this.ctx;this.save(t);const i=this._getPattern(t,e);s.fillStyle=i.getPattern(s,this,hn(s),ae.SHADING,t);const r=hn(s);if(r){const{width:o,height:a}=s.canvas,c=fi.slice();U.axialAlignedBoundingBox([0,0,o,a],r,c);const[l,u,h,d]=c;this.ctx.fillRect(l,u,h-l,d-u)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(t).recordFullPageBBox(t).recordDependencies(t,ze.transform).recordDependencies(t,ze.fill).recordOperation(t),this.compose(this.current.getClippedPathBoundingBox()),this.restore(t)}beginInlineImage(){_t("Should not call beginInlineImage")}beginImageData(){_t("Should not call beginImageData")}paintFormXObjectBegin(t,e,s){if(this.contentVisible&&(this.save(t),this.baseTransformStack.push(this.baseTransform),e&&this.transform(t,...e),this.baseTransform=Ct(this.ctx),s)){U.axialAlignedBoundingBox(s,this.baseTransform,this.current.minMax);const[i,r,o,a]=s,c=new Path2D;c.rect(i,r,o-i,a-r),this.ctx.clip(c),this.dependencyTracker?.recordClipBox(t,this.ctx,i,o,r,a),this.endPath(t)}}paintFormXObjectEnd(t){this.contentVisible&&(this.restore(t),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t,e){if(!this.contentVisible)return;this.save(t),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const s=this.ctx;e.isolated||tl("TODO: Support non-isolated groups."),e.knockout&&J("Knockout groups not supported.");const i=Ct(s);if(e.matrix&&s.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let r=fi.slice();U.axialAlignedBoundingBox(e.bbox,Ct(s),r);const o=[0,0,s.canvas.width,s.canvas.height];r=U.intersect(r,o)||[0,0,0,0];const a=Math.floor(r[0]),c=Math.floor(r[1]),l=Math.max(Math.ceil(r[2])-a,1),u=Math.max(Math.ceil(r[3])-c,1);this.current.startNewPathAndClipBox([0,0,l,u]);let h="groupAt"+this.groupLevel;e.smask&&(h+="_smask_"+this.smaskCounter++%2);const d=this.cachedCanvases.getCanvas(h,l,u),f=d.context;f.translate(-a,-c),f.transform(...i);let m=new Path2D;const[p,g,y,_]=e.bbox;if(m.rect(p,g,y-p,_-g),e.matrix){const b=new Path2D;b.addPath(m,new DOMMatrix(e.matrix)),m=b}f.clip(m),e.smask&&this.smaskStack.push({canvas:d.canvas,context:f,offsetX:a,offsetY:c,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}),(!e.smask||this.dependencyTracker)&&(s.setTransform(1,0,0,1,0,0),s.translate(a,c),s.save()),Qi(s,f),this.ctx=f,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(s),this.setGState(t,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(s),this.groupLevel++}endGroup(t,e){if(!this.contentVisible)return;this.groupLevel--;const s=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),e.smask)this.tempSMask=this.smaskStack.pop(),this.restore(t),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const r=Ct(this.ctx);this.restore(t),this.ctx.save(),this.ctx.setTransform(...r);const o=fi.slice();U.axialAlignedBoundingBox([0,0,s.canvas.width,s.canvas.height],r,o),this.ctx.drawImage(s.canvas,0,0),this.ctx.restore(),this.compose(o)}}beginAnnotation(t,e,s,i,r,o){if(this.#t(),Xo(this.ctx),this.ctx.save(),this.save(t),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),s){const a=s[2]-s[0],c=s[3]-s[1];if(o&&this.annotationCanvasMap){i=i.slice(),i[4]-=s[0],i[5]-=s[1],s=s.slice(),s[0]=s[1]=0,s[2]=a,s[3]=c,U.singularValueDecompose2dScale(Ct(this.ctx),Ie);const{viewportScale:l}=this,u=Math.ceil(a*this.outputScaleX*l),h=Math.ceil(c*this.outputScaleY*l);this.annotationCanvas=this.canvasFactory.create(u,h);const{canvas:d,context:f}=this.annotationCanvas;this.annotationCanvasMap.set(e,d),this.annotationCanvas.savedCtx=this.ctx,this.ctx=f,this.ctx.save(),this.ctx.setTransform(Ie[0],0,0,-Ie[1],0,c*Ie[1]),Xo(this.ctx)}else{Xo(this.ctx),this.endPath(t);const l=new Path2D;l.rect(s[0],s[1],a,c),this.ctx.clip(l)}}this.current=new u_(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(t,...i),this.transform(t,...r)}endAnnotation(t){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t,e){if(!this.contentVisible)return;const s=e.count;e=this.getObject(t,e.data,e),e.count=s;const i=this.ctx,r=this._createMaskCanvas(t,e),o=r.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(o,r.offsetX,r.offsetY),this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,r.offsetX,r.offsetX+o.width,r.offsetY,r.offsetY+o.height).recordOperation(t),i.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,s,i=0,r=0,o,a){if(!this.contentVisible)return;e=this.getObject(t,e.data,e);const c=this.ctx;c.save();const l=Ct(c);c.transform(s,i,r,o,0,0);const u=this._createMaskCanvas(t,e);c.setTransform(1,0,0,1,u.offsetX-l[4],u.offsetY-l[5]),this.dependencyTracker?.resetBBox(t);for(let h=0,d=a.length;h<d;h+=2){const f=U.transform(l,[s,i,r,o,a[h],a[h+1]]);c.drawImage(u.canvas,f[4],f[5]),this.dependencyTracker?.recordBBox(t,this.ctx,f[4],f[4]+u.canvas.width,f[5],f[5]+u.canvas.height)}c.restore(),this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageMaskXObjectGroup(t,e){if(!this.contentVisible)return;const s=this.ctx,i=this.current.fillColor,r=this.current.patternFill;this.dependencyTracker?.resetBBox(t).recordDependencies(t,ze.transformAndFill);for(const o of e){const{data:a,width:c,height:l,transform:u}=o,h=this.cachedCanvases.getCanvas("maskCanvas",c,l),d=h.context;d.save();const f=this.getObject(t,a,o);d_(d,f),d.globalCompositeOperation="source-in",d.fillStyle=r?i.getPattern(d,this,hn(s),ae.FILL,t):i,d.fillRect(0,0,c,l),d.restore(),s.save(),s.transform(...u),s.scale(1,-1),Yo(s,h.canvas,0,0,c,l,0,-1,1,1),this.dependencyTracker?.recordBBox(t,s,0,c,0,l),s.restore()}this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageXObject(t,e){if(!this.contentVisible)return;const s=this.getObject(t,e);if(!s){J("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t,s)}paintImageXObjectRepeat(t,e,s,i,r){if(!this.contentVisible)return;const o=this.getObject(t,e);if(!o){J("Dependent image isn't ready yet");return}const a=o.width,c=o.height,l=[];for(let u=0,h=r.length;u<h;u+=2)l.push({transform:[s,0,0,i,r[u],r[u+1]],x:0,y:0,w:a,h:c});this.paintInlineImageXObjectGroup(t,o,l)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:s,height:i}=t,r=this.cachedCanvases.getCanvas("inlineImage",s,i),o=r.context;return o.filter=this.current.transferMaps,o.drawImage(e,0,0),o.filter="none",r.canvas}paintInlineImageXObject(t,e){if(!this.contentVisible)return;const s=e.width,i=e.height,r=this.ctx;this.save(t);const{filter:o}=r;o!=="none"&&o!==""&&(r.filter="none"),r.scale(1/s,-1/i);let a;if(e.bitmap)a=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)a=e;else{const u=this.cachedCanvases.getCanvas("inlineImage",s,i).context;h_(u,e),a=this.applyTransferMapsToCanvas(u)}const c=this._scaleImage(a,hn(r));r.imageSmoothingEnabled=f_(Ct(r),e.interpolate),this.dependencyTracker?.resetBBox(t).recordBBox(t,r,0,s,-i,0).recordDependencies(t,ze.imageXObject).recordOperation(t),Yo(r,c.img,0,0,c.paintWidth,c.paintHeight,0,-i,s,i),this.compose(),this.restore(t)}paintInlineImageXObjectGroup(t,e,s){if(!this.contentVisible)return;const i=this.ctx;let r;if(e.bitmap)r=e.bitmap;else{const o=e.width,a=e.height,l=this.cachedCanvases.getCanvas("inlineImage",o,a).context;h_(l,e),r=this.applyTransferMapsToCanvas(l)}this.dependencyTracker?.resetBBox(t);for(const o of s)i.save(),i.transform(...o.transform),i.scale(1,-1),Yo(i,r,o.x,o.y,o.w,o.h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,i,0,1,-1,0),i.restore();this.dependencyTracker?.recordOperation(t),this.compose()}paintSolidColorImageMask(t){this.contentVisible&&(this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,0,1,0,1).recordDependencies(t,ze.fill).recordOperation(t),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t,e){}markPointProps(t,e,s){}beginMarkedContent(t,e){this.dependencyTracker?.beginMarkedContent(t),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e,s){this.dependencyTracker?.beginMarkedContent(t),e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(s)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(t){this.dependencyTracker?.endMarkedContent(t),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(t){}endCompat(t){}consumePath(t,e,s){const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(s);const r=this.ctx;this.pendingClip?(i||(this.pendingClip===p_?r.clip(e,"evenodd"):r.clip(e)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(t).recordFutureForcedDependency("clipPath",t)):this.dependencyTracker?.recordOperation(t),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=Ct(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),s=Math.hypot(t[0],t[2]),i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:s,c:i,d:r}=this.ctx.getTransform();let o,a;if(s===0&&i===0){const c=Math.abs(e),l=Math.abs(r);if(c===l)if(t===0)o=a=1/c;else{const u=c*t;o=a=u<1?1/u:1}else if(t===0)o=1/c,a=1/l;else{const u=c*t,h=l*t;o=u<1?1/u:1,a=h<1?1/h:1}}else{const c=Math.abs(e*r-s*i),l=Math.hypot(e,s),u=Math.hypot(i,r);if(t===0)o=u/c,a=l/c;else{const h=t*c;o=u>h?u/h:1,a=l>h?l/h:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:s,current:{lineWidth:i}}=this,[r,o]=this.getScaleForStroking();if(r===o){s.lineWidth=(i||1)*r,s.stroke(t);return}const a=s.getLineDash();e&&s.save(),s.scale(r,o),bh.a=1/r,bh.d=1/o;const c=new Path2D;if(c.addPath(t,bh),a.length>0){const l=Math.max(r,o);s.setLineDash(a.map(u=>u/l)),s.lineDashOffset/=l}s.lineWidth=i||1,s.stroke(c),e&&s.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const n in Kr)Ai.prototype[n]!==void 0&&(Ai.prototype[Kr[n]]=Ai.prototype[n]);class Er{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}}class HB{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}[Symbol.iterator](){return this.#t.entries()}}const ni=Symbol("INTERNAL");class qB{#t=!1;#e=!1;#s=!1;#n=!0;constructor(t,{name:e,intent:s,usage:i,rbGroups:r}){this.#t=!!(t&De.DISPLAY),this.#e=!!(t&De.PRINT),this.name=e,this.intent=s,this.usage=i,this.rbGroups=r}get visible(){if(this.#s)return this.#n;if(!this.#n)return!1;const{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,s=!1){t!==ni&&_t("Internal method `_setVisible` called."),this.#s=s,this.#n=e}}class WB{#t=null;#e=new Map;#s=null;#n=null;constructor(t,e=De.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#n=t.order;for(const s of t.groups)this.#e.set(s.id,new qB(e,s));if(t.baseState==="OFF")for(const s of this.#e.values())s._setVisible(ni,!1);for(const s of t.on)this.#e.get(s)._setVisible(ni,!0);for(const s of t.off)this.#e.get(s)._setVisible(ni,!1);this.#s=this.getHash()}}#o(t){const e=t.length;if(e<2)return!0;const s=t[0];for(let i=1;i<e;i++){const r=t[i];let o;if(Array.isArray(r))o=this.#o(r);else if(this.#e.has(r))o=this.#e.get(r).visible;else return J(`Optional content group not found: ${r}`),!0;switch(s){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return s==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return tl("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(J(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#o(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#e.has(e))return J(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#e.has(e))return J(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#e.has(e))return J(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#e.has(e))return J(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return J(`Unknown optional content policy ${t.policy}.`),!0}return J(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,s=!0){const i=this.#e.get(t);if(!i){J(`Optional content group not found: ${t}`);return}if(s&&e&&i.rbGroups.length)for(const r of i.rbGroups)for(const o of r)o!==t&&this.#e.get(o)?._setVisible(ni,!1,!0);i._setVisible(ni,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let s;for(const i of t){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const r=this.#e.get(i);if(r)switch(s){case"ON":this.setVisibility(i,!0,e);break;case"OFF":this.setVisibility(i,!1,e);break;case"Toggle":this.setVisibility(i,!r.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#s===null||this.getHash()===this.#s}getOrder(){return this.#e.size?this.#n?this.#n.slice():[...this.#e.keys()]:null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;const t=new E1;for(const[e,s]of this.#e)t.update(`${e}:${s.visible}`);return this.#t=t.hexdigest()}[Symbol.iterator](){return this.#e.entries()}}class GB{constructor(t,{disableRange:e=!1,disableStream:s=!1}){ct(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:r,progressiveDone:o,contentDispositionFilename:a}=t;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=a,r?.length>0){const c=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(c)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!s,this._isRangeSupported=!e,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((c,l)=>{this._onReceiveData({begin:c,chunk:l})}),t.addProgressListener((c,l)=>{this._onProgress({loaded:c,total:l})}),t.addProgressiveReadListener(c=>{this._onReceiveData({chunk:c})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const s=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(r){return r._begin!==t?!1:(r._enqueue(s),!0)});ct(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){ct(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new YB(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new XB(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class YB{constructor(t,e,s=!1,i=null){this._stream=t,this._done=s||!1,this._filename=Up(i)?i:null,this._queuedChunks=e||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class XB{constructor(t,e,s){this._stream=t,this._begin=e,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function KB(n){let t=!0,e=s("filename\\*","i").exec(n);if(e){e=e[1];let u=a(e);return u=unescape(u),u=c(u),u=l(u),r(u)}if(e=o(n),e){const u=l(e);return r(u)}if(e=s("filename","i").exec(n),e){e=e[1];let u=a(e);return u=l(u),r(u)}function s(u,h){return new RegExp("(?:^|;)\\s*"+u+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',h)}function i(u,h){if(u){if(!/^[\x00-\xFF]+$/.test(h))return h;try{const d=new TextDecoder(u,{fatal:!0}),f=yo(h);h=d.decode(f),t=!1}catch{}}return h}function r(u){return t&&/[\x80-\xff]/.test(u)&&(u=i("utf-8",u),t&&(u=i("iso-8859-1",u))),u}function o(u){const h=[];let d;const f=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(d=f.exec(u))!==null;){let[,p,g,y]=d;if(p=parseInt(p,10),p in h){if(p===0)break;continue}h[p]=[g,y]}const m=[];for(let p=0;p<h.length&&p in h;++p){let[g,y]=h[p];y=a(y),g&&(y=unescape(y),p===0&&(y=c(y))),m.push(y)}return m.join("")}function a(u){if(u.startsWith('"')){const h=u.slice(1).split('\\"');for(let d=0;d<h.length;++d){const f=h[d].indexOf('"');f!==-1&&(h[d]=h[d].slice(0,f),h.length=d+1),h[d]=h[d].replaceAll(/\\(.)/g,"$1")}u=h.join('"')}return u}function c(u){const h=u.indexOf("'");if(h===-1)return u;const d=u.slice(0,h),m=u.slice(h+1).replace(/^[^']*'/,"");return i(d,m)}function l(u){return!u.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(u)?u:u.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(h,d,f,m){if(f==="q"||f==="Q")return m=m.replaceAll("_"," "),m=m.replaceAll(/=([0-9a-fA-F]{2})/g,function(p,g){return String.fromCharCode(parseInt(g,16))}),i(d,m);try{m=atob(m)}catch{}return i(d,m)})}return""}function O1(n,t){const e=new Headers;if(!n||!t||typeof t!="object")return e;for(const s in t){const i=t[s];i!==void 0&&e.append(s,i)}return e}function sl(n){return URL.parse(n)?.origin??null}function D1({responseHeaders:n,isHttp:t,rangeChunkSize:e,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(n.get("Content-Length"),10);return!Number.isInteger(r)||(i.suggestedLength=r,r<=2*e)||s||!t||n.get("Accept-Ranges")!=="bytes"||(n.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function I1(n){const t=n.get("Content-Disposition");if(t){let e=KB(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Up(e))return e}return null}function Ao(n,t){return new uc(`Unexpected server response (${n}) while retrieving PDF "${t}".`,n,n===404||n===0&&t.startsWith("file:"))}function L1(n){return n===200||n===206}function N1(n,t,e){return{method:"GET",headers:n,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function F1(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(J(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}class ZB{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=O1(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ct(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new JB(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new QB(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class JB{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const s=new Headers(t.headers),i=e.url;fetch(i,N1(s,this._withCredentials,this._abortController)).then(r=>{if(t._responseOrigin=sl(r.url),!L1(r.status))throw Ao(r.status,i);this._reader=r.body.getReader(),this._headersCapability.resolve();const o=r.headers,{allowRangeRequests:a,suggestedLength:c}=D1({responseHeaders:o,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=c||this._contentLength,this._filename=I1(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new ns("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:F1(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class QB{constructor(t,e,s){this._stream=t,this._reader=null,this._loaded=0;const i=t.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const r=new Headers(t.headers);r.append("Range",`bytes=${e}-${s-1}`);const o=i.url;fetch(o,N1(r,this._withCredentials,this._abortController)).then(a=>{const c=sl(a.url);if(c!==t._responseOrigin)throw new Error(`Expected range response-origin "${c}" to match "${t._responseOrigin}".`);if(!L1(a.status))throw Ao(a.status,o);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:F1(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const _h=200,wh=206;function t$(n){const t=n.response;return typeof t!="string"?t:yo(t).buffer}class e${_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:s}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=O1(this.isHttp,e),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[r,o]of this.headers)e.setRequestHeader(r,o);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),i.expectedStatus=wh):i.expectedStatus=_h,e.responseType="arraybuffer",ct(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,s),e.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=t.onHeadersReceived,i.onDone=t.onDone,i.onError=t.onError,i.onProgress=t.onProgress,e.send(null),s}onProgress(t,e){const s=this.pendingRequests[t];s&&s.onProgress?.(e)}onStateChange(t,e){const s=this.pendingRequests[t];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],i.status===0&&this.isHttp){s.onError(i.status);return}const r=i.status||_h;if(!(r===_h&&s.expectedStatus===wh)&&r!==s.expectedStatus){s.onError(i.status);return}const a=t$(i);if(r===wh){const c=i.getResponseHeader("Content-Range"),l=/bytes (\d+)-(\d+)\/(\d+)/.exec(c);l?s.onDone({begin:parseInt(l[1],10),chunk:a}):(J('Missing or invalid "Content-Range" header.'),s.onError(0))}else a?s.onDone({begin:0,chunk:a}):s.onError(i.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class n${constructor(t){this._source=t,this._manager=new e$(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return ct(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new s$(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const s=new i$(this._manager,t,e);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class s${constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=sl(e.responseURL);const s=e.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{const[c,...l]=a.split(": ");return[c,l.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:o}=D1({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=I1(i),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Ao(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class i${constructor(t,e,s){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=sl(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=Ao(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const r$=/^[a-z][a-z0-9\-+.]+:/i;function o$(n){if(r$.test(n))return new URL(n);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(n))}class a${constructor(t){this.source=t,this.url=o$(t.url),ct(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ct(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new c$(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new l$(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class c${constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=Ao(0,this._url.href)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new ns("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class l${constructor(t,e,s){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=t.source;this._isStreamingSupported=!i.disableStream;const r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:e,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const tr=Symbol("INITIAL_DATA");class B1{#t=Object.create(null);#e(t){return this.#t[t]||={...Promise.withResolvers(),data:tr}}get(t,e=null){if(e){const i=this.#e(t);return i.promise.then(()=>e(i.data)),null}const s=this.#t[t];if(!s||s.data===tr)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return s.data}has(t){const e=this.#t[t];return!!e&&e.data!==tr}delete(t){const e=this.#t[t];return!e||e.data===tr?!1:(delete this.#t[t],!0)}resolve(t,e=null){const s=this.#e(t);s.data=e,s.resolve()}clear(){for(const t in this.#t){const{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{data:e}=this.#t[t];e!==tr&&(yield[t,e])}}}const u$=1e5,m_=30;class me{#t=Promise.withResolvers();#e=null;#s=!1;#n=!!globalThis.FontInspector?.enabled;#o=null;#r=null;#i=0;#a=0;#l=null;#c=null;#d=0;#h=0;#f=Object.create(null);#g=[];#m=null;#u=[];#p=new WeakMap;#y=null;static#_=new Map;static#b=new Map;static#E=new WeakMap;static#S=null;static#v=new Set;constructor({textContentSource:t,container:e,viewport:s}){if(t instanceof ReadableStream)this.#m=t;else if(typeof t=="object")this.#m=new ReadableStream({start(c){c.enqueue(t),c.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#c=e,this.#h=s.scale*En.pixelRatio,this.#d=s.rotation,this.#r={div:null,properties:null,ctx:null};const{pageWidth:i,pageHeight:r,pageX:o,pageY:a}=s.rawDims;this.#y=[1,0,0,-1,-o,a+r],this.#a=i,this.#i=r,me.#k(),Ls(e,s),this.#t.promise.finally(()=>{me.#v.delete(this),this.#r=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=ce.platform;return Q(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#l.read().then(({value:e,done:s})=>{if(s){this.#t.resolve();return}this.#o??=e.lang,Object.assign(this.#f,e.styles),this.#C(e.items),t()},this.#t.reject)};return this.#l=this.#m.getReader(),me.#v.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){const s=t.scale*En.pixelRatio,i=t.rotation;if(i!==this.#d&&(e?.(),this.#d=i,Ls(this.#c,{rotation:i})),s!==this.#h){e?.(),this.#h=s;const r={div:null,properties:null,ctx:me.#M(this.#o)};for(const o of this.#u)r.properties=this.#p.get(o),r.div=o,this.#T(r)}}cancel(){const t=new ns("TextLayer task cancelled.");this.#l?.cancel(t).catch(()=>{}),this.#l=null,this.#t.reject(t)}get textDivs(){return this.#u}get textContentItemsStr(){return this.#g}#C(t){if(this.#s)return;this.#r.ctx??=me.#M(this.#o);const e=this.#u,s=this.#g;for(const i of t){if(e.length>u$){J("Ignoring additional textDivs for performance reasons."),this.#s=!0;return}if(i.str===void 0){if(i.type==="beginMarkedContentProps"||i.type==="beginMarkedContent"){const r=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),i.id&&this.#e.setAttribute("id",`${i.id}`),r.append(this.#e)}else i.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}s.push(i.str),this.#w(i)}}#w(t){const e=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#u.push(e);const i=U.transform(this.#y,t.transform);let r=Math.atan2(i[1],i[0]);const o=this.#f[t.fontName];o.vertical&&(r+=Math.PI/2);let a=this.#n&&o.fontSubstitution||o.fontFamily;a=me.fontFamilyMap.get(a)||a;const c=Math.hypot(i[2],i[3]),l=c*me.#F(a,o,this.#o);let u,h;r===0?(u=i[4],h=i[5]-l):(u=i[4]+l*Math.sin(r),h=i[5]-l*Math.cos(r));const d="calc(var(--total-scale-factor) *",f=e.style;this.#e===this.#c?(f.left=`${(100*u/this.#a).toFixed(2)}%`,f.top=`${(100*h/this.#i).toFixed(2)}%`):(f.left=`${d}${u.toFixed(2)}px)`,f.top=`${d}${h.toFixed(2)}px)`),f.fontSize=`${d}${(me.#S*c).toFixed(2)}px)`,f.fontFamily=a,s.fontSize=c,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#n&&(e.dataset.fontName=o.fontSubstitutionLoadedName||t.fontName),r!==0&&(s.angle=r*(180/Math.PI));let m=!1;if(t.str.length>1)m=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const p=Math.abs(t.transform[0]),g=Math.abs(t.transform[3]);p!==g&&Math.max(p,g)/Math.min(p,g)>1.5&&(m=!0)}if(m&&(s.canvasWidth=o.vertical?t.height:t.width),this.#p.set(e,s),this.#r.div=e,this.#r.properties=s,this.#T(this.#r),s.hasText&&this.#e.append(e),s.hasEOL){const p=document.createElement("br");p.setAttribute("role","presentation"),this.#e.append(p)}}#T(t){const{div:e,properties:s,ctx:i}=t,{style:r}=e;let o="";if(me.#S>1&&(o=`scale(${1/me.#S})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:a}=r,{canvasWidth:c,fontSize:l}=s;me.#P(i,l*this.#h,a);const{width:u}=i.measureText(e.textContent);u>0&&(o=`scaleX(${c*this.#h/u}) ${o}`)}s.angle!==0&&(o=`rotate(${s.angle}deg) ${o}`),o.length>0&&(r.transform=o)}static cleanup(){if(!(this.#v.size>0)){this.#_.clear();for(const{canvas:t}of this.#b.values())t.remove();this.#b.clear()}}static#M(t=null){let e=this.#b.get(t||="");if(!e){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=t,document.body.append(s),e=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#b.set(t,e),this.#E.set(e,{size:0,family:""})}return e}static#P(t,e,s){const i=this.#E.get(t);e===i.size&&s===i.family||(t.font=`${e}px ${s}`,i.size=e,i.family=s)}static#k(){if(this.#S!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#S=t.getBoundingClientRect().height,t.remove()}static#F(t,e,s){const i=this.#_.get(t);if(i)return i;const r=this.#M(s);r.canvas.width=r.canvas.height=m_,this.#P(r,m_,t);const o=r.measureText(""),a=o.fontBoundingBoxAscent,c=Math.abs(o.fontBoundingBoxDescent);r.canvas.width=r.canvas.height=0;let l=.8;return a?l=a/(a+c):(ce.platform.isFirefox&&J("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?l=e.ascent:e.descent&&(l=1+e.descent)),this.#_.set(t,l),l}}const h$=100;function d$(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});const t=new Gp,{docId:e}=t,s=n.url?bB(n.url):null,i=n.data?_B(n.data):null,r=n.httpHeaders||null,o=n.withCredentials===!0,a=n.password??null,c=n.range instanceof $1?n.range:null,l=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:2**16;let u=n.worker instanceof se?n.worker:null;const h=n.verbosity,d=typeof n.docBaseUrl=="string"&&!el(n.docBaseUrl)?n.docBaseUrl:null,f=Ho(n.cMapUrl),m=n.cMapPacked!==!1,p=n.CMapReaderFactory||(ge?CB:e_),g=Ho(n.iccUrl),y=Ho(n.standardFontDataUrl),_=n.StandardFontDataFactory||(ge?PB:n_),b=Ho(n.wasmUrl),w=n.WasmFactory||(ge?kB:s_),v=n.stopAtErrors!==!0,A=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,S=n.isEvalSupported!==!1,T=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!ge,E=typeof n.isImageDecoderSupported=="boolean"?n.isImageDecoderSupported:!ge&&(ce.platform.isFirefox||!globalThis.chrome),P=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,x=typeof n.disableFontFace=="boolean"?n.disableFontFace:ge,I=n.fontExtraProperties===!0,V=n.enableXfa===!0,X=n.ownerDocument||globalThis.document,st=n.disableRange===!0,$=n.disableStream===!0,D=n.disableAutoFetch===!0,k=n.pdfBug===!0,L=n.CanvasFactory||(ge?xB:SB),H=n.FilterFactory||(ge?EB:TB),lt=n.enableHWA===!0,et=n.useWasm!==!1,ft=c?c.length:n.length??NaN,Jt=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!ge&&!x,ve=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:!!(p===e_&&_===n_&&w===s_&&f&&y&&b&&ar(f,document.baseURI)&&ar(y,document.baseURI)&&ar(b,document.baseURI)),Wt=null;W2(h);const yt={canvasFactory:new L({ownerDocument:X,enableHWA:lt}),filterFactory:new H({docId:e,ownerDocument:X}),cMapReaderFactory:ve?null:new p({baseUrl:f,isCompressed:m}),standardFontDataFactory:ve?null:new _({baseUrl:y}),wasmFactory:ve?null:new w({baseUrl:b})};u||(u=se.create({verbosity:h,port:Er.workerPort}),t._worker=u);const cs={docId:e,apiVersion:"5.4.449",data:i,password:a,disableAutoFetch:D,rangeChunkSize:l,length:ft,docBaseUrl:d,enableXfa:V,evaluatorOptions:{maxImageSize:A,disableFontFace:x,ignoreErrors:v,isEvalSupported:S,isOffscreenCanvasSupported:T,isImageDecoderSupported:E,canvasMaxAreaInBytes:P,fontExtraProperties:I,useSystemFonts:Jt,useWasm:et,useWorkerFetch:ve,cMapUrl:f,iccUrl:g,standardFontDataUrl:y,wasmUrl:b}},N={ownerDocument:X,pdfBug:k,styleElement:Wt,loadingParams:{disableAutoFetch:D,enableXfa:V}};return u.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const it=u.messageHandler.sendWithPromise("GetDocRequest",cs,i?[i.buffer]:null);let rt;if(c)rt=new GB(c,{disableRange:st,disableStream:$});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");const O=ar(s)?ZB:ge?a$:n$;rt=new O({url:s,length:ft,httpHeaders:r,withCredentials:o,rangeChunkSize:l,disableRange:st,disableStream:$})}return it.then(O=>{if(t.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const Qt=new cr(e,O,u.port),mt=new m$(Qt,t,rt,N,yt,lt);t._transport=mt,Qt.send("Ready",null)})}).catch(t._capability.reject),t}class Gp{static#t=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${Gp.#t++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class $1{#t=Promise.withResolvers();#e=[];#s=[];#n=[];#o=[];constructor(t,e,s=!1,i=null){this.length=t,this.initialData=e,this.progressiveDone=s,this.contentDispositionFilename=i}addRangeListener(t){this.#o.push(t)}addProgressListener(t){this.#n.push(t)}addProgressiveReadListener(t){this.#s.push(t)}addProgressiveDoneListener(t){this.#e.push(t)}onDataRange(t,e){for(const s of this.#o)s(t,e)}onDataProgress(t,e){this.#t.promise.then(()=>{for(const s of this.#n)s(t,e)})}onDataProgressiveRead(t){this.#t.promise.then(()=>{for(const e of this.#s)e(t)})}onDataProgressiveDone(){this.#t.promise.then(()=>{for(const t of this.#e)t()})}transportReady(){this.#t.resolve()}requestDataRange(t,e){_t("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class f${constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Q(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(t,e){return this._transport.getAnnotationsByType(t,e)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(t){return this._transport.extractPages(t)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class p${#t=!1;constructor(t,e,s,i=!1){this._pageIndex=t,this._pageInfo=e,this._transport=s,this._stats=i?new Yb:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new B1,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:r=!1}={}){return new _o({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:r})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Q(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,canvas:e=t.canvas,viewport:s,intent:i="display",annotationMode:r=Kn.ENABLE,transform:o=null,background:a=null,optionalContentConfigPromise:c=null,annotationCanvasMap:l=null,pageColors:u=null,printAnnotationStorage:h=null,isEditing:d=!1,recordOperations:f=!1,operationsFilter:m=null}){this._stats?.time("Overall");const p=this._transport.getRenderingIntent(i,r,h,d),{renderingIntent:g,cacheKey:y}=p;this.#t=!1,c||=this._transport.getOptionalContentConfig(g);let _=this._intentStates.get(y);_||(_=Object.create(null),this._intentStates.set(y,_)),_.streamReaderCancelTimeout&&(clearTimeout(_.streamReaderCancelTimeout),_.streamReaderCancelTimeout=null);const b=!!(g&De.PRINT);_.displayReadyCapability||(_.displayReadyCapability=Promise.withResolvers(),_.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(p));const w=!!(this._pdfBug&&globalThis.StepperManager?.enabled),v=!this.recordedBBoxes&&(f||w),A=E=>{if(_.renderTasks.delete(S),v){const P=S.gfx?.dependencyTracker.take();P&&(S.stepper&&S.stepper.setOperatorBBoxes(P,S.gfx.dependencyTracker.takeDebugMetadata()),f&&(this.recordedBBoxes=P))}b&&(this.#t=!0),this.#e(),E?(S.capability.reject(E),this._abortOperatorList({intentState:_,reason:E instanceof Error?E:new Error(E)})):S.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},S=new pi({callback:A,params:{canvas:e,canvasContext:t,dependencyTracker:v?new RB(e,_.operatorList.length,w):null,viewport:s,transform:o,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:_.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!b,pdfBug:this._pdfBug,pageColors:u,enableHWA:this._transport.enableHWA,operationsFilter:m});(_.renderTasks||=new Set).add(S);const T=S.task;return Promise.all([_.displayReadyCapability.promise,c]).then(([E,P])=>{if(this.destroyed){A();return}if(this._stats?.time("Rendering"),!(P.renderingIntent&g))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");S.initializeGraphics({transparency:E,optionalContentConfig:P}),S.operatorListChanged()}).catch(A),T}getOperatorList({intent:t="display",annotationMode:e=Kn.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){function r(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(c))}const o=this._transport.getRenderingIntent(t,e,s,i,!0);let a=this._intentStates.get(o.cacheKey);a||(a=Object.create(null),this._intentStates.set(o.cacheKey,a));let c;return a.opListReadCapability||(c=Object.create(null),c.operatorListChanged=r,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||=new Set).add(c),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(o)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>Zr.textContent(s));const e=this.streamTextContent(t);return new Promise(function(s,i){function r(){o.read().then(function({value:c,done:l}){if(l){s(a);return}a.lang??=c.lang,Object.assign(a.styles,c.styles),a.items.push(...c.items),r()},i)}const o=e.getReader(),a={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const s of e.renderTasks)t.push(s.completed),s.cancel();return this.objs.clear(),this.#t=!1,Promise.all(t)}cleanup(t=!1){this.#t=!0;const e=this.#e();return t&&e&&(this._stats&&=new Yb),e}#e(){if(!this.#t||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}_startRenderPage(t,e){const s=this._intentStates.get(e);s&&(this._stats?.timeEnd("Page Request"),s.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let s=0,i=t.length;s<i;s++)e.operatorList.fnArray.push(t.fnArray[s]),e.operatorList.argsArray.push(t.argsArray[s]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const s of e.renderTasks)s.operatorListChanged();t.lastChunk&&this.#e()}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:s,modifiedIds:i}){const{map:r,transfer:o}=s,c=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:r,modifiedIds:i},o).getReader(),l=this._intentStates.get(e);l.streamReader=c;const u=()=>{c.read().then(({value:h,done:d})=>{if(d){l.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(h,l),u())},h=>{if(l.streamReader=null,!this._transport.destroyed){if(l.operatorList){l.operatorList.lastChunk=!0;for(const d of l.renderTasks)d.operatorListChanged();this.#e()}if(l.displayReadyCapability)l.displayReadyCapability.reject(h);else if(l.opListReadCapability)l.opListReadCapability.reject(h);else throw h}})};u()}_abortOperatorList({intentState:t,reason:e,force:s=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!s){if(t.renderTasks.size>0)return;if(e instanceof $p){let i=h$;e.extraDelay>0&&e.extraDelay<1e3&&(i+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},i);return}}if(t.streamReader.cancel(new ns(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[i,r]of this._intentStates)if(r===t){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}class se{#t=Promise.withResolvers();#e=null;#s=null;#n=null;static#o=0;static#r=!1;static#i=new WeakMap;static{ge&&(this.#r=!0,Er.workerSrc||="./pdf.worker.mjs"),this._isSameOrigin=(t,e)=>{const s=URL.parse(t);if(!s?.origin||s.origin==="null")return!1;const i=new URL(e,s);return s.origin===i.origin},this._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},this.fromPort=t=>{if(rB("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return this.create(t)}}constructor({name:t=null,port:e=null,verbosity:s=G2()}={}){if(this.name=t,this.destroyed=!1,this.verbosity=s,e){if(se.#i.has(e))throw new Error("Cannot use more than one PDFWorker per port.");se.#i.set(e,this),this.#l(e)}else this.#c()}get promise(){return this.#t.promise}#a(){this.#t.resolve(),this.#e.send("configure",{verbosity:this.verbosity})}get port(){return this.#s}get messageHandler(){return this.#e}#l(t){this.#s=t,this.#e=new cr("main","worker",t),this.#e.on("ready",()=>{}),this.#a()}#c(){if(se.#r||se.#h){this.#d();return}let{workerSrc:t}=se;try{se._isSameOrigin(window.location,t)||(t=se._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),s=new cr("main","worker",e),i=()=>{r.abort(),s.destroy(),e.terminate(),this.destroyed?this.#t.reject(new Error("Worker was destroyed")):this.#d()},r=new AbortController;e.addEventListener("error",()=>{this.#n||i()},{signal:r.signal}),s.on("test",a=>{if(r.abort(),this.destroyed||!a){i();return}this.#e=s,this.#s=e,this.#n=e,this.#a()}),s.on("ready",a=>{if(r.abort(),this.destroyed){i();return}try{o()}catch{this.#d()}});const o=()=>{const a=new Uint8Array;s.send("test",a,[a.buffer])};o();return}catch{tl("The worker has been disabled.")}this.#d()}#d(){se.#r||(J("Setting up fake worker."),se.#r=!0),se._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this.#t.reject(new Error("Worker was destroyed"));return}const e=new AB;this.#s=e;const s=`fake${se.#o++}`,i=new cr(s+"_worker",s,e);t.setup(i,e),this.#e=new cr(s,s+"_worker",e),this.#a()}).catch(t=>{this.#t.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){this.destroyed=!0,this.#n?.terminate(),this.#n=null,se.#i.delete(this.#s),this.#s=null,this.#e?.destroy(),this.#e=null}static create(t){const e=this.#i.get(t?.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new se(t)}static get workerSrc(){if(Er.workerSrc)return Er.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#h(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return Q(this,"_setupFakeWorkerGlobal",(async()=>this.#h?this.#h:(await import(this.workerSrc)).WorkerMessageHandler)())}}class m${#t=new Map;#e=new Map;#s=new Map;#n=new Map;#o=null;constructor(t,e,s,i,r,o){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new B1,this.fontLoader=new gB({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.wasmFactory=r.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=o,this.setupMessageHandler()}#r(t,e=null){const s=this.#t.get(t);if(s)return s;const i=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,i),i}get annotationStorage(){return Q(this,"annotationStorage",new Vp)}getRenderingIntent(t,e=Kn.ENABLE,s=null,i=!1,r=!1){let o=De.DISPLAY,a=Ud;switch(t){case"any":o=De.ANY;break;case"display":break;case"print":o=De.PRINT;break;default:J(`getRenderingIntent - invalid intent: ${t}`)}const c=o&De.PRINT&&s instanceof x1?s:this.annotationStorage;switch(e){case Kn.DISABLE:o+=De.ANNOTATIONS_DISABLE;break;case Kn.ENABLE:break;case Kn.ENABLE_FORMS:o+=De.ANNOTATIONS_FORMS;break;case Kn.ENABLE_STORAGE:o+=De.ANNOTATIONS_STORAGE,a=c.serializable;break;default:J(`getRenderingIntent - invalid annotationMode: ${e}`)}i&&(o+=De.IS_EDITING),r&&(o+=De.OPLIST);const{ids:l,hash:u}=c.modifiedIds,h=[o,a.hash,u];return{renderingIntent:o,cacheKey:h.join("_"),annotationStorageSerializable:a,modifiedIds:l}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#o?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const s of this.#e.values())t.push(s._destroy());this.#e.clear(),this.#s.clear(),this.#n.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),me.cleanup(),this._networkStream?.cancelAllRequests(new ns("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(s,i)=>{ct(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},i.onPull=()=>{this._fullReader.read().then(function({value:r,done:o}){if(o){i.close();return}ct(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{this._fullReader.cancel(r),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),t.on("ReaderHeadersReady",async s=>{await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:r,contentLength:o}=this._fullReader;return(!i||!r)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=a=>{e.onProgress?.({loaded:a.loaded,total:a.total})}),{isStreamingSupported:i,isRangeSupported:r,contentLength:o}}),t.on("GetRangeReader",(s,i)=>{ct(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(s.begin,s.end);if(!r){i.close();return}i.onPull=()=>{r.read().then(function({value:o,done:a}){if(a){i.close();return}ct(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{i.error(o)})},i.onCancel=o=>{r.cancel(o),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,e._capability.resolve(new f$(s,this))}),t.on("DocException",s=>{e._capability.reject(Ae(s))}),t.on("PasswordRequest",s=>{this.#o=Promise.withResolvers();try{if(!e.onPassword)throw Ae(s);const i=r=>{r instanceof Error?this.#o.reject(r):this.#o.resolve({password:r})};e.onPassword(i,s.code)}catch(i){this.#o.reject(i)}return this.#o.promise}),t.on("DataLoaded",s=>{e.onProgress?.({loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),t.on("StartRenderPage",s=>{if(this.destroyed)return;this.#e.get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),t.on("commonobj",([s,i,r])=>{if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":if("error"in r){const h=r.error;J(`Error during font loading: ${h}`),this.commonObjs.resolve(s,h);break}const o=new gt(r),a=this._params.pdfBug&&globalThis.FontInspector?.enabled?(h,d)=>globalThis.FontInspector.fontAdded(h,d):null,c=new yB(o,a,r.extra,r.charProcOperatorList);this.fontLoader.bind(c).catch(()=>t.sendWithPromise("FontFallback",{id:s})).finally(()=>{!c.fontExtraProperties&&c.data&&c.clearData(),this.commonObjs.resolve(s,c)});break;case"CopyLocalImage":const{imageRef:l}=r;ct(l,"The imageRef must be defined.");for(const h of this.#e.values())for(const[,d]of h.objs)if(d?.ref===l)return d.dataLen?(this.commonObjs.resolve(s,structuredClone(d)),d.dataLen):null;break;case"FontPath":case"Image":this.commonObjs.resolve(s,r);break;case"Pattern":const u=new Gt(r);this.commonObjs.resolve(s,u.getIR());break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),t.on("obj",([s,i,r,o])=>{if(this.destroyed)return;const a=this.#e.get(i);if(!a.objs.has(s)){if(a._intentStates.size===0){o?.bitmap?.close();return}switch(r){case"Image":case"Pattern":a.objs.resolve(s,o);break;default:throw new Error(`Got unknown object type ${r}`)}}}),t.on("DocProgress",s=>{this.destroyed||e.onProgress?.({loaded:s.loaded,total:s.total})}),t.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[s.type];if(!i)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&J("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}extractPages(t){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:t})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,s=this.#s.get(e);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&this.#n.set(r.refStr,t);const o=new p$(e,r,this,this._params.pdfBug);return this.#e.set(e,o),o});return this.#s.set(e,i),i}getPageIndex(t){return jd(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#r("GetFieldObjects")}hasJSActions(){return this.#r("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(t,e){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:t,pageIndexesToSkip:e})}getDocJSActions(){return this.#r("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#r("GetOptionalContentConfig").then(e=>new WB(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#t.get(t);if(e)return e;const s=this.messageHandler.sendWithPromise(t,null).then(i=>({info:i[0],metadata:i[1]?new HB(i[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null,hasStructTree:i[2]}));return this.#t.set(t,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),me.cleanup()}}cachedPageNumber(t){if(!jd(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#n.get(e)??null}}class g${#t=null;onContinue=null;onError=null;constructor(t){this.#t=t}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}}class pi{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:s,commonObjs:i,annotationCanvasMap:r,operatorList:o,pageIndex:a,canvasFactory:c,filterFactory:l,useRequestAnimationFrame:u=!1,pdfBug:h=!1,pageColors:d=null,enableHWA:f=!1,operationsFilter:m=null}){this.callback=t,this.params=e,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=a,this.canvasFactory=c,this.filterFactory=l,this._pdfBug=h,this.pageColors=d,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=u===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new g$(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=f,this._dependencyTracker=e.dependencyTracker,this._operationsFilter=m}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(pi.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");pi.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:s,transform:i,background:r,dependencyTracker:o}=this.params,a=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Ai(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors,o),this.gfx.beginDrawing({transform:i,viewport:s,transparency:t,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),pi.#e.delete(this._canvas),t||=new $p(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),pi.#e.delete(this._canvas),this.callback())))}}const y$="5.4.449",b$="f44e5f0e6";class He{#t=null;#e=null;#s;#n=null;#o=!1;#r=!1;#i=null;#a;#l=null;#c=null;static#d=null;static get _keyboardManager(){return Q(this,"_keyboardManager",new vo([[["Escape","mac+Escape"],He.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],He.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],He.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],He.prototype._moveToPrevious],[["Home","mac+Home"],He.prototype._moveToBeginning],[["End","mac+End"],He.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#r=!1,this.#i=t):this.#r=!0,this.#c=t?._uiManager||e,this.#a=this.#c._eventBus,this.#s=t?.color?.toUpperCase()||this.#c?.highlightColors.values().next().value||"#FFFF98",He.#d||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#i&&(t.ariaControls=`${this.#i.id}_colorpicker_dropdown`);const e=this.#c._signal;t.addEventListener("click",this.#m.bind(this),{signal:e}),t.addEventListener("keydown",this.#g.bind(this),{signal:e});const s=this.#e=document.createElement("span");return s.className="swatch",s.ariaHidden="true",s.style.backgroundColor=this.#s,t.append(s),t}renderMainDropdown(){const t=this.#n=this.#h();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#h(){const t=document.createElement("div"),e=this.#c._signal;t.addEventListener("contextmenu",Je,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#i&&(t.id=`${this.#i.id}_colorpicker_dropdown`);for(const[s,i]of this.#c.highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",i),r.title=s,r.setAttribute("data-l10n-id",He.#d[s]);const o=document.createElement("span");r.append(o),o.className="swatch",o.style.backgroundColor=i,r.ariaSelected=i===this.#s,r.addEventListener("click",this.#f.bind(this,i),{signal:e}),t.append(r)}return t.addEventListener("keydown",this.#g.bind(this),{signal:e}),t}#f(t,e){e.stopPropagation(),this.#a.dispatch("switchannotationeditorparams",{source:this,type:at.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#m(t);return}const e=t.target.getAttribute("data-color");e&&this.#f(e,t)}_moveToNext(t){if(!this.#p){this.#m(t);return}if(t.target===this.#t){this.#n.firstElementChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#n?.firstElementChild||t.target===this.#t){this.#p&&this._hideDropdownFromKeyboard();return}this.#p||this.#m(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#p){this.#m(t);return}this.#n.firstElementChild?.focus()}_moveToEnd(t){if(!this.#p){this.#m(t);return}this.#n.lastElementChild?.focus()}#g(t){He._keyboardManager.exec(this,t)}#m(t){if(this.#p){this.hideDropdown();return}if(this.#o=t.detail===0,this.#l||(this.#l=new AbortController,window.addEventListener("pointerdown",this.#u.bind(this),{signal:this.#c.combinedSignal(this.#l)})),this.#t.ariaExpanded="true",this.#n){this.#n.classList.remove("hidden");return}const e=this.#n=this.#h();this.#t.append(e)}#u(t){this.#n?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#n?.classList.add("hidden"),this.#t.ariaExpanded="false",this.#l?.abort(),this.#l=null}get#p(){return this.#n&&!this.#n.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#r){if(!this.#p){this.#i?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#o})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#n)return;const e=this.#c.highlightColors.values();for(const s of this.#n.children)s.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#n?.remove(),this.#n=null}}class Jr{#t=null;#e=null;#s=null;static#n=null;constructor(t){this.#e=t,this.#s=t._uiManager,Jr.#n||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#t)return this.#t;const{editorType:t,colorType:e,color:s}=this.#e,i=this.#t=document.createElement("input");return i.type="color",i.value=s||"#000000",i.className="basicColorPicker",i.tabIndex=0,i.setAttribute("data-l10n-id",Jr.#n[t]),i.addEventListener("input",()=>{this.#s.updateParams(e,i.value)},{signal:this.#s._signal}),i}update(t){this.#t&&(this.#t.value=t)}destroy(){this.#t?.remove(),this.#t=null}hideDropdown(){}}function g_(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function er(n){return Math.max(0,Math.min(255,255*n))}class y_{static CMYK_G([t,e,s,i]){return["G",1-Math.min(1,.3*t+.59*s+.11*e+i)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=er(t),[t,t,t]}static G_HTML([t]){const e=g_(t);return`#${e}${e}${e}`}static RGB_G([t,e,s]){return["G",.3*t+.59*e+.11*s]}static RGB_rgb(t){return t.map(er)}static RGB_HTML(t){return`#${t.map(g_).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,s,i]){return["RGB",1-Math.min(1,t+i),1-Math.min(1,s+i),1-Math.min(1,e+i)]}static CMYK_rgb([t,e,s,i]){return[er(1-Math.min(1,t+i)),er(1-Math.min(1,s+i)),er(1-Math.min(1,e+i))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,s]){const i=1-t,r=1-e,o=1-s,a=Math.min(i,r,o);return["CMYK",i,r,o,a]}}class _${create(t,e,s=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${t} ${e}`),i}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){_t("Abstract method `_createSVG` called.")}}class dc extends _${_createSVG(t){return document.createElementNS(Pn,t)}}const w$=9,Ns=new WeakSet,v$=new Date().getTimezoneOffset()*60*1e3;class vh{static create(t){switch(t.data.annotationType){case Nt.LINK:return new Yp(t);case Nt.TEXT:return new S$(t);case Nt.WIDGET:switch(t.data.fieldType){case"Tx":return new T$(t);case"Btn":return t.data.radioButton?new U1(t):t.data.checkBox?new x$(t):new C$(t);case"Ch":return new P$(t);case"Sig":return new E$(t)}return new Hs(t);case Nt.POPUP:return new Hd(t);case Nt.FREETEXT:return new j1(t);case Nt.LINE:return new M$(t);case Nt.SQUARE:return new R$(t);case Nt.CIRCLE:return new O$(t);case Nt.POLYLINE:return new z1(t);case Nt.CARET:return new I$(t);case Nt.INK:return new Xp(t);case Nt.POLYGON:return new D$(t);case Nt.HIGHLIGHT:return new V1(t);case Nt.UNDERLINE:return new L$(t);case Nt.SQUIGGLY:return new N$(t);case Nt.STRIKEOUT:return new F$(t);case Nt.STAMP:return new H1(t);case Nt.FILEATTACHMENT:return new B$(t);default:return new kt(t)}}}class kt{#t=null;#e=!1;#s=null;constructor(t,{isRenderable:e=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableComment=t.enableComment,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,this.hasOwnCommentButton=!1,e&&(this.contentElement=this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t?.str||e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return kt._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:t}=this,e=this.annotationStorage?.getEditor(t.id);return e?e.getData():t}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const t=this.annotationStorage?.getEditor(this.data.id);if(t)return t.commentButtonPositionInPage;const{quadPoints:e,inkLists:s,rect:i}=this.data;let r=-1/0,o=-1/0;if(e?.length>=8){for(let a=0;a<e.length;a+=8)e[a+1]>o?(o=e[a+1],r=e[a+2]):e[a+1]===o&&(r=Math.max(r,e[a+2]));return[r,o]}if(s?.length>=1){for(const a of s)for(let c=0,l=a.length;c<l;c+=2)a[c+1]>o?(o=a[c+1],r=a[c]):a[c+1]===o&&(r=Math.max(r,a[c]));if(r!==1/0)return[r,o]}return i?[i[2],i[3]]:null}_normalizePoint(t){const{page:{view:e},viewport:{rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:o}}}=this.parent;return t[1]=e[3]-t[1]+e[1],t[0]=100*(t[0]-r)/s,t[1]=100*(t[1]-o)/i,t}get commentText(){const{data:t}=this;return this.annotationStorage.getRawValue(`${Xr}${t.id}`)?.popup?.contents||t.contentsObj?.str||""}set commentText(t){const{data:e}=this,s={deleted:!t,contents:t||""};this.annotationStorage.updateEditor(e.id,{popup:s})||this.annotationStorage.setValue(`${Xr}${e.id}`,{id:e.id,annotationType:e.annotationType,pageIndex:this.parent.page._pageIndex,popup:s,popupRef:e.popupRef,modificationDate:new Date}),t||this.removePopup()}removePopup(){(this.#s?.popup||this.popup)?.remove(),this.#s=this.popup=null}updateEdited(t){if(!this.container)return;t.rect&&(this.#t||={rect:this.data.rect.slice(0)});const{rect:e,popup:s}=t;e&&this.#n(e);let i=this.#s?.popup||this.popup;!i&&s?.text&&(this._createPopup(s),i=this.#s.popup),i&&(i.updateEdited(t),s?.deleted&&(i.remove(),this.#s=null,this.popup=null))}resetEdited(){this.#t&&(this.#n(this.#t.rect),this.#s?.popup.resetEdited(),this.#t=null)}#n(t){const{container:{style:e},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:o,pageX:a,pageY:c}}}}=this;s?.splice(0,4,...t),e.left=`${100*(t[0]-a)/r}%`,e.top=`${100*(o-t[3]+c)/o}%`,i===0?(e.width=`${100*(t[2]-t[0])/r}%`,e.height=`${100*(t[3]-t[1])/o}%`):this.setRotation(i)}_createContainer(t){const{data:e,parent:{page:s,viewport:i}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",e.id),!(this instanceof Hs)&&!(this instanceof Yp)&&(r.tabIndex=0);const{style:o}=r;if(o.zIndex=this.parent.zIndex,this.parent.zIndex+=2,e.alternativeText&&(r.title=e.alternativeText),e.noRotate&&r.classList.add("norotate"),!e.rect||this instanceof Hd){const{rotation:p}=e;return!e.hasOwnCanvas&&p!==0&&this.setRotation(p,r),r}const{width:a,height:c}=this;if(!t&&e.borderStyle.width>0){o.borderWidth=`${e.borderStyle.width}px`;const p=e.borderStyle.horizontalCornerRadius,g=e.borderStyle.verticalCornerRadius;if(p>0||g>0){const _=`calc(${p}px * var(--total-scale-factor)) / calc(${g}px * var(--total-scale-factor))`;o.borderRadius=_}else if(this instanceof U1){const _=`calc(${a}px * var(--total-scale-factor)) / calc(${c}px * var(--total-scale-factor))`;o.borderRadius=_}switch(e.borderStyle.style){case ei.SOLID:o.borderStyle="solid";break;case ei.DASHED:o.borderStyle="dashed";break;case ei.BEVELED:J("Unimplemented border style: beveled");break;case ei.INSET:J("Unimplemented border style: inset");break;case ei.UNDERLINE:o.borderBottomStyle="solid";break}const y=e.borderColor||null;y?(this.#e=!0,o.borderColor=U.makeHexColor(y[0]|0,y[1]|0,y[2]|0)):o.borderWidth=0}const l=U.normalizeRect([e.rect[0],s.view[3]-e.rect[1]+s.view[1],e.rect[2],s.view[3]-e.rect[3]+s.view[1]]),{pageWidth:u,pageHeight:h,pageX:d,pageY:f}=i.rawDims;o.left=`${100*(l[0]-d)/u}%`,o.top=`${100*(l[1]-f)/h}%`;const{rotation:m}=e;return e.hasOwnCanvas||m===0?(o.width=`${100*a/u}%`,o.height=`${100*c/h}%`):this.setRotation(m,r),r}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims;let{width:r,height:o}=this;t%180!==0&&([r,o]=[o,r]),e.style.width=`${100*r/s}%`,e.style.height=`${100*o/i}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,s,i)=>{const r=i.detail[e],o=r[0],a=r.slice(1);i.target.style[s]=y_[`${o}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[s]:y_[`${o}_rgb`](a)})};return Q(this,"_commonActions",{display:e=>{const{display:s}=e.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:s}=e.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const s=e.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(t,e){const s=this._commonActions;for(const i of Object.keys(e.detail))(t[i]||s[i])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const s=this._commonActions;for(const[i,r]of Object.entries(e)){const o=s[i];if(o){const a={detail:{[i]:r},target:t};o(a),delete e[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,s,i,r]=this.data.rect.map(p=>Math.fround(p));if(t.length===8){const[p,g,y,_]=t.subarray(2,6);if(i===p&&r===g&&e===y&&s===_)return}const{style:o}=this.container;let a;if(this.#e){const{borderColor:p,borderWidth:g}=o;o.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${p}" stroke-width="${g}">`],this.container.classList.add("hasBorder")}const c=i-e,l=r-s,{svgFactory:u}=this,h=u.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0),h.role="none";const d=u.createElement("defs");h.append(d);const f=u.createElement("clipPath"),m=`clippath_${this.data.id}`;f.setAttribute("id",m),f.setAttribute("clipPathUnits","objectBoundingBox"),d.append(f);for(let p=2,g=t.length;p<g;p+=8){const y=t[p],_=t[p+1],b=t[p+2],w=t[p+3],v=u.createElement("rect"),A=(b-e)/c,S=(r-_)/l,T=(y-b)/c,E=(_-w)/l;v.setAttribute("x",A),v.setAttribute("y",S),v.setAttribute("width",T),v.setAttribute("height",E),f.append(v),a?.push(`<rect vector-effect="non-scaling-stroke" x="${A}" y="${S}" width="${T}" height="${E}"/>`)}this.#e&&(a.push("</g></svg>')"),o.backgroundImage=a.join("")),this.container.append(h),this.container.style.clipPath=`url(#${m})`}_createPopup(t=null){const{data:e}=this;let s,i;t?(s={str:t.text},i=t.date):(s=e.contentsObj,i=e.modificationDate),this.#s=new Hd({data:{color:e.color,titleObj:e.titleObj,modificationDate:i,contentsObj:s,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]})}get hasPopupElement(){return!!(this.#s||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#s}render(){_t("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[t];if(i)for(const{page:r,id:o,exportValues:a}of i){if(r===-1||o===e)continue;const c=typeof a=="string"?a:null,l=document.querySelector(`[data-element-id="${o}"]`);if(l&&!Ns.has(l)){J(`_getElementsByName - element not allowed: ${o}`);continue}s.push({id:o,exportValue:c,domElement:l})}return s}for(const i of document.getElementsByName(t)){const{exportValue:r}=i,o=i.getAttribute("data-element-id");o!==e&&Ns.has(i)&&s.push({id:o,exportValue:r,domElement:i})}return s}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class A$ extends kt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.editor=t.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:t}=this;t.hasComment&&this._createPopup(t.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(t){this.editor.comment=t,t||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}class Yp extends kt{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let i=!1;return t.url?(e.addLinkAttributes(s,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(s,t.action,t.overlaidText),i=!0):t.attachment?(this.#e(s,t.attachment,t.overlaidText,t.attachmentDest),i=!0):t.setOCGState?(this.#s(s,t.setOCGState,t.overlaidText),i=!0):t.dest?(this._bindLink(s,t.dest,t.overlaidText),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),i=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(s,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&(this.contentElement=s,this.container.append(s)),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e,s=""){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t(),s&&(t.title=s)}_bindNamedAction(t,e,s=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),s&&(t.title=s),this.#t()}#e(t,e,s="",i=null){t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:s&&(t.title=s),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,i),!1),this.#t()}#s(t,e,s=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),s&&(t.title=s),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(e.actions)){const r=s.get(i);r&&(t[r]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:i}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){const s=t.onclick;if(s||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){J('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1);return}t.onclick=()=>{s?.();const{fields:i,refs:r,include:o}=e,a=[];if(i.length!==0||r.length!==0){const u=new Set(r);for(const h of i){const d=this._fieldObjects[h]||[];for(const{id:f}of d)u.add(f)}for(const h of Object.values(this._fieldObjects))for(const d of h)u.has(d.id)===o&&a.push(d)}else for(const u of Object.values(this._fieldObjects))a.push(...u);const c=this.annotationStorage,l=[];for(const u of a){const{id:h}=u;switch(l.push(h),u.type){case"text":{const f=u.defaultValue||"";c.setValue(h,{value:f});break}case"checkbox":case"radiobutton":{const f=u.defaultValue===u.exportValues;c.setValue(h,{value:f});break}case"combobox":case"listbox":{const f=u.defaultValue||"";c.setValue(h,{value:f});break}default:continue}const d=document.querySelector(`[data-element-id="${h}"]`);if(d){if(!Ns.has(d)){J(`_bindResetFormAction - element not allowed: ${h}`);continue}}else continue;d.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:l,name:"ResetForm"}}),!1}}}class S$ extends kt{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(t),this.container}}class Hs extends kt{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return ce.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,s,i,r){s.includes("mouse")?t.addEventListener(s,o=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):t.addEventListener(s,o=>{if(s==="blur"){if(!e.focused||!o.relatedTarget)return;e.focused=!1}else if(s==="focus"){if(e.focused)return;e.focused=!0}r&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o)}})})}_setEventListeners(t,e,s,i){for(const[r,o]of s)(o==="Action"||this.data.actions?.[o])&&((o==="Focus"||o==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,r,o,i),o==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):o==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":U.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||w$,r=t.style;let o;const a=2,c=l=>Math.round(10*l)/10;if(this.data.multiLine){const l=Math.abs(this.data.rect[3]-this.data.rect[1]-a),u=Math.round(l/(fh*i))||1,h=l/u;o=Math.min(i,c(h/fh))}else{const l=Math.abs(this.data.rect[3]-this.data.rect[1]-a);o=Math.min(i,c(l/fh))}r.fontSize=`calc(${o}px * var(--total-scale-factor))`,r.color=U.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(r.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class T$ extends Hs{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,s,i){const r=this.annotationStorage;for(const o of this._getElementsByName(t.name,t.id))o.domElement&&(o.domElement[e]=s),r.setValue(o.id,{[i]:s})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const i=t.getValue(e,{value:this.data.fieldValue});let r=i.value||"";const o=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;o&&r.length>o&&(r=r.slice(0,o));let a=i.formattedValue||this.data.textContent?.join(`
`)||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));const c={userValue:r,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=a??r,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",a??r),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Ns.add(s),this.contentElement=s,s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=0;const{datetimeFormat:l,datetimeType:u,timeStep:h}=this.data,d=!!u&&this.enableScripting;l&&(s.title=l),this._setRequired(s,this.data.required),o&&(s.maxLength=o),s.addEventListener("input",m=>{t.setValue(e,{value:m.target.value}),this.setPropertyOnSiblings(s,"value",m.target.value,"value"),c.formattedValue=null}),s.addEventListener("resetform",m=>{const p=this.data.defaultFieldValue??"";s.value=c.userValue=p,c.formattedValue=null});let f=m=>{const{formattedValue:p}=c;p!=null&&(m.target.value=p),m.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",p=>{if(c.focused)return;const{target:g}=p;if(d&&(g.type=u,h&&(g.step=h)),c.userValue){const y=c.userValue;if(d)if(u==="time"){const _=new Date(y),b=[_.getHours(),_.getMinutes(),_.getSeconds()];g.value=b.map(w=>w.toString().padStart(2,"0")).join(":")}else g.value=new Date(y-v$).toISOString().split(u==="date"?"T":".",1)[0];else g.value=y}c.lastCommittedValue=g.value,c.commitKey=1,this.data.actions?.Focus||(c.focused=!0)}),s.addEventListener("updatefromsandbox",p=>{this.showElementAndHideCanvas(p.target);const g={value(y){c.userValue=y.detail.value??"",d||t.setValue(e,{value:c.userValue.toString()}),y.target.value=c.userValue},formattedValue(y){const{formattedValue:_}=y.detail;c.formattedValue=_,_!=null&&y.target!==document.activeElement&&(y.target.value=_);const b={formattedValue:_};d&&(b.value=_),t.setValue(e,b)},selRange(y){y.target.setSelectionRange(...y.detail.selRange)},charLimit:y=>{const{charLimit:_}=y.detail,{target:b}=y;if(_===0){b.removeAttribute("maxLength");return}b.setAttribute("maxLength",_);let w=c.userValue;!w||w.length<=_||(w=w.slice(0,_),b.value=c.userValue=w,t.setValue(e,{value:w}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:w,willCommit:!0,commitKey:1,selStart:b.selectionStart,selEnd:b.selectionEnd}}))}};this._dispatchEventFromSandbox(g,p)}),s.addEventListener("keydown",p=>{c.commitKey=1;let g=-1;if(p.key==="Escape"?g=0:p.key==="Enter"&&!this.data.multiLine?g=2:p.key==="Tab"&&(c.commitKey=3),g===-1)return;const{value:y}=p.target;c.lastCommittedValue!==y&&(c.lastCommittedValue=y,c.userValue=y,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:y,willCommit:!0,commitKey:g,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}}))});const m=f;f=null,s.addEventListener("blur",p=>{if(!c.focused||!p.relatedTarget)return;this.data.actions?.Blur||(c.focused=!1);const{target:g}=p;let{value:y}=g;if(d){if(y&&u==="time"){const _=y.split(":").map(b=>parseInt(b,10));y=new Date(2e3,0,1,_[0],_[1],_[2]||0).valueOf(),g.step=""}else y.includes("T")||(y=`${y}T00:00`),y=new Date(y).valueOf();g.type="text"}c.userValue=y,c.lastCommittedValue!==y&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:y,willCommit:!0,commitKey:c.commitKey,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}}),m(p)}),this.data.actions?.Keystroke&&s.addEventListener("beforeinput",p=>{c.lastCommittedValue=null;const{data:g,target:y}=p,{value:_,selectionStart:b,selectionEnd:w}=y;let v=b,A=w;switch(p.inputType){case"deleteWordBackward":{const S=_.substring(0,b).match(/\w*[^\w]*$/);S&&(v-=S[0].length);break}case"deleteWordForward":{const S=_.substring(b).match(/^[^\w]*\w*/);S&&(A+=S[0].length);break}case"deleteContentBackward":b===w&&(v-=1);break;case"deleteContentForward":b===w&&(A+=1);break}p.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:_,change:g||"",willCommit:!1,selStart:v,selEnd:A}})}),this._setEventListeners(s,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],p=>p.target.value)}if(f&&s.addEventListener("blur",f),this.data.comb){const p=(this.data.rect[2]-this.data.rect[0])/o;s.classList.add("comb"),s.style.letterSpacing=`calc(${p}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class E$ extends Hs{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class x$ extends Hs{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.exportValue===e.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",t.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return Ns.add(r),r.setAttribute("data-element-id",s),r.disabled=e.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=e.fieldName,i&&r.setAttribute("checked",!0),r.setAttribute("exportValue",e.exportValue),r.tabIndex=0,r.addEventListener("change",o=>{const{name:a,checked:c}=o.target;for(const l of this._getElementsByName(a,s)){const u=c&&l.exportValue===e.exportValue;l.domElement&&(l.domElement.checked=u),t.setValue(l.id,{value:u})}t.setValue(s,{value:c})}),r.addEventListener("resetform",o=>{const a=e.defaultFieldValue||"Off";o.target.checked=a===e.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",o=>{const a={value(c){c.target.checked=c.detail.value!=="Off",t.setValue(s,{value:c.target.checked})}};this._dispatchEventFromSandbox(a,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class U1 extends Hs{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.fieldValue===e.buttonValue}).value;if(typeof i=="string"&&(i=i!==e.buttonValue,t.setValue(s,{value:i})),i)for(const o of this._getElementsByName(e.fieldName,s))t.setValue(o.id,{value:!1});const r=document.createElement("input");if(Ns.add(r),r.setAttribute("data-element-id",s),r.disabled=e.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=e.fieldName,i&&r.setAttribute("checked",!0),r.tabIndex=0,r.addEventListener("change",o=>{const{name:a,checked:c}=o.target;for(const l of this._getElementsByName(a,s))t.setValue(l.id,{value:!1});t.setValue(s,{value:c})}),r.addEventListener("resetform",o=>{const a=e.defaultFieldValue;o.target.checked=a!=null&&a===e.buttonValue}),this.enableScripting&&this.hasJSActions){const o=e.buttonValue;r.addEventListener("updatefromsandbox",a=>{const c={value:l=>{const u=o===l.detail.value;for(const h of this._getElementsByName(l.target.name)){const d=u&&h.id===s;h.domElement&&(h.domElement.checked=d),t.setValue(h.id,{value:d})}}};this._dispatchEventFromSandbox(c,a)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class C$ extends Yp{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),t}}class P$ extends Hs{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,s=t.getValue(e,{value:this.data.fieldValue}),i=document.createElement("select");Ns.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",u=>{const h=this.data.defaultFieldValue;for(const d of i.options)d.selected=d.value===h});for(const u of this.data.options){const h=document.createElement("option");h.textContent=u.displayValue,h.value=u.exportValue,s.value.includes(u.exportValue)&&(h.setAttribute("selected",!0),r=!1),i.append(h)}let o=null;if(r){const u=document.createElement("option");u.value=" ",u.setAttribute("hidden",!0),u.setAttribute("selected",!0),i.prepend(u),o=()=>{u.remove(),i.removeEventListener("input",o),o=null},i.addEventListener("input",o)}const a=u=>{const h=u?"value":"textContent",{options:d,multiple:f}=i;return f?Array.prototype.filter.call(d,m=>m.selected).map(m=>m[h]):d.selectedIndex===-1?null:d[d.selectedIndex][h]};let c=a(!1);const l=u=>{const h=u.target.options;return Array.prototype.map.call(h,d=>({displayValue:d.textContent,exportValue:d.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",u=>{const h={value(d){o?.();const f=d.detail.value,m=new Set(Array.isArray(f)?f:[f]);for(const p of i.options)p.selected=m.has(p.value);t.setValue(e,{value:a(!0)}),c=a(!1)},multipleSelection(d){i.multiple=!0},remove(d){const f=i.options,m=d.detail.remove;f[m].selected=!1,i.remove(m),f.length>0&&Array.prototype.findIndex.call(f,g=>g.selected)===-1&&(f[0].selected=!0),t.setValue(e,{value:a(!0),items:l(d)}),c=a(!1)},clear(d){for(;i.length!==0;)i.remove(0);t.setValue(e,{value:null,items:[]}),c=a(!1)},insert(d){const{index:f,displayValue:m,exportValue:p}=d.detail.insert,g=i.children[f],y=document.createElement("option");y.textContent=m,y.value=p,g?g.before(y):i.append(y),t.setValue(e,{value:a(!0),items:l(d)}),c=a(!1)},items(d){const{items:f}=d.detail;for(;i.length!==0;)i.remove(0);for(const m of f){const{displayValue:p,exportValue:g}=m,y=document.createElement("option");y.textContent=p,y.value=g,i.append(y)}i.options.length>0&&(i.options[0].selected=!0),t.setValue(e,{value:a(!0),items:l(d)}),c=a(!1)},indices(d){const f=new Set(d.detail.indices);for(const m of d.target.options)m.selected=f.has(m.index);t.setValue(e,{value:a(!0)}),c=a(!1)},editable(d){d.target.disabled=!d.detail.editable}};this._dispatchEventFromSandbox(h,u)}),i.addEventListener("input",u=>{const h=a(!0),d=a(!1);t.setValue(e,{value:h}),u.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:c,change:d,changeEx:h,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],u=>u.target.value)):i.addEventListener("input",function(u){t.setValue(e,{value:a(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Hd extends kt{constructor(t){const{data:e,elements:s,parent:i}=t,r=!!i._commentManager;if(super(t,{isRenderable:!r&&kt._hasPopupData(e)}),this.elements=s,r&&kt._hasPopupData(e)){const o=this.popup=this.#t();for(const a of s)a.popup=o}else this.popup=null}#t(){return new k$({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=this.#t(),s=[];for(const i of this.elements)i.popup=e,i.container.ariaHasPopup="dialog",s.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",s.map(i=>`${di}${i}`).join(",")),this.container}}class k${#t=null;#e=this.#H.bind(this);#s=this.#$.bind(this);#n=this.#D.bind(this);#o=this.#A.bind(this);#r=null;#i=null;#a=null;#l=null;#c=null;#d=null;#h=null;#f=!1;#g=null;#m=null;#u=null;#p=null;#y=null;#_=null;#b=null;#E=null;#S=null;#v=null;#C=!1;#w=null;#T=null;constructor({container:t,color:e,elements:s,titleObj:i,modificationDate:r,contentsObj:o,richText:a,parent:c,rect:l,parentRect:u,open:h,commentManager:d=null}){this.#i=t,this.#S=i,this.#a=o,this.#E=a,this.#d=c,this.#r=e,this.#b=l,this.#h=u,this.#c=s,this.#t=d,this.#w=s[0],this.#l=Fd.toDateObject(r),this.trigger=s.flatMap(f=>f.getElementsToTriggerPopup()),d||(this.#M(),this.#i.hidden=!0,h&&this.#A())}#M(){if(this.#m)return;this.#m=new AbortController;const{signal:t}=this.#m;for(const e of this.trigger)e.addEventListener("click",this.#o,{signal:t}),e.addEventListener("pointerenter",this.#n,{signal:t}),e.addEventListener("pointerleave",this.#s,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#c)e.container?.addEventListener("keydown",this.#e,{signal:t})}#P(){const t=this.#c.find(e=>e.hasCommentButton);t&&(this.#y=t._normalizePoint(t.commentButtonPosition))}renderCommentButton(){if(this.#p){this.#p.parentNode||this.#w.container.after(this.#p);return}if(this.#y||this.#P(),!this.#y)return;const{signal:t}=this.#m=new AbortController,e=this.#w.hasOwnCommentButton,s=()=>{this.#t.toggleCommentPopup(this,!0,void 0,!e)},i=()=>{this.#t.toggleCommentPopup(this,!1,!0,!e)},r=()=>{this.#t.toggleCommentPopup(this,!1,!1)};if(e){this.#p=this.#w.container;for(const o of this.trigger)o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.addEventListener("keydown",this.#e,{signal:t}),o.addEventListener("click",s,{signal:t}),o.addEventListener("pointerenter",i,{signal:t}),o.addEventListener("pointerleave",r,{signal:t}),o.classList.add("popupTriggerArea")}else{const o=this.#p=document.createElement("button");o.className="annotationCommentButton";const a=this.#w.container;o.style.zIndex=a.style.zIndex+1,o.tabIndex=0,o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#F(),this.#k(),o.addEventListener("keydown",this.#e,{signal:t}),o.addEventListener("click",s,{signal:t}),o.addEventListener("pointerenter",i,{signal:t}),o.addEventListener("pointerleave",r,{signal:t}),a.after(o)}}#k(){if(this.#w.extraPopupElement&&!this.#w.editor)return;this.#p||this.renderCommentButton();const[t,e]=this.#y,{style:s}=this.#p;s.left=`calc(${t}%)`,s.top=`calc(${e}% - var(--comment-button-dim))`}#F(){this.#w.extraPopupElement||(this.#p||this.renderCommentButton(),this.#p.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:t,opacity:e}=this.#w.commentData;return t?this.#d._commentManager.makeCommentColor(t,e):null}focusCommentButton(){setTimeout(()=>{this.#p?.focus()},0)}getData(){const{richText:t,color:e,opacity:s,creationDate:i,modificationDate:r}=this.#w.commentData;return{contentsObj:{str:this.comment},richText:t,color:e,opacity:s,creationDate:i,modificationDate:r}}get elementBeforePopup(){return this.#p}get comment(){return this.#T||=this.#w.commentText,this.#T}set comment(t){t!==this.comment&&(this.#w.commentText=this.#T=t)}focus(){this.#w.container?.focus()}get parentBoundingClientRect(){return this.#w.layer.getBoundingClientRect()}setCommentButtonStates({selected:t,hasPopup:e}){this.#p&&(this.#p.classList.toggle("selected",t),this.#p.ariaExpanded=e)}setSelectedCommentButton(t){this.#p.classList.toggle("selected",t)}get commentPopupPosition(){if(this.#_)return this.#_;const{x:t,y:e,height:s}=this.#p.getBoundingClientRect(),{x:i,y:r,width:o,height:a}=this.#w.layer.getBoundingClientRect();return[(t-i)/o,(e+s-r)/a]}set commentPopupPosition(t){this.#_=t}hasDefaultPopupPosition(){return this.#_===null}get commentButtonPosition(){return this.#y}get commentButtonWidth(){return this.#p.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(t){const[e,s]=this.#_||this.commentButtonPosition.map(l=>l/100),i=this.parentBoundingClientRect,{x:r,y:o,width:a,height:c}=i;this.#t.showDialog(null,this,r+e*a,o+s*c,{...t,parentDimensions:i})}render(){if(this.#g)return;const t=this.#g=document.createElement("div");if(t.className="popup",this.#r){const s=t.style.outlineColor=U.makeHexColor(...this.#r);t.style.backgroundColor=`color-mix(in srgb, ${s} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#S?.str){const s=document.createElement("span");s.className="title",e.append(s),{dir:s.dir,str:s.textContent}=this.#S}if(t.append(e),this.#l){const s=document.createElement("time");s.className="popupDate",s.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),s.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#l.valueOf()})),s.dateTime=this.#l.toISOString(),e.append(s)}A1({html:this.#O||this.#a.str,dir:this.#a?.dir,className:"popupContent"},t),this.#i.append(t)}get#O(){const t=this.#E,e=this.#a;return t?.str&&(!e?.str||e.str===t.str)&&this.#E.html||null}get#I(){return this.#O?.attributes?.style?.fontSize||0}get#B(){return this.#O?.attributes?.style?.color||null}#L(t){const e=[],s={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},i={style:{color:this.#B,fontSize:this.#I?`calc(${this.#I}px * var(--total-scale-factor))`:""}};for(const r of t.split(`
`))e.push({name:"span",value:r,attributes:i});return s}#H(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#f)&&this.#A()}updateEdited({rect:t,popup:e,deleted:s}){if(this.#t){s?(this.remove(),this.#T=null):e&&(e.deleted?this.remove():(this.#F(),this.#T=e.text)),t&&(this.#y=null,this.#P(),this.#k());return}if(s||e?.deleted){this.remove();return}this.#M(),this.#v||={contentsObj:this.#a,richText:this.#E},t&&(this.#u=null),e&&e.text&&(this.#E=this.#L(e.text),this.#l=Fd.toDateObject(e.date),this.#a=null),this.#g?.remove(),this.#g=null}resetEdited(){this.#v&&({contentsObj:this.#a,richText:this.#E}=this.#v,this.#v=null,this.#g?.remove(),this.#g=null,this.#u=null)}remove(){if(this.#m?.abort(),this.#m=null,this.#g?.remove(),this.#g=null,this.#C=!1,this.#f=!1,this.#p?.remove(),this.#p=null,this.trigger)for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#x(){if(this.#u!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:s,pageX:i,pageY:r}}}=this.#d;let o=!!this.#h,a=o?this.#h:this.#b;for(const m of this.#c)if(!a||U.intersect(m.data.rect,a)!==null){a=m.data.rect,o=!0;break}const c=U.normalizeRect([a[0],t[3]-a[1]+t[1],a[2],t[3]-a[3]+t[1]]),u=o?a[2]-a[0]+5:0,h=c[0]+u,d=c[1];this.#u=[100*(h-i)/e,100*(d-r)/s];const{style:f}=this.#i;f.left=`${this.#u[0]}%`,f.top=`${this.#u[1]}%`}#A(){if(this.#t){this.#t.toggleCommentPopup(this,!1);return}this.#f=!this.#f,this.#f?(this.#D(),this.#i.addEventListener("click",this.#o),this.#i.addEventListener("keydown",this.#e)):(this.#$(),this.#i.removeEventListener("click",this.#o),this.#i.removeEventListener("keydown",this.#e))}#D(){this.#g||this.render(),this.isVisible?this.#f&&this.#i.classList.add("focused"):(this.#x(),this.#i.hidden=!1,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)+1e3)}#$(){this.#i.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#i.hidden=!0,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)-1e3)}forceHide(){this.#C=this.isVisible,this.#C&&(this.#i.hidden=!0)}maybeShow(){this.#t||(this.#M(),this.#C&&(this.#g||this.#D(),this.#C=!1,this.#i.hidden=!1))}get isVisible(){return this.#t?!1:this.#i.hidden===!1}}class j1 extends kt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=tt.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=this.contentElement=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const s=document.createElement("span");s.textContent=e,t.append(s)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class M$ extends kt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),r=this.#t=this.svgFactory.createElement("svg:line");return r.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),r.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),r.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),r.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),r.setAttribute("stroke-width",t.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class R$ extends kt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),r=t.borderStyle.width,o=this.#t=this.svgFactory.createElement("svg:rect");return o.setAttribute("x",r/2),o.setAttribute("y",r/2),o.setAttribute("width",e-r),o.setAttribute("height",s-r),o.setAttribute("stroke-width",r||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class O$ extends kt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),r=t.borderStyle.width,o=this.#t=this.svgFactory.createElement("svg:ellipse");return o.setAttribute("cx",e/2),o.setAttribute("cy",s/2),o.setAttribute("rx",e/2-r/2),o.setAttribute("ry",s/2-r/2),o.setAttribute("stroke-width",r||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class z1 extends kt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:s,popupRef:i},width:r,height:o}=this;if(!e)return this.container;const a=this.svgFactory.create(r,o,!0);let c=[];for(let u=0,h=e.length;u<h;u+=2){const d=e[u]-t[0],f=t[3]-e[u+1];c.push(`${d},${f}`)}c=c.join(" ");const l=this.#t=this.svgFactory.createElement(this.svgElementName);return l.setAttribute("points",c),l.setAttribute("stroke-width",s.width||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),a.append(l),this.container.append(a),!i&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class D$ extends z1{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class I$ extends kt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}class Xp extends kt{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?tt.HIGHLIGHT:tt.INK}#s(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:s,borderStyle:i,popupRef:r}}=this,{transform:o,width:a,height:c}=this.#s(e,t),l=this.svgFactory.create(a,c,!0),u=this.#t=this.svgFactory.createElement("svg:g");l.append(u),u.setAttribute("stroke-width",i.width||1),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-linejoin","round"),u.setAttribute("stroke-miterlimit",10),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),u.setAttribute("transform",o);for(let h=0,d=s.length;h<d;h++){const f=this.svgFactory.createElement(this.svgElementName);this.#e.push(f),f.setAttribute("points",s[h].join(",")),u.append(f)}return!r&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(l),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:s,rect:i}=t,r=this.#t;if(e>=0&&r.setAttribute("stroke-width",e||1),s)for(let o=0,a=this.#e.length;o<a;o++)this.#e[o].setAttribute("points",s[o].join(","));if(i){const{transform:o,width:a,height:c}=this.#s(this.data.rotation,i);r.parentElement.setAttribute("viewBox",`0 0 ${a} ${c}`),r.setAttribute("transform",o)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class V1 extends kt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=tt.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const s=document.createElement("mark");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class L$ extends kt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),t){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class N$ extends kt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),t){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class F$ extends kt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),t){const s=document.createElement("s");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class H1 extends kt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=tt.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class B$ extends kt{#t=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let s;e.hasAppearance||e.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),s.addEventListener("dblclick",this.#e.bind(this)),this.#t=s;const{isMac:i}=ce.platform;return t.addEventListener("keydown",r=>{r.key==="Enter"&&(i?r.metaKey:r.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class Kp{#t=null;#e=null;#s=null;#n=new Map;#o=null;#r=null;#i=[];#a=!1;constructor({div:t,accessibilityManager:e,annotationCanvasMap:s,annotationEditorUIManager:i,page:r,viewport:o,structTreeLayer:a,commentManager:c,linkService:l,annotationStorage:u}){this.div=t,this.#t=e,this.#e=s,this.#o=a||null,this.#r=l||null,this.#s=u||new Vp,this.page=r,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=i,this._commentManager=c||null}hasEditableAnnotations(){return this.#n.size>0}async render(t){const{annotations:e}=t,s=this.div;Ls(s,this.viewport);const i=new Map,r=[],o={data:null,layer:s,linkService:this.#r,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new dc,annotationStorage:this.#s,enableComment:t.enableComment===!0,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const a of e){if(a.noHTML)continue;const c=a.annotationType===Nt.POPUP;if(c){const h=i.get(a.id);if(!h)continue;if(!this._commentManager){r.push(a);continue}o.elements=h}else if(a.rect[2]===a.rect[0]||a.rect[3]===a.rect[1])continue;o.data=a;const l=vh.create(o);if(!l.isRenderable)continue;if(!c&&(this.#i.push(l),a.popupRef)){const h=i.get(a.popupRef);h?h.push(l):i.set(a.popupRef,[l])}const u=l.render();a.hidden&&(u.style.visibility="hidden"),l._isEditable&&(this.#n.set(l.data.id,l),this._annotationEditorUIManager?.renderAnnotationElement(l))}await this.#l();for(const a of r){const c=o.elements=i.get(a.id);o.data=a;const l=vh.create(o);if(!l.isRenderable)continue;const u=l.render();l.contentElement.id=`${di}${a.id}`,a.hidden&&(u.style.visibility="hidden"),c.at(-1).container.after(u)}this.#c()}async#l(){if(this.#i.length===0)return;this.div.replaceChildren();const t=[];if(!this.#a){this.#a=!0;for(const{contentElement:s,data:{id:i}}of this.#i){const r=s.id=`${di}${i}`;t.push(this.#o?.getAriaAttributes(r).then(o=>{if(o)for(const[a,c]of o)s.setAttribute(a,c)}))}}this.#i.sort(({data:{rect:[s,i,r,o]}},{data:{rect:[a,c,l,u]}})=>{if(s===r&&i===o)return 1;if(a===l&&c===u)return-1;const h=o,d=i,f=(i+o)/2,m=u,p=c,g=(c+u)/2;if(f>=m&&g<=d)return-1;if(g>=h&&f<=p)return 1;const y=(s+r)/2,_=(a+l)/2;return y-_});const e=document.createDocumentFragment();for(const s of this.#i)e.append(s.container),this._commentManager?(s.extraPopupElement?.popup||s.popup)?.renderCommentButton():s.extraPopupElement&&e.append(s.extraPopupElement.render());if(this.div.append(e),await Promise.all(t),this.#t)for(const s of this.#i)this.#t.addPointerInTextLayer(s.contentElement,!1)}async addLinkAnnotations(t){const e={data:null,layer:this.div,linkService:this.#r,svgFactory:new dc,parent:this};for(const s of t){s.borderStyle||=Kp._defaultBorderStyle,e.data=s;const i=vh.create(e);i.isRenderable&&(i.render(),i.contentElement.id=`${di}${s.id}`,this.#i.push(i))}await this.#l()}update({viewport:t}){const e=this.div;this.viewport=t,Ls(e,{rotation:t.rotation}),this.#c(),e.hidden=!1}#c(){if(!this.#e)return;const t=this.div;for(const[e,s]of this.#e){const i=t.querySelector(`[data-annotation-id="${e}"]`);if(!i)continue;s.className="annotationContent";const{firstChild:r}=i;r?r.nodeName==="CANVAS"?r.replaceWith(s):r.classList.contains("annotationContent")?r.after(s):r.before(s):i.append(s);const o=this.#n.get(e);o&&(o._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,i.id,s),o._hasNoCanvas=!1):o.canvas=s)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#n.values())}getEditableAnnotation(t){return this.#n.get(t)}addFakeAnnotation(t){const{div:e}=this,{id:s,rotation:i}=t,r=new A$({data:{id:s,rect:t.getPDFRect(),rotation:i},editor:t,layer:e,parent:this,enableComment:!!this._commentManager,linkService:this.#r,annotationStorage:this.#s});return r.render(),r.contentElement.id=`${di}${s}`,r.createOrUpdatePopup(),this.#i.push(r),r}removeAnnotation(t){const e=this.#i.findIndex(i=>i.data.id===t);if(e<0)return;const[s]=this.#i.splice(e,1);this.#t?.removePointerInTextLayer(s.contentElement)}updateFakeAnnotations(t){if(t.length!==0){for(const e of t)e.updateFakeAnnotationElement(this);this.#l()}}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}static get _defaultBorderStyle(){return Q(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:ei.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const Ko=/\r\n?|\n/g;class Yt extends W{#t="";#e=`${this.id}-editor`;#s=null;#n;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=Yt.prototype,e=r=>r.isEmpty(),s=ss.TRANSLATE_SMALL,i=ss.TRANSLATE_BIG;return Q(this,"_keyboardManager",new vo([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}]]))}static _type="freetext";static _editorType=tt.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.color=t.color||Yt._defaultColor||W._defaultLineColor,this.#n=t.fontSize||Yt._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static initialize(t,e){W.initialize(t,e);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case at.FREETEXT_SIZE:Yt._defaultFontSize=e;break;case at.FREETEXT_COLOR:Yt._defaultColor=e;break}}updateParams(t,e){switch(t){case at.FREETEXT_SIZE:this.#o(e);break;case at.FREETEXT_COLOR:this.#r(e);break}}static get defaultPropertiesToUpdate(){return[[at.FREETEXT_SIZE,Yt._defaultFontSize],[at.FREETEXT_COLOR,Yt._defaultColor||W._defaultLineColor]]}get propertiesToUpdate(){return[[at.FREETEXT_SIZE,this.#n],[at.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new Jr(this),[["colorPicker",this._colorPicker]]}get colorType(){return at.FREETEXT_COLOR}#o(t){const e=i=>{this.editorDiv.style.fontSize=`calc(${i}px * var(--total-scale-factor))`,this.translate(0,-(i-this.#n)*this.parentScale),this.#n=i,this.#a()},s=this.#n;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:at.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#r(t){const e=i=>{this.color=i,this.onUpdatedColor()},s=this.color;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:at.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-Yt._internalPadding*t,-(Yt._internalPadding+this.#n)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#s=new AbortController;const t=this._uiManager.combinedSignal(this.#s);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#e),this._isDraggable=!0,this.#s?.abort(),this.#s=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#i(){const t=[];this.editorDiv.normalize();let e=null;for(const s of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&s.nodeName==="BR"||(t.push(Yt.#l(s)),e=s);return t.join(`
`)}#a(){const[t,e]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:i,div:r}=this,o=r.style.display,a=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",i.div.append(this.div),s=r.getBoundingClientRect(),r.remove(),r.style.display=o,r.classList.toggle("hidden",a)}this.rotation%180===this.parentRotation%180?(this.width=s.width/t,this.height=s.height/e):(this.width=s.height/t,this.height=s.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#t,e=this.#t=this.#i().trimEnd();if(t===e)return;const s=i=>{if(this.#t=i,!i){this.remove();return}this.#c(),this._uiManager.rebuild(this),this.#a()};this.addCommands({cmd:()=>{s(e)},undo:()=>{s(t)},mustExec:!1}),this.#a()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Yt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#e),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${this.#n}px * var(--total-scale-factor))`,s.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[i,r]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[a,c]=this.getInitialTranslation();[a,c]=this.pageTranslationToScreen(a,c);const[l,u]=this.pageDimensions,[h,d]=this.pageTranslation;let f,m;switch(this.rotation){case 0:f=t+(o[0]-h)/l,m=e+this.height-(o[1]-d)/u;break;case 90:f=t+(o[0]-h)/l,m=e-(o[1]-d)/u,[a,c]=[c,-a];break;case 180:f=t-this.width+(o[0]-h)/l,m=e-(o[1]-d)/u,[a,c]=[-a,-c];break;case 270:f=t+(o[0]-h-this.height*u)/l,m=e+(o[1]-d-this.width*l)/u,[a,c]=[-c,a];break}this.setAt(f*i,m*r,a,c)}else this._moveAfterPaste(t,e);this.#c(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#l(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Ko,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:s}=e;if(s.length===1&&s[0]==="text/plain")return;t.preventDefault();const i=Yt.#h(e.getData("text")||"").replaceAll(Ko,`
`);if(!i)return;const r=window.getSelection();if(!r.rangeCount)return;this.editorDiv.normalize(),r.deleteFromDocument();const o=r.getRangeAt(0);if(!i.includes(`
`)){o.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),r.collapseToStart();return}const{startContainer:a,startOffset:c}=o,l=[],u=[];if(a.nodeType===Node.TEXT_NODE){const f=a.parentElement;if(u.push(a.nodeValue.slice(c).replaceAll(Ko,"")),f!==this.editorDiv){let m=l;for(const p of this.editorDiv.childNodes){if(p===f){m=u;continue}m.push(Yt.#l(p))}}l.push(a.nodeValue.slice(0,c).replaceAll(Ko,""))}else if(a===this.editorDiv){let f=l,m=0;for(const p of this.editorDiv.childNodes)m++===c&&(f=u),f.push(Yt.#l(p))}this.#t=`${l.join(`
`)}${i}${u.join(`
`)}`,this.#c();const h=new Range;let d=Math.sumPrecise(l.map(f=>f.length));for(const{firstChild:f}of this.editorDiv.childNodes)if(f.nodeType===Node.TEXT_NODE){const m=f.nodeValue.length;if(d<=m){h.setStart(f,d),h.setEnd(f,d);break}d-=m}r.removeAllRanges(),r.addRange(h)}#c(){if(this.editorDiv.replaceChildren(),!!this.#t)for(const t of this.#t.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#d(){return this.#t.replaceAll(""," ")}static#h(t){return t.replaceAll(" ","")}get contentDiv(){return this.editorDiv}getPDFRect(){const t=Yt._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,e,s){let i=null;if(t instanceof j1){const{data:{defaultAppearanceData:{fontSize:o,fontColor:a},rect:c,rotation:l,id:u,popupRef:h,richText:d,contentsObj:f,creationDate:m,modificationDate:p},textContent:g,textPosition:y,parent:{page:{pageNumber:_}}}=t;if(!g||g.length===0)return null;i=t={annotationType:tt.FREETEXT,color:Array.from(a),fontSize:o,value:g.join(`
`),position:y,pageIndex:_-1,rect:c.slice(0),rotation:l,annotationElementId:u,id:u,deleted:!1,popupRef:h,comment:f?.str||null,richText:d,creationDate:m,modificationDate:p}}const r=await super.deserialize(t,e,s);return r.#n=t.fontSize,r.color=U.makeHexColor(...t.color),r.#t=Yt.#h(t.value),r._initialData=i,t.comment&&r.setCommentData(t),r}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=W._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),s=Object.assign(super.serialize(t),{color:e,fontSize:this.#n,value:this.#d()});return this.addComment(s),t?(s.isCopy=!0,s):this.annotationElementId&&!this.#f(s)?null:(s.id=this.annotationElementId,s)}#f(t){const{value:e,fontSize:s,color:i,pageIndex:r}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==s||t.color.some((o,a)=>o!==i[a])||t.pageIndex!==r}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(!e)return null;const{style:s}=e;s.fontSize=`calc(${this.#n}px * var(--total-scale-factor))`,s.color=this.color,e.replaceChildren();for(const i of this.#t.split(`
`)){const r=document.createElement("div");r.append(i?document.createTextNode(i):document.createElement("br")),e.append(r)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#t}}),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class F{static PRECISION=1e-4;toSVGPath(){_t("Abstract method `toSVGPath` must be implemented.")}get box(){_t("Abstract getter `box` must be implemented.")}serialize(t,e){_t("Abstract method `serialize` must be implemented.")}static _rescale(t,e,s,i,r,o){o||=new Float32Array(t.length);for(let a=0,c=t.length;a<c;a+=2)o[a]=e+t[a]*i,o[a+1]=s+t[a+1]*r;return o}static _rescaleAndSwap(t,e,s,i,r,o){o||=new Float32Array(t.length);for(let a=0,c=t.length;a<c;a+=2)o[a]=e+t[a+1]*i,o[a+1]=s+t[a]*r;return o}static _translate(t,e,s,i){i||=new Float32Array(t.length);for(let r=0,o=t.length;r<o;r+=2)i[r]=e+t[r],i[r+1]=s+t[r+1];return i}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,s,i,r){switch(r){case 90:return[1-e/s,t/i];case 180:return[1-t/s,1-e/i];case 270:return[e/s,1-t/i];default:return[t/s,e/i]}}static _normalizePagePoint(t,e,s){switch(s){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,s,i,r,o){return[(t+5*s)/6,(e+5*i)/6,(5*s+r)/6,(5*i+o)/6,(s+r)/2,(i+o)/2]}}class As{#t;#e=[];#s;#n;#o=[];#r=new Float32Array(18);#i;#a;#l;#c;#d;#h;#f=[];static#g=8;static#m=2;static#u=As.#g+As.#m;constructor({x:t,y:e},s,i,r,o,a=0){this.#t=s,this.#h=r*i,this.#n=o,this.#r.set([NaN,NaN,NaN,NaN,t,e],6),this.#s=a,this.#c=As.#g*i,this.#l=As.#u*i,this.#d=i,this.#f.push(t,e)}isEmpty(){return isNaN(this.#r[8])}#p(){const t=this.#r.subarray(4,6),e=this.#r.subarray(16,18),[s,i,r,o]=this.#t;return[(this.#i+(t[0]-e[0])/2-s)/r,(this.#a+(t[1]-e[1])/2-i)/o,(this.#i+(e[0]-t[0])/2-s)/r,(this.#a+(e[1]-t[1])/2-i)/o]}add({x:t,y:e}){this.#i=t,this.#a=e;const[s,i,r,o]=this.#t;let[a,c,l,u]=this.#r.subarray(8,12);const h=t-l,d=e-u,f=Math.hypot(h,d);if(f<this.#l)return!1;const m=f-this.#c,p=m/f,g=p*h,y=p*d;let _=a,b=c;a=l,c=u,l+=g,u+=y,this.#f?.push(t,e);const w=-y/m,v=g/m,A=w*this.#h,S=v*this.#h;return this.#r.set(this.#r.subarray(2,8),0),this.#r.set([l+A,u+S],4),this.#r.set(this.#r.subarray(14,18),12),this.#r.set([l-A,u-S],16),isNaN(this.#r[6])?(this.#o.length===0&&(this.#r.set([a+A,c+S],2),this.#o.push(NaN,NaN,NaN,NaN,(a+A-s)/r,(c+S-i)/o),this.#r.set([a-A,c-S],14),this.#e.push(NaN,NaN,NaN,NaN,(a-A-s)/r,(c-S-i)/o)),this.#r.set([_,b,a,c,l,u],6),!this.isEmpty()):(this.#r.set([_,b,a,c,l,u],6),Math.abs(Math.atan2(b-c,_-a)-Math.atan2(y,g))<Math.PI/2?([a,c,l,u]=this.#r.subarray(2,6),this.#o.push(NaN,NaN,NaN,NaN,((a+l)/2-s)/r,((c+u)/2-i)/o),[a,c,_,b]=this.#r.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((_+a)/2-s)/r,((b+c)/2-i)/o),!0):([_,b,a,c,l,u]=this.#r.subarray(0,6),this.#o.push(((_+5*a)/6-s)/r,((b+5*c)/6-i)/o,((5*a+l)/6-s)/r,((5*c+u)/6-i)/o,((a+l)/2-s)/r,((c+u)/2-i)/o),[l,u,a,c,_,b]=this.#r.subarray(12,18),this.#e.push(((_+5*a)/6-s)/r,((b+5*c)/6-i)/o,((5*a+l)/6-s)/r,((5*c+u)/6-i)/o,((a+l)/2-s)/r,((c+u)/2-i)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#o,e=this.#e;if(isNaN(this.#r[6])&&!this.isEmpty())return this.#y();const s=[];s.push(`M${t[4]} ${t[5]}`);for(let i=6;i<t.length;i+=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);this.#b(s);for(let i=e.length-6;i>=6;i-=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);return this.#_(s),s.join(" ")}#y(){const[t,e,s,i]=this.#t,[r,o,a,c]=this.#p();return`M${(this.#r[2]-t)/s} ${(this.#r[3]-e)/i} L${(this.#r[4]-t)/s} ${(this.#r[5]-e)/i} L${r} ${o} L${a} ${c} L${(this.#r[16]-t)/s} ${(this.#r[17]-e)/i} L${(this.#r[14]-t)/s} ${(this.#r[15]-e)/i} Z`}#_(t){const e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#b(t){const[e,s,i,r]=this.#t,o=this.#r.subarray(4,6),a=this.#r.subarray(16,18),[c,l,u,h]=this.#p();t.push(`L${(o[0]-e)/i} ${(o[1]-s)/r} L${c} ${l} L${u} ${h} L${(a[0]-e)/i} ${(a[1]-s)/r}`)}newFreeDrawOutline(t,e,s,i,r,o){return new q1(t,e,s,i,r,o)}getOutlines(){const t=this.#o,e=this.#e,s=this.#r,[i,r,o,a]=this.#t,c=new Float32Array((this.#f?.length??0)+2);for(let h=0,d=c.length-2;h<d;h+=2)c[h]=(this.#f[h]-i)/o,c[h+1]=(this.#f[h+1]-r)/a;if(c[c.length-2]=(this.#i-i)/o,c[c.length-1]=(this.#a-r)/a,isNaN(s[6])&&!this.isEmpty())return this.#E(c);const l=new Float32Array(this.#o.length+24+this.#e.length);let u=t.length;for(let h=0;h<u;h+=2){if(isNaN(t[h])){l[h]=l[h+1]=NaN;continue}l[h]=t[h],l[h+1]=t[h+1]}u=this.#v(l,u);for(let h=e.length-6;h>=6;h-=6)for(let d=0;d<6;d+=2){if(isNaN(e[h+d])){l[u]=l[u+1]=NaN,u+=2;continue}l[u]=e[h+d],l[u+1]=e[h+d+1],u+=2}return this.#S(l,u),this.newFreeDrawOutline(l,c,this.#t,this.#d,this.#s,this.#n)}#E(t){const e=this.#r,[s,i,r,o]=this.#t,[a,c,l,u]=this.#p(),h=new Float32Array(36);return h.set([NaN,NaN,NaN,NaN,(e[2]-s)/r,(e[3]-i)/o,NaN,NaN,NaN,NaN,(e[4]-s)/r,(e[5]-i)/o,NaN,NaN,NaN,NaN,a,c,NaN,NaN,NaN,NaN,l,u,NaN,NaN,NaN,NaN,(e[16]-s)/r,(e[17]-i)/o,NaN,NaN,NaN,NaN,(e[14]-s)/r,(e[15]-i)/o],0),this.newFreeDrawOutline(h,t,this.#t,this.#d,this.#s,this.#n)}#S(t,e){const s=this.#e;return t.set([NaN,NaN,NaN,NaN,s[4],s[5]],e),e+=6}#v(t,e){const s=this.#r.subarray(4,6),i=this.#r.subarray(16,18),[r,o,a,c]=this.#t,[l,u,h,d]=this.#p();return t.set([NaN,NaN,NaN,NaN,(s[0]-r)/a,(s[1]-o)/c,NaN,NaN,NaN,NaN,l,u,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,(i[0]-r)/a,(i[1]-o)/c],e),e+=24}}class q1 extends F{#t;#e=new Float32Array(4);#s;#n;#o;#r;#i;constructor(t,e,s,i,r,o){super(),this.#i=t,this.#o=e,this.#t=s,this.#r=i,this.#s=r,this.#n=o,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#a(o);const[a,c,l,u]=this.#e;for(let h=0,d=t.length;h<d;h+=2)t[h]=(t[h]-a)/l,t[h+1]=(t[h+1]-c)/u;for(let h=0,d=e.length;h<d;h+=2)e[h]=(e[h]-a)/l,e[h+1]=(e[h+1]-c)/u}toSVGPath(){const t=[`M${this.#i[4]} ${this.#i[5]}`];for(let e=6,s=this.#i.length;e<s;e+=6){if(isNaN(this.#i[e])){t.push(`L${this.#i[e+4]} ${this.#i[e+5]}`);continue}t.push(`C${this.#i[e]} ${this.#i[e+1]} ${this.#i[e+2]} ${this.#i[e+3]} ${this.#i[e+4]} ${this.#i[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,s,i],r){const o=s-t,a=i-e;let c,l;switch(r){case 0:c=F._rescale(this.#i,t,i,o,-a),l=F._rescale(this.#o,t,i,o,-a);break;case 90:c=F._rescaleAndSwap(this.#i,t,e,o,a),l=F._rescaleAndSwap(this.#o,t,e,o,a);break;case 180:c=F._rescale(this.#i,s,e,-o,a),l=F._rescale(this.#o,s,e,-o,a);break;case 270:c=F._rescaleAndSwap(this.#i,s,i,-o,-a),l=F._rescaleAndSwap(this.#o,s,i,-o,-a);break}return{outline:Array.from(c),points:[Array.from(l)]}}#a(t){const e=this.#i;let s=e[4],i=e[5];const r=[s,i,s,i];let o=s,a=i,c=s,l=i;const u=t?Math.max:Math.min,h=new Float32Array(4);for(let f=6,m=e.length;f<m;f+=6){const p=e[f+4],g=e[f+5];isNaN(e[f])?(U.pointBoundingBox(p,g,r),a>g?(o=p,a=g):a===g&&(o=u(o,p)),l<g?(c=p,l=g):l===g&&(c=u(c,p))):(h[0]=h[1]=1/0,h[2]=h[3]=-1/0,U.bezierBoundingBox(s,i,...e.slice(f,f+6),h),U.rectBoundingBox(h[0],h[1],h[2],h[3],r),a>h[1]?(o=h[0],a=h[1]):a===h[1]&&(o=u(o,h[0])),l<h[3]?(c=h[2],l=h[3]):l===h[3]&&(c=u(c,h[2]))),s=p,i=g}const d=this.#e;d[0]=r[0]-this.#s,d[1]=r[1]-this.#s,d[2]=r[2]-r[0]+2*this.#s,d[3]=r[3]-r[1]+2*this.#s,this.firstPoint=[o,a],this.lastPoint=[c,l]}get box(){return this.#e}newOutliner(t,e,s,i,r,o=0){return new As(t,e,s,i,r,o)}getNewOutline(t,e){const[s,i,r,o]=this.#e,[a,c,l,u]=this.#t,h=r*l,d=o*u,f=s*l+a,m=i*u+c,p=this.newOutliner({x:this.#o[0]*h+f,y:this.#o[1]*d+m},this.#t,this.#r,t,this.#n,e??this.#s);for(let g=2;g<this.#o.length;g+=2)p.add({x:this.#o[g]*h+f,y:this.#o[g+1]*d+m});return p.getOutlines()}}class qd{#t;#e;#s;#n=[];#o=[];constructor(t,e=0,s=0,i=!0){const r=[1/0,1/0,-1/0,-1/0],o=10**-4;for(const{x:p,y:g,width:y,height:_}of t){const b=Math.floor((p-e)/o)*o,w=Math.ceil((p+y+e)/o)*o,v=Math.floor((g-e)/o)*o,A=Math.ceil((g+_+e)/o)*o,S=[b,v,A,!0],T=[w,v,A,!1];this.#n.push(S,T),U.rectBoundingBox(b,v,w,A,r)}const a=r[2]-r[0]+2*s,c=r[3]-r[1]+2*s,l=r[0]-s,u=r[1]-s;let h=i?-1/0:1/0,d=1/0;const f=this.#n.at(i?-1:-2),m=[f[0],f[2]];for(const p of this.#n){const[g,y,_,b]=p;!b&&i?y<d?(d=y,h=g):y===d&&(h=Math.max(h,g)):b&&!i&&(y<d?(d=y,h=g):y===d&&(h=Math.min(h,g))),p[0]=(g-l)/a,p[1]=(y-u)/c,p[2]=(_-u)/c}this.#t=new Float32Array([l,u,a,c]),this.#e=[h,d],this.#s=m}getOutlines(){this.#n.sort((e,s)=>e[0]-s[0]||e[1]-s[1]||e[2]-s[2]);const t=[];for(const e of this.#n)e[3]?(t.push(...this.#c(e)),this.#a(e)):(this.#l(e),t.push(...this.#c(e)));return this.#r(t)}#r(t){const e=[],s=new Set;for(const o of t){const[a,c,l]=o;e.push([a,c,o],[a,l,o])}e.sort((o,a)=>o[1]-a[1]||o[0]-a[0]);for(let o=0,a=e.length;o<a;o+=2){const c=e[o][2],l=e[o+1][2];c.push(l),l.push(c),s.add(c),s.add(l)}const i=[];let r;for(;s.size>0;){const o=s.values().next().value;let[a,c,l,u,h]=o;s.delete(o);let d=a,f=c;for(r=[a,l],i.push(r);;){let m;if(s.has(u))m=u;else if(s.has(h))m=h;else break;s.delete(m),[a,c,l,u,h]=m,d!==a&&(r.push(d,f,a,f===c?c:l),d=a),f=f===c?l:c}r.push(d,f)}return new $$(i,this.#t,this.#e,this.#s)}#i(t){const e=this.#o;let s=0,i=e.length-1;for(;s<=i;){const r=s+i>>1,o=e[r][0];if(o===t)return r;o<t?s=r+1:i=r-1}return i+1}#a([,t,e]){const s=this.#i(t);this.#o.splice(s,0,[t,e])}#l([,t,e]){const s=this.#i(t);for(let i=s;i<this.#o.length;i++){const[r,o]=this.#o[i];if(r!==t)break;if(r===t&&o===e){this.#o.splice(i,1);return}}for(let i=s-1;i>=0;i--){const[r,o]=this.#o[i];if(r!==t)break;if(r===t&&o===e){this.#o.splice(i,1);return}}}#c(t){const[e,s,i]=t,r=[[e,s,i]],o=this.#i(i);for(let a=0;a<o;a++){const[c,l]=this.#o[a];for(let u=0,h=r.length;u<h;u++){const[,d,f]=r[u];if(!(l<=d||f<=c)){if(d>=c){if(f>l)r[u][1]=l;else{if(h===1)return[];r.splice(u,1),u--,h--}continue}r[u][2]=c,f>l&&r.push([e,l,f])}}}return r}}class $$ extends F{#t;#e;constructor(t,e,s,i){super(),this.#e=t,this.#t=e,this.firstPoint=s,this.lastPoint=i}toSVGPath(){const t=[];for(const e of this.#e){let[s,i]=e;t.push(`M${s} ${i}`);for(let r=2;r<e.length;r+=2){const o=e[r],a=e[r+1];o===s?(t.push(`V${a}`),i=a):a===i&&(t.push(`H${o}`),s=o)}t.push("Z")}return t.join(" ")}serialize([t,e,s,i],r){const o=[],a=s-t,c=i-e;for(const l of this.#e){const u=new Array(l.length);for(let h=0;h<l.length;h+=2)u[h]=t+l[h]*a,u[h+1]=i-l[h+1]*c;o.push(u)}return o}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class Wd extends As{newFreeDrawOutline(t,e,s,i,r,o){return new U$(t,e,s,i,r,o)}}class U$ extends q1{newOutliner(t,e,s,i,r,o=0){return new Wd(t,e,s,i,r,o)}}class Dt extends W{#t=null;#e=0;#s;#n=null;#o=null;#r=null;#i=null;#a=0;#l=null;#c=null;#d=null;#h=!1;#f=null;#g=null;#m=null;#u="";#p;#y="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=tt.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=Dt.prototype;return Q(this,"_keyboardManager",new vo([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||Dt._defaultColor,this.#p=t.thickness||Dt._defaultThickness,this.opacity=t.opacity||Dt._defaultOpacity,this.#s=t.boxes||null,this.#y=t.methodOfCreation||"",this.#u=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#h=!0,this.#b(t),this.#w()):this.#s&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#i=t.focusNode,this.#a=t.focusOffset,this.#_(),this.#w(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#h?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#p,methodOfCreation:this.#y}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#_(){const t=new qd(this.#s,.001);this.#c=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#c.box;const e=new qd(this.#s,.0025,.001,this._uiManager.direction==="ltr");this.#r=e.getOutlines();const{firstPoint:s}=this.#c;this.#f=[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height];const{lastPoint:i}=this.#r;this.#g=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]}#b({highlightOutlines:t,highlightId:e,clipPathId:s}){this.#c=t;const i=1.5;if(this.#r=t.getNewOutline(this.#p/2+i,.0025),e>=0)this.#d=e,this.#n=s,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#m=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},!0);else if(this.parent){const h=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#d,{bbox:Dt.#T(this.#c.box,(h-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#m,{bbox:Dt.#T(this.#r.box,h),path:{d:this.#r.toSVGPath()}})}const[r,o,a,c]=t.box;switch(this.rotation){case 0:this.x=r,this.y=o,this.width=a,this.height=c;break;case 90:{const[h,d]=this.parentDimensions;this.x=o,this.y=1-r,this.width=a*d/h,this.height=c*h/d;break}case 180:this.x=1-r,this.y=1-o,this.width=a,this.height=c;break;case 270:{const[h,d]=this.parentDimensions;this.x=1-o,this.y=r,this.width=a*d/h,this.height=c*h/d;break}}const{firstPoint:l}=t;this.#f=[(l[0]-r)/a,(l[1]-o)/c];const{lastPoint:u}=this.#r;this.#g=[(u[0]-r)/a,(u[1]-o)/c]}static initialize(t,e){W.initialize(t,e),Dt._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case at.HIGHLIGHT_COLOR:Dt._defaultColor=e;break;case at.HIGHLIGHT_THICKNESS:Dt._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#g}get commentButtonPosition(){return this.#f}updateParams(t,e){switch(t){case at.HIGHLIGHT_COLOR:this.#E(e);break;case at.HIGHLIGHT_THICKNESS:this.#S(e);break}}static get defaultPropertiesToUpdate(){return[[at.HIGHLIGHT_COLOR,Dt._defaultColor],[at.HIGHLIGHT_THICKNESS,Dt._defaultThickness]]}get propertiesToUpdate(){return[[at.HIGHLIGHT_COLOR,this.color||Dt._defaultColor],[at.HIGHLIGHT_THICKNESS,this.#p||Dt._defaultThickness],[at.HIGHLIGHT_FREE,this.#h]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#d,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#o?.updateColor(this.color),super.onUpdatedColor()}#E(t){const e=(r,o)=>{this.color=r,this.opacity=o,this.onUpdatedColor()},s=this.color,i=this.opacity;this.addCommands({cmd:e.bind(this,t,Dt._defaultOpacity),undo:e.bind(this,s,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:at.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#S(t){const e=this.#p,s=i=>{this.#p=i,this.#v(i)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:at.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#o=new He({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#k())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#k())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#C(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#w(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#C():t&&(this.#w(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#v(t){this.#h&&(this.#b({highlightOutlines:this.#c.getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims())}#C(){this.#d===null||!this.parent||(this.parent.drawLayer.remove(this.#d),this.#d=null,this.parent.drawLayer.remove(this.#m),this.#m=null)}#w(t=this.parent){this.#d===null&&({id:this.#d,clipPathId:this.#n}=t.drawLayer.draw({bbox:this.#c.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#h},path:{d:this.#c.toSVGPath()}},!1,!0),this.#m=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#h},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},this.#h),this.#l&&(this.#l.style.clipPath=this.#n))}static#T([t,e,s,i],r){switch(r){case 90:return[1-e-i,t,i,s];case 180:return[1-t-s,1-e-i,s,i];case 270:return[e,1-t-s,i,s]}return[t,e,s,i]}rotate(t){const{drawLayer:e}=this.parent;let s;this.#h?(t=(t-this.rotation+360)%360,s=Dt.#T(this.#c.box,t)):s=Dt.#T([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#d,{bbox:s,root:{"data-main-rotation":t}}),e.updateProperties(this.#m,{bbox:Dt.#T(this.#r.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#u&&(t.setAttribute("aria-label",this.#u),t.setAttribute("role","mark")),this.#h?t.classList.add("free"):this.div.addEventListener("keydown",this.#M.bind(this),{signal:this._uiManager._signal});const e=this.#l=document.createElement("div");return t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#n,this.setDims(),T1(this,this.#l,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{hovered:!1}})}#M(t){Dt._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#P(!0);break;case 1:case 3:this.#P(!1);break}}#P(t){if(!this.#t)return;const e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#i,this.#a)}select(){super.select(),this.#m&&this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#m&&(this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{selected:!1}}),this.#h||this.#P(!1))}get _mustFixPosition(){return!this.#h}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#d,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#m,{rootClass:{hidden:!t}}))}#k(){return this.#h?this.rotation:0}#F(){if(this.#h)return null;const[t,e]=this.pageDimensions,[s,i]=this.pageTranslation,r=this.#s,o=new Float32Array(r.length*8);let a=0;for(const{x:c,y:l,width:u,height:h}of r){const d=c*t+s,f=(1-l)*e+i;o[a]=o[a+4]=d,o[a+1]=o[a+3]=f,o[a+2]=o[a+6]=d+u*t,o[a+5]=o[a+7]=f-h*e,a+=8}return o}#O(t){return this.#c.serialize(t,this.#k())}static startHighlighting(t,e,{target:s,x:i,y:r}){const{x:o,y:a,width:c,height:l}=s.getBoundingClientRect(),u=new AbortController,h=t.combinedSignal(u),d=f=>{u.abort(),this.#B(t,f)};window.addEventListener("blur",d,{signal:h}),window.addEventListener("pointerup",d,{signal:h}),window.addEventListener("pointerdown",Ot,{capture:!0,passive:!1,signal:h}),window.addEventListener("contextmenu",Je,{signal:h}),s.addEventListener("pointermove",this.#I.bind(this,t),{signal:h}),this._freeHighlight=new Wd({x:i,y:r},[o,a,c,l],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#I(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#B(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,s){let i=null;if(t instanceof V1){const{data:{quadPoints:m,rect:p,rotation:g,id:y,color:_,opacity:b,popupRef:w,richText:v,contentsObj:A,creationDate:S,modificationDate:T},parent:{page:{pageNumber:E}}}=t;i=t={annotationType:tt.HIGHLIGHT,color:Array.from(_),opacity:b,quadPoints:m,boxes:null,pageIndex:E-1,rect:p.slice(0),rotation:g,annotationElementId:y,id:y,deleted:!1,popupRef:w,richText:v,comment:A?.str||null,creationDate:S,modificationDate:T}}else if(t instanceof Xp){const{data:{inkLists:m,rect:p,rotation:g,id:y,color:_,borderStyle:{rawWidth:b},popupRef:w,richText:v,contentsObj:A,creationDate:S,modificationDate:T},parent:{page:{pageNumber:E}}}=t;i=t={annotationType:tt.HIGHLIGHT,color:Array.from(_),thickness:b,inkLists:m,boxes:null,pageIndex:E-1,rect:p.slice(0),rotation:g,annotationElementId:y,id:y,deleted:!1,popupRef:w,richText:v,comment:A?.str||null,creationDate:S,modificationDate:T}}const{color:r,quadPoints:o,inkLists:a,opacity:c}=t,l=await super.deserialize(t,e,s);l.color=U.makeHexColor(...r),l.opacity=c||1,a&&(l.#p=t.thickness),l._initialData=i,t.comment&&l.setCommentData(t);const[u,h]=l.pageDimensions,[d,f]=l.pageTranslation;if(o){const m=l.#s=[];for(let p=0;p<o.length;p+=8)m.push({x:(o[p]-d)/u,y:1-(o[p+1]-f)/h,width:(o[p+2]-o[p])/u,height:(o[p+1]-o[p+5])/h});l.#_(),l.#w(),l.rotate(l.rotation)}else if(a){l.#h=!0;const m=a[0],p={x:m[0]-d,y:h-(m[1]-f)},g=new Wd(p,[0,0,u,h],1,l.#p/2,!0,.001);for(let b=0,w=m.length;b<w;b+=2)p.x=m[b]-d,p.y=h-(m[b+1]-f),g.add(p);const{id:y,clipPathId:_}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:l.color,"fill-opacity":l._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:g.toSVGPath()}},!0,!0);l.#b({highlightOutlines:g.getOutlines(),highlightId:y,clipPathId:_}),l.#w(),l.rotate(l.parentRotation)}return l}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=W._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),s=super.serialize(t);return Object.assign(s,{color:e,opacity:this.opacity,thickness:this.#p,quadPoints:this.#F(),outlines:this.#O(s.rect)}),this.addComment(s),this.annotationElementId&&!this.#L(s)?null:(s.id=this.annotationElementId,s)}#L(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((s,i)=>s!==e[i])}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class W1{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,s]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,s)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){const t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){_t("Not implemented")}}class ht extends W{#t=null;#e;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#s=null;static#n=null;static#o=null;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,this._addOutlines(t)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(this.#r(t),this.#l())}#r({drawOutlines:t,drawId:e,drawingOptions:s}){this.#t=t,this._drawingOptions||=s,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#i(t,this.parent),this.#h(t.box)}#i(t,e){const{id:s}=e.drawLayer.draw(ht._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return s}static _mergeSVGProperties(t,e){const s=new Set(Object.keys(t));for(const[i,r]of Object.entries(e))s.has(i)?Object.assign(t[i],r):t[i]=r;return t}static getDefaultDrawingOptions(t){_t("Not implemented")}static get typesMap(){_t("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,e),this._currentParent&&(ht.#s.updateProperty(s,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[s,i]of this.typesMap)t.push([s,e[i]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[s,i]of this.constructor.typesMap)t.push([s,e[i]]);return t}_updateProperty(t,e,s){const i=this._drawingOptions,r=i[e],o=a=>{i.updateProperty(e,a);const c=this.#t.updateProperty(e,a);c&&this.#h(c),this.parent?.drawLayer.updateProperties(this._drawId,i.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:o.bind(this,s),undo:o.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,ht._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#d()),{bbox:this.#f()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,ht._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#d()),{bbox:this.#f()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#f()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,ht._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#d(),this.parentDimensions),{bbox:this.#f()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#a(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#l(),this.#h(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#a()):t&&(this._uiManager.addShouldRescale(this),this.#l(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#a(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#l(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#i(this.#t,t)}}#c([t,e,s,i]){const{parentDimensions:[r,o],rotation:a}=this;switch(a){case 90:return[e,1-t,s*(o/r),i*(r/o)];case 180:return[1-t,1-e,s,i];case 270:return[1-e,t,s*(o/r),i*(r/o)];default:return[t,e,s,i]}}#d(){const{x:t,y:e,width:s,height:i,parentDimensions:[r,o],rotation:a}=this;switch(a){case 90:return[1-e,t,s*(r/o),i*(o/r)];case 180:return[1-t,1-e,s,i];case 270:return[e,1-t,s*(r/o),i*(o/r)];default:return[t,e,s,i]}}#h(t){[this.x,this.y,this.width,this.height]=this.#c(t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#f(){const{x:t,y:e,width:s,height:i,rotation:r,parentRotation:o,parentDimensions:[a,c]}=this;switch((r*4+o)/90){case 1:return[1-e-i,t,i,s];case 2:return[1-t-s,1-e-i,s,i];case 3:return[e,1-t-s,i,s];case 4:return[t,e-s*(a/c),i*(c/a),s*(a/c)];case 5:return[1-e,t,s*(a/c),i*(c/a)];case 6:return[1-t-i*(c/a),1-e,i*(c/a),s*(a/c)];case 7:return[e-s*(a/c),1-t-i*(c/a),s*(a/c),i*(c/a)];case 8:return[t-s,e-i,s,i];case 9:return[1-e,t-s,i,s];case 10:return[1-t,1-e,s,i];case 11:return[e-i,1-t,i,s];case 12:return[t-i*(c/a),e,i*(c/a),s*(a/c)];case 13:return[1-e-s*(a/c),t-i*(c/a),s*(a/c),i*(c/a)];case 14:return[1-t,1-e-s*(a/c),i*(c/a),s*(a/c)];case 15:return[e,1-t,s*(a/c),i*(c/a)];default:return[t,e,s,i]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,ht._mergeSVGProperties({bbox:this.#f()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#h(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const s=super.render();s.classList.add("draw");const i=document.createElement("div");return s.append(i),i.setAttribute("aria-hidden","true"),i.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),s}static createDrawerInstance(t,e,s,i,r){_t("Not implemented")}static startDrawing(t,e,s,i){const{target:r,offsetX:o,offsetY:a,pointerId:c,pointerType:l}=i;if(dt.isInitializedAndDifferentPointerType(l))return;const{viewport:{rotation:u}}=t,{width:h,height:d}=r.getBoundingClientRect(),f=ht.#n=new AbortController,m=t.combinedSignal(f);if(dt.setPointer(l,c),window.addEventListener("pointerup",p=>{dt.isSamePointerIdOrRemove(p.pointerId)&&this._endDraw(p)},{signal:m}),window.addEventListener("pointercancel",p=>{dt.isSamePointerIdOrRemove(p.pointerId)&&this._currentParent.endDrawingSession()},{signal:m}),window.addEventListener("pointerdown",p=>{dt.isSamePointerType(p.pointerType)&&(dt.initializeAndAddPointerId(p.pointerId),ht.#s.isCancellable()&&(ht.#s.removeLastElement(),ht.#s.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:m}),window.addEventListener("contextmenu",Je,{signal:m}),r.addEventListener("pointermove",this._drawMove.bind(this),{signal:m}),r.addEventListener("touchmove",p=>{dt.isSameTimeStamp(p.timeStamp)&&Ot(p)},{signal:m}),t.toggleDrawing(),e._editorUndoBar?.hide(),ht.#s){t.drawLayer.updateProperties(this._currentDrawId,ht.#s.startNew(o,a,h,d,u));return}e.updateUIForDefaultProperties(this),ht.#s=this.createDrawerInstance(o,a,h,d,u),ht.#o=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(ht.#o.toSVGProperties(),ht.#s.defaultSVGProperties),!0,!1)}static _drawMove(t){if(dt.isSameTimeStamp(t.timeStamp),!ht.#s)return;const{offsetX:e,offsetY:s,pointerId:i}=t;if(dt.isSamePointerId(i)){if(dt.isUsingMultiplePointers()){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,ht.#s.add(e,s)),dt.setTimeStamp(t.timeStamp),Ot(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,ht.#s=null,ht.#o=null,dt.clearPointerType(),dt.clearTimeStamp()),ht.#n&&(ht.#n.abort(),ht.#n=null,dt.clearPointerIds())}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,ht.#s.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const s=ht.#s,i=this._currentDrawId,r=s.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(i,s.setLastElement(r))},undo:()=>{e.drawLayer.updateProperties(i,s.removeLastElement())},mustExec:!1,type:at.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(at.DRAW_STEP),!ht.#s.isEmpty()){const{pageDimensions:[s,i],scale:r}=e,o=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:ht.#s.getOutlines(s*r,i*r,r,this._INNER_MARGIN),drawingOptions:ht.#o,mustBeCommitted:!t});return this._cleanup(!0),o}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,s,i,r,o){_t("Not implemented")}static async deserialize(t,e,s){const{rawDims:{pageWidth:i,pageHeight:r,pageX:o,pageY:a}}=e.viewport,c=this.deserializeDraw(o,a,i,r,this._INNER_MARGIN,t),l=await super.deserialize(t,e,s);return l.createDrawingOptions(t),l.#r({drawOutlines:c}),l.#l(),l.onScaleChanging(),l.rotate(),l}serializeDraw(t){const[e,s]=this.pageTranslation,[i,r]=this.pageDimensions;return this.#t.serialize([e,s,i,r],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class j${#t=new Float64Array(6);#e;#s;#n;#o;#r;#i="";#a=0;#l=new So;#c;#d;constructor(t,e,s,i,r,o){this.#c=s,this.#d=i,this.#n=r,this.#o=o,[t,e]=this.#h(t,e);const a=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#r=[t,e],this.#s=[{line:a,points:this.#r}],this.#t.set(a,0)}updateProperty(t,e){t==="stroke-width"&&(this.#o=e)}#h(t,e){return F._normalizePoint(t,e,this.#c,this.#d,this.#n)}isEmpty(){return!this.#s||this.#s.length===0}isCancellable(){return this.#r.length<=10}add(t,e){[t,e]=this.#h(t,e);const[s,i,r,o]=this.#t.subarray(2,6),a=t-r,c=e-o;return Math.hypot(this.#c*a,this.#d*c)<=2?null:(this.#r.push(t,e),isNaN(s)?(this.#t.set([r,o,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([s,i,r,o,t,e],0),this.#e.push(...F.createBezierPoints(s,i,r,o,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const s=this.add(t,e);return s||(this.#r.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,s,i,r){this.#c=s,this.#d=i,this.#n=r,[t,e]=this.#h(t,e);const o=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#r=[t,e];const a=this.#s.at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),this.#s.push({line:o,points:this.#r}),this.#t.set(o,0),this.#a=0,this.toSVGPath(),null}getLastElement(){return this.#s.at(-1)}setLastElement(t){return this.#s?(this.#s.push(t),this.#e=t.line,this.#r=t.points,this.#a=0,{path:{d:this.toSVGPath()}}):this.#l.setLastElement(t)}removeLastElement(){if(!this.#s)return this.#l.removeLastElement();this.#s.pop(),this.#i="";for(let t=0,e=this.#s.length;t<e;t++){const{line:s,points:i}=this.#s[t];this.#e=s,this.#r=i,this.#a=0,this.toSVGPath()}return{path:{d:this.#i}}}toSVGPath(){const t=F.svgRound(this.#e[4]),e=F.svgRound(this.#e[5]);if(this.#r.length===2)return this.#i=`${this.#i} M ${t} ${e} Z`,this.#i;if(this.#r.length<=6){const i=this.#i.lastIndexOf("M");this.#i=`${this.#i.slice(0,i)} M ${t} ${e}`,this.#a=6}if(this.#r.length===4){const i=F.svgRound(this.#e[10]),r=F.svgRound(this.#e[11]);return this.#i=`${this.#i} L ${i} ${r}`,this.#a=12,this.#i}const s=[];this.#a===0&&(s.push(`M ${t} ${e}`),this.#a=6);for(let i=this.#a,r=this.#e.length;i<r;i+=6){const[o,a,c,l,u,h]=this.#e.slice(i,i+6).map(F.svgRound);s.push(`C${o} ${a} ${c} ${l} ${u} ${h}`)}return this.#i+=s.join(" "),this.#a=this.#e.length,this.#i}getOutlines(t,e,s,i){const r=this.#s.at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),this.#l.build(this.#s,t,e,s,this.#n,this.#o,i),this.#t=null,this.#e=null,this.#s=null,this.#i=null,this.#l}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class So extends F{#t;#e=0;#s;#n;#o;#r;#i;#a;#l;build(t,e,s,i,r,o,a){this.#o=e,this.#r=s,this.#i=i,this.#a=r,this.#l=o,this.#s=a??0,this.#n=t,this.#h()}get thickness(){return this.#l}setLastElement(t){return this.#n.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#n.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#n){if(t.push(`M${F.svgRound(e[4])} ${F.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12&&isNaN(e[6])){t.push(`L${F.svgRound(e[10])} ${F.svgRound(e[11])}`);continue}for(let s=6,i=e.length;s<i;s+=6){const[r,o,a,c,l,u]=e.subarray(s,s+6).map(F.svgRound);t.push(`C${r} ${o} ${a} ${c} ${l} ${u}`)}}return t.join("")}serialize([t,e,s,i],r){const o=[],a=[],[c,l,u,h]=this.#d();let d,f,m,p,g,y,_,b,w;switch(this.#a){case 0:w=F._rescale,d=t,f=e+i,m=s,p=-i,g=t+c*s,y=e+(1-l-h)*i,_=t+(c+u)*s,b=e+(1-l)*i;break;case 90:w=F._rescaleAndSwap,d=t,f=e,m=s,p=i,g=t+l*s,y=e+c*i,_=t+(l+h)*s,b=e+(c+u)*i;break;case 180:w=F._rescale,d=t+s,f=e,m=-s,p=i,g=t+(1-c-u)*s,y=e+l*i,_=t+(1-c)*s,b=e+(l+h)*i;break;case 270:w=F._rescaleAndSwap,d=t+s,f=e+i,m=-s,p=-i,g=t+(1-l-h)*s,y=e+(1-c-u)*i,_=t+(1-l)*s,b=e+(1-c)*i;break}for(const{line:v,points:A}of this.#n)o.push(w(v,d,f,m,p,r?new Array(v.length):null)),a.push(w(A,d,f,m,p,r?new Array(A.length):null));return{lines:o,points:a,rect:[g,y,_,b]}}static deserialize(t,e,s,i,r,{paths:{lines:o,points:a},rotation:c,thickness:l}){const u=[];let h,d,f,m,p;switch(c){case 0:p=F._rescale,h=-t/s,d=e/i+1,f=1/s,m=-1/i;break;case 90:p=F._rescaleAndSwap,h=-e/i,d=-t/s,f=1/i,m=1/s;break;case 180:p=F._rescale,h=t/s+1,d=-e/i,f=-1/s,m=1/i;break;case 270:p=F._rescaleAndSwap,h=e/i+1,d=t/s+1,f=-1/i,m=-1/s;break}if(!o){o=[];for(const y of a){const _=y.length;if(_===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,y[0],y[1]]));continue}if(_===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,y[0],y[1],NaN,NaN,NaN,NaN,y[2],y[3]]));continue}const b=new Float32Array(3*(_-2));o.push(b);let[w,v,A,S]=y.subarray(0,4);b.set([NaN,NaN,NaN,NaN,w,v],0);for(let T=4;T<_;T+=2){const E=y[T],P=y[T+1];b.set(F.createBezierPoints(w,v,A,S,E,P),(T-2)*3),[w,v,A,S]=[A,S,E,P]}}}for(let y=0,_=o.length;y<_;y++)u.push({line:p(o[y].map(b=>b??NaN),h,d,f,m),points:p(a[y].map(b=>b??NaN),h,d,f,m)});const g=new this.prototype.constructor;return g.build(u,s,i,1,c,l,r),g}#c(t=this.#l){const e=this.#s+t/2*this.#i;return this.#a%180===0?[e/this.#o,e/this.#r]:[e/this.#r,e/this.#o]}#d(){const[t,e,s,i]=this.#t,[r,o]=this.#c(0);return[t+r,e+o,s-2*r,i-2*o]}#h(){const t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:i}of this.#n){if(i.length<=12){for(let a=4,c=i.length;a<c;a+=6)U.pointBoundingBox(i[a],i[a+1],t);continue}let r=i[4],o=i[5];for(let a=6,c=i.length;a<c;a+=6){const[l,u,h,d,f,m]=i.subarray(a,a+6);U.bezierBoundingBox(r,o,l,u,h,d,f,m,t),r=f,o=m}}const[e,s]=this.#c();t[0]=ye(t[0]-e,0,1),t[1]=ye(t[1]-s,0,1),t[2]=ye(t[2]+e,0,1),t[3]=ye(t[3]+s,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#f(e):null}#f(t){const[e,s]=this.#c();this.#l=t;const[i,r]=this.#c(),[o,a]=[i-e,r-s],c=this.#t;return c[0]-=o,c[1]-=a,c[2]+=2*o,c[3]+=2*a,c}updateParentDimensions([t,e],s){const[i,r]=this.#c();this.#o=t,this.#r=e,this.#i=s;const[o,a]=this.#c(),c=o-i,l=a-r,u=this.#t;return u[0]-=c,u[1]-=l,u[2]+=2*c,u[3]+=2*l,u}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(F.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${F.svgRound(t)} ${F.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#t;let s=0,i=0,r=0,o=0,a=0,c=0;switch(this.#e){case 90:i=e/t,r=-t/e,a=t;break;case 180:s=-1,o=-1,a=t,c=e;break;case 270:i=-e/t,r=t/e,c=e;break;default:return""}return`matrix(${s} ${i} ${r} ${o} ${F.svgRound(a)} ${F.svgRound(c)})`}getPathResizingSVGProperties([t,e,s,i]){const[r,o]=this.#c(),[a,c,l,u]=this.#t;if(Math.abs(l-r)<=F.PRECISION||Math.abs(u-o)<=F.PRECISION){const p=t+s/2-(a+l/2),g=e+i/2-(c+u/2);return{path:{"transform-origin":`${F.svgRound(t)} ${F.svgRound(e)}`,transform:`${this.rotationTransform} translate(${p} ${g})`}}}const h=(s-2*r)/(l-2*r),d=(i-2*o)/(u-2*o),f=l/s,m=u/i;return{path:{"transform-origin":`${F.svgRound(a)} ${F.svgRound(c)}`,transform:`${this.rotationTransform} scale(${f} ${m}) translate(${F.svgRound(r)} ${F.svgRound(o)}) scale(${h} ${d}) translate(${F.svgRound(-r)} ${F.svgRound(-o)})`}}}getPathResizedSVGProperties([t,e,s,i]){const[r,o]=this.#c(),a=this.#t,[c,l,u,h]=a;if(a[0]=t,a[1]=e,a[2]=s,a[3]=i,Math.abs(u-r)<=F.PRECISION||Math.abs(h-o)<=F.PRECISION){const g=t+s/2-(c+u/2),y=e+i/2-(l+h/2);for(const{line:_,points:b}of this.#n)F._translate(_,g,y,_),F._translate(b,g,y,b);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${F.svgRound(t)} ${F.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const d=(s-2*r)/(u-2*r),f=(i-2*o)/(h-2*o),m=-d*(c+r)+t+r,p=-f*(l+o)+e+o;if(d!==1||f!==1||m!==0||p!==0)for(const{line:g,points:y}of this.#n)F._rescale(g,m,p,d,f,g),F._rescale(y,m,p,d,f,y);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${F.svgRound(t)} ${F.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],s){const[i,r]=s,o=this.#t,a=t-o[0],c=e-o[1];if(this.#o===i&&this.#r===r)for(const{line:l,points:u}of this.#n)F._translate(l,a,c,l),F._translate(u,a,c,u);else{const l=this.#o/i,u=this.#r/r;this.#o=i,this.#r=r;for(const{line:h,points:d}of this.#n)F._rescale(h,a,c,l,u,h),F._rescale(d,a,c,l,u,d);o[2]*=l,o[3]*=u}return o[0]=t,o[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${F.svgRound(t)} ${F.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${F.svgRound(t[0])} ${F.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class il extends W1{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:W._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new il(this._viewParameters);return t.updateAll(this),t}}class Zp extends ht{static _type="ink";static _editorType=tt.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){W.initialize(t,e),this._defaultDrawingOptions=new il(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return Q(this,"typesMap",new Map([[at.INK_THICKNESS,"stroke-width"],[at.INK_COLOR,"stroke"],[at.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,s,i,r){return new j$(t,e,s,i,r,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,s,i,r,o){return So.deserialize(t,e,s,i,r,o)}static async deserialize(t,e,s){let i=null;if(t instanceof Xp){const{data:{inkLists:o,rect:a,rotation:c,id:l,color:u,opacity:h,borderStyle:{rawWidth:d},popupRef:f,richText:m,contentsObj:p,creationDate:g,modificationDate:y},parent:{page:{pageNumber:_}}}=t;i=t={annotationType:tt.INK,color:Array.from(u),thickness:d,opacity:h,paths:{points:o},boxes:null,pageIndex:_-1,rect:a.slice(0),rotation:c,annotationElementId:l,id:l,deleted:!1,popupRef:f,richText:m,comment:p?.str||null,creationDate:g,modificationDate:y}}const r=await super.deserialize(t,e,s);return r._initialData=i,t.comment&&r.setCommentData(t),r}get toolbarButtons(){return this._colorPicker||=new Jr(this),[["colorPicker",this._colorPicker]]}get colorType(){return at.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:s}=this;e.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:s}){this._drawingOptions=Zp.getDefaultDrawingOptions({stroke:U.makeHexColor(...t),"stroke-width":e,"stroke-opacity":s})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:s}=this.serializeDraw(t),{_drawingOptions:{stroke:i,"stroke-opacity":r,"stroke-width":o}}=this,a=Object.assign(super.serialize(t),{color:W._colorManager.convert(i),opacity:r,thickness:o,paths:{lines:e,points:s}});return this.addComment(a),t?(a.isCopy=!0,a):this.annotationElementId&&!this.#t(a)?null:(a.id=this.annotationElementId,a)}#t(t){const{color:e,thickness:s,opacity:i,pageIndex:r}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((o,a)=>o!==e[a])||t.thickness!==s||t.opacity!==i||t.pageIndex!==r}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:e,rect:s}=this.serializeDraw(!1);return t.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:e,popup:this.comment}),null}}class Gd extends So{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const Zo=8,nr=3;class si{static#t={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#e(t,e,s,i){return s-=t,i-=e,s===0?i>0?0:4:s===1?i+6:2-i}static#s=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#n(t,e,s,i,r,o,a){const c=this.#e(s,i,r,o);for(let l=0;l<8;l++){const u=(-l+c-a+16)%8,h=this.#s[2*u],d=this.#s[2*u+1];if(t[(s+h)*e+(i+d)]!==0)return u}return-1}static#o(t,e,s,i,r,o,a){const c=this.#e(s,i,r,o);for(let l=0;l<8;l++){const u=(l+c+a+16)%8,h=this.#s[2*u],d=this.#s[2*u+1];if(t[(s+h)*e+(i+d)]!==0)return u}return-1}static#r(t,e,s,i){const r=t.length,o=new Int32Array(r);for(let u=0;u<r;u++)o[u]=t[u]<=i?1:0;for(let u=1;u<s-1;u++)o[u*e]=o[u*e+e-1]=0;for(let u=0;u<e;u++)o[u]=o[e*s-1-u]=0;let a=1,c;const l=[];for(let u=1;u<s-1;u++){c=1;for(let h=1;h<e-1;h++){const d=u*e+h,f=o[d];if(f===0)continue;let m=u,p=h;if(f===1&&o[d-1]===0)a+=1,p-=1;else if(f>=1&&o[d+1]===0)a+=1,p+=1,f>1&&(c=f);else{f!==1&&(c=Math.abs(f));continue}const g=[h,u],y=p===h+1,_={isHole:y,points:g,id:a,parent:0};l.push(_);let b;for(const x of l)if(x.id===c){b=x;break}b?b.isHole?_.parent=y?b.parent:c:_.parent=y?c:b.parent:_.parent=y?c:0;const w=this.#n(o,e,u,h,m,p,0);if(w===-1){o[d]=-a,o[d]!==1&&(c=Math.abs(o[d]));continue}let v=this.#s[2*w],A=this.#s[2*w+1];const S=u+v,T=h+A;m=S,p=T;let E=u,P=h;for(;;){const x=this.#o(o,e,E,P,m,p,1);v=this.#s[2*x],A=this.#s[2*x+1];const I=E+v,V=P+A;g.push(V,I);const X=E*e+P;if(o[X+1]===0?o[X]=-a:o[X]===1&&(o[X]=a),I===u&&V===h&&E===S&&P===T){o[d]!==1&&(c=Math.abs(o[d]));break}else m=E,p=P,E=I,P=V}}}return l}static#i(t,e,s,i){if(s-e<=4){for(let S=e;S<s-2;S+=2)i.push(t[S],t[S+1]);return}const r=t[e],o=t[e+1],a=t[s-4]-r,c=t[s-3]-o,l=Math.hypot(a,c),u=a/l,h=c/l,d=u*o-h*r,f=c/a,m=1/l,p=Math.atan(f),g=Math.cos(p),y=Math.sin(p),_=m*(Math.abs(g)+Math.abs(y)),b=m*(1-_+_**2),w=Math.max(Math.atan(Math.abs(y+g)*b),Math.atan(Math.abs(y-g)*b));let v=0,A=e;for(let S=e+2;S<s-2;S+=2){const T=Math.abs(d-u*t[S+1]+h*t[S]);T>v&&(A=S,v=T)}v>(l*w)**2?(this.#i(t,e,A+2,i),this.#i(t,A,s,i)):i.push(r,o)}static#a(t){const e=[],s=t.length;return this.#i(t,0,s,e),e.push(t[s-2],t[s-1]),e.length<=4?null:e}static#l(t,e,s,i,r,o){const a=new Float32Array(o**2),c=-2*i**2,l=o>>1;for(let p=0;p<o;p++){const g=(p-l)**2;for(let y=0;y<o;y++)a[p*o+y]=Math.exp((g+(y-l)**2)/c)}const u=new Float32Array(256),h=-2*r**2;for(let p=0;p<256;p++)u[p]=Math.exp(p**2/h);const d=t.length,f=new Uint8Array(d),m=new Uint32Array(256);for(let p=0;p<s;p++)for(let g=0;g<e;g++){const y=p*e+g,_=t[y];let b=0,w=0;for(let A=0;A<o;A++){const S=p+A-l;if(!(S<0||S>=s))for(let T=0;T<o;T++){const E=g+T-l;if(E<0||E>=e)continue;const P=t[S*e+E],x=a[A*o+T]*u[Math.abs(P-_)];b+=P*x,w+=x}}const v=f[y]=Math.round(b/w);m[v]++}return[f,m]}static#c(t){const e=new Uint32Array(256);for(const s of t)e[s]++;return e}static#d(t){const e=t.length,s=new Uint8ClampedArray(e>>2);let i=-1/0,r=1/0;for(let a=0,c=s.length;a<c;a++){const l=s[a]=t[a<<2];i=Math.max(i,l),r=Math.min(r,l)}const o=255/(i-r);for(let a=0,c=s.length;a<c;a++)s[a]=(s[a]-r)*o;return s}static#h(t){let e,s=-1/0,i=-1/0;const r=t.findIndex(c=>c!==0);let o=r,a=r;for(e=r;e<256;e++){const c=t[e];c>s&&(e-o>i&&(i=e-o,a=e-1),s=c,o=e)}for(e=a-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#f(t){const e=t,{width:s,height:i}=t,{maxDim:r}=this.#t;let o=s,a=i;if(s>r||i>r){let d=s,f=i,m=Math.log2(Math.max(s,i)/r);const p=Math.floor(m);m=m===p?p-1:p;for(let y=0;y<m;y++){o=Math.ceil(d/2),a=Math.ceil(f/2);const _=new OffscreenCanvas(o,a);_.getContext("2d").drawImage(t,0,0,d,f,0,0,o,a),d=o,f=a,t!==e&&t.close(),t=_.transferToImageBitmap()}const g=Math.min(r/o,r/a);o=Math.round(o*g),a=Math.round(a*g)}const l=new OffscreenCanvas(o,a).getContext("2d",{willReadFrequently:!0});l.fillStyle="white",l.fillRect(0,0,o,a),l.filter="grayscale(1)",l.drawImage(t,0,0,t.width,t.height,0,0,o,a);const u=l.getImageData(0,0,o,a).data;return[this.#d(u),o,a]}static extractContoursFromText(t,{fontFamily:e,fontStyle:s,fontWeight:i},r,o,a,c){let l=new OffscreenCanvas(1,1),u=l.getContext("2d",{alpha:!1});const h=200,d=u.font=`${s} ${i} ${h}px ${e}`,{actualBoundingBoxLeft:f,actualBoundingBoxRight:m,actualBoundingBoxAscent:p,actualBoundingBoxDescent:g,fontBoundingBoxAscent:y,fontBoundingBoxDescent:_,width:b}=u.measureText(t),w=1.5,v=Math.ceil(Math.max(Math.abs(f)+Math.abs(m)||0,b)*w),A=Math.ceil(Math.max(Math.abs(p)+Math.abs(g)||h,Math.abs(y)+Math.abs(_)||h)*w);l=new OffscreenCanvas(v,A),u=l.getContext("2d",{alpha:!0,willReadFrequently:!0}),u.font=d,u.filter="grayscale(1)",u.fillStyle="white",u.fillRect(0,0,v,A),u.fillStyle="black",u.fillText(t,v*(w-1)/2,A*(3-w)/2);const S=this.#d(u.getImageData(0,0,v,A).data),T=this.#c(S),E=this.#h(T),P=this.#r(S,v,A,E);return this.processDrawnLines({lines:{curves:P,width:v,height:A},pageWidth:r,pageHeight:o,rotation:a,innerMargin:c,mustSmooth:!0,areContours:!0})}static process(t,e,s,i,r){const[o,a,c]=this.#f(t),[l,u]=this.#l(o,a,c,Math.hypot(a,c)*this.#t.sigmaSFactor,this.#t.sigmaR,this.#t.kernelSize),h=this.#h(u),d=this.#r(l,a,c,h);return this.processDrawnLines({lines:{curves:d,width:a,height:c},pageWidth:e,pageHeight:s,rotation:i,innerMargin:r,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:i,innerMargin:r,mustSmooth:o,areContours:a}){i%180!==0&&([e,s]=[s,e]);const{curves:c,width:l,height:u}=t,h=t.thickness??0,d=[],f=Math.min(e/l,s/u),m=f/e,p=f/s,g=[];for(const{points:_}of c){const b=o?this.#a(_):_;if(!b)continue;g.push(b);const w=b.length,v=new Float32Array(w),A=new Float32Array(3*(w===2?2:w-2));if(d.push({line:A,points:v}),w===2){v[0]=b[0]*m,v[1]=b[1]*p,A.set([NaN,NaN,NaN,NaN,v[0],v[1]],0);continue}let[S,T,E,P]=b;S*=m,T*=p,E*=m,P*=p,v.set([S,T,E,P],0),A.set([NaN,NaN,NaN,NaN,S,T],0);for(let x=4;x<w;x+=2){const I=v[x]=b[x]*m,V=v[x+1]=b[x+1]*p;A.set(F.createBezierPoints(S,T,E,P,I,V),(x-2)*3),[S,T,E,P]=[E,P,I,V]}}if(d.length===0)return null;const y=a?new Gd:new So;return y.build(d,e,s,1,i,a?0:h,r),{outline:y,newCurves:g,areContours:a,thickness:h,width:l,height:u}}static async compressSignature({outlines:t,areContours:e,thickness:s,width:i,height:r}){let o=1/0,a=-1/0,c=0;for(const b of t){c+=b.length;for(let w=2,v=b.length;w<v;w++){const A=b[w]-b[w-2];o=Math.min(o,A),a=Math.max(a,A)}}let l;o>=-128&&a<=127?l=Int8Array:o>=-32768&&a<=32767?l=Int16Array:l=Int32Array;const u=t.length,h=Zo+nr*u,d=new Uint32Array(h);let f=0;d[f++]=h*Uint32Array.BYTES_PER_ELEMENT+(c-2*u)*l.BYTES_PER_ELEMENT,d[f++]=0,d[f++]=i,d[f++]=r,d[f++]=e?0:1,d[f++]=Math.max(0,Math.floor(s??0)),d[f++]=u,d[f++]=l.BYTES_PER_ELEMENT;for(const b of t)d[f++]=b.length-2,d[f++]=b[0],d[f++]=b[1];const m=new CompressionStream("deflate-raw"),p=m.writable.getWriter();await p.ready,p.write(d);const g=l.prototype.constructor;for(const b of t){const w=new g(b.length-2);for(let v=2,A=b.length;v<A;v++)w[v-2]=b[v]-b[v-2];p.write(w)}p.close();const y=await new Response(m.readable).arrayBuffer(),_=new Uint8Array(y);return w1(_)}static async decompressSignature(t){try{const e=nB(t),{readable:s,writable:i}=new DecompressionStream("deflate-raw"),r=i.getWriter();await r.ready,r.write(e).then(async()=>{await r.ready,await r.close()}).catch(()=>{});let o=null,a=0;for await(const b of s)o||=new Uint8Array(new Uint32Array(b.buffer,0,4)[0]),o.set(b,a),a+=b.length;const c=new Uint32Array(o.buffer,0,o.length>>2),l=c[1];if(l!==0)throw new Error(`Invalid version: ${l}`);const u=c[2],h=c[3],d=c[4]===0,f=c[5],m=c[6],p=c[7],g=[],y=(Zo+nr*m)*Uint32Array.BYTES_PER_ELEMENT;let _;switch(p){case Int8Array.BYTES_PER_ELEMENT:_=new Int8Array(o.buffer,y);break;case Int16Array.BYTES_PER_ELEMENT:_=new Int16Array(o.buffer,y);break;case Int32Array.BYTES_PER_ELEMENT:_=new Int32Array(o.buffer,y);break}a=0;for(let b=0;b<m;b++){const w=c[nr*b+Zo],v=new Float32Array(w+2);g.push(v);for(let A=0;A<nr-1;A++)v[A]=c[nr*b+Zo+A+1];for(let A=0;A<w;A++)v[A+2]=v[A]+_[a++]}return{areContours:d,thickness:f,outlines:g,width:u,height:h}}catch(e){return J(`decompressSignature: ${e}`),null}}}class Jp extends W1{constructor(){super(),super.updateProperties({fill:W._defaultLineColor,"stroke-width":0})}clone(){const t=new Jp;return t.updateAll(this),t}}class Qp extends il{constructor(t){super(t),super.updateProperties({stroke:W._defaultLineColor,"stroke-width":1})}clone(){const t=new Qp(this._viewParameters);return t.updateAll(this),t}}class pn extends ht{#t=!1;#e=null;#s=null;#n=null;static _type="signature";static _editorType=tt.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#s=t.signatureData||null,this.#e=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){W.initialize(t,e),this._defaultDrawingOptions=new Jp,this._defaultDrawnSignatureOptions=new Qp(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return Q(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#e}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:s}=this;if(s&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),this._drawId===null)if(this.#s){const{lines:i,mustSmooth:r,areContours:o,description:a,uuid:c,heightInPage:l}=this.#s,{rawDims:{pageWidth:u,pageHeight:h},rotation:d}=this.parent.viewport,f=si.processDrawnLines({lines:i,pageWidth:u,pageHeight:h,rotation:d,innerMargin:pn._INNER_MARGIN,mustSmooth:r,areContours:o});this.addSignature(f,l,a,c)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#e||""}));return s&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#n=t,this.addEditToolbar()}getUuid(){return this.#n}get description(){return this.#e}set description(t){this.#e=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:s,width:i,height:r}=this.#s,o=Math.max(i,r),a=si.processDrawnLines({lines:{curves:t.map(c=>({points:c})),thickness:s,width:i,height:r},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e});return{areContours:e,outline:a.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,s,i){const{x:r,y:o}=this,{outline:a}=this.#s=t;this.#t=a instanceof Gd,this.description=s;let c;this.#t?c=pn.getDefaultDrawingOptions():(c=pn._defaultDrawnSignatureOptions.clone(),c.updateProperties({"stroke-width":a.thickness})),this._addOutlines({drawOutlines:a,drawingOptions:c});const[,l]=this.pageDimensions;let u=e/l;u=u>=1?.5:u,this.width*=u/this.height,this.width>=1&&(u*=.9/this.width,this.width=.9),this.height=u,this.setDims(),this.x=r,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(i),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!i,hasDescription:!!s}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:s},rotation:i}=this.parent.viewport;return si.process(t,e,s,i,pn._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:s,pageHeight:i},rotation:r}=this.parent.viewport;return si.extractContoursFromText(t,e,s,i,r,pn._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:s},rotation:i}=this.parent.viewport;return si.processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:i,innerMargin:pn._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=pn.getDefaultDrawingOptions():(this._drawingOptions=pn._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:s}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":i}}=this,r=Object.assign(super.serialize(t),{isSignature:!0,areContours:this.#t,color:[0,0,0],thickness:this.#t?0:i});return this.addComment(r),t?(r.paths={lines:e,points:s},r.uuid=this.#n,r.isCopy=!0):r.lines=e,this.#e&&(r.accessibilityData={type:"Figure",alt:this.#e}),r}static deserializeDraw(t,e,s,i,r,o){return o.areContours?Gd.deserialize(t,e,s,i,r,o):So.deserialize(t,e,s,i,r,o)}static async deserialize(t,e,s){const i=await super.deserialize(t,e,s);return i.#t=t.areContours,i.description=t.accessibilityData?.alt||"",i.#n=t.uuid,i}}class z$ extends W{#t=null;#e=null;#s=null;#n=null;#o=null;#r="";#i=null;#a=!1;#l=null;#c=!1;#d=!1;static _type="stamp";static _editorType=tt.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#n=t.bitmapUrl,this.#o=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){W.initialize(t,e)}static isHandlingMimeForPasting(t){return Bd.includes(t)}static paste(t,e){e.pasteEditor({mode:tt.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#h(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#c=t.isSvg),t.file&&(this.#r=t.file.name),this.#m()}#f(){if(this.#s=null,this._uiManager.enableWaiting(!1),!!this.#i){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:r,height:o}=t||this.copyCanvas(null,null,!0).imageData,a=await s.guess({name:"altText",request:{data:i,width:r,height:o,channels:i.length/(r*o)}});if(!a)throw new Error("No response from the AI service.");if(a.error)throw new Error("Error from the AI service.");if(a.cancel)return null;if(!a.output)throw new Error("No valid response from the AI service.");const c=a.output;return await this.setGuessedAltText(c),e&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c}#g(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(s=>this.#h(s,!0)).finally(()=>this.#f());return}if(this.#n){const s=this.#n;this.#n=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromUrl(s).then(i=>this.#h(i)).finally(()=>this.#f());return}if(this.#o){const s=this.#o;this.#o=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromFile(s).then(i=>this.#h(i)).finally(()=>this.#f());return}const t=document.createElement("input");t.type="file",t.accept=Bd.join(",");const e=this._uiManager._signal;this.#s=new Promise(s=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const i=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#h(i)}s()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),s()},{signal:e})}).finally(()=>this.#f()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#i?.remove(),this.#i=null,this.#l&&(clearTimeout(this.#l),this.#l=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#g();return}super.rebuild(),this.div!==null&&(this.#e&&this.#i===null&&this.#g(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#s||this.#t||this.#n||this.#o||this.#e||this.#a)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#a||(this.#t?this.#m():this.#g()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:s,bitmap:i}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),s&&this._uiManager.imageManager.isValidId(s)&&(this.#e=s,i&&(this.#t=i),this.#a=!1,this.#m())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#l!==null&&clearTimeout(this.#l);const t=200;this.#l=setTimeout(()=>{this.#l=null,this.#p()},t)}#m(){const{div:t}=this;let{width:e,height:s}=this.#t;const[i,r]=this.pageDimensions,o=.75;if(this.width)e=this.width*i,s=this.height*r;else if(e>o*i||s>o*r){const c=Math.min(o*i/e,o*r/s);e*=c,s*=c}this._uiManager.enableWaiting(!1);const a=this.#i=document.createElement("canvas");a.setAttribute("role","img"),this.addContainer(a),this.width=e/i,this.height=s/r,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#p(),this.#d||(this.parent.addUndoableEditor(this),this.#d=!0),this._reportTelemetry({action:"inserted_image"}),this.#r&&this.div.setAttribute("aria-description",this.#r),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e,s=!1){t||(t=224);const{width:i,height:r}=this.#t,o=new En;let a=this.#t,c=i,l=r,u=null;if(e){if(i>e||r>e){const A=Math.min(e/i,e/r);c=Math.floor(i*A),l=Math.floor(r*A)}u=document.createElement("canvas");const d=u.width=Math.ceil(c*o.sx),f=u.height=Math.ceil(l*o.sy);this.#c||(a=this.#u(d,f));const m=u.getContext("2d");m.filter=this._uiManager.hcmFilter;let p="white",g="#cfcfd8";this._uiManager.hcmFilter!=="none"?g="black":cB.isDarkMode&&(p="#8f8f9d",g="#42414d");const y=15,_=y*o.sx,b=y*o.sy,w=new OffscreenCanvas(_*2,b*2),v=w.getContext("2d");v.fillStyle=p,v.fillRect(0,0,_*2,b*2),v.fillStyle=g,v.fillRect(0,0,_,b),v.fillRect(_,b,_,b),m.fillStyle=m.createPattern(w,"repeat"),m.fillRect(0,0,d,f),m.drawImage(a,0,0,a.width,a.height,0,0,d,f)}let h=null;if(s){let d,f;if(o.symmetric&&a.width<t&&a.height<t)d=a.width,f=a.height;else if(a=this.#t,i>t||r>t){const g=Math.min(t/i,t/r);d=Math.floor(i*g),f=Math.floor(r*g),this.#c||(a=this.#u(d,f))}const p=new OffscreenCanvas(d,f).getContext("2d",{willReadFrequently:!0});p.drawImage(a,0,0,a.width,a.height,0,0,d,f),h={width:d,height:f,data:p.getImageData(0,0,d,f).data}}return{canvas:u,width:c,height:l,imageData:h}}#u(t,e){const{width:s,height:i}=this.#t;let r=s,o=i,a=this.#t;for(;r>2*t||o>2*e;){const c=r,l=o;r>2*t&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2)),o>2*e&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const u=new OffscreenCanvas(r,o);u.getContext("2d").drawImage(a,0,0,c,l,0,0,r,o),a=u.transferToImageBitmap()}return a}#p(){const[t,e]=this.parentDimensions,{width:s,height:i}=this,r=new En,o=Math.ceil(s*t*r.sx),a=Math.ceil(i*e*r.sy),c=this.#i;if(!c||c.width===o&&c.height===a)return;c.width=o,c.height=a;const l=this.#c?this.#t:this.#u(o,a),u=c.getContext("2d");u.filter=this._uiManager.hcmFilter,u.drawImage(l,0,0,l.width,l.height,0,0,o,a)}#y(t){if(t){if(this.#c){const i=this._uiManager.imageManager.getSvgUrl(this.#e);if(i)return i}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#c){const[e,s]=this.pageDimensions,i=Math.round(this.width*e*Oi.PDF_TO_CSS_UNITS),r=Math.round(this.height*s*Oi.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(i,r);return o.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,i,r),o.transferToImageBitmap()}return structuredClone(this.#t)}static async deserialize(t,e,s){let i=null,r=!1;if(t instanceof H1){const{data:{rect:p,rotation:g,id:y,structParent:_,popupRef:b,richText:w,contentsObj:v,creationDate:A,modificationDate:S},container:T,parent:{page:{pageNumber:E}},canvas:P}=t;let x,I;P?(delete t.canvas,{id:x,bitmap:I}=s.imageManager.getFromCanvas(T.id,P),P.remove()):(r=!0,t._hasNoCanvas=!0);const V=(await e._structTree.getAriaAttributes(`${di}${y}`))?.get("aria-label")||"";i=t={annotationType:tt.STAMP,bitmapId:x,bitmap:I,pageIndex:E-1,rect:p.slice(0),rotation:g,annotationElementId:y,id:y,deleted:!1,accessibilityData:{decorative:!1,altText:V},isSvg:!1,structParent:_,popupRef:b,richText:w,comment:v?.str||null,creationDate:A,modificationDate:S}}const o=await super.deserialize(t,e,s),{rect:a,bitmap:c,bitmapUrl:l,bitmapId:u,isSvg:h,accessibilityData:d}=t;r?(s.addMissingCanvas(t.id,o),o.#a=!0):u&&s.imageManager.isValidId(u)?(o.#e=u,c&&(o.#t=c)):o.#n=l,o.#c=h;const[f,m]=o.pageDimensions;return o.width=(a[2]-a[0])/f,o.height=(a[3]-a[1])/m,d&&(o.altTextData=d),o._initialData=i,t.comment&&o.setCommentData(t),o.#d=!!i,o}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=Object.assign(super.serialize(t),{bitmapId:this.#e,isSvg:this.#c});if(this.addComment(s),t)return s.bitmapUrl=this.#y(!0),s.accessibilityData=this.serializeAltText(!0),s.isCopy=!0,s;const{decorative:i,altText:r}=this.serializeAltText(!1);if(!i&&r&&(s.accessibilityData={type:"Figure",alt:r}),this.annotationElementId){const a=this.#_(s);return a.isSame?null:(a.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1,s.id=this.annotationElementId,delete s.bitmapId,s)}if(e===null)return s;e.stamps||=new Map;const o=this.#c?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:o,serialized:s}),s.bitmap=this.#y(!1);else if(this.#c){const a=e.stamps.get(this.#e);o>a.area&&(a.area=o,a.serialized.bitmap.close(),a.serialized.bitmap=this.#y(!1))}return s}#_(t){const{pageIndex:e,accessibilityData:{altText:s}}=this._initialData,i=t.pageIndex===e,r=(t.accessibilityData?.alt||"")===s;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&i&&r,isSameAltText:r}}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class Mn{#t;#e=!1;#s=null;#n=null;#o=null;#r=new Map;#i=!1;#a=!1;#l=!1;#c=null;#d=null;#h=null;#f=null;#g=null;#m=-1;#u;static _initialized=!1;static#p=new Map([Yt,Zp,z$,Dt,pn].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:s,structTreeLayer:i,accessibilityManager:r,annotationLayer:o,drawLayer:a,textLayer:c,viewport:l,l10n:u}){const h=[...Mn.#p.values()];if(!Mn._initialized){Mn._initialized=!0;for(const d of h)d.initialize(u,t)}t.registerEditorTypes(h),this.#u=t,this.pageIndex=e,this.div=s,this.#t=r,this.#s=o,this.viewport=l,this.#h=c,this.drawLayer=a,this._structTree=i,this.#u.addLayer(this)}get isEmpty(){return this.#r.size===0}get isInvisible(){return this.isEmpty&&this.#u.getMode()===tt.NONE}updateToolbar(t){this.#u.updateToolbar(t)}updateMode(t=this.#u.getMode()){switch(this.#v(),t){case tt.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case tt.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case tt.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;if(e.toggle("nonEditing",!1),t===tt.POPUP)e.toggle("commentEditing",!0);else{e.toggle("commentEditing",!1);for(const s of Mn.#p.values())e.toggle(`${s._type}Editing`,t===s._editorType)}this.div.hidden=!1}hasTextLayer(t){return t===this.#h?.div}setEditingState(t){this.#u.setEditingState(t)}addCommands(t){this.#u.addCommands(t)}cleanUndoStack(t){this.#u.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#s?.togglePointerEvents(t)}get#y(){return this.#r.size!==0?this.#r.values():this.#u.getEditors(this.pageIndex)}async enable(){this.#l=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#g?.abort(),this.#g=null;const t=new Set;for(const s of this.#y)s.enableEditing(),s.show(!0),s.annotationElementId&&(this.#u.removeChangedExistingAnnotation(s),t.add(s.annotationElementId));const e=this.#s;if(e)for(const s of e.getEditableAnnotations()){if(s.hide(),this.#u.isDeletedAnnotationElement(s.data.id)||t.has(s.data.id))continue;const i=await this.deserialize(s);i&&(this.addOrRebuild(i),i.enableEditing())}this.#l=!1,this.#u._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#a=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#h&&!this.#g){this.#g=new AbortController;const i=this.#u.combinedSignal(this.#g);this.#h.div.addEventListener("pointerdown",r=>{const{clientX:a,clientY:c,timeStamp:l}=r,u=this.#m;if(l-u>500){this.#m=l;return}this.#m=-1;const{classList:h}=this.div;h.toggle("getElements",!0);const d=document.elementsFromPoint(a,c);if(h.toggle("getElements",!1),!this.div.contains(d[0]))return;let f;const m=new RegExp(`^${Xr}[0-9]+$`);for(const g of d)if(m.test(g.id)){f=g.id;break}if(!f)return;const p=this.#r.get(f);p?.annotationElementId===null&&(r.stopPropagation(),r.preventDefault(),p.dblclick(r))},{signal:i,capture:!0})}const t=this.#s,e=[];if(t){const i=new Map,r=new Map;for(const a of this.#y){if(a.disableEditing(),!a.annotationElementId){e.push(a);continue}if(a.serialize()!==null){i.set(a.annotationElementId,a);continue}else r.set(a.annotationElementId,a);this.getEditableAnnotation(a.annotationElementId)?.show(),a.remove()}const o=t.getEditableAnnotations();for(const a of o){const{id:c}=a.data;if(this.#u.isDeletedAnnotationElement(c)){a.updateEdited({deleted:!0});continue}let l=r.get(c);if(l){l.resetAnnotationElement(a),l.show(!1),a.show();continue}l=i.get(c),l&&(this.#u.addChangedExistingAnnotation(l),l.renderAnnotationElement(a)&&l.show(!1)),a.show()}}this.#v(),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const i of Mn.#p.values())s.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),t?.updateFakeAnnotations(e),this.#a=!1}getEditableAnnotation(t){return this.#s?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#u.getActive()!==t&&this.#u.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#h?.div&&!this.#f){this.#f=new AbortController;const t=this.#u.combinedSignal(this.#f);this.#h.div.addEventListener("pointerdown",this.#_.bind(this),{signal:t}),this.#h.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#h?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#h.div.classList.remove("highlighting"))}#_(t){this.#u.unselectAll();const{target:e}=t;if(e===this.#h.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#h.div.contains(e)){const{isMac:s}=ce.platform;if(t.button!==0||t.ctrlKey&&s)return;this.#u.showAllEditors("highlight",!0,!0),this.#h.div.classList.add("free"),this.toggleDrawing(),Dt.startHighlighting(this,this.#u.direction==="ltr",{target:this.#h.div,x:t.x,y:t.y}),this.#h.div.addEventListener("pointerup",()=>{this.#h.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#u._signal}),t.preventDefault()}}enableClick(){if(this.#n)return;this.#n=new AbortController;const t=this.#u.combinedSignal(this.#n);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#n?.abort(),this.#n=null}attach(t){this.#r.set(t.id,t);const{annotationElementId:e}=t;e&&this.#u.isDeletedAnnotationElement(e)&&this.#u.removeDeletedAnnotationElement(t)}detach(t){this.#r.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#a&&t.annotationElementId&&this.#u.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#u.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#u.addDeletedAnnotationElement(t),W.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#u.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#l),this.#u.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#o&&(t._focusEventsAllowed=!1,this.#o=setTimeout(()=>{this.#o=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#u._signal}),e.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),s=()=>{t.remove()};this.addCommands({cmd:e,undo:s,mustExec:!1})}getEditorByUID(t){for(const e of this.#r.values())if(e.uid===t)return e;return null}getNextId(){return this.#u.getId()}get#b(){return Mn.#p.get(this.#u.getMode())}combinedSignal(t){return this.#u.combinedSignal(t)}#E(t){const e=this.#b;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#b?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#u.updateMode(t.mode);const{offsetX:s,offsetY:i}=this.#S(),r=this.getNextId(),o=this.#E({parent:this,id:r,x:s,y:i,uiManager:this.#u,isCentered:!0,...e});o&&this.add(o)}async deserialize(t){return await Mn.#p.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#u)||null}createAndAddNewEditor(t,e,s={}){const i=this.getNextId(),r=this.#E({parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:this.#u,isCentered:e,...s});return r&&this.add(r),r}get boundingClientRect(){return this.div.getBoundingClientRect()}#S(){const{x:t,y:e,width:s,height:i}=this.boundingClientRect,r=Math.max(0,t),o=Math.max(0,e),a=Math.min(window.innerWidth,t+s),c=Math.min(window.innerHeight,e+i),l=(r+a)/2-t,u=(o+c)/2-e,[h,d]=this.viewport.rotation%180===0?[l,u]:[u,l];return{offsetX:h,offsetY:d}}addNewEditor(t={}){this.createAndAddNewEditor(this.#S(),!0,t)}setSelected(t){this.#u.setSelected(t)}toggleSelected(t){this.#u.toggleSelected(t)}unselect(t){this.#u.unselect(t)}pointerup(t){const{isMac:e}=ce.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!this.#i||(this.#i=!1,this.#b?.isDrawer&&this.#b.supportMultipleDrawings))return;if(!this.#e){this.#e=!0;return}const s=this.#u.getMode();if(s===tt.STAMP||s===tt.SIGNATURE){this.#u.unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){if(this.#u.getMode()===tt.HIGHLIGHT&&this.enableTextSelection(),this.#i){this.#i=!1;return}const{isMac:e}=ce.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(this.#i=!0,this.#b?.isDrawer){this.startDrawingSession(t);return}const s=this.#u.getActive();this.#e=!s||s.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#c){this.#b.startDrawing(this,this.#u,!1,t);return}this.#u.setCurrentDrawingSession(this),this.#c=new AbortController;const e=this.#u.combinedSignal(this.#c);this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(this.#d=null,this.commitOrRemove())},{signal:e}),this.#b.startDrawing(this,this.#u,!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&(this.#d=e);return}this.#d&&setTimeout(()=>{this.#d?.focus(),this.#d=null},0)}endDrawingSession(t=!1){return this.#c?(this.#u.setCurrentDrawingSession(null),this.#c.abort(),this.#c=null,this.#d=null,this.#b.endDrawing(t)):null}findNewParent(t,e,s){const i=this.#u.findParent(e,s);return i===null||i===this?!1:(i.changeParent(t),!0)}commitOrRemove(){return this.#c?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#c&&this.#b.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#u.getActive()?.parent===this&&(this.#u.commitOrRemove(),this.#u.setActiveEditor(null)),this.#o&&(clearTimeout(this.#o),this.#o=null);for(const t of this.#r.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#r.clear(),this.#u.removeLayer(this)}#v(){for(const t of this.#r.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,Ls(this.div,t);for(const e of this.#u.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#u.commitOrRemove(),this.#v();const e=this.viewport.rotation,s=t.rotation;if(this.viewport=t,Ls(this.div,{rotation:s}),e!==s)for(const i of this.#r.values())i.rotate(s)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#u.viewParameters.realScale}}class ee{#t=null;#e=new Map;#s=new Map;static#n=0;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#e.size>0)for(const e of this.#e.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return Q(this,"_svgFactory",new dc)}static#o(t,[e,s,i,r]){const{style:o}=t;o.top=`${100*s}%`,o.left=`${100*e}%`,o.width=`${100*i}%`,o.height=`${100*r}%`}#r(){const t=ee._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#i(t,e){const s=ee._svgFactory.createElement("clipPath");t.append(s);const i=`clip_${e}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const r=ee._svgFactory.createElement("use");return s.append(r),r.setAttribute("href",`#${e}`),r.classList.add("clip"),i}#a(t,e){for(const[s,i]of Object.entries(e))i===null?t.removeAttribute(s):t.setAttribute(s,i)}draw(t,e=!1,s=!1){const i=ee.#n++,r=this.#r(),o=ee._svgFactory.createElement("defs");r.append(o);const a=ee._svgFactory.createElement("path");o.append(a);const c=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",c),a.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#s.set(i,a);const l=s?this.#i(o,c):null,u=ee._svgFactory.createElement("use");return r.append(u),u.setAttribute("href",`#${c}`),this.updateProperties(r,t),this.#e.set(i,r),{id:i,clipPathId:`url(#${l})`}}drawOutline(t,e){const s=ee.#n++,i=this.#r(),r=ee._svgFactory.createElement("defs");i.append(r);const o=ee._svgFactory.createElement("path");r.append(o);const a=`path_p${this.pageIndex}_${s}`;o.setAttribute("id",a),o.setAttribute("vector-effect","non-scaling-stroke");let c;if(e){const h=ee._svgFactory.createElement("mask");r.append(h),c=`mask_p${this.pageIndex}_${s}`,h.setAttribute("id",c),h.setAttribute("maskUnits","objectBoundingBox");const d=ee._svgFactory.createElement("rect");h.append(d),d.setAttribute("width","1"),d.setAttribute("height","1"),d.setAttribute("fill","white");const f=ee._svgFactory.createElement("use");h.append(f),f.setAttribute("href",`#${a}`),f.setAttribute("stroke","none"),f.setAttribute("fill","black"),f.setAttribute("fill-rule","nonzero"),f.classList.add("mask")}const l=ee._svgFactory.createElement("use");i.append(l),l.setAttribute("href",`#${a}`),c&&l.setAttribute("mask",`url(#${c})`);const u=l.cloneNode();return i.append(u),l.classList.add("mainOutline"),u.classList.add("secondaryOutline"),this.updateProperties(i,t),this.#e.set(s,i),s}finalizeDraw(t,e){this.#s.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:s,bbox:i,rootClass:r,path:o}=e,a=typeof t=="number"?this.#e.get(t):t;if(a){if(s&&this.#a(a,s),i&&ee.#o(a,i),r){const{classList:c}=a;for(const[l,u]of Object.entries(r))c.toggle(l,u)}if(o){const l=a.firstElementChild.firstElementChild;this.#a(l,o)}}}updateParent(t,e){if(e===this)return;const s=this.#e.get(t);s&&(e.#t.append(s),this.#e.delete(t),e.#e.set(t,s))}remove(t){this.#s.delete(t),this.#t!==null&&(this.#e.get(t).remove(),this.#e.delete(t))}destroy(){this.#t=null;for(const t of this.#e.values())t.remove();this.#e.clear(),this.#s.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:qd};globalThis.pdfjsLib={AbortException:ns,AnnotationEditorLayer:Mn,AnnotationEditorParamsType:at,AnnotationEditorType:tt,AnnotationEditorUIManager:ss,AnnotationLayer:Kp,AnnotationMode:Kn,AnnotationType:Nt,applyOpacity:uB,build:b$,ColorPicker:He,createValidAbsoluteUrl:g1,CSSConstants:lB,DOMSVGFactory:dc,DrawLayer:ee,FeatureTest:ce,fetchData:bo,findContrastColor:hB,getDocument:d$,getFilenameFromUrl:sB,getPdfFilenameFromUrl:iB,getRGB:wo,getUuid:_1,getXfaPageViewport:oB,GlobalWorkerOptions:Er,ImageKind:wa,InvalidPDFException:Nd,isDataScheme:el,isPdfFile:Up,isValidExplicitDest:vB,MathClamp:ye,noContextMenu:Je,normalizeUnicode:tB,OPS:Kr,OutputScale:En,PasswordResponses:q2,PDFDataRangeTransport:$1,PDFDateString:Fd,PDFWorker:se,PermissionFlag:H2,PixelsPerInch:Oi,RenderingCancelledException:$p,renderRichText:A1,ResponseException:uc,setLayerDimensions:Ls,shadow:Q,SignatureExtractor:si,stopEvent:Ot,SupportedImageMimeTypes:Bd,TextLayer:me,TouchManager:nl,updateUrlHash:y1,Util:U,VerbosityLevel:Jc,version:y$,XfaLayer:v1};function M(n,t,e){function s(a,c){if(a._zod||Object.defineProperty(a,"_zod",{value:{def:c,constr:o,traits:new Set},enumerable:!1}),a._zod.traits.has(n))return;a._zod.traits.add(n),t(a,c);const l=o.prototype,u=Object.keys(l);for(let h=0;h<u.length;h++){const d=u[h];d in a||(a[d]=l[d].bind(a))}}const i=e?.Parent??Object;class r extends i{}Object.defineProperty(r,"name",{value:n});function o(a){var c;const l=e?.Parent?new r:this;s(l,a),(c=l._zod).deferred??(c.deferred=[]);for(const u of l._zod.deferred)u();return l}return Object.defineProperty(o,"init",{value:s}),Object.defineProperty(o,Symbol.hasInstance,{value:a=>e?.Parent&&a instanceof e.Parent?!0:a?._zod?.traits?.has(n)}),Object.defineProperty(o,"name",{value:n}),o}class Si extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class G1 extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const Y1={};function Fs(n){return Y1}function X1(n){const t=Object.values(n).filter(s=>typeof s=="number");return Object.entries(n).filter(([s,i])=>t.indexOf(+s)===-1).map(([s,i])=>i)}function Yd(n,t){return typeof t=="bigint"?t.toString():t}function tm(n){return{get value(){{const t=n();return Object.defineProperty(this,"value",{value:t}),t}}}}function em(n){return n==null}function nm(n){const t=n.startsWith("^")?1:0,e=n.endsWith("$")?n.length-1:n.length;return n.slice(t,e)}function V$(n,t){const e=(n.toString().split(".")[1]||"").length,s=t.toString();let i=(s.split(".")[1]||"").length;if(i===0&&/\d?e-\d?/.test(s)){const c=s.match(/\d?e-(\d?)/);c?.[1]&&(i=Number.parseInt(c[1]))}const r=e>i?e:i,o=Number.parseInt(n.toFixed(r).replace(".","")),a=Number.parseInt(t.toFixed(r).replace(".",""));return o%a/10**r}const b_=Symbol("evaluating");function vt(n,t,e){let s;Object.defineProperty(n,t,{get(){if(s!==b_)return s===void 0&&(s=b_,s=e()),s},set(i){Object.defineProperty(n,t,{value:i})},configurable:!0})}function qs(n,t,e){Object.defineProperty(n,t,{value:e,writable:!0,enumerable:!0,configurable:!0})}function Ws(...n){const t={};for(const e of n){const s=Object.getOwnPropertyDescriptors(e);Object.assign(t,s)}return Object.defineProperties({},t)}function __(n){return JSON.stringify(n)}function H$(n){return n.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const K1="captureStackTrace"in Error?Error.captureStackTrace:(...n)=>{};function fc(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}const q$=tm(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const n=Function;return new n(""),!0}catch{return!1}});function Qr(n){if(fc(n)===!1)return!1;const t=n.constructor;if(t===void 0||typeof t!="function")return!0;const e=t.prototype;return!(fc(e)===!1||Object.prototype.hasOwnProperty.call(e,"isPrototypeOf")===!1)}function Z1(n){return Qr(n)?{...n}:Array.isArray(n)?[...n]:n}const W$=new Set(["string","number","symbol"]);function rl(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function as(n,t,e){const s=new n._zod.constr(t??n._zod.def);return(!t||e?.parent)&&(s._zod.parent=n),s}function Y(n){const t=n;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function G$(n){return Object.keys(n).filter(t=>n[t]._zod.optin==="optional"&&n[t]._zod.optout==="optional")}const Y$={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function X$(n,t){const e=n._zod.def,s=Ws(n._zod.def,{get shape(){const i={};for(const r in t){if(!(r in e.shape))throw new Error(`Unrecognized key: "${r}"`);t[r]&&(i[r]=e.shape[r])}return qs(this,"shape",i),i},checks:[]});return as(n,s)}function K$(n,t){const e=n._zod.def,s=Ws(n._zod.def,{get shape(){const i={...n._zod.def.shape};for(const r in t){if(!(r in e.shape))throw new Error(`Unrecognized key: "${r}"`);t[r]&&delete i[r]}return qs(this,"shape",i),i},checks:[]});return as(n,s)}function Z$(n,t){if(!Qr(t))throw new Error("Invalid input to extend: expected a plain object");const e=n._zod.def.checks;if(e&&e.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const i=Ws(n._zod.def,{get shape(){const r={...n._zod.def.shape,...t};return qs(this,"shape",r),r},checks:[]});return as(n,i)}function J$(n,t){if(!Qr(t))throw new Error("Invalid input to safeExtend: expected a plain object");const e={...n._zod.def,get shape(){const s={...n._zod.def.shape,...t};return qs(this,"shape",s),s},checks:n._zod.def.checks};return as(n,e)}function Q$(n,t){const e=Ws(n._zod.def,{get shape(){const s={...n._zod.def.shape,...t._zod.def.shape};return qs(this,"shape",s),s},get catchall(){return t._zod.def.catchall},checks:[]});return as(n,e)}function tU(n,t,e){const s=Ws(t._zod.def,{get shape(){const i=t._zod.def.shape,r={...i};if(e)for(const o in e){if(!(o in i))throw new Error(`Unrecognized key: "${o}"`);e[o]&&(r[o]=n?new n({type:"optional",innerType:i[o]}):i[o])}else for(const o in i)r[o]=n?new n({type:"optional",innerType:i[o]}):i[o];return qs(this,"shape",r),r},checks:[]});return as(t,s)}function eU(n,t,e){const s=Ws(t._zod.def,{get shape(){const i=t._zod.def.shape,r={...i};if(e)for(const o in e){if(!(o in r))throw new Error(`Unrecognized key: "${o}"`);e[o]&&(r[o]=new n({type:"nonoptional",innerType:i[o]}))}else for(const o in i)r[o]=new n({type:"nonoptional",innerType:i[o]});return qs(this,"shape",r),r},checks:[]});return as(t,s)}function mi(n,t=0){if(n.aborted===!0)return!0;for(let e=t;e<n.issues.length;e++)if(n.issues[e]?.continue!==!0)return!0;return!1}function J1(n,t){return t.map(e=>{var s;return(s=e).path??(s.path=[]),e.path.unshift(n),e})}function Jo(n){return typeof n=="string"?n:n?.message}function Bs(n,t,e){const s={...n,path:n.path??[]};if(!n.message){const i=Jo(n.inst?._zod.def?.error?.(n))??Jo(t?.error?.(n))??Jo(e.customError?.(n))??Jo(e.localeError?.(n))??"Invalid input";s.message=i}return delete s.inst,delete s.continue,t?.reportInput||delete s.input,s}function sm(n){return Array.isArray(n)?"array":typeof n=="string"?"string":"unknown"}function to(...n){const[t,e,s]=n;return typeof t=="string"?{message:t,code:"custom",input:e,inst:s}:{...t}}const Q1=(n,t)=>{n.name="$ZodError",Object.defineProperty(n,"_zod",{value:n._zod,enumerable:!1}),Object.defineProperty(n,"issues",{value:t,enumerable:!1}),n.message=JSON.stringify(t,Yd,2),Object.defineProperty(n,"toString",{value:()=>n.message,enumerable:!1})},tT=M("$ZodError",Q1),eT=M("$ZodError",Q1,{Parent:Error});function nU(n,t=e=>e.message){const e={},s=[];for(const i of n.issues)i.path.length>0?(e[i.path[0]]=e[i.path[0]]||[],e[i.path[0]].push(t(i))):s.push(t(i));return{formErrors:s,fieldErrors:e}}function sU(n,t=e=>e.message){const e={_errors:[]},s=i=>{for(const r of i.issues)if(r.code==="invalid_union"&&r.errors.length)r.errors.map(o=>s({issues:o}));else if(r.code==="invalid_key")s({issues:r.issues});else if(r.code==="invalid_element")s({issues:r.issues});else if(r.path.length===0)e._errors.push(t(r));else{let o=e,a=0;for(;a<r.path.length;){const c=r.path[a];a===r.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(r))):o[c]=o[c]||{_errors:[]},o=o[c],a++}}};return s(n),e}const im=n=>(t,e,s,i)=>{const r=s?Object.assign(s,{async:!1}):{async:!1},o=t._zod.run({value:e,issues:[]},r);if(o instanceof Promise)throw new Si;if(o.issues.length){const a=new(i?.Err??n)(o.issues.map(c=>Bs(c,r,Fs())));throw K1(a,i?.callee),a}return o.value},rm=n=>async(t,e,s,i)=>{const r=s?Object.assign(s,{async:!0}):{async:!0};let o=t._zod.run({value:e,issues:[]},r);if(o instanceof Promise&&(o=await o),o.issues.length){const a=new(i?.Err??n)(o.issues.map(c=>Bs(c,r,Fs())));throw K1(a,i?.callee),a}return o.value},ol=n=>(t,e,s)=>{const i=s?{...s,async:!1}:{async:!1},r=t._zod.run({value:e,issues:[]},i);if(r instanceof Promise)throw new Si;return r.issues.length?{success:!1,error:new(n??tT)(r.issues.map(o=>Bs(o,i,Fs())))}:{success:!0,data:r.value}},iU=ol(eT),al=n=>async(t,e,s)=>{const i=s?Object.assign(s,{async:!0}):{async:!0};let r=t._zod.run({value:e,issues:[]},i);return r instanceof Promise&&(r=await r),r.issues.length?{success:!1,error:new n(r.issues.map(o=>Bs(o,i,Fs())))}:{success:!0,data:r.value}},rU=al(eT),oU=n=>(t,e,s)=>{const i=s?Object.assign(s,{direction:"backward"}):{direction:"backward"};return im(n)(t,e,i)},aU=n=>(t,e,s)=>im(n)(t,e,s),cU=n=>async(t,e,s)=>{const i=s?Object.assign(s,{direction:"backward"}):{direction:"backward"};return rm(n)(t,e,i)},lU=n=>async(t,e,s)=>rm(n)(t,e,s),uU=n=>(t,e,s)=>{const i=s?Object.assign(s,{direction:"backward"}):{direction:"backward"};return ol(n)(t,e,i)},hU=n=>(t,e,s)=>ol(n)(t,e,s),dU=n=>async(t,e,s)=>{const i=s?Object.assign(s,{direction:"backward"}):{direction:"backward"};return al(n)(t,e,i)},fU=n=>async(t,e,s)=>al(n)(t,e,s),pU=/^[cC][^\s-]{8,}$/,mU=/^[0-9a-z]+$/,gU=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,yU=/^[0-9a-vA-V]{20}$/,bU=/^[A-Za-z0-9]{27}$/,_U=/^[a-zA-Z0-9_-]{21}$/,wU=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,vU=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,w_=n=>n?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${n}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,AU=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,SU="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function TU(){return new RegExp(SU,"u")}const EU=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,xU=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,CU=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,PU=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,kU=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,nT=/^[A-Za-z0-9_-]*$/,MU=/^\+(?:[0-9]){6,14}[0-9]$/,sT="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",RU=new RegExp(`^${sT}$`);function iT(n){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof n.precision=="number"?n.precision===-1?`${t}`:n.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${n.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function OU(n){return new RegExp(`^${iT(n)}$`)}function DU(n){const t=iT({precision:n.precision}),e=["Z"];n.local&&e.push(""),n.offset&&e.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const s=`${t}(?:${e.join("|")})`;return new RegExp(`^${sT}T(?:${s})$`)}const IU=n=>{const t=n?`[\\s\\S]{${n?.minimum??0},${n?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},LU=/^-?\d+$/,NU=/^-?\d+(?:\.\d+)?/,FU=/^(?:true|false)$/i,BU=/^[^A-Z]*$/,$U=/^[^a-z]*$/,Ce=M("$ZodCheck",(n,t)=>{var e;n._zod??(n._zod={}),n._zod.def=t,(e=n._zod).onattach??(e.onattach=[])}),rT={number:"number",bigint:"bigint",object:"date"},oT=M("$ZodCheckLessThan",(n,t)=>{Ce.init(n,t);const e=rT[typeof t.value];n._zod.onattach.push(s=>{const i=s._zod.bag,r=(t.inclusive?i.maximum:i.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<r&&(t.inclusive?i.maximum=t.value:i.exclusiveMaximum=t.value)}),n._zod.check=s=>{(t.inclusive?s.value<=t.value:s.value<t.value)||s.issues.push({origin:e,code:"too_big",maximum:t.value,input:s.value,inclusive:t.inclusive,inst:n,continue:!t.abort})}}),aT=M("$ZodCheckGreaterThan",(n,t)=>{Ce.init(n,t);const e=rT[typeof t.value];n._zod.onattach.push(s=>{const i=s._zod.bag,r=(t.inclusive?i.minimum:i.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>r&&(t.inclusive?i.minimum=t.value:i.exclusiveMinimum=t.value)}),n._zod.check=s=>{(t.inclusive?s.value>=t.value:s.value>t.value)||s.issues.push({origin:e,code:"too_small",minimum:t.value,input:s.value,inclusive:t.inclusive,inst:n,continue:!t.abort})}}),UU=M("$ZodCheckMultipleOf",(n,t)=>{Ce.init(n,t),n._zod.onattach.push(e=>{var s;(s=e._zod.bag).multipleOf??(s.multipleOf=t.value)}),n._zod.check=e=>{if(typeof e.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof e.value=="bigint"?e.value%t.value===BigInt(0):V$(e.value,t.value)===0)||e.issues.push({origin:typeof e.value,code:"not_multiple_of",divisor:t.value,input:e.value,inst:n,continue:!t.abort})}}),jU=M("$ZodCheckNumberFormat",(n,t)=>{Ce.init(n,t),t.format=t.format||"float64";const e=t.format?.includes("int"),s=e?"int":"number",[i,r]=Y$[t.format];n._zod.onattach.push(o=>{const a=o._zod.bag;a.format=t.format,a.minimum=i,a.maximum=r,e&&(a.pattern=LU)}),n._zod.check=o=>{const a=o.value;if(e){if(!Number.isInteger(a)){o.issues.push({expected:s,format:t.format,code:"invalid_type",continue:!1,input:a,inst:n});return}if(!Number.isSafeInteger(a)){a>0?o.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:n,origin:s,continue:!t.abort}):o.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:n,origin:s,continue:!t.abort});return}}a<i&&o.issues.push({origin:"number",input:a,code:"too_small",minimum:i,inclusive:!0,inst:n,continue:!t.abort}),a>r&&o.issues.push({origin:"number",input:a,code:"too_big",maximum:r,inst:n})}}),zU=M("$ZodCheckMaxLength",(n,t)=>{var e;Ce.init(n,t),(e=n._zod.def).when??(e.when=s=>{const i=s.value;return!em(i)&&i.length!==void 0}),n._zod.onattach.push(s=>{const i=s._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<i&&(s._zod.bag.maximum=t.maximum)}),n._zod.check=s=>{const i=s.value;if(i.length<=t.maximum)return;const o=sm(i);s.issues.push({origin:o,code:"too_big",maximum:t.maximum,inclusive:!0,input:i,inst:n,continue:!t.abort})}}),VU=M("$ZodCheckMinLength",(n,t)=>{var e;Ce.init(n,t),(e=n._zod.def).when??(e.when=s=>{const i=s.value;return!em(i)&&i.length!==void 0}),n._zod.onattach.push(s=>{const i=s._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>i&&(s._zod.bag.minimum=t.minimum)}),n._zod.check=s=>{const i=s.value;if(i.length>=t.minimum)return;const o=sm(i);s.issues.push({origin:o,code:"too_small",minimum:t.minimum,inclusive:!0,input:i,inst:n,continue:!t.abort})}}),HU=M("$ZodCheckLengthEquals",(n,t)=>{var e;Ce.init(n,t),(e=n._zod.def).when??(e.when=s=>{const i=s.value;return!em(i)&&i.length!==void 0}),n._zod.onattach.push(s=>{const i=s._zod.bag;i.minimum=t.length,i.maximum=t.length,i.length=t.length}),n._zod.check=s=>{const i=s.value,r=i.length;if(r===t.length)return;const o=sm(i),a=r>t.length;s.issues.push({origin:o,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:s.value,inst:n,continue:!t.abort})}}),cl=M("$ZodCheckStringFormat",(n,t)=>{var e,s;Ce.init(n,t),n._zod.onattach.push(i=>{const r=i._zod.bag;r.format=t.format,t.pattern&&(r.patterns??(r.patterns=new Set),r.patterns.add(t.pattern))}),t.pattern?(e=n._zod).check??(e.check=i=>{t.pattern.lastIndex=0,!t.pattern.test(i.value)&&i.issues.push({origin:"string",code:"invalid_format",format:t.format,input:i.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:n,continue:!t.abort})}):(s=n._zod).check??(s.check=()=>{})}),qU=M("$ZodCheckRegex",(n,t)=>{cl.init(n,t),n._zod.check=e=>{t.pattern.lastIndex=0,!t.pattern.test(e.value)&&e.issues.push({origin:"string",code:"invalid_format",format:"regex",input:e.value,pattern:t.pattern.toString(),inst:n,continue:!t.abort})}}),WU=M("$ZodCheckLowerCase",(n,t)=>{t.pattern??(t.pattern=BU),cl.init(n,t)}),GU=M("$ZodCheckUpperCase",(n,t)=>{t.pattern??(t.pattern=$U),cl.init(n,t)}),YU=M("$ZodCheckIncludes",(n,t)=>{Ce.init(n,t);const e=rl(t.includes),s=new RegExp(typeof t.position=="number"?`^.{${t.position}}${e}`:e);t.pattern=s,n._zod.onattach.push(i=>{const r=i._zod.bag;r.patterns??(r.patterns=new Set),r.patterns.add(s)}),n._zod.check=i=>{i.value.includes(t.includes,t.position)||i.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:i.value,inst:n,continue:!t.abort})}}),XU=M("$ZodCheckStartsWith",(n,t)=>{Ce.init(n,t);const e=new RegExp(`^${rl(t.prefix)}.*`);t.pattern??(t.pattern=e),n._zod.onattach.push(s=>{const i=s._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(e)}),n._zod.check=s=>{s.value.startsWith(t.prefix)||s.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:s.value,inst:n,continue:!t.abort})}}),KU=M("$ZodCheckEndsWith",(n,t)=>{Ce.init(n,t);const e=new RegExp(`.*${rl(t.suffix)}$`);t.pattern??(t.pattern=e),n._zod.onattach.push(s=>{const i=s._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(e)}),n._zod.check=s=>{s.value.endsWith(t.suffix)||s.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:s.value,inst:n,continue:!t.abort})}}),ZU=M("$ZodCheckOverwrite",(n,t)=>{Ce.init(n,t),n._zod.check=e=>{e.value=t.tx(e.value)}});class JU{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const s=t.split(`
`).filter(o=>o),i=Math.min(...s.map(o=>o.length-o.trimStart().length)),r=s.map(o=>o.slice(i)).map(o=>" ".repeat(this.indent*2)+o);for(const o of r)this.content.push(o)}compile(){const t=Function,e=this?.args,i=[...(this?.content??[""]).map(r=>`  ${r}`)];return new t(...e,i.join(`
`))}}const QU={major:4,minor:2,patch:1},It=M("$ZodType",(n,t)=>{var e;n??(n={}),n._zod.def=t,n._zod.bag=n._zod.bag||{},n._zod.version=QU;const s=[...n._zod.def.checks??[]];n._zod.traits.has("$ZodCheck")&&s.unshift(n);for(const i of s)for(const r of i._zod.onattach)r(n);if(s.length===0)(e=n._zod).deferred??(e.deferred=[]),n._zod.deferred?.push(()=>{n._zod.run=n._zod.parse});else{const i=(o,a,c)=>{let l=mi(o),u;for(const h of a){if(h._zod.def.when){if(!h._zod.def.when(o))continue}else if(l)continue;const d=o.issues.length,f=h._zod.check(o);if(f instanceof Promise&&c?.async===!1)throw new Si;if(u||f instanceof Promise)u=(u??Promise.resolve()).then(async()=>{await f,o.issues.length!==d&&(l||(l=mi(o,d)))});else{if(o.issues.length===d)continue;l||(l=mi(o,d))}}return u?u.then(()=>o):o},r=(o,a,c)=>{if(mi(o))return o.aborted=!0,o;const l=i(a,s,c);if(l instanceof Promise){if(c.async===!1)throw new Si;return l.then(u=>n._zod.parse(u,c))}return n._zod.parse(l,c)};n._zod.run=(o,a)=>{if(a.skipChecks)return n._zod.parse(o,a);if(a.direction==="backward"){const l=n._zod.parse({value:o.value,issues:[]},{...a,skipChecks:!0});return l instanceof Promise?l.then(u=>r(u,o,a)):r(l,o,a)}const c=n._zod.parse(o,a);if(c instanceof Promise){if(a.async===!1)throw new Si;return c.then(l=>i(l,s,a))}return i(c,s,a)}}n["~standard"]={validate:i=>{try{const r=iU(n,i);return r.success?{value:r.data}:{issues:r.error?.issues}}catch{return rU(n,i).then(o=>o.success?{value:o.data}:{issues:o.error?.issues})}},vendor:"zod",version:1}}),om=M("$ZodString",(n,t)=>{It.init(n,t),n._zod.pattern=[...n?._zod.bag?.patterns??[]].pop()??IU(n._zod.bag),n._zod.parse=(e,s)=>{if(t.coerce)try{e.value=String(e.value)}catch{}return typeof e.value=="string"||e.issues.push({expected:"string",code:"invalid_type",input:e.value,inst:n}),e}}),xt=M("$ZodStringFormat",(n,t)=>{cl.init(n,t),om.init(n,t)}),tj=M("$ZodGUID",(n,t)=>{t.pattern??(t.pattern=vU),xt.init(n,t)}),ej=M("$ZodUUID",(n,t)=>{if(t.version){const s={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(s===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=w_(s))}else t.pattern??(t.pattern=w_());xt.init(n,t)}),nj=M("$ZodEmail",(n,t)=>{t.pattern??(t.pattern=AU),xt.init(n,t)}),sj=M("$ZodURL",(n,t)=>{xt.init(n,t),n._zod.check=e=>{try{const s=e.value.trim(),i=new URL(s);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(i.hostname)||e.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:e.value,inst:n,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(i.protocol.endsWith(":")?i.protocol.slice(0,-1):i.protocol)||e.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:e.value,inst:n,continue:!t.abort})),t.normalize?e.value=i.href:e.value=s;return}catch{e.issues.push({code:"invalid_format",format:"url",input:e.value,inst:n,continue:!t.abort})}}}),ij=M("$ZodEmoji",(n,t)=>{t.pattern??(t.pattern=TU()),xt.init(n,t)}),rj=M("$ZodNanoID",(n,t)=>{t.pattern??(t.pattern=_U),xt.init(n,t)}),oj=M("$ZodCUID",(n,t)=>{t.pattern??(t.pattern=pU),xt.init(n,t)}),aj=M("$ZodCUID2",(n,t)=>{t.pattern??(t.pattern=mU),xt.init(n,t)}),cj=M("$ZodULID",(n,t)=>{t.pattern??(t.pattern=gU),xt.init(n,t)}),lj=M("$ZodXID",(n,t)=>{t.pattern??(t.pattern=yU),xt.init(n,t)}),uj=M("$ZodKSUID",(n,t)=>{t.pattern??(t.pattern=bU),xt.init(n,t)}),hj=M("$ZodISODateTime",(n,t)=>{t.pattern??(t.pattern=DU(t)),xt.init(n,t)}),dj=M("$ZodISODate",(n,t)=>{t.pattern??(t.pattern=RU),xt.init(n,t)}),fj=M("$ZodISOTime",(n,t)=>{t.pattern??(t.pattern=OU(t)),xt.init(n,t)}),pj=M("$ZodISODuration",(n,t)=>{t.pattern??(t.pattern=wU),xt.init(n,t)}),mj=M("$ZodIPv4",(n,t)=>{t.pattern??(t.pattern=EU),xt.init(n,t),n._zod.bag.format="ipv4"}),gj=M("$ZodIPv6",(n,t)=>{t.pattern??(t.pattern=xU),xt.init(n,t),n._zod.bag.format="ipv6",n._zod.check=e=>{try{new URL(`http://[${e.value}]`)}catch{e.issues.push({code:"invalid_format",format:"ipv6",input:e.value,inst:n,continue:!t.abort})}}}),yj=M("$ZodCIDRv4",(n,t)=>{t.pattern??(t.pattern=CU),xt.init(n,t)}),bj=M("$ZodCIDRv6",(n,t)=>{t.pattern??(t.pattern=PU),xt.init(n,t),n._zod.check=e=>{const s=e.value.split("/");try{if(s.length!==2)throw new Error;const[i,r]=s;if(!r)throw new Error;const o=Number(r);if(`${o}`!==r)throw new Error;if(o<0||o>128)throw new Error;new URL(`http://[${i}]`)}catch{e.issues.push({code:"invalid_format",format:"cidrv6",input:e.value,inst:n,continue:!t.abort})}}});function cT(n){if(n==="")return!0;if(n.length%4!==0)return!1;try{return atob(n),!0}catch{return!1}}const _j=M("$ZodBase64",(n,t)=>{t.pattern??(t.pattern=kU),xt.init(n,t),n._zod.bag.contentEncoding="base64",n._zod.check=e=>{cT(e.value)||e.issues.push({code:"invalid_format",format:"base64",input:e.value,inst:n,continue:!t.abort})}});function wj(n){if(!nT.test(n))return!1;const t=n.replace(/[-_]/g,s=>s==="-"?"+":"/"),e=t.padEnd(Math.ceil(t.length/4)*4,"=");return cT(e)}const vj=M("$ZodBase64URL",(n,t)=>{t.pattern??(t.pattern=nT),xt.init(n,t),n._zod.bag.contentEncoding="base64url",n._zod.check=e=>{wj(e.value)||e.issues.push({code:"invalid_format",format:"base64url",input:e.value,inst:n,continue:!t.abort})}}),Aj=M("$ZodE164",(n,t)=>{t.pattern??(t.pattern=MU),xt.init(n,t)});function Sj(n,t=null){try{const e=n.split(".");if(e.length!==3)return!1;const[s]=e;if(!s)return!1;const i=JSON.parse(atob(s));return!("typ"in i&&i?.typ!=="JWT"||!i.alg||t&&(!("alg"in i)||i.alg!==t))}catch{return!1}}const Tj=M("$ZodJWT",(n,t)=>{xt.init(n,t),n._zod.check=e=>{Sj(e.value,t.alg)||e.issues.push({code:"invalid_format",format:"jwt",input:e.value,inst:n,continue:!t.abort})}}),lT=M("$ZodNumber",(n,t)=>{It.init(n,t),n._zod.pattern=n._zod.bag.pattern??NU,n._zod.parse=(e,s)=>{if(t.coerce)try{e.value=Number(e.value)}catch{}const i=e.value;if(typeof i=="number"&&!Number.isNaN(i)&&Number.isFinite(i))return e;const r=typeof i=="number"?Number.isNaN(i)?"NaN":Number.isFinite(i)?void 0:"Infinity":void 0;return e.issues.push({expected:"number",code:"invalid_type",input:i,inst:n,...r?{received:r}:{}}),e}}),Ej=M("$ZodNumberFormat",(n,t)=>{jU.init(n,t),lT.init(n,t)}),xj=M("$ZodBoolean",(n,t)=>{It.init(n,t),n._zod.pattern=FU,n._zod.parse=(e,s)=>{if(t.coerce)try{e.value=!!e.value}catch{}const i=e.value;return typeof i=="boolean"||e.issues.push({expected:"boolean",code:"invalid_type",input:i,inst:n}),e}}),Cj=M("$ZodUnknown",(n,t)=>{It.init(n,t),n._zod.parse=e=>e}),Pj=M("$ZodNever",(n,t)=>{It.init(n,t),n._zod.parse=(e,s)=>(e.issues.push({expected:"never",code:"invalid_type",input:e.value,inst:n}),e)});function v_(n,t,e){n.issues.length&&t.issues.push(...J1(e,n.issues)),t.value[e]=n.value}const kj=M("$ZodArray",(n,t)=>{It.init(n,t),n._zod.parse=(e,s)=>{const i=e.value;if(!Array.isArray(i))return e.issues.push({expected:"array",code:"invalid_type",input:i,inst:n}),e;e.value=Array(i.length);const r=[];for(let o=0;o<i.length;o++){const a=i[o],c=t.element._zod.run({value:a,issues:[]},s);c instanceof Promise?r.push(c.then(l=>v_(l,e,o))):v_(c,e,o)}return r.length?Promise.all(r).then(()=>e):e}});function pc(n,t,e,s){n.issues.length&&t.issues.push(...J1(e,n.issues)),n.value===void 0?e in s&&(t.value[e]=void 0):t.value[e]=n.value}function uT(n){const t=Object.keys(n.shape);for(const s of t)if(!n.shape?.[s]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${s}": expected a Zod schema`);const e=G$(n.shape);return{...n,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(e)}}function hT(n,t,e,s,i,r){const o=[],a=i.keySet,c=i.catchall._zod,l=c.def.type;for(const u in t){if(a.has(u))continue;if(l==="never"){o.push(u);continue}const h=c.run({value:t[u],issues:[]},s);h instanceof Promise?n.push(h.then(d=>pc(d,e,u,t))):pc(h,e,u,t)}return o.length&&e.issues.push({code:"unrecognized_keys",keys:o,input:t,inst:r}),n.length?Promise.all(n).then(()=>e):e}const Mj=M("$ZodObject",(n,t)=>{if(It.init(n,t),!Object.getOwnPropertyDescriptor(t,"shape")?.get){const a=t.shape;Object.defineProperty(t,"shape",{get:()=>{const c={...a};return Object.defineProperty(t,"shape",{value:c}),c}})}const s=tm(()=>uT(t));vt(n._zod,"propValues",()=>{const a=t.shape,c={};for(const l in a){const u=a[l]._zod;if(u.values){c[l]??(c[l]=new Set);for(const h of u.values)c[l].add(h)}}return c});const i=fc,r=t.catchall;let o;n._zod.parse=(a,c)=>{o??(o=s.value);const l=a.value;if(!i(l))return a.issues.push({expected:"object",code:"invalid_type",input:l,inst:n}),a;a.value={};const u=[],h=o.shape;for(const d of o.keys){const m=h[d]._zod.run({value:l[d],issues:[]},c);m instanceof Promise?u.push(m.then(p=>pc(p,a,d,l))):pc(m,a,d,l)}return r?hT(u,l,a,c,s.value,n):u.length?Promise.all(u).then(()=>a):a}}),Rj=M("$ZodObjectJIT",(n,t)=>{Mj.init(n,t);const e=n._zod.parse,s=tm(()=>uT(t)),i=d=>{const f=new JU(["shape","payload","ctx"]),m=s.value,p=b=>{const w=__(b);return`shape[${w}]._zod.run({ value: input[${w}], issues: [] }, ctx)`};f.write("const input = payload.value;");const g=Object.create(null);let y=0;for(const b of m.keys)g[b]=`key_${y++}`;f.write("const newResult = {};");for(const b of m.keys){const w=g[b],v=__(b);f.write(`const ${w} = ${p(b)};`),f.write(`
        if (${w}.issues.length) {
          payload.issues = payload.issues.concat(${w}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${v}, ...iss.path] : [${v}]
          })));
        }
        
        
        if (${w}.value === undefined) {
          if (${v} in input) {
            newResult[${v}] = undefined;
          }
        } else {
          newResult[${v}] = ${w}.value;
        }
        
      `)}f.write("payload.value = newResult;"),f.write("return payload;");const _=f.compile();return(b,w)=>_(d,b,w)};let r;const o=fc,a=!Y1.jitless,l=a&&q$.value,u=t.catchall;let h;n._zod.parse=(d,f)=>{h??(h=s.value);const m=d.value;return o(m)?a&&l&&f?.async===!1&&f.jitless!==!0?(r||(r=i(t.shape)),d=r(d,f),u?hT([],m,d,f,h,n):d):e(d,f):(d.issues.push({expected:"object",code:"invalid_type",input:m,inst:n}),d)}});function A_(n,t,e,s){for(const r of n)if(r.issues.length===0)return t.value=r.value,t;const i=n.filter(r=>!mi(r));return i.length===1?(t.value=i[0].value,i[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:e,errors:n.map(r=>r.issues.map(o=>Bs(o,s,Fs())))}),t)}const Oj=M("$ZodUnion",(n,t)=>{It.init(n,t),vt(n._zod,"optin",()=>t.options.some(i=>i._zod.optin==="optional")?"optional":void 0),vt(n._zod,"optout",()=>t.options.some(i=>i._zod.optout==="optional")?"optional":void 0),vt(n._zod,"values",()=>{if(t.options.every(i=>i._zod.values))return new Set(t.options.flatMap(i=>Array.from(i._zod.values)))}),vt(n._zod,"pattern",()=>{if(t.options.every(i=>i._zod.pattern)){const i=t.options.map(r=>r._zod.pattern);return new RegExp(`^(${i.map(r=>nm(r.source)).join("|")})$`)}});const e=t.options.length===1,s=t.options[0]._zod.run;n._zod.parse=(i,r)=>{if(e)return s(i,r);let o=!1;const a=[];for(const c of t.options){const l=c._zod.run({value:i.value,issues:[]},r);if(l instanceof Promise)a.push(l),o=!0;else{if(l.issues.length===0)return l;a.push(l)}}return o?Promise.all(a).then(c=>A_(c,i,n,r)):A_(a,i,n,r)}}),Dj=M("$ZodIntersection",(n,t)=>{It.init(n,t),n._zod.parse=(e,s)=>{const i=e.value,r=t.left._zod.run({value:i,issues:[]},s),o=t.right._zod.run({value:i,issues:[]},s);return r instanceof Promise||o instanceof Promise?Promise.all([r,o]).then(([c,l])=>S_(e,c,l)):S_(e,r,o)}});function Xd(n,t){if(n===t)return{valid:!0,data:n};if(n instanceof Date&&t instanceof Date&&+n==+t)return{valid:!0,data:n};if(Qr(n)&&Qr(t)){const e=Object.keys(t),s=Object.keys(n).filter(r=>e.indexOf(r)!==-1),i={...n,...t};for(const r of s){const o=Xd(n[r],t[r]);if(!o.valid)return{valid:!1,mergeErrorPath:[r,...o.mergeErrorPath]};i[r]=o.data}return{valid:!0,data:i}}if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return{valid:!1,mergeErrorPath:[]};const e=[];for(let s=0;s<n.length;s++){const i=n[s],r=t[s],o=Xd(i,r);if(!o.valid)return{valid:!1,mergeErrorPath:[s,...o.mergeErrorPath]};e.push(o.data)}return{valid:!0,data:e}}return{valid:!1,mergeErrorPath:[]}}function S_(n,t,e){if(t.issues.length&&n.issues.push(...t.issues),e.issues.length&&n.issues.push(...e.issues),mi(n))return n;const s=Xd(t.value,e.value);if(!s.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(s.mergeErrorPath)}`);return n.value=s.data,n}const Ij=M("$ZodEnum",(n,t)=>{It.init(n,t);const e=X1(t.entries),s=new Set(e);n._zod.values=s,n._zod.pattern=new RegExp(`^(${e.filter(i=>W$.has(typeof i)).map(i=>typeof i=="string"?rl(i):i.toString()).join("|")})$`),n._zod.parse=(i,r)=>{const o=i.value;return s.has(o)||i.issues.push({code:"invalid_value",values:e,input:o,inst:n}),i}}),Lj=M("$ZodTransform",(n,t)=>{It.init(n,t),n._zod.parse=(e,s)=>{if(s.direction==="backward")throw new G1(n.constructor.name);const i=t.transform(e.value,e);if(s.async)return(i instanceof Promise?i:Promise.resolve(i)).then(o=>(e.value=o,e));if(i instanceof Promise)throw new Si;return e.value=i,e}});function T_(n,t){return n.issues.length&&t===void 0?{issues:[],value:void 0}:n}const Nj=M("$ZodOptional",(n,t)=>{It.init(n,t),n._zod.optin="optional",n._zod.optout="optional",vt(n._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),vt(n._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${nm(e.source)})?$`):void 0}),n._zod.parse=(e,s)=>{if(t.innerType._zod.optin==="optional"){const i=t.innerType._zod.run(e,s);return i instanceof Promise?i.then(r=>T_(r,e.value)):T_(i,e.value)}return e.value===void 0?e:t.innerType._zod.run(e,s)}}),Fj=M("$ZodNullable",(n,t)=>{It.init(n,t),vt(n._zod,"optin",()=>t.innerType._zod.optin),vt(n._zod,"optout",()=>t.innerType._zod.optout),vt(n._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${nm(e.source)}|null)$`):void 0}),vt(n._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),n._zod.parse=(e,s)=>e.value===null?e:t.innerType._zod.run(e,s)}),Bj=M("$ZodDefault",(n,t)=>{It.init(n,t),n._zod.optin="optional",vt(n._zod,"values",()=>t.innerType._zod.values),n._zod.parse=(e,s)=>{if(s.direction==="backward")return t.innerType._zod.run(e,s);if(e.value===void 0)return e.value=t.defaultValue,e;const i=t.innerType._zod.run(e,s);return i instanceof Promise?i.then(r=>E_(r,t)):E_(i,t)}});function E_(n,t){return n.value===void 0&&(n.value=t.defaultValue),n}const $j=M("$ZodPrefault",(n,t)=>{It.init(n,t),n._zod.optin="optional",vt(n._zod,"values",()=>t.innerType._zod.values),n._zod.parse=(e,s)=>(s.direction==="backward"||e.value===void 0&&(e.value=t.defaultValue),t.innerType._zod.run(e,s))}),Uj=M("$ZodNonOptional",(n,t)=>{It.init(n,t),vt(n._zod,"values",()=>{const e=t.innerType._zod.values;return e?new Set([...e].filter(s=>s!==void 0)):void 0}),n._zod.parse=(e,s)=>{const i=t.innerType._zod.run(e,s);return i instanceof Promise?i.then(r=>x_(r,n)):x_(i,n)}});function x_(n,t){return!n.issues.length&&n.value===void 0&&n.issues.push({code:"invalid_type",expected:"nonoptional",input:n.value,inst:t}),n}const jj=M("$ZodCatch",(n,t)=>{It.init(n,t),vt(n._zod,"optin",()=>t.innerType._zod.optin),vt(n._zod,"optout",()=>t.innerType._zod.optout),vt(n._zod,"values",()=>t.innerType._zod.values),n._zod.parse=(e,s)=>{if(s.direction==="backward")return t.innerType._zod.run(e,s);const i=t.innerType._zod.run(e,s);return i instanceof Promise?i.then(r=>(e.value=r.value,r.issues.length&&(e.value=t.catchValue({...e,error:{issues:r.issues.map(o=>Bs(o,s,Fs()))},input:e.value}),e.issues=[]),e)):(e.value=i.value,i.issues.length&&(e.value=t.catchValue({...e,error:{issues:i.issues.map(r=>Bs(r,s,Fs()))},input:e.value}),e.issues=[]),e)}}),zj=M("$ZodPipe",(n,t)=>{It.init(n,t),vt(n._zod,"values",()=>t.in._zod.values),vt(n._zod,"optin",()=>t.in._zod.optin),vt(n._zod,"optout",()=>t.out._zod.optout),vt(n._zod,"propValues",()=>t.in._zod.propValues),n._zod.parse=(e,s)=>{if(s.direction==="backward"){const r=t.out._zod.run(e,s);return r instanceof Promise?r.then(o=>Qo(o,t.in,s)):Qo(r,t.in,s)}const i=t.in._zod.run(e,s);return i instanceof Promise?i.then(r=>Qo(r,t.out,s)):Qo(i,t.out,s)}});function Qo(n,t,e){return n.issues.length?(n.aborted=!0,n):t._zod.run({value:n.value,issues:n.issues},e)}const Vj=M("$ZodReadonly",(n,t)=>{It.init(n,t),vt(n._zod,"propValues",()=>t.innerType._zod.propValues),vt(n._zod,"values",()=>t.innerType._zod.values),vt(n._zod,"optin",()=>t.innerType?._zod?.optin),vt(n._zod,"optout",()=>t.innerType?._zod?.optout),n._zod.parse=(e,s)=>{if(s.direction==="backward")return t.innerType._zod.run(e,s);const i=t.innerType._zod.run(e,s);return i instanceof Promise?i.then(C_):C_(i)}});function C_(n){return n.value=Object.freeze(n.value),n}const Hj=M("$ZodCustom",(n,t)=>{Ce.init(n,t),It.init(n,t),n._zod.parse=(e,s)=>e,n._zod.check=e=>{const s=e.value,i=t.fn(s);if(i instanceof Promise)return i.then(r=>P_(r,e,s,n));P_(i,e,s,n)}});function P_(n,t,e,s){if(!n){const i={code:"custom",input:e,inst:s,path:[...s._zod.def.path??[]],continue:!s._zod.def.abort};s._zod.def.params&&(i.params=s._zod.def.params),t.issues.push(to(i))}}var k_;class qj{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...e){const s=e[0];if(this._map.set(t,s),s&&typeof s=="object"&&"id"in s){if(this._idmap.has(s.id))throw new Error(`ID ${s.id} already exists in the registry`);this._idmap.set(s.id,t)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const e=this._map.get(t);return e&&typeof e=="object"&&"id"in e&&this._idmap.delete(e.id),this._map.delete(t),this}get(t){const e=t._zod.parent;if(e){const s={...this.get(e)??{}};delete s.id;const i={...s,...this._map.get(t)};return Object.keys(i).length?i:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function Wj(){return new qj}(k_=globalThis).__zod_globalRegistry??(k_.__zod_globalRegistry=Wj());const lr=globalThis.__zod_globalRegistry;function Gj(n,t){return new n({type:"string",...Y(t)})}function Yj(n,t){return new n({type:"string",format:"email",check:"string_format",abort:!1,...Y(t)})}function M_(n,t){return new n({type:"string",format:"guid",check:"string_format",abort:!1,...Y(t)})}function Xj(n,t){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,...Y(t)})}function Kj(n,t){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...Y(t)})}function Zj(n,t){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...Y(t)})}function Jj(n,t){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...Y(t)})}function Qj(n,t){return new n({type:"string",format:"url",check:"string_format",abort:!1,...Y(t)})}function tz(n,t){return new n({type:"string",format:"emoji",check:"string_format",abort:!1,...Y(t)})}function ez(n,t){return new n({type:"string",format:"nanoid",check:"string_format",abort:!1,...Y(t)})}function nz(n,t){return new n({type:"string",format:"cuid",check:"string_format",abort:!1,...Y(t)})}function sz(n,t){return new n({type:"string",format:"cuid2",check:"string_format",abort:!1,...Y(t)})}function iz(n,t){return new n({type:"string",format:"ulid",check:"string_format",abort:!1,...Y(t)})}function rz(n,t){return new n({type:"string",format:"xid",check:"string_format",abort:!1,...Y(t)})}function oz(n,t){return new n({type:"string",format:"ksuid",check:"string_format",abort:!1,...Y(t)})}function az(n,t){return new n({type:"string",format:"ipv4",check:"string_format",abort:!1,...Y(t)})}function cz(n,t){return new n({type:"string",format:"ipv6",check:"string_format",abort:!1,...Y(t)})}function lz(n,t){return new n({type:"string",format:"cidrv4",check:"string_format",abort:!1,...Y(t)})}function uz(n,t){return new n({type:"string",format:"cidrv6",check:"string_format",abort:!1,...Y(t)})}function hz(n,t){return new n({type:"string",format:"base64",check:"string_format",abort:!1,...Y(t)})}function dz(n,t){return new n({type:"string",format:"base64url",check:"string_format",abort:!1,...Y(t)})}function fz(n,t){return new n({type:"string",format:"e164",check:"string_format",abort:!1,...Y(t)})}function pz(n,t){return new n({type:"string",format:"jwt",check:"string_format",abort:!1,...Y(t)})}function mz(n,t){return new n({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...Y(t)})}function gz(n,t){return new n({type:"string",format:"date",check:"string_format",...Y(t)})}function yz(n,t){return new n({type:"string",format:"time",check:"string_format",precision:null,...Y(t)})}function bz(n,t){return new n({type:"string",format:"duration",check:"string_format",...Y(t)})}function _z(n,t){return new n({type:"number",checks:[],...Y(t)})}function wz(n,t){return new n({type:"number",check:"number_format",abort:!1,format:"safeint",...Y(t)})}function vz(n,t){return new n({type:"boolean",...Y(t)})}function Az(n){return new n({type:"unknown"})}function Sz(n,t){return new n({type:"never",...Y(t)})}function R_(n,t){return new oT({check:"less_than",...Y(t),value:n,inclusive:!1})}function Ah(n,t){return new oT({check:"less_than",...Y(t),value:n,inclusive:!0})}function O_(n,t){return new aT({check:"greater_than",...Y(t),value:n,inclusive:!1})}function Sh(n,t){return new aT({check:"greater_than",...Y(t),value:n,inclusive:!0})}function D_(n,t){return new UU({check:"multiple_of",...Y(t),value:n})}function dT(n,t){return new zU({check:"max_length",...Y(t),maximum:n})}function mc(n,t){return new VU({check:"min_length",...Y(t),minimum:n})}function fT(n,t){return new HU({check:"length_equals",...Y(t),length:n})}function Tz(n,t){return new qU({check:"string_format",format:"regex",...Y(t),pattern:n})}function Ez(n){return new WU({check:"string_format",format:"lowercase",...Y(n)})}function xz(n){return new GU({check:"string_format",format:"uppercase",...Y(n)})}function Cz(n,t){return new YU({check:"string_format",format:"includes",...Y(t),includes:n})}function Pz(n,t){return new XU({check:"string_format",format:"starts_with",...Y(t),prefix:n})}function kz(n,t){return new KU({check:"string_format",format:"ends_with",...Y(t),suffix:n})}function Ui(n){return new ZU({check:"overwrite",tx:n})}function Mz(n){return Ui(t=>t.normalize(n))}function Rz(){return Ui(n=>n.trim())}function Oz(){return Ui(n=>n.toLowerCase())}function Dz(){return Ui(n=>n.toUpperCase())}function Iz(){return Ui(n=>H$(n))}function Lz(n,t,e){return new n({type:"array",element:t,...Y(e)})}function Nz(n,t,e){return new n({type:"custom",check:"custom",fn:t,...Y(e)})}function Fz(n){const t=Bz(e=>(e.addIssue=s=>{if(typeof s=="string")e.issues.push(to(s,e.value,t._zod.def));else{const i=s;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=e.value),i.inst??(i.inst=t),i.continue??(i.continue=!t._zod.def.abort),e.issues.push(to(i))}},n(e.value,e)));return t}function Bz(n,t){const e=new Ce({check:"custom",...Y(t)});return e._zod.check=n,e}function pT(n){let t=n?.target??"draft-2020-12";return t==="draft-4"&&(t="draft-04"),t==="draft-7"&&(t="draft-07"),{processors:n.processors??{},metadataRegistry:n?.metadata??lr,target:t,unrepresentable:n?.unrepresentable??"throw",override:n?.override??(()=>{}),io:n?.io??"output",counter:0,seen:new Map,cycles:n?.cycles??"ref",reused:n?.reused??"inline",external:n?.external??void 0}}function le(n,t,e={path:[],schemaPath:[]}){var s;const i=n._zod.def,r=t.seen.get(n);if(r)return r.count++,e.schemaPath.includes(n)&&(r.cycle=e.path),r.schema;const o={schema:{},count:1,cycle:void 0,path:e.path};t.seen.set(n,o);const a=n._zod.toJSONSchema?.();if(a)o.schema=a;else{const u={...e,schemaPath:[...e.schemaPath,n],path:e.path},h=n._zod.parent;if(h)o.ref=h,le(h,t,u),t.seen.get(h).isParent=!0;else if(n._zod.processJSONSchema)n._zod.processJSONSchema(t,o.schema,u);else{const d=o.schema,f=t.processors[i.type];if(!f)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${i.type}`);f(n,t,d,u)}}const c=t.metadataRegistry.get(n);return c&&Object.assign(o.schema,c),t.io==="input"&&fe(n)&&(delete o.schema.examples,delete o.schema.default),t.io==="input"&&o.schema._prefault&&((s=o.schema).default??(s.default=o.schema._prefault)),delete o.schema._prefault,t.seen.get(n).schema}function mT(n,t){const e=n.seen.get(t);if(!e)throw new Error("Unprocessed schema. This is a bug in Zod.");const s=r=>{const o=n.target==="draft-2020-12"?"$defs":"definitions";if(n.external){const u=n.external.registry.get(r[0])?.id,h=n.external.uri??(f=>f);if(u)return{ref:h(u)};const d=r[1].defId??r[1].schema.id??`schema${n.counter++}`;return r[1].defId=d,{defId:d,ref:`${h("__shared")}#/${o}/${d}`}}if(r[1]===e)return{ref:"#"};const c=`#/${o}/`,l=r[1].schema.id??`__schema${n.counter++}`;return{defId:l,ref:c+l}},i=r=>{if(r[1].schema.$ref)return;const o=r[1],{ref:a,defId:c}=s(r);o.def={...o.schema},c&&(o.defId=c);const l=o.schema;for(const u in l)delete l[u];l.$ref=a};if(n.cycles==="throw")for(const r of n.seen.entries()){const o=r[1];if(o.cycle)throw new Error(`Cycle detected: #/${o.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const r of n.seen.entries()){const o=r[1];if(t===r[0]){i(r);continue}if(n.external){const c=n.external.registry.get(r[0])?.id;if(t!==r[0]&&c){i(r);continue}}if(n.metadataRegistry.get(r[0])?.id){i(r);continue}if(o.cycle){i(r);continue}if(o.count>1&&n.reused==="ref"){i(r);continue}}}function gT(n,t){const e=n.seen.get(t);if(!e)throw new Error("Unprocessed schema. This is a bug in Zod.");const s=o=>{const a=n.seen.get(o),c=a.def??a.schema,l={...c};if(a.ref===null)return;const u=a.ref;if(a.ref=null,u){s(u);const h=n.seen.get(u).schema;h.$ref&&(n.target==="draft-07"||n.target==="draft-04"||n.target==="openapi-3.0")?(c.allOf=c.allOf??[],c.allOf.push(h)):(Object.assign(c,h),Object.assign(c,l))}a.isParent||n.override({zodSchema:o,jsonSchema:c,path:a.path??[]})};for(const o of[...n.seen.entries()].reverse())s(o[0]);const i={};if(n.target==="draft-2020-12"?i.$schema="https://json-schema.org/draft/2020-12/schema":n.target==="draft-07"?i.$schema="http://json-schema.org/draft-07/schema#":n.target==="draft-04"?i.$schema="http://json-schema.org/draft-04/schema#":n.target,n.external?.uri){const o=n.external.registry.get(t)?.id;if(!o)throw new Error("Schema is missing an `id` property");i.$id=n.external.uri(o)}Object.assign(i,e.def??e.schema);const r=n.external?.defs??{};for(const o of n.seen.entries()){const a=o[1];a.def&&a.defId&&(r[a.defId]=a.def)}n.external||Object.keys(r).length>0&&(n.target==="draft-2020-12"?i.$defs=r:i.definitions=r);try{const o=JSON.parse(JSON.stringify(i));return Object.defineProperty(o,"~standard",{value:{...t["~standard"],jsonSchema:{input:gc(t,"input"),output:gc(t,"output")}},enumerable:!1,writable:!1}),o}catch{throw new Error("Error converting schema to JSON.")}}function fe(n,t){const e=t??{seen:new Set};if(e.seen.has(n))return!1;e.seen.add(n);const s=n._zod.def;if(s.type==="transform")return!0;if(s.type==="array")return fe(s.element,e);if(s.type==="set")return fe(s.valueType,e);if(s.type==="lazy")return fe(s.getter(),e);if(s.type==="promise"||s.type==="optional"||s.type==="nonoptional"||s.type==="nullable"||s.type==="readonly"||s.type==="default"||s.type==="prefault")return fe(s.innerType,e);if(s.type==="intersection")return fe(s.left,e)||fe(s.right,e);if(s.type==="record"||s.type==="map")return fe(s.keyType,e)||fe(s.valueType,e);if(s.type==="pipe")return fe(s.in,e)||fe(s.out,e);if(s.type==="object"){for(const i in s.shape)if(fe(s.shape[i],e))return!0;return!1}if(s.type==="union"){for(const i of s.options)if(fe(i,e))return!0;return!1}if(s.type==="tuple"){for(const i of s.items)if(fe(i,e))return!0;return!!(s.rest&&fe(s.rest,e))}return!1}const $z=(n,t={})=>e=>{const s=pT({...e,processors:t});return le(n,s),mT(s,n),gT(s,n)},gc=(n,t)=>e=>{const{libraryOptions:s,target:i}=e??{},r=pT({...s??{},target:i,io:t,processors:{}});return le(n,r),mT(r,n),gT(r,n)},Uz={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},jz=(n,t,e,s)=>{const i=e;i.type="string";const{minimum:r,maximum:o,format:a,patterns:c,contentEncoding:l}=n._zod.bag;if(typeof r=="number"&&(i.minLength=r),typeof o=="number"&&(i.maxLength=o),a&&(i.format=Uz[a]??a,i.format===""&&delete i.format),l&&(i.contentEncoding=l),c&&c.size>0){const u=[...c];u.length===1?i.pattern=u[0].source:u.length>1&&(i.allOf=[...u.map(h=>({...t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0"?{type:"string"}:{},pattern:h.source}))])}},zz=(n,t,e,s)=>{const i=e,{minimum:r,maximum:o,format:a,multipleOf:c,exclusiveMaximum:l,exclusiveMinimum:u}=n._zod.bag;typeof a=="string"&&a.includes("int")?i.type="integer":i.type="number",typeof u=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(i.minimum=u,i.exclusiveMinimum=!0):i.exclusiveMinimum=u),typeof r=="number"&&(i.minimum=r,typeof u=="number"&&t.target!=="draft-04"&&(u>=r?delete i.minimum:delete i.exclusiveMinimum)),typeof l=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(i.maximum=l,i.exclusiveMaximum=!0):i.exclusiveMaximum=l),typeof o=="number"&&(i.maximum=o,typeof l=="number"&&t.target!=="draft-04"&&(l<=o?delete i.maximum:delete i.exclusiveMaximum)),typeof c=="number"&&(i.multipleOf=c)},Vz=(n,t,e,s)=>{e.type="boolean"},Hz=(n,t,e,s)=>{e.not={}},qz=(n,t,e,s)=>{},Wz=(n,t,e,s)=>{const i=n._zod.def,r=X1(i.entries);r.every(o=>typeof o=="number")&&(e.type="number"),r.every(o=>typeof o=="string")&&(e.type="string"),e.enum=r},Gz=(n,t,e,s)=>{if(t.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},Yz=(n,t,e,s)=>{if(t.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},Xz=(n,t,e,s)=>{const i=e,r=n._zod.def,{minimum:o,maximum:a}=n._zod.bag;typeof o=="number"&&(i.minItems=o),typeof a=="number"&&(i.maxItems=a),i.type="array",i.items=le(r.element,t,{...s,path:[...s.path,"items"]})},Kz=(n,t,e,s)=>{const i=e,r=n._zod.def;i.type="object",i.properties={};const o=r.shape;for(const l in o)i.properties[l]=le(o[l],t,{...s,path:[...s.path,"properties",l]});const a=new Set(Object.keys(o)),c=new Set([...a].filter(l=>{const u=r.shape[l]._zod;return t.io==="input"?u.optin===void 0:u.optout===void 0}));c.size>0&&(i.required=Array.from(c)),r.catchall?._zod.def.type==="never"?i.additionalProperties=!1:r.catchall?r.catchall&&(i.additionalProperties=le(r.catchall,t,{...s,path:[...s.path,"additionalProperties"]})):t.io==="output"&&(i.additionalProperties=!1)},Zz=(n,t,e,s)=>{const i=n._zod.def,r=i.inclusive===!1,o=i.options.map((a,c)=>le(a,t,{...s,path:[...s.path,r?"oneOf":"anyOf",c]}));r?e.oneOf=o:e.anyOf=o},Jz=(n,t,e,s)=>{const i=n._zod.def,r=le(i.left,t,{...s,path:[...s.path,"allOf",0]}),o=le(i.right,t,{...s,path:[...s.path,"allOf",1]}),a=l=>"allOf"in l&&Object.keys(l).length===1,c=[...a(r)?r.allOf:[r],...a(o)?o.allOf:[o]];e.allOf=c},Qz=(n,t,e,s)=>{const i=n._zod.def,r=le(i.innerType,t,s),o=t.seen.get(n);t.target==="openapi-3.0"?(o.ref=i.innerType,e.nullable=!0):e.anyOf=[r,{type:"null"}]},tV=(n,t,e,s)=>{const i=n._zod.def;le(i.innerType,t,s);const r=t.seen.get(n);r.ref=i.innerType},eV=(n,t,e,s)=>{const i=n._zod.def;le(i.innerType,t,s);const r=t.seen.get(n);r.ref=i.innerType,e.default=JSON.parse(JSON.stringify(i.defaultValue))},nV=(n,t,e,s)=>{const i=n._zod.def;le(i.innerType,t,s);const r=t.seen.get(n);r.ref=i.innerType,t.io==="input"&&(e._prefault=JSON.parse(JSON.stringify(i.defaultValue)))},sV=(n,t,e,s)=>{const i=n._zod.def;le(i.innerType,t,s);const r=t.seen.get(n);r.ref=i.innerType;let o;try{o=i.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}e.default=o},iV=(n,t,e,s)=>{const i=n._zod.def,r=t.io==="input"?i.in._zod.def.type==="transform"?i.out:i.in:i.out;le(r,t,s);const o=t.seen.get(n);o.ref=r},rV=(n,t,e,s)=>{const i=n._zod.def;le(i.innerType,t,s);const r=t.seen.get(n);r.ref=i.innerType,e.readOnly=!0},oV=(n,t,e,s)=>{const i=n._zod.def;le(i.innerType,t,s);const r=t.seen.get(n);r.ref=i.innerType},aV=M("ZodISODateTime",(n,t)=>{hj.init(n,t),Mt.init(n,t)});function cV(n){return mz(aV,n)}const lV=M("ZodISODate",(n,t)=>{dj.init(n,t),Mt.init(n,t)});function uV(n){return gz(lV,n)}const hV=M("ZodISOTime",(n,t)=>{fj.init(n,t),Mt.init(n,t)});function dV(n){return yz(hV,n)}const fV=M("ZodISODuration",(n,t)=>{pj.init(n,t),Mt.init(n,t)});function pV(n){return bz(fV,n)}const mV=(n,t)=>{tT.init(n,t),n.name="ZodError",Object.defineProperties(n,{format:{value:e=>sU(n,e)},flatten:{value:e=>nU(n,e)},addIssue:{value:e=>{n.issues.push(e),n.message=JSON.stringify(n.issues,Yd,2)}},addIssues:{value:e=>{n.issues.push(...e),n.message=JSON.stringify(n.issues,Yd,2)}},isEmpty:{get(){return n.issues.length===0}}})},tn=M("ZodError",mV,{Parent:Error}),gV=im(tn),yV=rm(tn),bV=ol(tn),_V=al(tn),wV=oU(tn),vV=aU(tn),AV=cU(tn),SV=lU(tn),TV=uU(tn),EV=hU(tn),xV=dU(tn),CV=fU(tn),jt=M("ZodType",(n,t)=>(It.init(n,t),Object.assign(n["~standard"],{jsonSchema:{input:gc(n,"input"),output:gc(n,"output")}}),n.toJSONSchema=$z(n,{}),n.def=t,n.type=t.type,Object.defineProperty(n,"_def",{value:t}),n.check=(...e)=>n.clone(Ws(t,{checks:[...t.checks??[],...e.map(s=>typeof s=="function"?{_zod:{check:s,def:{check:"custom"},onattach:[]}}:s)]})),n.clone=(e,s)=>as(n,e,s),n.brand=()=>n,n.register=((e,s)=>(e.add(n,s),n)),n.parse=(e,s)=>gV(n,e,s,{callee:n.parse}),n.safeParse=(e,s)=>bV(n,e,s),n.parseAsync=async(e,s)=>yV(n,e,s,{callee:n.parseAsync}),n.safeParseAsync=async(e,s)=>_V(n,e,s),n.spa=n.safeParseAsync,n.encode=(e,s)=>wV(n,e,s),n.decode=(e,s)=>vV(n,e,s),n.encodeAsync=async(e,s)=>AV(n,e,s),n.decodeAsync=async(e,s)=>SV(n,e,s),n.safeEncode=(e,s)=>TV(n,e,s),n.safeDecode=(e,s)=>EV(n,e,s),n.safeEncodeAsync=async(e,s)=>xV(n,e,s),n.safeDecodeAsync=async(e,s)=>CV(n,e,s),n.refine=(e,s)=>n.check(_3(e,s)),n.superRefine=e=>n.check(w3(e)),n.overwrite=e=>n.check(Ui(e)),n.optional=()=>F_(n),n.nullable=()=>B_(n),n.nullish=()=>F_(B_(n)),n.nonoptional=e=>d3(n,e),n.array=()=>JV(n),n.or=e=>e3([n,e]),n.and=e=>s3(n,e),n.transform=e=>$_(n,o3(e)),n.default=e=>l3(n,e),n.prefault=e=>h3(n,e),n.catch=e=>p3(n,e),n.pipe=e=>$_(n,e),n.readonly=()=>y3(n),n.describe=e=>{const s=n.clone();return lr.add(s,{description:e}),s},Object.defineProperty(n,"description",{get(){return lr.get(n)?.description},configurable:!0}),n.meta=(...e)=>{if(e.length===0)return lr.get(n);const s=n.clone();return lr.add(s,e[0]),s},n.isOptional=()=>n.safeParse(void 0).success,n.isNullable=()=>n.safeParse(null).success,n)),yT=M("_ZodString",(n,t)=>{om.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(s,i,r)=>jz(n,s,i);const e=n._zod.bag;n.format=e.format??null,n.minLength=e.minimum??null,n.maxLength=e.maximum??null,n.regex=(...s)=>n.check(Tz(...s)),n.includes=(...s)=>n.check(Cz(...s)),n.startsWith=(...s)=>n.check(Pz(...s)),n.endsWith=(...s)=>n.check(kz(...s)),n.min=(...s)=>n.check(mc(...s)),n.max=(...s)=>n.check(dT(...s)),n.length=(...s)=>n.check(fT(...s)),n.nonempty=(...s)=>n.check(mc(1,...s)),n.lowercase=s=>n.check(Ez(s)),n.uppercase=s=>n.check(xz(s)),n.trim=()=>n.check(Rz()),n.normalize=(...s)=>n.check(Mz(...s)),n.toLowerCase=()=>n.check(Oz()),n.toUpperCase=()=>n.check(Dz()),n.slugify=()=>n.check(Iz())}),PV=M("ZodString",(n,t)=>{om.init(n,t),yT.init(n,t),n.email=e=>n.check(Yj(kV,e)),n.url=e=>n.check(Qj(MV,e)),n.jwt=e=>n.check(pz(qV,e)),n.emoji=e=>n.check(tz(RV,e)),n.guid=e=>n.check(M_(I_,e)),n.uuid=e=>n.check(Xj(ta,e)),n.uuidv4=e=>n.check(Kj(ta,e)),n.uuidv6=e=>n.check(Zj(ta,e)),n.uuidv7=e=>n.check(Jj(ta,e)),n.nanoid=e=>n.check(ez(OV,e)),n.guid=e=>n.check(M_(I_,e)),n.cuid=e=>n.check(nz(DV,e)),n.cuid2=e=>n.check(sz(IV,e)),n.ulid=e=>n.check(iz(LV,e)),n.base64=e=>n.check(hz(zV,e)),n.base64url=e=>n.check(dz(VV,e)),n.xid=e=>n.check(rz(NV,e)),n.ksuid=e=>n.check(oz(FV,e)),n.ipv4=e=>n.check(az(BV,e)),n.ipv6=e=>n.check(cz($V,e)),n.cidrv4=e=>n.check(lz(UV,e)),n.cidrv6=e=>n.check(uz(jV,e)),n.e164=e=>n.check(fz(HV,e)),n.datetime=e=>n.check(cV(e)),n.date=e=>n.check(uV(e)),n.time=e=>n.check(dV(e)),n.duration=e=>n.check(pV(e))});function Dq(n){return Gj(PV,n)}const Mt=M("ZodStringFormat",(n,t)=>{xt.init(n,t),yT.init(n,t)}),kV=M("ZodEmail",(n,t)=>{nj.init(n,t),Mt.init(n,t)}),I_=M("ZodGUID",(n,t)=>{tj.init(n,t),Mt.init(n,t)}),ta=M("ZodUUID",(n,t)=>{ej.init(n,t),Mt.init(n,t)}),MV=M("ZodURL",(n,t)=>{sj.init(n,t),Mt.init(n,t)}),RV=M("ZodEmoji",(n,t)=>{ij.init(n,t),Mt.init(n,t)}),OV=M("ZodNanoID",(n,t)=>{rj.init(n,t),Mt.init(n,t)}),DV=M("ZodCUID",(n,t)=>{oj.init(n,t),Mt.init(n,t)}),IV=M("ZodCUID2",(n,t)=>{aj.init(n,t),Mt.init(n,t)}),LV=M("ZodULID",(n,t)=>{cj.init(n,t),Mt.init(n,t)}),NV=M("ZodXID",(n,t)=>{lj.init(n,t),Mt.init(n,t)}),FV=M("ZodKSUID",(n,t)=>{uj.init(n,t),Mt.init(n,t)}),BV=M("ZodIPv4",(n,t)=>{mj.init(n,t),Mt.init(n,t)}),$V=M("ZodIPv6",(n,t)=>{gj.init(n,t),Mt.init(n,t)}),UV=M("ZodCIDRv4",(n,t)=>{yj.init(n,t),Mt.init(n,t)}),jV=M("ZodCIDRv6",(n,t)=>{bj.init(n,t),Mt.init(n,t)}),zV=M("ZodBase64",(n,t)=>{_j.init(n,t),Mt.init(n,t)}),VV=M("ZodBase64URL",(n,t)=>{vj.init(n,t),Mt.init(n,t)}),HV=M("ZodE164",(n,t)=>{Aj.init(n,t),Mt.init(n,t)}),qV=M("ZodJWT",(n,t)=>{Tj.init(n,t),Mt.init(n,t)}),bT=M("ZodNumber",(n,t)=>{lT.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(s,i,r)=>zz(n,s,i),n.gt=(s,i)=>n.check(O_(s,i)),n.gte=(s,i)=>n.check(Sh(s,i)),n.min=(s,i)=>n.check(Sh(s,i)),n.lt=(s,i)=>n.check(R_(s,i)),n.lte=(s,i)=>n.check(Ah(s,i)),n.max=(s,i)=>n.check(Ah(s,i)),n.int=s=>n.check(L_(s)),n.safe=s=>n.check(L_(s)),n.positive=s=>n.check(O_(0,s)),n.nonnegative=s=>n.check(Sh(0,s)),n.negative=s=>n.check(R_(0,s)),n.nonpositive=s=>n.check(Ah(0,s)),n.multipleOf=(s,i)=>n.check(D_(s,i)),n.step=(s,i)=>n.check(D_(s,i)),n.finite=()=>n;const e=n._zod.bag;n.minValue=Math.max(e.minimum??Number.NEGATIVE_INFINITY,e.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,n.maxValue=Math.min(e.maximum??Number.POSITIVE_INFINITY,e.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,n.isInt=(e.format??"").includes("int")||Number.isSafeInteger(e.multipleOf??.5),n.isFinite=!0,n.format=e.format??null});function Iq(n){return _z(bT,n)}const WV=M("ZodNumberFormat",(n,t)=>{Ej.init(n,t),bT.init(n,t)});function L_(n){return wz(WV,n)}const GV=M("ZodBoolean",(n,t)=>{xj.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(e,s,i)=>Vz(n,e,s)});function Lq(n){return vz(GV,n)}const YV=M("ZodUnknown",(n,t)=>{Cj.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(e,s,i)=>qz()});function N_(){return Az(YV)}const XV=M("ZodNever",(n,t)=>{Pj.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(e,s,i)=>Hz(n,e,s)});function KV(n){return Sz(XV,n)}const ZV=M("ZodArray",(n,t)=>{kj.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(e,s,i)=>Xz(n,e,s,i),n.element=t.element,n.min=(e,s)=>n.check(mc(e,s)),n.nonempty=e=>n.check(mc(1,e)),n.max=(e,s)=>n.check(dT(e,s)),n.length=(e,s)=>n.check(fT(e,s)),n.unwrap=()=>n.element});function JV(n,t){return Lz(ZV,n,t)}const QV=M("ZodObject",(n,t)=>{Rj.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(e,s,i)=>Kz(n,e,s,i),vt(n,"shape",()=>t.shape),n.keyof=()=>i3(Object.keys(n._zod.def.shape)),n.catchall=e=>n.clone({...n._zod.def,catchall:e}),n.passthrough=()=>n.clone({...n._zod.def,catchall:N_()}),n.loose=()=>n.clone({...n._zod.def,catchall:N_()}),n.strict=()=>n.clone({...n._zod.def,catchall:KV()}),n.strip=()=>n.clone({...n._zod.def,catchall:void 0}),n.extend=e=>Z$(n,e),n.safeExtend=e=>J$(n,e),n.merge=e=>Q$(n,e),n.pick=e=>X$(n,e),n.omit=e=>K$(n,e),n.partial=(...e)=>tU(_T,n,e[0]),n.required=(...e)=>eU(wT,n,e[0])});function Nq(n,t){const e={type:"object",shape:n??{},...Y(t)};return new QV(e)}const t3=M("ZodUnion",(n,t)=>{Oj.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(e,s,i)=>Zz(n,e,s,i),n.options=t.options});function e3(n,t){return new t3({type:"union",options:n,...Y(t)})}const n3=M("ZodIntersection",(n,t)=>{Dj.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(e,s,i)=>Jz(n,e,s,i)});function s3(n,t){return new n3({type:"intersection",left:n,right:t})}const yc=M("ZodEnum",(n,t)=>{Ij.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(s,i,r)=>Wz(n,s,i),n.enum=t.entries,n.options=Object.values(t.entries);const e=new Set(Object.keys(t.entries));n.extract=(s,i)=>{const r={};for(const o of s)if(e.has(o))r[o]=t.entries[o];else throw new Error(`Key ${o} not found in enum`);return new yc({...t,checks:[],...Y(i),entries:r})},n.exclude=(s,i)=>{const r={...t.entries};for(const o of s)if(e.has(o))delete r[o];else throw new Error(`Key ${o} not found in enum`);return new yc({...t,checks:[],...Y(i),entries:r})}});function i3(n,t){const e=Array.isArray(n)?Object.fromEntries(n.map(s=>[s,s])):n;return new yc({type:"enum",entries:e,...Y(t)})}function Fq(n,t){return new yc({type:"enum",entries:n,...Y(t)})}const r3=M("ZodTransform",(n,t)=>{Lj.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(e,s,i)=>Yz(n,e),n._zod.parse=(e,s)=>{if(s.direction==="backward")throw new G1(n.constructor.name);e.addIssue=r=>{if(typeof r=="string")e.issues.push(to(r,e.value,t));else{const o=r;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=e.value),o.inst??(o.inst=n),e.issues.push(to(o))}};const i=t.transform(e.value,e);return i instanceof Promise?i.then(r=>(e.value=r,e)):(e.value=i,e)}});function o3(n){return new r3({type:"transform",transform:n})}const _T=M("ZodOptional",(n,t)=>{Nj.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(e,s,i)=>oV(n,e,s,i),n.unwrap=()=>n._zod.def.innerType});function F_(n){return new _T({type:"optional",innerType:n})}const a3=M("ZodNullable",(n,t)=>{Fj.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(e,s,i)=>Qz(n,e,s,i),n.unwrap=()=>n._zod.def.innerType});function B_(n){return new a3({type:"nullable",innerType:n})}const c3=M("ZodDefault",(n,t)=>{Bj.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(e,s,i)=>eV(n,e,s,i),n.unwrap=()=>n._zod.def.innerType,n.removeDefault=n.unwrap});function l3(n,t){return new c3({type:"default",innerType:n,get defaultValue(){return typeof t=="function"?t():Z1(t)}})}const u3=M("ZodPrefault",(n,t)=>{$j.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(e,s,i)=>nV(n,e,s,i),n.unwrap=()=>n._zod.def.innerType});function h3(n,t){return new u3({type:"prefault",innerType:n,get defaultValue(){return typeof t=="function"?t():Z1(t)}})}const wT=M("ZodNonOptional",(n,t)=>{Uj.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(e,s,i)=>tV(n,e,s,i),n.unwrap=()=>n._zod.def.innerType});function d3(n,t){return new wT({type:"nonoptional",innerType:n,...Y(t)})}const f3=M("ZodCatch",(n,t)=>{jj.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(e,s,i)=>sV(n,e,s,i),n.unwrap=()=>n._zod.def.innerType,n.removeCatch=n.unwrap});function p3(n,t){return new f3({type:"catch",innerType:n,catchValue:typeof t=="function"?t:()=>t})}const m3=M("ZodPipe",(n,t)=>{zj.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(e,s,i)=>iV(n,e,s,i),n.in=t.in,n.out=t.out});function $_(n,t){return new m3({type:"pipe",in:n,out:t})}const g3=M("ZodReadonly",(n,t)=>{Vj.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(e,s,i)=>rV(n,e,s,i),n.unwrap=()=>n._zod.def.innerType});function y3(n){return new g3({type:"readonly",innerType:n})}const b3=M("ZodCustom",(n,t)=>{Hj.init(n,t),jt.init(n,t),n._zod.processJSONSchema=(e,s,i)=>Gz(n,e)});function _3(n,t={}){return Nz(b3,n,t)}function w3(n){return Fz(n)}var ea={exports:{}},U_;function v3(){if(U_)return ea.exports;U_=1;var n=typeof Reflect=="object"?Reflect:null,t=n&&typeof n.apply=="function"?n.apply:function(v,A,S){return Function.prototype.apply.call(v,A,S)},e;n&&typeof n.ownKeys=="function"?e=n.ownKeys:Object.getOwnPropertySymbols?e=function(v){return Object.getOwnPropertyNames(v).concat(Object.getOwnPropertySymbols(v))}:e=function(v){return Object.getOwnPropertyNames(v)};function s(w){console&&console.warn&&console.warn(w)}var i=Number.isNaN||function(v){return v!==v};function r(){r.init.call(this)}ea.exports=r,ea.exports.once=y,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var o=10;function a(w){if(typeof w!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof w)}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(w){if(typeof w!="number"||w<0||i(w))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+w+".");o=w}}),r.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(v){if(typeof v!="number"||v<0||i(v))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+v+".");return this._maxListeners=v,this};function c(w){return w._maxListeners===void 0?r.defaultMaxListeners:w._maxListeners}r.prototype.getMaxListeners=function(){return c(this)},r.prototype.emit=function(v){for(var A=[],S=1;S<arguments.length;S++)A.push(arguments[S]);var T=v==="error",E=this._events;if(E!==void 0)T=T&&E.error===void 0;else if(!T)return!1;if(T){var P;if(A.length>0&&(P=A[0]),P instanceof Error)throw P;var x=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw x.context=P,x}var I=E[v];if(I===void 0)return!1;if(typeof I=="function")t(I,this,A);else for(var V=I.length,X=m(I,V),S=0;S<V;++S)t(X[S],this,A);return!0};function l(w,v,A,S){var T,E,P;if(a(A),E=w._events,E===void 0?(E=w._events=Object.create(null),w._eventsCount=0):(E.newListener!==void 0&&(w.emit("newListener",v,A.listener?A.listener:A),E=w._events),P=E[v]),P===void 0)P=E[v]=A,++w._eventsCount;else if(typeof P=="function"?P=E[v]=S?[A,P]:[P,A]:S?P.unshift(A):P.push(A),T=c(w),T>0&&P.length>T&&!P.warned){P.warned=!0;var x=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(v)+" listeners added. Use emitter.setMaxListeners() to increase limit");x.name="MaxListenersExceededWarning",x.emitter=w,x.type=v,x.count=P.length,s(x)}return w}r.prototype.addListener=function(v,A){return l(this,v,A,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(v,A){return l(this,v,A,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(w,v,A){var S={fired:!1,wrapFn:void 0,target:w,type:v,listener:A},T=u.bind(S);return T.listener=A,S.wrapFn=T,T}r.prototype.once=function(v,A){return a(A),this.on(v,h(this,v,A)),this},r.prototype.prependOnceListener=function(v,A){return a(A),this.prependListener(v,h(this,v,A)),this},r.prototype.removeListener=function(v,A){var S,T,E,P,x;if(a(A),T=this._events,T===void 0)return this;if(S=T[v],S===void 0)return this;if(S===A||S.listener===A)--this._eventsCount===0?this._events=Object.create(null):(delete T[v],T.removeListener&&this.emit("removeListener",v,S.listener||A));else if(typeof S!="function"){for(E=-1,P=S.length-1;P>=0;P--)if(S[P]===A||S[P].listener===A){x=S[P].listener,E=P;break}if(E<0)return this;E===0?S.shift():p(S,E),S.length===1&&(T[v]=S[0]),T.removeListener!==void 0&&this.emit("removeListener",v,x||A)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(v){var A,S,T;if(S=this._events,S===void 0)return this;if(S.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):S[v]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete S[v]),this;if(arguments.length===0){var E=Object.keys(S),P;for(T=0;T<E.length;++T)P=E[T],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(A=S[v],typeof A=="function")this.removeListener(v,A);else if(A!==void 0)for(T=A.length-1;T>=0;T--)this.removeListener(v,A[T]);return this};function d(w,v,A){var S=w._events;if(S===void 0)return[];var T=S[v];return T===void 0?[]:typeof T=="function"?A?[T.listener||T]:[T]:A?g(T):m(T,T.length)}r.prototype.listeners=function(v){return d(this,v,!0)},r.prototype.rawListeners=function(v){return d(this,v,!1)},r.listenerCount=function(w,v){return typeof w.listenerCount=="function"?w.listenerCount(v):f.call(w,v)},r.prototype.listenerCount=f;function f(w){var v=this._events;if(v!==void 0){var A=v[w];if(typeof A=="function")return 1;if(A!==void 0)return A.length}return 0}r.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};function m(w,v){for(var A=new Array(v),S=0;S<v;++S)A[S]=w[S];return A}function p(w,v){for(;v+1<w.length;v++)w[v]=w[v+1];w.pop()}function g(w){for(var v=new Array(w.length),A=0;A<v.length;++A)v[A]=w[A].listener||w[A];return v}function y(w,v){return new Promise(function(A,S){function T(P){w.removeListener(v,E),S(P)}function E(){typeof w.removeListener=="function"&&w.removeListener("error",T),A([].slice.call(arguments))}b(w,v,E,{once:!0}),v!=="error"&&_(w,T,{once:!0})})}function _(w,v,A){typeof w.on=="function"&&b(w,"error",v,A)}function b(w,v,A,S){if(typeof w.on=="function")S.once?w.once(v,A):w.on(v,A);else if(typeof w.addEventListener=="function")w.addEventListener(v,function T(E){S.once&&w.removeEventListener(v,T),A(E)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof w)}return ea.exports}v3();function Z(n,t,e,s,i){if(typeof t=="function"?n!==t||!0:!t.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(n,e),e}function C(n,t,e,s){if(e==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?n!==t||!s:!t.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?s:e==="a"?s.call(n):s?s.value:t.get(n)}let vT=function(){const{crypto:n}=globalThis;if(n?.randomUUID)return vT=n.randomUUID.bind(n),n.randomUUID();const t=new Uint8Array(1),e=n?()=>n.getRandomValues(t)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,s=>(+s^e()&15>>+s/4).toString(16))};function Kd(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}const Zd=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){const t=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(t.stack=n.stack),n.cause&&!t.cause&&(t.cause=n.cause),n.name&&(t.name=n.name),t}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};class G extends Error{}class ue extends G{constructor(t,e,s,i){super(`${ue.makeMessage(t,e,s)}`),this.status=t,this.headers=i,this.requestID=i?.get("x-request-id"),this.error=e;const r=e;this.code=r?.code,this.param=r?.param,this.type=r?.type}static makeMessage(t,e,s){const i=e?.message?typeof e.message=="string"?e.message:JSON.stringify(e.message):e?JSON.stringify(e):s;return t&&i?`${t} ${i}`:t?`${t} status code (no body)`:i||"(no status code or body)"}static generate(t,e,s,i){if(!t||!i)return new ll({message:s,cause:Zd(e)});const r=e?.error;return t===400?new AT(t,r,s,i):t===401?new ST(t,r,s,i):t===403?new TT(t,r,s,i):t===404?new ET(t,r,s,i):t===409?new xT(t,r,s,i):t===422?new CT(t,r,s,i):t===429?new PT(t,r,s,i):t>=500?new kT(t,r,s,i):new ue(t,r,s,i)}}class Ye extends ue{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class ll extends ue{constructor({message:t,cause:e}){super(void 0,void 0,t||"Connection error.",void 0),e&&(this.cause=e)}}class am extends ll{constructor({message:t}={}){super({message:t??"Request timed out."})}}class AT extends ue{}class ST extends ue{}class TT extends ue{}class ET extends ue{}class xT extends ue{}class CT extends ue{}class PT extends ue{}class kT extends ue{}class MT extends G{constructor(){super("Could not parse response content as the length limit was reached")}}class RT extends G{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class ur extends Error{constructor(t){super(t)}}const A3=/^[a-z][a-z0-9+.-]*:/i,S3=n=>A3.test(n);let Te=n=>(Te=Array.isArray,Te(n)),j_=Te;function OT(n){return typeof n!="object"?{}:n??{}}function T3(n){if(!n)return!0;for(const t in n)return!1;return!0}function E3(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function Th(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}const x3=(n,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new G(`${n} must be an integer`);if(t<0)throw new G(`${n} must be a positive integer`);return t},C3=n=>{try{return JSON.parse(n)}catch{return}},To=n=>new Promise(t=>setTimeout(t,n)),ii="6.15.0",P3=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function k3(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const M3=()=>{const n=k3();if(n==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ii,"X-Stainless-OS":V_(Deno.build.os),"X-Stainless-Arch":z_(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ii,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(n==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ii,"X-Stainless-OS":V_(globalThis.process.platform??"unknown"),"X-Stainless-Arch":z_(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const t=R3();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ii,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ii,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function R3(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:e}of n){const s=e.exec(navigator.userAgent);if(s){const i=s[1]||0,r=s[2]||0,o=s[3]||0;return{browser:t,version:`${i}.${r}.${o}`}}}return null}const z_=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",V_=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let H_;const O3=()=>H_??(H_=M3());function D3(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function DT(...n){const t=globalThis.ReadableStream;if(typeof t>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...n)}function IT(n){let t=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return DT({start(){},async pull(e){const{done:s,value:i}=await t.next();s?e.close():e.enqueue(i)},async cancel(){await t.return?.()}})}function LT(n){if(n[Symbol.asyncIterator])return n;const t=n.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function I3(n){if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await n[Symbol.asyncIterator]().return?.();return}const t=n.getReader(),e=t.cancel();t.releaseLock(),await e}const L3=({headers:n,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),NT="RFC3986",FT=n=>String(n),q_={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:FT},N3="RFC1738";let Jd=(n,t)=>(Jd=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),Jd(n,t));const fn=(()=>{const n=[];for(let t=0;t<256;++t)n.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return n})(),Eh=1024,F3=(n,t,e,s,i)=>{if(n.length===0)return n;let r=n;if(typeof n=="symbol"?r=Symbol.prototype.toString.call(n):typeof n!="string"&&(r=String(n)),e==="iso-8859-1")return escape(r).replace(/%u[0-9a-f]{4}/gi,function(a){return"%26%23"+parseInt(a.slice(2),16)+"%3B"});let o="";for(let a=0;a<r.length;a+=Eh){const c=r.length>=Eh?r.slice(a,a+Eh):r,l=[];for(let u=0;u<c.length;++u){let h=c.charCodeAt(u);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||i===N3&&(h===40||h===41)){l[l.length]=c.charAt(u);continue}if(h<128){l[l.length]=fn[h];continue}if(h<2048){l[l.length]=fn[192|h>>6]+fn[128|h&63];continue}if(h<55296||h>=57344){l[l.length]=fn[224|h>>12]+fn[128|h>>6&63]+fn[128|h&63];continue}u+=1,h=65536+((h&1023)<<10|c.charCodeAt(u)&1023),l[l.length]=fn[240|h>>18]+fn[128|h>>12&63]+fn[128|h>>6&63]+fn[128|h&63]}o+=l.join("")}return o};function B3(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function W_(n,t){if(Te(n)){const e=[];for(let s=0;s<n.length;s+=1)e.push(t(n[s]));return e}return t(n)}const BT={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,t){return String(n)+"["+t+"]"},repeat(n){return String(n)}},$T=function(n,t){Array.prototype.push.apply(n,Te(t)?t:[t])};let G_;const Vt={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:F3,encodeValuesOnly:!1,format:NT,formatter:FT,indices:!1,serializeDate(n){return(G_??(G_=Function.prototype.call.bind(Date.prototype.toISOString)))(n)},skipNulls:!1,strictNullHandling:!1};function $3(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const xh={};function UT(n,t,e,s,i,r,o,a,c,l,u,h,d,f,m,p,g,y){let _=n,b=y,w=0,v=!1;for(;(b=b.get(xh))!==void 0&&!v;){const P=b.get(n);if(w+=1,typeof P<"u"){if(P===w)throw new RangeError("Cyclic object value");v=!0}typeof b.get(xh)>"u"&&(w=0)}if(typeof l=="function"?_=l(t,_):_ instanceof Date?_=d?.(_):e==="comma"&&Te(_)&&(_=W_(_,function(P){return P instanceof Date?d?.(P):P})),_===null){if(r)return c&&!p?c(t,Vt.encoder,g,"key",f):t;_=""}if($3(_)||B3(_)){if(c){const P=p?t:c(t,Vt.encoder,g,"key",f);return[m?.(P)+"="+m?.(c(_,Vt.encoder,g,"value",f))]}return[m?.(t)+"="+m?.(String(_))]}const A=[];if(typeof _>"u")return A;let S;if(e==="comma"&&Te(_))p&&c&&(_=W_(_,c)),S=[{value:_.length>0?_.join(",")||null:void 0}];else if(Te(l))S=l;else{const P=Object.keys(_);S=u?P.sort(u):P}const T=a?String(t).replace(/\./g,"%2E"):String(t),E=s&&Te(_)&&_.length===1?T+"[]":T;if(i&&Te(_)&&_.length===0)return E+"[]";for(let P=0;P<S.length;++P){const x=S[P],I=typeof x=="object"&&typeof x.value<"u"?x.value:_[x];if(o&&I===null)continue;const V=h&&a?x.replace(/\./g,"%2E"):x,X=Te(_)?typeof e=="function"?e(E,V):E:E+(h?"."+V:"["+V+"]");y.set(n,w);const st=new WeakMap;st.set(xh,y),$T(A,UT(I,X,e,s,i,r,o,a,e==="comma"&&p&&Te(_)?null:c,l,u,h,d,f,m,p,g,st))}return A}function U3(n=Vt){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const t=n.charset||Vt.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let e=NT;if(typeof n.format<"u"){if(!Jd(q_,n.format))throw new TypeError("Unknown format option provided.");e=n.format}const s=q_[e];let i=Vt.filter;(typeof n.filter=="function"||Te(n.filter))&&(i=n.filter);let r;if(n.arrayFormat&&n.arrayFormat in BT?r=n.arrayFormat:"indices"in n?r=n.indices?"indices":"repeat":r=Vt.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const o=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:Vt.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:Vt.addQueryPrefix,allowDots:o,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:Vt.allowEmptyArrays,arrayFormat:r,charset:t,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:Vt.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?Vt.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:Vt.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:Vt.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:Vt.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:Vt.encodeValuesOnly,filter:i,format:e,formatter:s,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:Vt.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:Vt.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:Vt.strictNullHandling}}function j3(n,t={}){let e=n;const s=U3(t);let i,r;typeof s.filter=="function"?(r=s.filter,e=r("",e)):Te(s.filter)&&(r=s.filter,i=r);const o=[];if(typeof e!="object"||e===null)return"";const a=BT[s.arrayFormat],c=a==="comma"&&s.commaRoundTrip;i||(i=Object.keys(e)),s.sort&&i.sort(s.sort);const l=new WeakMap;for(let d=0;d<i.length;++d){const f=i[d];s.skipNulls&&e[f]===null||$T(o,UT(e[f],f,a,c,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,l))}const u=o.join(s.delimiter);let h=s.addQueryPrefix===!0?"?":"";return s.charsetSentinel&&(s.charset==="iso-8859-1"?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),u.length>0?h+u:""}function z3(n){let t=0;for(const i of n)t+=i.length;const e=new Uint8Array(t);let s=0;for(const i of n)e.set(i,s),s+=i.length;return e}let Y_;function cm(n){let t;return(Y_??(t=new globalThis.TextEncoder,Y_=t.encode.bind(t)))(n)}let X_;function K_(n){let t;return(X_??(t=new globalThis.TextDecoder,X_=t.decode.bind(t)))(n)}var Me,Re;class ul{constructor(){Me.set(this,void 0),Re.set(this,void 0),Z(this,Me,new Uint8Array),Z(this,Re,null)}decode(t){if(t==null)return[];const e=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?cm(t):t;Z(this,Me,z3([C(this,Me,"f"),e]));const s=[];let i;for(;(i=V3(C(this,Me,"f"),C(this,Re,"f")))!=null;){if(i.carriage&&C(this,Re,"f")==null){Z(this,Re,i.index);continue}if(C(this,Re,"f")!=null&&(i.index!==C(this,Re,"f")+1||i.carriage)){s.push(K_(C(this,Me,"f").subarray(0,C(this,Re,"f")-1))),Z(this,Me,C(this,Me,"f").subarray(C(this,Re,"f"))),Z(this,Re,null);continue}const r=C(this,Re,"f")!==null?i.preceding-1:i.preceding,o=K_(C(this,Me,"f").subarray(0,r));s.push(o),Z(this,Me,C(this,Me,"f").subarray(i.index)),Z(this,Re,null)}return s}flush(){return C(this,Me,"f").length?this.decode(`
`):[]}}Me=new WeakMap,Re=new WeakMap;ul.NEWLINE_CHARS=new Set([`
`,"\r"]);ul.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function V3(n,t){for(let i=t??0;i<n.length;i++){if(n[i]===10)return{preceding:i,index:i+1,carriage:!1};if(n[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function H3(n){for(let s=0;s<n.length-1;s++){if(n[s]===10&&n[s+1]===10||n[s]===13&&n[s+1]===13)return s+2;if(n[s]===13&&n[s+1]===10&&s+3<n.length&&n[s+2]===13&&n[s+3]===10)return s+4}return-1}const bc={off:0,error:200,warn:300,info:400,debug:500},Z_=(n,t,e)=>{if(n){if(E3(bc,n))return n;re(e).warn(`${t} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(bc))}`)}};function hr(){}function na(n,t,e){return!t||bc[n]>bc[e]?hr:t[n].bind(t)}const q3={error:hr,warn:hr,info:hr,debug:hr};let J_=new WeakMap;function re(n){const t=n.logger,e=n.logLevel??"off";if(!t)return q3;const s=J_.get(t);if(s&&s[0]===e)return s[1];const i={error:na("error",t,e),warn:na("warn",t,e),info:na("info",t,e),debug:na("debug",t,e)};return J_.set(t,[e,i]),i}const gs=n=>(n.options&&(n.options={...n.options},delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([t,e])=>[t,t.toLowerCase()==="authorization"||t.toLowerCase()==="cookie"||t.toLowerCase()==="set-cookie"?"***":e]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n);var sr;class bn{constructor(t,e,s){this.iterator=t,sr.set(this,void 0),this.controller=e,Z(this,sr,s)}static fromSSEResponse(t,e,s){let i=!1;const r=s?re(s):console;async function*o(){if(i)throw new G("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let a=!1;try{for await(const c of W3(t,e))if(!a){if(c.data.startsWith("[DONE]")){a=!0;continue}if(c.event===null||!c.event.startsWith("thread.")){let l;try{l=JSON.parse(c.data)}catch(u){throw r.error("Could not parse message into JSON:",c.data),r.error("From chunk:",c.raw),u}if(l&&l.error)throw new ue(void 0,l.error,void 0,t.headers);yield l}else{let l;try{l=JSON.parse(c.data)}catch(u){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),u}if(c.event=="error")throw new ue(void 0,l.error,l.message,void 0);yield{event:c.event,data:l}}}a=!0}catch(c){if(Kd(c))return;throw c}finally{a||e.abort()}}return new bn(o,e,s)}static fromReadableStream(t,e,s){let i=!1;async function*r(){const a=new ul,c=LT(t);for await(const l of c)for(const u of a.decode(l))yield u;for(const l of a.flush())yield l}async function*o(){if(i)throw new G("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let a=!1;try{for await(const c of r())a||c&&(yield JSON.parse(c));a=!0}catch(c){if(Kd(c))return;throw c}finally{a||e.abort()}}return new bn(o,e,s)}[(sr=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const t=[],e=[],s=this.iterator(),i=r=>({next:()=>{if(r.length===0){const o=s.next();t.push(o),e.push(o)}return r.shift()}});return[new bn(()=>i(t),this.controller,C(this,sr,"f")),new bn(()=>i(e),this.controller,C(this,sr,"f"))]}toReadableStream(){const t=this;let e;return DT({async start(){e=t[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:r}=await e.next();if(r)return s.close();const o=cm(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){await e.return?.()}})}}async function*W3(n,t){if(!n.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new G("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new G("Attempted to iterate over a response with no body");const e=new Y3,s=new ul,i=LT(n.body);for await(const r of G3(i))for(const o of s.decode(r)){const a=e.decode(o);a&&(yield a)}for(const r of s.flush()){const o=e.decode(r);o&&(yield o)}}async function*G3(n){let t=new Uint8Array;for await(const e of n){if(e==null)continue;const s=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?cm(e):e;let i=new Uint8Array(t.length+s.length);i.set(t),i.set(s,t.length),t=i;let r;for(;(r=H3(t))!==-1;)yield t.slice(0,r),t=t.slice(r)}t.length>0&&(yield t)}class Y3{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(t),t.startsWith(":"))return null;let[e,s,i]=X3(t,":");return i.startsWith(" ")&&(i=i.substring(1)),e==="event"?this.event=i:e==="data"&&this.data.push(i),null}}function X3(n,t){const e=n.indexOf(t);return e!==-1?[n.substring(0,e),t,n.substring(e+t.length)]:[n,"",""]}async function jT(n,t){const{response:e,requestLogID:s,retryOfRequestLogID:i,startTime:r}=t,o=await(async()=>{if(t.options.stream)return re(n).debug("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller,n):bn.fromSSEResponse(e,t.controller,n);if(e.status===204)return null;if(t.options.__binaryResponse)return e;const c=e.headers.get("content-type")?.split(";")[0]?.trim();if(c?.includes("application/json")||c?.endsWith("+json")){const h=await e.json();return zT(h,e)}return await e.text()})();return re(n).debug(`[${s}] response parsed`,gs({retryOfRequestLogID:i,url:e.url,status:e.status,body:o,durationMs:Date.now()-r})),o}function zT(n,t){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}var dr;class hl extends Promise{constructor(t,e,s=jT){super(i=>{i(null)}),this.responsePromise=e,this.parseResponse=s,dr.set(this,void 0),Z(this,dr,t)}_thenUnwrap(t){return new hl(C(this,dr,"f"),this.responsePromise,async(e,s)=>zT(t(await this.parseResponse(e,s),s),s.response))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,e]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:e,request_id:e.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(C(this,dr,"f"),t))),this.parsedPromise}then(t,e){return this.parse().then(t,e)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}dr=new WeakMap;var sa;class lm{constructor(t,e,s,i){sa.set(this,void 0),Z(this,sa,t),this.options=i,this.response=e,this.body=s}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const t=this.nextPageRequestOptions();if(!t)throw new G("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await C(this,sa,"f").requestAPIList(this.constructor,t)}async*iterPages(){let t=this;for(yield t;t.hasNextPage();)t=await t.getNextPage(),yield t}async*[(sa=new WeakMap,Symbol.asyncIterator)](){for await(const t of this.iterPages())for(const e of t.getPaginatedItems())yield e}}class K3 extends hl{constructor(t,e,s){super(t,e,async(i,r)=>new s(i,r.response,await jT(i,r),r.options))}async*[Symbol.asyncIterator](){const t=await this;for await(const e of t)yield e}}class dl extends lm{constructor(t,e,s,i){super(t,e,s,i),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class Ut extends lm{constructor(t,e,s,i){super(t,e,s,i),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const t=this.getPaginatedItems(),e=t[t.length-1]?.id;return e?{...this.options,query:{...OT(this.options.query),after:e}}:null}}class _c extends lm{constructor(t,e,s,i){super(t,e,s,i),this.data=s.data||[],this.has_more=s.has_more||!1,this.last_id=s.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const t=this.last_id;return t?{...this.options,query:{...OT(this.options.query),after:t}}:null}}const VT=()=>{if(typeof File>"u"){const{process:n}=globalThis,t=typeof n?.versions?.node=="string"&&parseInt(n.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function xr(n,t,e){return VT(),new File(n,t??"unknown_file",e)}function va(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}const um=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Q_=async(n,t)=>Qd(n.body)?{...n,body:await HT(n.body,t)}:n,$s=async(n,t)=>({...n,body:await HT(n.body,t)}),tw=new WeakMap;function Z3(n){const t=typeof n=="function"?n:n.fetch,e=tw.get(t);if(e)return e;const s=(async()=>{try{const i="Response"in t?t.Response:(await t("data:,")).constructor,r=new FormData;return r.toString()!==await new i(r).text()}catch{return!0}})();return tw.set(t,s),s}const HT=async(n,t)=>{if(!await Z3(t))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const e=new FormData;return await Promise.all(Object.entries(n||{}).map(([s,i])=>tf(e,s,i))),e},qT=n=>n instanceof Blob&&"name"in n,J3=n=>typeof n=="object"&&n!==null&&(n instanceof Response||um(n)||qT(n)),Qd=n=>{if(J3(n))return!0;if(Array.isArray(n))return n.some(Qd);if(n&&typeof n=="object"){for(const t in n)if(Qd(n[t]))return!0}return!1},tf=async(n,t,e)=>{if(e!==void 0){if(e==null)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof e=="string"||typeof e=="number"||typeof e=="boolean")n.append(t,String(e));else if(e instanceof Response)n.append(t,xr([await e.blob()],va(e)));else if(um(e))n.append(t,xr([await new Response(IT(e)).blob()],va(e)));else if(qT(e))n.append(t,e,va(e));else if(Array.isArray(e))await Promise.all(e.map(s=>tf(n,t+"[]",s)));else if(typeof e=="object")await Promise.all(Object.entries(e).map(([s,i])=>tf(n,`${t}[${s}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${e} instead`)}},WT=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",Q3=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&WT(n),tH=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function eH(n,t,e){if(VT(),n=await n,Q3(n))return n instanceof File?n:xr([await n.arrayBuffer()],n.name);if(tH(n)){const i=await n.blob();return t||(t=new URL(n.url).pathname.split(/[\\/]/).pop()),xr(await ef(i),t,e)}const s=await ef(n);if(t||(t=va(n)),!e?.type){const i=s.find(r=>typeof r=="object"&&"type"in r&&r.type);typeof i=="string"&&(e={...e,type:i})}return xr(s,t,e)}async function ef(n){let t=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)t.push(n);else if(WT(n))t.push(n instanceof Blob?n:await n.arrayBuffer());else if(um(n))for await(const e of n)t.push(...await ef(e));else{const e=n?.constructor?.name;throw new Error(`Unexpected data type: ${typeof n}${e?`; constructor: ${e}`:""}${nH(n)}`)}return t}function nH(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(e=>`"${e}"`).join(", ")}]`}class q{constructor(t){this._client=t}}function GT(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const ew=Object.freeze(Object.create(null)),sH=(n=GT)=>function(e,...s){if(e.length===1)return e[0];let i=!1;const r=[],o=e.reduce((u,h,d)=>{/[?#]/.test(h)&&(i=!0);const f=s[d];let m=(i?encodeURIComponent:n)(""+f);return d!==s.length&&(f==null||typeof f=="object"&&f.toString===Object.getPrototypeOf(Object.getPrototypeOf(f.hasOwnProperty??ew)??ew)?.toString)&&(m=f+"",r.push({start:u.length+h.length,length:m.length,error:`Value of type ${Object.prototype.toString.call(f).slice(8,-1)} is not a valid path parameter`})),u+h+(d===s.length?"":m)},""),a=o.split(/[?#]/,1)[0],c=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;let l;for(;(l=c.exec(a))!==null;)r.push({start:l.index,length:l[0].length,error:`Value "${l[0]}" can't be safely passed as a path parameter`});if(r.sort((u,h)=>u.start-h.start),r.length>0){let u=0;const h=r.reduce((d,f)=>{const m=" ".repeat(f.start-u),p="^".repeat(f.length);return u=f.start+f.length,d+m+p},"");throw new G(`Path parameters result in path with invalid segments:
${r.map(d=>d.error).join(`
`)}
${o}
${h}`)}return o},R=sH(GT);let YT=class extends q{list(t,e={},s){return this._client.getAPIList(R`/chat/completions/${t}/messages`,Ut,{query:e,...s})}};function wc(n){return n!==void 0&&"function"in n&&n.function!==void 0}function hm(n){return n?.$brand==="auto-parseable-response-format"}function Eo(n){return n?.$brand==="auto-parseable-tool"}function iH(n,t){return!t||!XT(t)?{...n,choices:n.choices.map(e=>(KT(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}:dm(n,t)}function dm(n,t){const e=n.choices.map(s=>{if(s.finish_reason==="length")throw new MT;if(s.finish_reason==="content_filter")throw new RT;return KT(s.message.tool_calls),{...s,message:{...s.message,...s.message.tool_calls?{tool_calls:s.message.tool_calls?.map(i=>oH(t,i))??void 0}:void 0,parsed:s.message.content&&!s.message.refusal?rH(t,s.message.content):null}}});return{...n,choices:e}}function rH(n,t){return n.response_format?.type!=="json_schema"?null:n.response_format?.type==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(t):JSON.parse(t):null}function oH(n,t){const e=n.tools?.find(s=>wc(s)&&s.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:Eo(e)?e.$parseRaw(t.function.arguments):e?.function.strict?JSON.parse(t.function.arguments):null}}}function aH(n,t){if(!n||!("tools"in n)||!n.tools)return!1;const e=n.tools?.find(s=>wc(s)&&s.function?.name===t.function.name);return wc(e)&&(Eo(e)||e?.function.strict||!1)}function XT(n){return hm(n.response_format)?!0:n.tools?.some(t=>Eo(t)||t.type==="function"&&t.function.strict===!0)??!1}function KT(n){for(const t of n||[])if(t.type!=="function")throw new G(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}function cH(n){for(const t of n??[]){if(t.type!=="function")throw new G(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(t.function.strict!==!0)throw new G(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}const vc=n=>n?.role==="assistant",ZT=n=>n?.role==="tool";var nf,Aa,Sa,fr,pr,Ta,mr,kn,gr,Ac,Sc,ri,JT;class fm{constructor(){nf.add(this),this.controller=new AbortController,Aa.set(this,void 0),Sa.set(this,()=>{}),fr.set(this,()=>{}),pr.set(this,void 0),Ta.set(this,()=>{}),mr.set(this,()=>{}),kn.set(this,{}),gr.set(this,!1),Ac.set(this,!1),Sc.set(this,!1),ri.set(this,!1),Z(this,Aa,new Promise((t,e)=>{Z(this,Sa,t,"f"),Z(this,fr,e,"f")})),Z(this,pr,new Promise((t,e)=>{Z(this,Ta,t,"f"),Z(this,mr,e,"f")})),C(this,Aa,"f").catch(()=>{}),C(this,pr,"f").catch(()=>{})}_run(t){setTimeout(()=>{t().then(()=>{this._emitFinal(),this._emit("end")},C(this,nf,"m",JT).bind(this))},0)}_connected(){this.ended||(C(this,Sa,"f").call(this),this._emit("connect"))}get ended(){return C(this,gr,"f")}get errored(){return C(this,Ac,"f")}get aborted(){return C(this,Sc,"f")}abort(){this.controller.abort()}on(t,e){return(C(this,kn,"f")[t]||(C(this,kn,"f")[t]=[])).push({listener:e}),this}off(t,e){const s=C(this,kn,"f")[t];if(!s)return this;const i=s.findIndex(r=>r.listener===e);return i>=0&&s.splice(i,1),this}once(t,e){return(C(this,kn,"f")[t]||(C(this,kn,"f")[t]=[])).push({listener:e,once:!0}),this}emitted(t){return new Promise((e,s)=>{Z(this,ri,!0),t!=="error"&&this.once("error",s),this.once(t,e)})}async done(){Z(this,ri,!0),await C(this,pr,"f")}_emit(t,...e){if(C(this,gr,"f"))return;t==="end"&&(Z(this,gr,!0),C(this,Ta,"f").call(this));const s=C(this,kn,"f")[t];if(s&&(C(this,kn,"f")[t]=s.filter(i=>!i.once),s.forEach(({listener:i})=>i(...e))),t==="abort"){const i=e[0];!C(this,ri,"f")&&!s?.length&&Promise.reject(i),C(this,fr,"f").call(this,i),C(this,mr,"f").call(this,i),this._emit("end");return}if(t==="error"){const i=e[0];!C(this,ri,"f")&&!s?.length&&Promise.reject(i),C(this,fr,"f").call(this,i),C(this,mr,"f").call(this,i),this._emit("end")}}_emitFinal(){}}Aa=new WeakMap,Sa=new WeakMap,fr=new WeakMap,pr=new WeakMap,Ta=new WeakMap,mr=new WeakMap,kn=new WeakMap,gr=new WeakMap,Ac=new WeakMap,Sc=new WeakMap,ri=new WeakMap,nf=new WeakSet,JT=function(t){if(Z(this,Ac,!0),t instanceof Error&&t.name==="AbortError"&&(t=new Ye),t instanceof Ye)return Z(this,Sc,!0),this._emit("abort",t);if(t instanceof G)return this._emit("error",t);if(t instanceof Error){const e=new G(t.message);return e.cause=t,this._emit("error",e)}return this._emit("error",new G(String(t)))};function lH(n){return typeof n.parse=="function"}var pe,sf,Tc,rf,of,af,QT,tE;const uH=10;class eE extends fm{constructor(){super(...arguments),pe.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(t){this._chatCompletions.push(t),this._emit("chatCompletion",t);const e=t.choices[0]?.message;return e&&this._addMessage(e),t}_addMessage(t,e=!0){if("content"in t||(t.content=null),this.messages.push(t),e){if(this._emit("message",t),ZT(t)&&t.content)this._emit("functionToolCallResult",t.content);else if(vc(t)&&t.tool_calls)for(const s of t.tool_calls)s.type==="function"&&this._emit("functionToolCall",s.function)}}async finalChatCompletion(){await this.done();const t=this._chatCompletions[this._chatCompletions.length-1];if(!t)throw new G("stream ended without producing a ChatCompletion");return t}async finalContent(){return await this.done(),C(this,pe,"m",sf).call(this)}async finalMessage(){return await this.done(),C(this,pe,"m",Tc).call(this)}async finalFunctionToolCall(){return await this.done(),C(this,pe,"m",rf).call(this)}async finalFunctionToolCallResult(){return await this.done(),C(this,pe,"m",of).call(this)}async totalUsage(){return await this.done(),C(this,pe,"m",af).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const t=this._chatCompletions[this._chatCompletions.length-1];t&&this._emit("finalChatCompletion",t);const e=C(this,pe,"m",Tc).call(this);e&&this._emit("finalMessage",e);const s=C(this,pe,"m",sf).call(this);s&&this._emit("finalContent",s);const i=C(this,pe,"m",rf).call(this);i&&this._emit("finalFunctionToolCall",i);const r=C(this,pe,"m",of).call(this);r!=null&&this._emit("finalFunctionToolCallResult",r),this._chatCompletions.some(o=>o.usage)&&this._emit("totalUsage",C(this,pe,"m",af).call(this))}async _createChatCompletion(t,e,s){const i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),C(this,pe,"m",QT).call(this,e);const r=await t.chat.completions.create({...e,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(dm(r,e))}async _runChatCompletion(t,e,s){for(const i of e.messages)this._addMessage(i,!1);return await this._createChatCompletion(t,e,s)}async _runTools(t,e,s){const i="tool",{tool_choice:r="auto",stream:o,...a}=e,c=typeof r!="string"&&r.type==="function"&&r?.function?.name,{maxChatCompletions:l=uH}=s||{},u=e.tools.map(f=>{if(Eo(f)){if(!f.$callback)throw new G("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:f.$callback,name:f.function.name,description:f.function.description||"",parameters:f.function.parameters,parse:f.$parseRaw,strict:!0}}}return f}),h={};for(const f of u)f.type==="function"&&(h[f.function.name||f.function.function.name]=f.function);const d="tools"in e?u.map(f=>f.type==="function"?{type:"function",function:{name:f.function.name||f.function.function.name,parameters:f.function.parameters,description:f.function.description,strict:f.function.strict}}:f):void 0;for(const f of e.messages)this._addMessage(f,!1);for(let f=0;f<l;++f){const p=(await this._createChatCompletion(t,{...a,tool_choice:r,tools:d,messages:[...this.messages]},s)).choices[0]?.message;if(!p)throw new G("missing message in ChatCompletion response");if(!p.tool_calls?.length)return;for(const g of p.tool_calls){if(g.type!=="function")continue;const y=g.id,{name:_,arguments:b}=g.function,w=h[_];if(w){if(c&&c!==_){const T=`Invalid tool_call: ${JSON.stringify(_)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:i,tool_call_id:y,content:T});continue}}else{const T=`Invalid tool_call: ${JSON.stringify(_)}. Available options are: ${Object.keys(h).map(E=>JSON.stringify(E)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:y,content:T});continue}let v;try{v=lH(w)?await w.parse(b):b}catch(T){const E=T instanceof Error?T.message:String(T);this._addMessage({role:i,tool_call_id:y,content:E});continue}const A=await w.function(v,this),S=C(this,pe,"m",tE).call(this,A);if(this._addMessage({role:i,tool_call_id:y,content:S}),c)return}}}}pe=new WeakSet,sf=function(){return C(this,pe,"m",Tc).call(this).content??null},Tc=function(){let t=this.messages.length;for(;t-- >0;){const e=this.messages[t];if(vc(e))return{...e,content:e.content??null,refusal:e.refusal??null}}throw new G("stream ended without producing a ChatCompletionMessage with role=assistant")},rf=function(){for(let t=this.messages.length-1;t>=0;t--){const e=this.messages[t];if(vc(e)&&e?.tool_calls?.length)return e.tool_calls.filter(s=>s.type==="function").at(-1)?.function}},of=function(){for(let t=this.messages.length-1;t>=0;t--){const e=this.messages[t];if(ZT(e)&&e.content!=null&&typeof e.content=="string"&&this.messages.some(s=>s.role==="assistant"&&s.tool_calls?.some(i=>i.type==="function"&&i.id===e.tool_call_id)))return e.content}},af=function(){const t={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:e}of this._chatCompletions)e&&(t.completion_tokens+=e.completion_tokens,t.prompt_tokens+=e.prompt_tokens,t.total_tokens+=e.total_tokens);return t},QT=function(t){if(t.n!=null&&t.n>1)throw new G("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},tE=function(t){return typeof t=="string"?t:t===void 0?"undefined":JSON.stringify(t)};class pm extends eE{static runTools(t,e,s){const i=new pm,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(t,e,r)),i}_addMessage(t,e=!0){super._addMessage(t,e),vc(t)&&t.content&&this._emit("content",t.content)}}const nE=1,sE=2,iE=4,rE=8,oE=16,aE=32,cE=64,lE=128,uE=256,hE=lE|uE,dE=oE|aE|hE|cE,fE=nE|sE|dE,pE=iE|rE,hH=fE|pE,Xt={STR:nE,NUM:sE,ARR:iE,OBJ:rE,NULL:oE,BOOL:aE,NAN:cE,INFINITY:lE,MINUS_INFINITY:uE,INF:hE,SPECIAL:dE,ATOM:fE,COLLECTION:pE,ALL:hH};class dH extends Error{}class fH extends Error{}function pH(n,t=Xt.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return mH(n.trim(),t)}const mH=(n,t)=>{const e=n.length;let s=0;const i=d=>{throw new dH(`${d} at position ${s}`)},r=d=>{throw new fH(`${d} at position ${s}`)},o=()=>(h(),s>=e&&i("Unexpected end of input"),n[s]==='"'?a():n[s]==="{"?c():n[s]==="["?l():n.substring(s,s+4)==="null"||Xt.NULL&t&&e-s<4&&"null".startsWith(n.substring(s))?(s+=4,null):n.substring(s,s+4)==="true"||Xt.BOOL&t&&e-s<4&&"true".startsWith(n.substring(s))?(s+=4,!0):n.substring(s,s+5)==="false"||Xt.BOOL&t&&e-s<5&&"false".startsWith(n.substring(s))?(s+=5,!1):n.substring(s,s+8)==="Infinity"||Xt.INFINITY&t&&e-s<8&&"Infinity".startsWith(n.substring(s))?(s+=8,1/0):n.substring(s,s+9)==="-Infinity"||Xt.MINUS_INFINITY&t&&1<e-s&&e-s<9&&"-Infinity".startsWith(n.substring(s))?(s+=9,-1/0):n.substring(s,s+3)==="NaN"||Xt.NAN&t&&e-s<3&&"NaN".startsWith(n.substring(s))?(s+=3,NaN):u()),a=()=>{const d=s;let f=!1;for(s++;s<e&&(n[s]!=='"'||f&&n[s-1]==="\\");)f=n[s]==="\\"?!f:!1,s++;if(n.charAt(s)=='"')try{return JSON.parse(n.substring(d,++s-Number(f)))}catch(m){r(String(m))}else if(Xt.STR&t)try{return JSON.parse(n.substring(d,s-Number(f))+'"')}catch{return JSON.parse(n.substring(d,n.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},c=()=>{s++,h();const d={};try{for(;n[s]!=="}";){if(h(),s>=e&&Xt.OBJ&t)return d;const f=a();h(),s++;try{const m=o();Object.defineProperty(d,f,{value:m,writable:!0,enumerable:!0,configurable:!0})}catch(m){if(Xt.OBJ&t)return d;throw m}h(),n[s]===","&&s++}}catch{if(Xt.OBJ&t)return d;i("Expected '}' at end of object")}return s++,d},l=()=>{s++;const d=[];try{for(;n[s]!=="]";)d.push(o()),h(),n[s]===","&&s++}catch{if(Xt.ARR&t)return d;i("Expected ']' at end of array")}return s++,d},u=()=>{if(s===0){n==="-"&&Xt.NUM&t&&i("Not sure what '-' is");try{return JSON.parse(n)}catch(f){if(Xt.NUM&t)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}r(String(f))}}const d=s;for(n[s]==="-"&&s++;n[s]&&!",]}".includes(n[s]);)s++;s==e&&!(Xt.NUM&t)&&i("Unterminated number literal");try{return JSON.parse(n.substring(d,s))}catch{n.substring(d,s)==="-"&&Xt.NUM&t&&i("Not sure what '-' is");try{return JSON.parse(n.substring(d,n.lastIndexOf("e")))}catch(m){r(String(m))}}},h=()=>{for(;s<e&&` 
\r	`.includes(n[s]);)s++};return o()},nw=n=>pH(n,Xt.ALL^Xt.NUM);var zt,Cn,Zs,Hn,Ch,ia,Ph,kh,Mh,ra,Rh,sw;class eo extends eE{constructor(t){super(),zt.add(this),Cn.set(this,void 0),Zs.set(this,void 0),Hn.set(this,void 0),Z(this,Cn,t),Z(this,Zs,[])}get currentChatCompletionSnapshot(){return C(this,Hn,"f")}static fromReadableStream(t){const e=new eo(null);return e._run(()=>e._fromReadableStream(t)),e}static createChatCompletion(t,e,s){const i=new eo(e);return i._run(()=>i._runChatCompletion(t,{...e,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(t,e,s){super._createChatCompletion;const i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),C(this,zt,"m",Ch).call(this);const r=await t.chat.completions.create({...e,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const o of r)C(this,zt,"m",Ph).call(this,o);if(r.controller.signal?.aborted)throw new Ye;return this._addChatCompletion(C(this,zt,"m",ra).call(this))}async _fromReadableStream(t,e){const s=e?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),C(this,zt,"m",Ch).call(this),this._connected();const i=bn.fromReadableStream(t,this.controller);let r;for await(const o of i)r&&r!==o.id&&this._addChatCompletion(C(this,zt,"m",ra).call(this)),C(this,zt,"m",Ph).call(this,o),r=o.id;if(i.controller.signal?.aborted)throw new Ye;return this._addChatCompletion(C(this,zt,"m",ra).call(this))}[(Cn=new WeakMap,Zs=new WeakMap,Hn=new WeakMap,zt=new WeakSet,Ch=function(){this.ended||Z(this,Hn,void 0)},ia=function(e){let s=C(this,Zs,"f")[e.index];return s||(s={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},C(this,Zs,"f")[e.index]=s,s)},Ph=function(e){if(this.ended)return;const s=C(this,zt,"m",sw).call(this,e);this._emit("chunk",e,s);for(const i of e.choices){const r=s.choices[i.index];i.delta.content!=null&&r.message?.role==="assistant"&&r.message?.content&&(this._emit("content",i.delta.content,r.message.content),this._emit("content.delta",{delta:i.delta.content,snapshot:r.message.content,parsed:r.message.parsed})),i.delta.refusal!=null&&r.message?.role==="assistant"&&r.message?.refusal&&this._emit("refusal.delta",{delta:i.delta.refusal,snapshot:r.message.refusal}),i.logprobs?.content!=null&&r.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:i.logprobs?.content,snapshot:r.logprobs?.content??[]}),i.logprobs?.refusal!=null&&r.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:i.logprobs?.refusal,snapshot:r.logprobs?.refusal??[]});const o=C(this,zt,"m",ia).call(this,r);r.finish_reason&&(C(this,zt,"m",Mh).call(this,r),o.current_tool_call_index!=null&&C(this,zt,"m",kh).call(this,r,o.current_tool_call_index));for(const a of i.delta.tool_calls??[])o.current_tool_call_index!==a.index&&(C(this,zt,"m",Mh).call(this,r),o.current_tool_call_index!=null&&C(this,zt,"m",kh).call(this,r,o.current_tool_call_index)),o.current_tool_call_index=a.index;for(const a of i.delta.tool_calls??[]){const c=r.message.tool_calls?.[a.index];c?.type&&(c?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:c.function?.name,index:a.index,arguments:c.function.arguments,parsed_arguments:c.function.parsed_arguments,arguments_delta:a.function?.arguments??""}):(c?.type,void 0))}}},kh=function(e,s){if(C(this,zt,"m",ia).call(this,e).done_tool_calls.has(s))return;const r=e.message.tool_calls?.[s];if(!r)throw new Error("no tool call snapshot");if(!r.type)throw new Error("tool call snapshot missing `type`");if(r.type==="function"){const o=C(this,Cn,"f")?.tools?.find(a=>wc(a)&&a.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:s,arguments:r.function.arguments,parsed_arguments:Eo(o)?o.$parseRaw(r.function.arguments):o?.function.strict?JSON.parse(r.function.arguments):null})}else r.type},Mh=function(e){const s=C(this,zt,"m",ia).call(this,e);if(e.message.content&&!s.content_done){s.content_done=!0;const i=C(this,zt,"m",Rh).call(this);this._emit("content.done",{content:e.message.content,parsed:i?i.$parseRaw(e.message.content):null})}e.message.refusal&&!s.refusal_done&&(s.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!s.logprobs_content_done&&(s.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!s.logprobs_refusal_done&&(s.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},ra=function(){if(this.ended)throw new G("stream has ended, this shouldn't happen");const e=C(this,Hn,"f");if(!e)throw new G("request ended without sending any chunks");return Z(this,Hn,void 0),Z(this,Zs,[]),gH(e,C(this,Cn,"f"))},Rh=function(){const e=C(this,Cn,"f")?.response_format;return hm(e)?e:null},sw=function(e){var s,i,r,o;let a=C(this,Hn,"f");const{choices:c,...l}=e;a?Object.assign(a,l):a=Z(this,Hn,{...l,choices:[]});for(const{delta:u,finish_reason:h,index:d,logprobs:f=null,...m}of e.choices){let p=a.choices[d];if(p||(p=a.choices[d]={finish_reason:h,index:d,message:{},logprobs:f,...m}),f)if(!p.logprobs)p.logprobs=Object.assign({},f);else{const{content:A,refusal:S,...T}=f;Object.assign(p.logprobs,T),A&&((s=p.logprobs).content??(s.content=[]),p.logprobs.content.push(...A)),S&&((i=p.logprobs).refusal??(i.refusal=[]),p.logprobs.refusal.push(...S))}if(h&&(p.finish_reason=h,C(this,Cn,"f")&&XT(C(this,Cn,"f")))){if(h==="length")throw new MT;if(h==="content_filter")throw new RT}if(Object.assign(p,m),!u)continue;const{content:g,refusal:y,function_call:_,role:b,tool_calls:w,...v}=u;if(Object.assign(p.message,v),y&&(p.message.refusal=(p.message.refusal||"")+y),b&&(p.message.role=b),_&&(p.message.function_call?(_.name&&(p.message.function_call.name=_.name),_.arguments&&((r=p.message.function_call).arguments??(r.arguments=""),p.message.function_call.arguments+=_.arguments)):p.message.function_call=_),g&&(p.message.content=(p.message.content||"")+g,!p.message.refusal&&C(this,zt,"m",Rh).call(this)&&(p.message.parsed=nw(p.message.content))),w){p.message.tool_calls||(p.message.tool_calls=[]);for(const{index:A,id:S,type:T,function:E,...P}of w){const x=(o=p.message.tool_calls)[A]??(o[A]={});Object.assign(x,P),S&&(x.id=S),T&&(x.type=T),E&&(x.function??(x.function={name:E.name??"",arguments:""})),E?.name&&(x.function.name=E.name),E?.arguments&&(x.function.arguments+=E.arguments,aH(C(this,Cn,"f"),x)&&(x.function.parsed_arguments=nw(x.function.arguments)))}}}return a},Symbol.asyncIterator)](){const t=[],e=[];let s=!1;return this.on("chunk",i=>{const r=e.shift();r?r.resolve(i):t.push(i)}),this.on("end",()=>{s=!0;for(const i of e)i.resolve(void 0);e.length=0}),this.on("abort",i=>{s=!0;for(const r of e)r.reject(i);e.length=0}),this.on("error",i=>{s=!0;for(const r of e)r.reject(i);e.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,o)=>e.push({resolve:r,reject:o})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new bn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function gH(n,t){const{id:e,choices:s,created:i,model:r,system_fingerprint:o,...a}=n,c={...a,id:e,choices:s.map(({message:l,finish_reason:u,index:h,logprobs:d,...f})=>{if(!u)throw new G(`missing finish_reason for choice ${h}`);const{content:m=null,function_call:p,tool_calls:g,...y}=l,_=l.role;if(!_)throw new G(`missing role for choice ${h}`);if(p){const{arguments:b,name:w}=p;if(b==null)throw new G(`missing function_call.arguments for choice ${h}`);if(!w)throw new G(`missing function_call.name for choice ${h}`);return{...f,message:{content:m,function_call:{arguments:b,name:w},role:_,refusal:l.refusal??null},finish_reason:u,index:h,logprobs:d}}return g?{...f,index:h,finish_reason:u,logprobs:d,message:{...y,role:_,content:m,refusal:l.refusal??null,tool_calls:g.map((b,w)=>{const{function:v,type:A,id:S,...T}=b,{arguments:E,name:P,...x}=v||{};if(S==null)throw new G(`missing choices[${h}].tool_calls[${w}].id
${oa(n)}`);if(A==null)throw new G(`missing choices[${h}].tool_calls[${w}].type
${oa(n)}`);if(P==null)throw new G(`missing choices[${h}].tool_calls[${w}].function.name
${oa(n)}`);if(E==null)throw new G(`missing choices[${h}].tool_calls[${w}].function.arguments
${oa(n)}`);return{...T,id:S,type:A,function:{...x,name:P,arguments:E}}})}}:{...f,message:{...y,content:m,role:_,refusal:l.refusal??null},finish_reason:u,index:h,logprobs:d}}),created:i,model:r,object:"chat.completion",...o?{system_fingerprint:o}:{}};return iH(c,t)}function oa(n){return JSON.stringify(n)}class Ec extends eo{static fromReadableStream(t){const e=new Ec(null);return e._run(()=>e._fromReadableStream(t)),e}static runTools(t,e,s){const i=new Ec(e),r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(t,e,r)),i}}let mm=class extends q{constructor(){super(...arguments),this.messages=new YT(this._client)}create(t,e){return this._client.post("/chat/completions",{body:t,...e,stream:t.stream??!1})}retrieve(t,e){return this._client.get(R`/chat/completions/${t}`,e)}update(t,e,s){return this._client.post(R`/chat/completions/${t}`,{body:e,...s})}list(t={},e){return this._client.getAPIList("/chat/completions",Ut,{query:t,...e})}delete(t,e){return this._client.delete(R`/chat/completions/${t}`,e)}parse(t,e){return cH(t.tools),this._client.chat.completions.create(t,{...e,headers:{...e?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(s=>dm(s,t))}runTools(t,e){return t.stream?Ec.runTools(this._client,t,e):pm.runTools(this._client,t,e)}stream(t,e){return eo.createChatCompletion(this._client,t,e)}};mm.Messages=YT;class gm extends q{constructor(){super(...arguments),this.completions=new mm(this._client)}}gm.Completions=mm;const mE=Symbol("brand.privateNullableHeaders");function*yH(n){if(!n)return;if(mE in n){const{values:s,nulls:i}=n;yield*s.entries();for(const r of i)yield[r,null];return}let t=!1,e;n instanceof Headers?e=n.entries():j_(n)?e=n:(t=!0,e=Object.entries(n??{}));for(let s of e){const i=s[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");const r=j_(s[1])?s[1]:[s[1]];let o=!1;for(const a of r)a!==void 0&&(t&&!o&&(o=!0,yield[i,null]),yield[i,a])}}const j=n=>{const t=new Headers,e=new Set;for(const s of n){const i=new Set;for(const[r,o]of yH(s)){const a=r.toLowerCase();i.has(a)||(t.delete(r),i.add(a)),o===null?(t.delete(r),e.add(a)):(t.append(r,o),e.delete(a))}}return{[mE]:!0,values:t,nulls:e}};class gE extends q{create(t,e){return this._client.post("/audio/speech",{body:t,...e,headers:j([{Accept:"application/octet-stream"},e?.headers]),__binaryResponse:!0})}}class yE extends q{create(t,e){return this._client.post("/audio/transcriptions",$s({body:t,...e,stream:t.stream??!1,__metadata:{model:t.model}},this._client))}}class bE extends q{create(t,e){return this._client.post("/audio/translations",$s({body:t,...e,__metadata:{model:t.model}},this._client))}}class xo extends q{constructor(){super(...arguments),this.transcriptions=new yE(this._client),this.translations=new bE(this._client),this.speech=new gE(this._client)}}xo.Transcriptions=yE;xo.Translations=bE;xo.Speech=gE;class _E extends q{create(t,e){return this._client.post("/batches",{body:t,...e})}retrieve(t,e){return this._client.get(R`/batches/${t}`,e)}list(t={},e){return this._client.getAPIList("/batches",Ut,{query:t,...e})}cancel(t,e){return this._client.post(R`/batches/${t}/cancel`,e)}}class wE extends q{create(t,e){return this._client.post("/assistants",{body:t,...e,headers:j([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}retrieve(t,e){return this._client.get(R`/assistants/${t}`,{...e,headers:j([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}update(t,e,s){return this._client.post(R`/assistants/${t}`,{body:e,...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(t={},e){return this._client.getAPIList("/assistants",Ut,{query:t,...e,headers:j([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}delete(t,e){return this._client.delete(R`/assistants/${t}`,{...e,headers:j([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}}let vE=class extends q{create(t,e){return this._client.post("/realtime/sessions",{body:t,...e,headers:j([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}};class AE extends q{create(t,e){return this._client.post("/realtime/transcription_sessions",{body:t,...e,headers:j([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}}let fl=class extends q{constructor(){super(...arguments),this.sessions=new vE(this._client),this.transcriptionSessions=new AE(this._client)}};fl.Sessions=vE;fl.TranscriptionSessions=AE;class SE extends q{create(t,e){return this._client.post("/chatkit/sessions",{body:t,...e,headers:j([{"OpenAI-Beta":"chatkit_beta=v1"},e?.headers])})}cancel(t,e){return this._client.post(R`/chatkit/sessions/${t}/cancel`,{...e,headers:j([{"OpenAI-Beta":"chatkit_beta=v1"},e?.headers])})}}let TE=class extends q{retrieve(t,e){return this._client.get(R`/chatkit/threads/${t}`,{...e,headers:j([{"OpenAI-Beta":"chatkit_beta=v1"},e?.headers])})}list(t={},e){return this._client.getAPIList("/chatkit/threads",_c,{query:t,...e,headers:j([{"OpenAI-Beta":"chatkit_beta=v1"},e?.headers])})}delete(t,e){return this._client.delete(R`/chatkit/threads/${t}`,{...e,headers:j([{"OpenAI-Beta":"chatkit_beta=v1"},e?.headers])})}listItems(t,e={},s){return this._client.getAPIList(R`/chatkit/threads/${t}/items`,_c,{query:e,...s,headers:j([{"OpenAI-Beta":"chatkit_beta=v1"},s?.headers])})}};class pl extends q{constructor(){super(...arguments),this.sessions=new SE(this._client),this.threads=new TE(this._client)}}pl.Sessions=SE;pl.Threads=TE;class EE extends q{create(t,e,s){return this._client.post(R`/threads/${t}/messages`,{body:e,...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(t,e,s){const{thread_id:i}=e;return this._client.get(R`/threads/${i}/messages/${t}`,{...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(t,e,s){const{thread_id:i,...r}=e;return this._client.post(R`/threads/${i}/messages/${t}`,{body:r,...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(t,e={},s){return this._client.getAPIList(R`/threads/${t}/messages`,Ut,{query:e,...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(t,e,s){const{thread_id:i}=e;return this._client.delete(R`/threads/${i}/messages/${t}`,{...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class xE extends q{retrieve(t,e,s){const{thread_id:i,run_id:r,...o}=e;return this._client.get(R`/threads/${i}/runs/${r}/steps/${t}`,{query:o,...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(t,e,s){const{thread_id:i,...r}=e;return this._client.getAPIList(R`/threads/${i}/runs/${t}/steps`,Ut,{query:r,...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}const bH=n=>{if(typeof Buffer<"u"){const t=Buffer.from(n,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}else{const t=atob(n),e=t.length,s=new Uint8Array(e);for(let i=0;i<e;i++)s[i]=t.charCodeAt(i);return Array.from(new Float32Array(s.buffer))}};var _H={};const Js=n=>{if(typeof globalThis.process<"u")return _H?.[n]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(n)?.trim()};var oe,Ss,cf,gn,Ea,sn,Ts,gi,ys,xc,Oe,xa,Ca,Cr,yr,br,iw,rw,ow,aw,cw,lw,uw;class Pr extends fm{constructor(){super(...arguments),oe.add(this),cf.set(this,[]),gn.set(this,{}),Ea.set(this,{}),sn.set(this,void 0),Ts.set(this,void 0),gi.set(this,void 0),ys.set(this,void 0),xc.set(this,void 0),Oe.set(this,void 0),xa.set(this,void 0),Ca.set(this,void 0),Cr.set(this,void 0)}[(cf=new WeakMap,gn=new WeakMap,Ea=new WeakMap,sn=new WeakMap,Ts=new WeakMap,gi=new WeakMap,ys=new WeakMap,xc=new WeakMap,Oe=new WeakMap,xa=new WeakMap,Ca=new WeakMap,Cr=new WeakMap,oe=new WeakSet,Symbol.asyncIterator)](){const t=[],e=[];let s=!1;return this.on("event",i=>{const r=e.shift();r?r.resolve(i):t.push(i)}),this.on("end",()=>{s=!0;for(const i of e)i.resolve(void 0);e.length=0}),this.on("abort",i=>{s=!0;for(const r of e)r.reject(i);e.length=0}),this.on("error",i=>{s=!0;for(const r of e)r.reject(i);e.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,o)=>e.push({resolve:r,reject:o})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(t){const e=new Ss;return e._run(()=>e._fromReadableStream(t)),e}async _fromReadableStream(t,e){const s=e?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();const i=bn.fromReadableStream(t,this.controller);for await(const r of i)C(this,oe,"m",yr).call(this,r);if(i.controller.signal?.aborted)throw new Ye;return this._addRun(C(this,oe,"m",br).call(this))}toReadableStream(){return new bn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(t,e,s,i){const r=new Ss;return r._run(()=>r._runToolAssistantStream(t,e,s,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createToolAssistantStream(t,e,s,i){const r=i?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},a=await t.submitToolOutputs(e,o,{...i,signal:this.controller.signal});this._connected();for await(const c of a)C(this,oe,"m",yr).call(this,c);if(a.controller.signal?.aborted)throw new Ye;return this._addRun(C(this,oe,"m",br).call(this))}static createThreadAssistantStream(t,e,s){const i=new Ss;return i._run(()=>i._threadAssistantStream(t,e,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(t,e,s,i){const r=new Ss;return r._run(()=>r._runAssistantStream(t,e,s,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return C(this,xa,"f")}currentRun(){return C(this,Ca,"f")}currentMessageSnapshot(){return C(this,sn,"f")}currentRunStepSnapshot(){return C(this,Cr,"f")}async finalRunSteps(){return await this.done(),Object.values(C(this,gn,"f"))}async finalMessages(){return await this.done(),Object.values(C(this,Ea,"f"))}async finalRun(){if(await this.done(),!C(this,Ts,"f"))throw Error("Final run was not received.");return C(this,Ts,"f")}async _createThreadAssistantStream(t,e,s){const i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const r={...e,stream:!0},o=await t.createAndRun(r,{...s,signal:this.controller.signal});this._connected();for await(const a of o)C(this,oe,"m",yr).call(this,a);if(o.controller.signal?.aborted)throw new Ye;return this._addRun(C(this,oe,"m",br).call(this))}async _createAssistantStream(t,e,s,i){const r=i?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},a=await t.create(e,o,{...i,signal:this.controller.signal});this._connected();for await(const c of a)C(this,oe,"m",yr).call(this,c);if(a.controller.signal?.aborted)throw new Ye;return this._addRun(C(this,oe,"m",br).call(this))}static accumulateDelta(t,e){for(const[s,i]of Object.entries(e)){if(!t.hasOwnProperty(s)){t[s]=i;continue}let r=t[s];if(r==null){t[s]=i;continue}if(s==="index"||s==="type"){t[s]=i;continue}if(typeof r=="string"&&typeof i=="string")r+=i;else if(typeof r=="number"&&typeof i=="number")r+=i;else if(Th(r)&&Th(i))r=this.accumulateDelta(r,i);else if(Array.isArray(r)&&Array.isArray(i)){if(r.every(o=>typeof o=="string"||typeof o=="number")){r.push(...i);continue}for(const o of i){if(!Th(o))throw new Error(`Expected array delta entry to be an object but got: ${o}`);const a=o.index;if(a==null)throw console.error(o),new Error("Expected array delta entry to have an `index` property");if(typeof a!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${a}`);const c=r[a];c==null?r.push(o):r[a]=this.accumulateDelta(c,o)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${i}, accValue: ${r}`);t[s]=r}return t}_addRun(t){return t}async _threadAssistantStream(t,e,s){return await this._createThreadAssistantStream(e,t,s)}async _runAssistantStream(t,e,s,i){return await this._createAssistantStream(e,t,s,i)}async _runToolAssistantStream(t,e,s,i){return await this._createToolAssistantStream(e,t,s,i)}}Ss=Pr,yr=function(t){if(!this.ended)switch(Z(this,xa,t),C(this,oe,"m",ow).call(this,t),t.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":C(this,oe,"m",uw).call(this,t);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":C(this,oe,"m",rw).call(this,t);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":C(this,oe,"m",iw).call(this,t);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},br=function(){if(this.ended)throw new G("stream has ended, this shouldn't happen");if(!C(this,Ts,"f"))throw Error("Final run has not been received");return C(this,Ts,"f")},iw=function(t){const[e,s]=C(this,oe,"m",cw).call(this,t,C(this,sn,"f"));Z(this,sn,e),C(this,Ea,"f")[e.id]=e;for(const i of s){const r=e.content[i.index];r?.type=="text"&&this._emit("textCreated",r.text)}switch(t.event){case"thread.message.created":this._emit("messageCreated",t.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",t.data.delta,e),t.data.delta.content)for(const i of t.data.delta.content){if(i.type=="text"&&i.text){let r=i.text,o=e.content[i.index];if(o&&o.type=="text")this._emit("textDelta",r,o.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=C(this,gi,"f")){if(C(this,ys,"f"))switch(C(this,ys,"f").type){case"text":this._emit("textDone",C(this,ys,"f").text,C(this,sn,"f"));break;case"image_file":this._emit("imageFileDone",C(this,ys,"f").image_file,C(this,sn,"f"));break}Z(this,gi,i.index)}Z(this,ys,e.content[i.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(C(this,gi,"f")!==void 0){const i=t.data.content[C(this,gi,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,C(this,sn,"f"));break;case"text":this._emit("textDone",i.text,C(this,sn,"f"));break}}C(this,sn,"f")&&this._emit("messageDone",t.data),Z(this,sn,void 0)}},rw=function(t){const e=C(this,oe,"m",aw).call(this,t);switch(Z(this,Cr,e),t.event){case"thread.run.step.created":this._emit("runStepCreated",t.data);break;case"thread.run.step.delta":const s=t.data.delta;if(s.step_details&&s.step_details.type=="tool_calls"&&s.step_details.tool_calls&&e.step_details.type=="tool_calls")for(const r of s.step_details.tool_calls)r.index==C(this,xc,"f")?this._emit("toolCallDelta",r,e.step_details.tool_calls[r.index]):(C(this,Oe,"f")&&this._emit("toolCallDone",C(this,Oe,"f")),Z(this,xc,r.index),Z(this,Oe,e.step_details.tool_calls[r.index]),C(this,Oe,"f")&&this._emit("toolCallCreated",C(this,Oe,"f")));this._emit("runStepDelta",t.data.delta,e);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Z(this,Cr,void 0),t.data.step_details.type=="tool_calls"&&C(this,Oe,"f")&&(this._emit("toolCallDone",C(this,Oe,"f")),Z(this,Oe,void 0)),this._emit("runStepDone",t.data,e);break}},ow=function(t){C(this,cf,"f").push(t),this._emit("event",t)},aw=function(t){switch(t.event){case"thread.run.step.created":return C(this,gn,"f")[t.data.id]=t.data,t.data;case"thread.run.step.delta":let e=C(this,gn,"f")[t.data.id];if(!e)throw Error("Received a RunStepDelta before creation of a snapshot");let s=t.data;if(s.delta){const i=Ss.accumulateDelta(e,s.delta);C(this,gn,"f")[t.data.id]=i}return C(this,gn,"f")[t.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":C(this,gn,"f")[t.data.id]=t.data;break}if(C(this,gn,"f")[t.data.id])return C(this,gn,"f")[t.data.id];throw new Error("No snapshot available")},cw=function(t,e){let s=[];switch(t.event){case"thread.message.created":return[t.data,s];case"thread.message.delta":if(!e)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=t.data;if(i.delta.content)for(const r of i.delta.content)if(r.index in e.content){let o=e.content[r.index];e.content[r.index]=C(this,oe,"m",lw).call(this,r,o)}else e.content[r.index]=r,s.push(r);return[e,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(e)return[e,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},lw=function(t,e){return Ss.accumulateDelta(e,t)},uw=function(t){switch(Z(this,Ca,t.data),t.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":Z(this,Ts,t.data),C(this,Oe,"f")&&(this._emit("toolCallDone",C(this,Oe,"f")),Z(this,Oe,void 0));break}};let ym=class extends q{constructor(){super(...arguments),this.steps=new xE(this._client)}create(t,e,s){const{include:i,...r}=e;return this._client.post(R`/threads/${t}/runs`,{query:{include:i},body:r,...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:e.stream??!1})}retrieve(t,e,s){const{thread_id:i}=e;return this._client.get(R`/threads/${i}/runs/${t}`,{...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(t,e,s){const{thread_id:i,...r}=e;return this._client.post(R`/threads/${i}/runs/${t}`,{body:r,...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(t,e={},s){return this._client.getAPIList(R`/threads/${t}/runs`,Ut,{query:e,...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(t,e,s){const{thread_id:i}=e;return this._client.post(R`/threads/${i}/runs/${t}/cancel`,{...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(t,e,s){const i=await this.create(t,e,s);return await this.poll(i.id,{thread_id:t},s)}createAndStream(t,e,s){return Pr.createAssistantStream(t,this._client.beta.threads.runs,e,s)}async poll(t,e,s){const i=j([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:r,response:o}=await this.retrieve(t,e,{...s,headers:{...s?.headers,...i}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{const c=o.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(a=l)}}await To(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(t,e,s){return Pr.createAssistantStream(t,this._client.beta.threads.runs,e,s)}submitToolOutputs(t,e,s){const{thread_id:i,...r}=e;return this._client.post(R`/threads/${i}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:e.stream??!1})}async submitToolOutputsAndPoll(t,e,s){const i=await this.submitToolOutputs(t,e,s);return await this.poll(i.id,e,s)}submitToolOutputsStream(t,e,s){return Pr.createToolAssistantStream(t,this._client.beta.threads.runs,e,s)}};ym.Steps=xE;class ml extends q{constructor(){super(...arguments),this.runs=new ym(this._client),this.messages=new EE(this._client)}create(t={},e){return this._client.post("/threads",{body:t,...e,headers:j([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}retrieve(t,e){return this._client.get(R`/threads/${t}`,{...e,headers:j([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}update(t,e,s){return this._client.post(R`/threads/${t}`,{body:e,...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(t,e){return this._client.delete(R`/threads/${t}`,{...e,headers:j([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}createAndRun(t,e){return this._client.post("/threads/runs",{body:t,...e,headers:j([{"OpenAI-Beta":"assistants=v2"},e?.headers]),stream:t.stream??!1})}async createAndRunPoll(t,e){const s=await this.createAndRun(t,e);return await this.runs.poll(s.id,{thread_id:s.thread_id},e)}createAndRunStream(t,e){return Pr.createThreadAssistantStream(t,this._client.beta.threads,e)}}ml.Runs=ym;ml.Messages=EE;class ji extends q{constructor(){super(...arguments),this.realtime=new fl(this._client),this.chatkit=new pl(this._client),this.assistants=new wE(this._client),this.threads=new ml(this._client)}}ji.Realtime=fl;ji.ChatKit=pl;ji.Assistants=wE;ji.Threads=ml;class CE extends q{create(t,e){return this._client.post("/completions",{body:t,...e,stream:t.stream??!1})}}class PE extends q{retrieve(t,e,s){const{container_id:i}=e;return this._client.get(R`/containers/${i}/files/${t}/content`,{...s,headers:j([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}}let bm=class extends q{constructor(){super(...arguments),this.content=new PE(this._client)}create(t,e,s){return this._client.post(R`/containers/${t}/files`,$s({body:e,...s},this._client))}retrieve(t,e,s){const{container_id:i}=e;return this._client.get(R`/containers/${i}/files/${t}`,s)}list(t,e={},s){return this._client.getAPIList(R`/containers/${t}/files`,Ut,{query:e,...s})}delete(t,e,s){const{container_id:i}=e;return this._client.delete(R`/containers/${i}/files/${t}`,{...s,headers:j([{Accept:"*/*"},s?.headers])})}};bm.Content=PE;class _m extends q{constructor(){super(...arguments),this.files=new bm(this._client)}create(t,e){return this._client.post("/containers",{body:t,...e})}retrieve(t,e){return this._client.get(R`/containers/${t}`,e)}list(t={},e){return this._client.getAPIList("/containers",Ut,{query:t,...e})}delete(t,e){return this._client.delete(R`/containers/${t}`,{...e,headers:j([{Accept:"*/*"},e?.headers])})}}_m.Files=bm;class kE extends q{create(t,e,s){const{include:i,...r}=e;return this._client.post(R`/conversations/${t}/items`,{query:{include:i},body:r,...s})}retrieve(t,e,s){const{conversation_id:i,...r}=e;return this._client.get(R`/conversations/${i}/items/${t}`,{query:r,...s})}list(t,e={},s){return this._client.getAPIList(R`/conversations/${t}/items`,_c,{query:e,...s})}delete(t,e,s){const{conversation_id:i}=e;return this._client.delete(R`/conversations/${i}/items/${t}`,s)}}class wm extends q{constructor(){super(...arguments),this.items=new kE(this._client)}create(t={},e){return this._client.post("/conversations",{body:t,...e})}retrieve(t,e){return this._client.get(R`/conversations/${t}`,e)}update(t,e,s){return this._client.post(R`/conversations/${t}`,{body:e,...s})}delete(t,e){return this._client.delete(R`/conversations/${t}`,e)}}wm.Items=kE;class ME extends q{create(t,e){const s=!!t.encoding_format;let i=s?t.encoding_format:"base64";s&&re(this._client).debug("embeddings/user defined encoding_format:",t.encoding_format);const r=this._client.post("/embeddings",{body:{...t,encoding_format:i},...e});return s?r:(re(this._client).debug("embeddings/decoding base64 embeddings from base64"),r._thenUnwrap(o=>(o&&o.data&&o.data.forEach(a=>{const c=a.embedding;a.embedding=bH(c)}),o)))}}class RE extends q{retrieve(t,e,s){const{eval_id:i,run_id:r}=e;return this._client.get(R`/evals/${i}/runs/${r}/output_items/${t}`,s)}list(t,e,s){const{eval_id:i,...r}=e;return this._client.getAPIList(R`/evals/${i}/runs/${t}/output_items`,Ut,{query:r,...s})}}class vm extends q{constructor(){super(...arguments),this.outputItems=new RE(this._client)}create(t,e,s){return this._client.post(R`/evals/${t}/runs`,{body:e,...s})}retrieve(t,e,s){const{eval_id:i}=e;return this._client.get(R`/evals/${i}/runs/${t}`,s)}list(t,e={},s){return this._client.getAPIList(R`/evals/${t}/runs`,Ut,{query:e,...s})}delete(t,e,s){const{eval_id:i}=e;return this._client.delete(R`/evals/${i}/runs/${t}`,s)}cancel(t,e,s){const{eval_id:i}=e;return this._client.post(R`/evals/${i}/runs/${t}`,s)}}vm.OutputItems=RE;class Am extends q{constructor(){super(...arguments),this.runs=new vm(this._client)}create(t,e){return this._client.post("/evals",{body:t,...e})}retrieve(t,e){return this._client.get(R`/evals/${t}`,e)}update(t,e,s){return this._client.post(R`/evals/${t}`,{body:e,...s})}list(t={},e){return this._client.getAPIList("/evals",Ut,{query:t,...e})}delete(t,e){return this._client.delete(R`/evals/${t}`,e)}}Am.Runs=vm;let OE=class extends q{create(t,e){return this._client.post("/files",$s({body:t,...e},this._client))}retrieve(t,e){return this._client.get(R`/files/${t}`,e)}list(t={},e){return this._client.getAPIList("/files",Ut,{query:t,...e})}delete(t,e){return this._client.delete(R`/files/${t}`,e)}content(t,e){return this._client.get(R`/files/${t}/content`,{...e,headers:j([{Accept:"application/binary"},e?.headers]),__binaryResponse:!0})}async waitForProcessing(t,{pollInterval:e=5e3,maxWait:s=1800*1e3}={}){const i=new Set(["processed","error","deleted"]),r=Date.now();let o=await this.retrieve(t);for(;!o.status||!i.has(o.status);)if(await To(e),o=await this.retrieve(t),Date.now()-r>s)throw new am({message:`Giving up on waiting for file ${t} to finish processing after ${s} milliseconds.`});return o}};class DE extends q{}let IE=class extends q{run(t,e){return this._client.post("/fine_tuning/alpha/graders/run",{body:t,...e})}validate(t,e){return this._client.post("/fine_tuning/alpha/graders/validate",{body:t,...e})}};class Sm extends q{constructor(){super(...arguments),this.graders=new IE(this._client)}}Sm.Graders=IE;class LE extends q{create(t,e,s){return this._client.getAPIList(R`/fine_tuning/checkpoints/${t}/permissions`,dl,{body:e,method:"post",...s})}retrieve(t,e={},s){return this._client.get(R`/fine_tuning/checkpoints/${t}/permissions`,{query:e,...s})}delete(t,e,s){const{fine_tuned_model_checkpoint:i}=e;return this._client.delete(R`/fine_tuning/checkpoints/${i}/permissions/${t}`,s)}}let Tm=class extends q{constructor(){super(...arguments),this.permissions=new LE(this._client)}};Tm.Permissions=LE;class NE extends q{list(t,e={},s){return this._client.getAPIList(R`/fine_tuning/jobs/${t}/checkpoints`,Ut,{query:e,...s})}}class Em extends q{constructor(){super(...arguments),this.checkpoints=new NE(this._client)}create(t,e){return this._client.post("/fine_tuning/jobs",{body:t,...e})}retrieve(t,e){return this._client.get(R`/fine_tuning/jobs/${t}`,e)}list(t={},e){return this._client.getAPIList("/fine_tuning/jobs",Ut,{query:t,...e})}cancel(t,e){return this._client.post(R`/fine_tuning/jobs/${t}/cancel`,e)}listEvents(t,e={},s){return this._client.getAPIList(R`/fine_tuning/jobs/${t}/events`,Ut,{query:e,...s})}pause(t,e){return this._client.post(R`/fine_tuning/jobs/${t}/pause`,e)}resume(t,e){return this._client.post(R`/fine_tuning/jobs/${t}/resume`,e)}}Em.Checkpoints=NE;class zi extends q{constructor(){super(...arguments),this.methods=new DE(this._client),this.jobs=new Em(this._client),this.checkpoints=new Tm(this._client),this.alpha=new Sm(this._client)}}zi.Methods=DE;zi.Jobs=Em;zi.Checkpoints=Tm;zi.Alpha=Sm;class FE extends q{}class xm extends q{constructor(){super(...arguments),this.graderModels=new FE(this._client)}}xm.GraderModels=FE;class BE extends q{createVariation(t,e){return this._client.post("/images/variations",$s({body:t,...e},this._client))}edit(t,e){return this._client.post("/images/edits",$s({body:t,...e,stream:t.stream??!1},this._client))}generate(t,e){return this._client.post("/images/generations",{body:t,...e,stream:t.stream??!1})}}class $E extends q{retrieve(t,e){return this._client.get(R`/models/${t}`,e)}list(t){return this._client.getAPIList("/models",dl,t)}delete(t,e){return this._client.delete(R`/models/${t}`,e)}}class UE extends q{create(t,e){return this._client.post("/moderations",{body:t,...e})}}class jE extends q{accept(t,e,s){return this._client.post(R`/realtime/calls/${t}/accept`,{body:e,...s,headers:j([{Accept:"*/*"},s?.headers])})}hangup(t,e){return this._client.post(R`/realtime/calls/${t}/hangup`,{...e,headers:j([{Accept:"*/*"},e?.headers])})}refer(t,e,s){return this._client.post(R`/realtime/calls/${t}/refer`,{body:e,...s,headers:j([{Accept:"*/*"},s?.headers])})}reject(t,e={},s){return this._client.post(R`/realtime/calls/${t}/reject`,{body:e,...s,headers:j([{Accept:"*/*"},s?.headers])})}}class zE extends q{create(t,e){return this._client.post("/realtime/client_secrets",{body:t,...e})}}class gl extends q{constructor(){super(...arguments),this.clientSecrets=new zE(this._client),this.calls=new jE(this._client)}}gl.ClientSecrets=zE;gl.Calls=jE;function wH(n,t){return!t||!AH(t)?{...n,output_parsed:null,output:n.output.map(e=>e.type==="function_call"?{...e,parsed_arguments:null}:e.type==="message"?{...e,content:e.content.map(s=>({...s,parsed:null}))}:e)}:VE(n,t)}function VE(n,t){const e=n.output.map(i=>{if(i.type==="function_call")return{...i,parsed_arguments:EH(t,i)};if(i.type==="message"){const r=i.content.map(o=>o.type==="output_text"?{...o,parsed:vH(t,o.text)}:o);return{...i,content:r}}return i}),s=Object.assign({},n,{output:e});return Object.getOwnPropertyDescriptor(n,"output_text")||lf(s),Object.defineProperty(s,"output_parsed",{enumerable:!0,get(){for(const i of s.output)if(i.type==="message"){for(const r of i.content)if(r.type==="output_text"&&r.parsed!==null)return r.parsed}return null}}),s}function vH(n,t){return n.text?.format?.type!=="json_schema"?null:"$parseRaw"in n.text?.format?(n.text?.format).$parseRaw(t):JSON.parse(t)}function AH(n){return!!hm(n.text?.format)}function SH(n){return n?.$brand==="auto-parseable-tool"}function TH(n,t){return n.find(e=>e.type==="function"&&e.name===t)}function EH(n,t){const e=TH(n.tools??[],t.name);return{...t,...t,parsed_arguments:SH(e)?e.$parseRaw(t.arguments):e?.strict?JSON.parse(t.arguments):null}}function lf(n){const t=[];for(const e of n.output)if(e.type==="message")for(const s of e.content)s.type==="output_text"&&t.push(s.text);n.output_text=t.join("")}var Qs,aa,qn,ca,hw,dw,fw,pw;class Cm extends fm{constructor(t){super(),Qs.add(this),aa.set(this,void 0),qn.set(this,void 0),ca.set(this,void 0),Z(this,aa,t)}static createResponse(t,e,s){const i=new Cm(e);return i._run(()=>i._createOrRetrieveResponse(t,e,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(t,e,s){const i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),C(this,Qs,"m",hw).call(this);let r,o=null;"response_id"in e?(r=await t.responses.retrieve(e.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),o=e.starting_after??null):r=await t.responses.create({...e,stream:!0},{...s,signal:this.controller.signal}),this._connected();for await(const a of r)C(this,Qs,"m",dw).call(this,a,o);if(r.controller.signal?.aborted)throw new Ye;return C(this,Qs,"m",fw).call(this)}[(aa=new WeakMap,qn=new WeakMap,ca=new WeakMap,Qs=new WeakSet,hw=function(){this.ended||Z(this,qn,void 0)},dw=function(e,s){if(this.ended)return;const i=(o,a)=>{(s==null||a.sequence_number>s)&&this._emit(o,a)},r=C(this,Qs,"m",pw).call(this,e);switch(i("event",e),e.type){case"response.output_text.delta":{const o=r.output[e.output_index];if(!o)throw new G(`missing output at index ${e.output_index}`);if(o.type==="message"){const a=o.content[e.content_index];if(!a)throw new G(`missing content at index ${e.content_index}`);if(a.type!=="output_text")throw new G(`expected content to be 'output_text', got ${a.type}`);i("response.output_text.delta",{...e,snapshot:a.text})}break}case"response.function_call_arguments.delta":{const o=r.output[e.output_index];if(!o)throw new G(`missing output at index ${e.output_index}`);o.type==="function_call"&&i("response.function_call_arguments.delta",{...e,snapshot:o.arguments});break}default:i(e.type,e);break}},fw=function(){if(this.ended)throw new G("stream has ended, this shouldn't happen");const e=C(this,qn,"f");if(!e)throw new G("request ended without sending any events");Z(this,qn,void 0);const s=xH(e,C(this,aa,"f"));return Z(this,ca,s),s},pw=function(e){let s=C(this,qn,"f");if(!s){if(e.type!=="response.created")throw new G(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return s=Z(this,qn,e.response),s}switch(e.type){case"response.output_item.added":{s.output.push(e.item);break}case"response.content_part.added":{const i=s.output[e.output_index];if(!i)throw new G(`missing output at index ${e.output_index}`);const r=i.type,o=e.part;r==="message"&&o.type!=="reasoning_text"?i.content.push(o):r==="reasoning"&&o.type==="reasoning_text"&&(i.content||(i.content=[]),i.content.push(o));break}case"response.output_text.delta":{const i=s.output[e.output_index];if(!i)throw new G(`missing output at index ${e.output_index}`);if(i.type==="message"){const r=i.content[e.content_index];if(!r)throw new G(`missing content at index ${e.content_index}`);if(r.type!=="output_text")throw new G(`expected content to be 'output_text', got ${r.type}`);r.text+=e.delta}break}case"response.function_call_arguments.delta":{const i=s.output[e.output_index];if(!i)throw new G(`missing output at index ${e.output_index}`);i.type==="function_call"&&(i.arguments+=e.delta);break}case"response.reasoning_text.delta":{const i=s.output[e.output_index];if(!i)throw new G(`missing output at index ${e.output_index}`);if(i.type==="reasoning"){const r=i.content?.[e.content_index];if(!r)throw new G(`missing content at index ${e.content_index}`);if(r.type!=="reasoning_text")throw new G(`expected content to be 'reasoning_text', got ${r.type}`);r.text+=e.delta}break}case"response.completed":{Z(this,qn,e.response);break}}return s},Symbol.asyncIterator)](){const t=[],e=[];let s=!1;return this.on("event",i=>{const r=e.shift();r?r.resolve(i):t.push(i)}),this.on("end",()=>{s=!0;for(const i of e)i.resolve(void 0);e.length=0}),this.on("abort",i=>{s=!0;for(const r of e)r.reject(i);e.length=0}),this.on("error",i=>{s=!0;for(const r of e)r.reject(i);e.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,o)=>e.push({resolve:r,reject:o})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const t=C(this,ca,"f");if(!t)throw new G("stream ended without producing a ChatCompletion");return t}}function xH(n,t){return wH(n,t)}class HE extends q{list(t,e={},s){return this._client.getAPIList(R`/responses/${t}/input_items`,Ut,{query:e,...s})}}class qE extends q{count(t={},e){return this._client.post("/responses/input_tokens",{body:t,...e})}}class yl extends q{constructor(){super(...arguments),this.inputItems=new HE(this._client),this.inputTokens=new qE(this._client)}create(t,e){return this._client.post("/responses",{body:t,...e,stream:t.stream??!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&lf(s),s))}retrieve(t,e={},s){return this._client.get(R`/responses/${t}`,{query:e,...s,stream:e?.stream??!1})._thenUnwrap(i=>("object"in i&&i.object==="response"&&lf(i),i))}delete(t,e){return this._client.delete(R`/responses/${t}`,{...e,headers:j([{Accept:"*/*"},e?.headers])})}parse(t,e){return this._client.responses.create(t,e)._thenUnwrap(s=>VE(s,t))}stream(t,e){return Cm.createResponse(this._client,t,e)}cancel(t,e){return this._client.post(R`/responses/${t}/cancel`,e)}compact(t,e){return this._client.post("/responses/compact",{body:t,...e})}}yl.InputItems=HE;yl.InputTokens=qE;class WE extends q{create(t,e,s){return this._client.post(R`/uploads/${t}/parts`,$s({body:e,...s},this._client))}}class Pm extends q{constructor(){super(...arguments),this.parts=new WE(this._client)}create(t,e){return this._client.post("/uploads",{body:t,...e})}cancel(t,e){return this._client.post(R`/uploads/${t}/cancel`,e)}complete(t,e,s){return this._client.post(R`/uploads/${t}/complete`,{body:e,...s})}}Pm.Parts=WE;const CH=async n=>{const t=await Promise.allSettled(n),e=t.filter(i=>i.status==="rejected");if(e.length){for(const i of e)console.error(i.reason);throw new Error(`${e.length} promise(s) failed - see the above errors`)}const s=[];for(const i of t)i.status==="fulfilled"&&s.push(i.value);return s};class GE extends q{create(t,e,s){return this._client.post(R`/vector_stores/${t}/file_batches`,{body:e,...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(t,e,s){const{vector_store_id:i}=e;return this._client.get(R`/vector_stores/${i}/file_batches/${t}`,{...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(t,e,s){const{vector_store_id:i}=e;return this._client.post(R`/vector_stores/${i}/file_batches/${t}/cancel`,{...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(t,e,s){const i=await this.create(t,e);return await this.poll(t,i.id,s)}listFiles(t,e,s){const{vector_store_id:i,...r}=e;return this._client.getAPIList(R`/vector_stores/${i}/file_batches/${t}/files`,Ut,{query:r,...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async poll(t,e,s){const i=j([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:r,response:o}=await this.retrieve(e,{vector_store_id:t},{...s,headers:i}).withResponse();switch(r.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{const c=o.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(a=l)}}await To(a);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(t,{files:e,fileIds:s=[]},i){if(e==null||e.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const r=i?.maxConcurrency??5,o=Math.min(r,e.length),a=this._client,c=e.values(),l=[...s];async function u(d){for(let f of d){const m=await a.files.create({file:f,purpose:"assistants"},i);l.push(m.id)}}const h=Array(o).fill(c).map(u);return await CH(h),await this.createAndPoll(t,{file_ids:l})}}class YE extends q{create(t,e,s){return this._client.post(R`/vector_stores/${t}/files`,{body:e,...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(t,e,s){const{vector_store_id:i}=e;return this._client.get(R`/vector_stores/${i}/files/${t}`,{...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(t,e,s){const{vector_store_id:i,...r}=e;return this._client.post(R`/vector_stores/${i}/files/${t}`,{body:r,...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(t,e={},s){return this._client.getAPIList(R`/vector_stores/${t}/files`,Ut,{query:e,...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(t,e,s){const{vector_store_id:i}=e;return this._client.delete(R`/vector_stores/${i}/files/${t}`,{...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(t,e,s){const i=await this.create(t,e,s);return await this.poll(t,i.id,s)}async poll(t,e,s){const i=j([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){const r=await this.retrieve(e,{vector_store_id:t},{...s,headers:i}).withResponse(),o=r.data;switch(o.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{const c=r.response.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(a=l)}}await To(a);break;case"failed":case"completed":return o}}}async upload(t,e,s){const i=await this._client.files.create({file:e,purpose:"assistants"},s);return this.create(t,{file_id:i.id},s)}async uploadAndPoll(t,e,s){const i=await this.upload(t,e,s);return await this.poll(t,i.id,s)}content(t,e,s){const{vector_store_id:i}=e;return this._client.getAPIList(R`/vector_stores/${i}/files/${t}/content`,dl,{...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class bl extends q{constructor(){super(...arguments),this.files=new YE(this._client),this.fileBatches=new GE(this._client)}create(t,e){return this._client.post("/vector_stores",{body:t,...e,headers:j([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}retrieve(t,e){return this._client.get(R`/vector_stores/${t}`,{...e,headers:j([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}update(t,e,s){return this._client.post(R`/vector_stores/${t}`,{body:e,...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(t={},e){return this._client.getAPIList("/vector_stores",Ut,{query:t,...e,headers:j([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}delete(t,e){return this._client.delete(R`/vector_stores/${t}`,{...e,headers:j([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}search(t,e,s){return this._client.getAPIList(R`/vector_stores/${t}/search`,dl,{body:e,method:"post",...s,headers:j([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}bl.Files=YE;bl.FileBatches=GE;class XE extends q{create(t,e){return this._client.post("/videos",Q_({body:t,...e},this._client))}retrieve(t,e){return this._client.get(R`/videos/${t}`,e)}list(t={},e){return this._client.getAPIList("/videos",_c,{query:t,...e})}delete(t,e){return this._client.delete(R`/videos/${t}`,e)}downloadContent(t,e={},s){return this._client.get(R`/videos/${t}/content`,{query:e,...s,headers:j([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}remix(t,e,s){return this._client.post(R`/videos/${t}/remix`,Q_({body:e,...s},this._client))}}var oi,KE,Pa;class ZE extends q{constructor(){super(...arguments),oi.add(this)}async unwrap(t,e,s=this._client.webhookSecret,i=300){return await this.verifySignature(t,e,s,i),JSON.parse(t)}async verifySignature(t,e,s=this._client.webhookSecret,i=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");C(this,oi,"m",KE).call(this,s);const r=j([e]).values,o=C(this,oi,"m",Pa).call(this,r,"webhook-signature"),a=C(this,oi,"m",Pa).call(this,r,"webhook-timestamp"),c=C(this,oi,"m",Pa).call(this,r,"webhook-id"),l=parseInt(a,10);if(isNaN(l))throw new ur("Invalid webhook timestamp format");const u=Math.floor(Date.now()/1e3);if(u-l>i)throw new ur("Webhook timestamp is too old");if(l>u+i)throw new ur("Webhook timestamp is too new");const h=o.split(" ").map(p=>p.startsWith("v1,")?p.substring(3):p),d=s.startsWith("whsec_")?Buffer.from(s.replace("whsec_",""),"base64"):Buffer.from(s,"utf-8"),f=c?`${c}.${a}.${t}`:`${a}.${t}`,m=await crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const p of h)try{const g=Buffer.from(p,"base64");if(await crypto.subtle.verify("HMAC",m,g,new TextEncoder().encode(f)))return}catch{continue}throw new ur("The given webhook signature does not match the expected signature")}}oi=new WeakSet,KE=function(t){if(typeof t!="string"||t.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Pa=function(t,e){if(!t)throw new Error("Headers are required");const s=t.get(e);if(s==null)throw new Error(`Missing required header: ${e}`);return s};var uf,km,ka,JE;class nt{constructor({baseURL:t=Js("OPENAI_BASE_URL"),apiKey:e=Js("OPENAI_API_KEY"),organization:s=Js("OPENAI_ORG_ID")??null,project:i=Js("OPENAI_PROJECT_ID")??null,webhookSecret:r=Js("OPENAI_WEBHOOK_SECRET")??null,...o}={}){if(uf.add(this),ka.set(this,void 0),this.completions=new CE(this),this.chat=new gm(this),this.embeddings=new ME(this),this.files=new OE(this),this.images=new BE(this),this.audio=new xo(this),this.moderations=new UE(this),this.models=new $E(this),this.fineTuning=new zi(this),this.graders=new xm(this),this.vectorStores=new bl(this),this.webhooks=new ZE(this),this.beta=new ji(this),this.batches=new _E(this),this.uploads=new Pm(this),this.responses=new yl(this),this.realtime=new gl(this),this.conversations=new wm(this),this.evals=new Am(this),this.containers=new _m(this),this.videos=new XE(this),e===void 0)throw new G("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const a={apiKey:e,organization:s,project:i,webhookSecret:r,...o,baseURL:t||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&P3())throw new G(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=a.baseURL,this.timeout=a.timeout??km.DEFAULT_TIMEOUT,this.logger=a.logger??console;const c="warn";this.logLevel=c,this.logLevel=Z_(a.logLevel,"ClientOptions.logLevel",this)??Z_(Js("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??c,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??D3(),Z(this,ka,L3),this._options=a,this.apiKey=typeof e=="string"?e:"Missing Key",this.organization=s,this.project=i,this.webhookSecret=r}withOptions(t){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...t})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:e}){}async authHeaders(t){return j([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(t){return j3(t,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${ii}`}defaultIdempotencyKey(){return`stainless-node-retry-${vT()}`}makeStatusError(t,e,s,i){return ue.generate(t,e,s,i)}async _callApiKey(){const t=this._options.apiKey;if(typeof t!="function")return!1;let e;try{e=await t()}catch(s){throw s instanceof G?s:new G(`Failed to get token from 'apiKey' function: ${s.message}`,{cause:s})}if(typeof e!="string"||!e)throw new G(`Expected 'apiKey' function argument to return a string but it returned ${e}`);return this.apiKey=e,!0}buildURL(t,e,s){const i=!C(this,uf,"m",JE).call(this)&&s||this.baseURL,r=S3(t)?new URL(t):new URL(i+(i.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),o=this.defaultQuery();return T3(o)||(e={...o,...e}),typeof e=="object"&&e&&!Array.isArray(e)&&(r.search=this.stringifyQuery(e)),r.toString()}async prepareOptions(t){await this._callApiKey()}async prepareRequest(t,{url:e,options:s}){}get(t,e){return this.methodRequest("get",t,e)}post(t,e){return this.methodRequest("post",t,e)}patch(t,e){return this.methodRequest("patch",t,e)}put(t,e){return this.methodRequest("put",t,e)}delete(t,e){return this.methodRequest("delete",t,e)}methodRequest(t,e,s){return this.request(Promise.resolve(s).then(i=>({method:t,path:e,...i})))}request(t,e=null){return new hl(this,this.makeRequest(t,e,void 0))}async makeRequest(t,e,s){const i=await t,r=i.maxRetries??this.maxRetries;e==null&&(e=r),await this.prepareOptions(i);const{req:o,url:a,timeout:c}=await this.buildRequest(i,{retryCount:r-e});await this.prepareRequest(o,{url:a,options:i});const l="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),u=s===void 0?"":`, retryOf: ${s}`,h=Date.now();if(re(this).debug(`[${l}] sending request`,gs({retryOfRequestLogID:s,method:i.method,url:a,options:i,headers:o.headers})),i.signal?.aborted)throw new Ye;const d=new AbortController,f=await this.fetchWithTimeout(a,o,c,d).catch(Zd),m=Date.now();if(f instanceof globalThis.Error){const y=`retrying, ${e} attempts remaining`;if(i.signal?.aborted)throw new Ye;const _=Kd(f)||/timed? ?out/i.test(String(f)+("cause"in f?String(f.cause):""));if(e)return re(this).info(`[${l}] connection ${_?"timed out":"failed"} - ${y}`),re(this).debug(`[${l}] connection ${_?"timed out":"failed"} (${y})`,gs({retryOfRequestLogID:s,url:a,durationMs:m-h,message:f.message})),this.retryRequest(i,e,s??l);throw re(this).info(`[${l}] connection ${_?"timed out":"failed"} - error; no more retries left`),re(this).debug(`[${l}] connection ${_?"timed out":"failed"} (error; no more retries left)`,gs({retryOfRequestLogID:s,url:a,durationMs:m-h,message:f.message})),_?new am:new ll({cause:f})}const p=[...f.headers.entries()].filter(([y])=>y==="x-request-id").map(([y,_])=>", "+y+": "+JSON.stringify(_)).join(""),g=`[${l}${u}${p}] ${o.method} ${a} ${f.ok?"succeeded":"failed"} with status ${f.status} in ${m-h}ms`;if(!f.ok){const y=await this.shouldRetry(f);if(e&&y){const S=`retrying, ${e} attempts remaining`;return await I3(f.body),re(this).info(`${g} - ${S}`),re(this).debug(`[${l}] response error (${S})`,gs({retryOfRequestLogID:s,url:f.url,status:f.status,headers:f.headers,durationMs:m-h})),this.retryRequest(i,e,s??l,f.headers)}const _=y?"error; no more retries left":"error; not retryable";re(this).info(`${g} - ${_}`);const b=await f.text().catch(S=>Zd(S).message),w=C3(b),v=w?void 0:b;throw re(this).debug(`[${l}] response error (${_})`,gs({retryOfRequestLogID:s,url:f.url,status:f.status,headers:f.headers,message:v,durationMs:Date.now()-h})),this.makeStatusError(f.status,w,v,f.headers)}return re(this).info(g),re(this).debug(`[${l}] response start`,gs({retryOfRequestLogID:s,url:f.url,status:f.status,headers:f.headers,durationMs:m-h})),{response:f,options:i,controller:d,requestLogID:l,retryOfRequestLogID:s,startTime:h}}getAPIList(t,e,s){return this.requestAPIList(e,{method:"get",path:t,...s})}requestAPIList(t,e){const s=this.makeRequest(e,null,void 0);return new K3(this,s,t)}async fetchWithTimeout(t,e,s,i){const{signal:r,method:o,...a}=e||{};r&&r.addEventListener("abort",()=>i.abort());const c=setTimeout(()=>i.abort(),s),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||typeof a.body=="object"&&a.body!==null&&Symbol.asyncIterator in a.body,u={signal:i.signal,...l?{duplex:"half"}:{},method:"GET",...a};o&&(u.method=o.toUpperCase());try{return await this.fetch.call(void 0,t,u)}finally{clearTimeout(c)}}async shouldRetry(t){const e=t.headers.get("x-should-retry");return e==="true"?!0:e==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,e,s,i){let r;const o=i?.get("retry-after-ms");if(o){const c=parseFloat(o);Number.isNaN(c)||(r=c)}const a=i?.get("retry-after");if(a&&!r){const c=parseFloat(a);Number.isNaN(c)?r=Date.parse(a)-Date.now():r=c*1e3}if(!(r&&0<=r&&r<60*1e3)){const c=t.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(e,c)}return await To(r),this.makeRequest(t,e-1,s)}calculateDefaultRetryTimeoutMillis(t,e){const r=e-t,o=Math.min(.5*Math.pow(2,r),8),a=1-Math.random()*.25;return o*a*1e3}async buildRequest(t,{retryCount:e=0}={}){const s={...t},{method:i,path:r,query:o,defaultBaseURL:a}=s,c=this.buildURL(r,o,a);"timeout"in s&&x3("timeout",s.timeout),s.timeout=s.timeout??this.timeout;const{bodyHeaders:l,body:u}=this.buildBody({options:s}),h=await this.buildHeaders({options:t,method:i,bodyHeaders:l,retryCount:e});return{req:{method:i,headers:h,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&u instanceof globalThis.ReadableStream&&{duplex:"half"},...u&&{body:u},...this.fetchOptions??{},...s.fetchOptions??{}},url:c,timeout:s.timeout}}async buildHeaders({options:t,method:e,bodyHeaders:s,retryCount:i}){let r={};this.idempotencyHeader&&e!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=t.idempotencyKey);const o=j([r,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i),...t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{},...O3(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(t),this._options.defaultHeaders,s,t.headers]);return this.validateHeaders(o),o.values}buildBody({options:{body:t,headers:e}}){if(!t)return{bodyHeaders:void 0,body:void 0};const s=j([e]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&s.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:IT(t)}:C(this,ka,"f").call(this,{body:t,headers:s})}}km=nt,ka=new WeakMap,uf=new WeakSet,JE=function(){return this.baseURL!=="https://api.openai.com/v1"};nt.OpenAI=km;nt.DEFAULT_TIMEOUT=6e5;nt.OpenAIError=G;nt.APIError=ue;nt.APIConnectionError=ll;nt.APIConnectionTimeoutError=am;nt.APIUserAbortError=Ye;nt.NotFoundError=ET;nt.ConflictError=xT;nt.RateLimitError=PT;nt.BadRequestError=AT;nt.AuthenticationError=ST;nt.InternalServerError=kT;nt.PermissionDeniedError=TT;nt.UnprocessableEntityError=CT;nt.InvalidWebhookSignatureError=ur;nt.toFile=eH;nt.Completions=CE;nt.Chat=gm;nt.Embeddings=ME;nt.Files=OE;nt.Images=BE;nt.Audio=xo;nt.Moderations=UE;nt.Models=$E;nt.FineTuning=zi;nt.Graders=xm;nt.VectorStores=bl;nt.Webhooks=ZE;nt.Beta=ji;nt.Batches=_E;nt.Uploads=Pm;nt.Responses=yl;nt.Realtime=gl;nt.Conversations=wm;nt.Evals=Am;nt.Containers=_m;nt.Videos=XE;export{Bp as $,tq as A,eq as B,QH as C,JH as D,ZH as E,KH as F,sA as G,XH as H,BH as I,FH as J,WH as K,YH as L,GH as M,_q as N,bq as O,yq as P,wq as Q,vq as R,qH as S,Aq as T,Ci as U,pq as V,dq as W,LO as X,fO as Y,MH as Z,Mq as _,VH as a,Oq as a0,Rq as a1,OH as a2,IH as a3,Cq as a4,Er as a5,d$ as a6,Nq as a7,JV as a8,Dq as a9,Lq as aa,Fq as ab,i3 as ac,Iq as ad,RH as ae,Dm as af,Sq as ag,Eq as ah,Tq as ai,xq as aj,oh as ak,Pq as al,zH as b,LH as c,jH as d,UH as e,$H as f,oq as g,hR as h,eO as i,lq as j,fq as k,nq as l,py as m,Nr as n,rq as o,iq as p,sq as q,hq as r,HH as s,mq as t,aq as u,PO as v,cq as w,gq as x,NH as y,uR as z};
