/** * LEDESBilling Component * LEDES 1998B/2000 format support with UTBMS code management and e-billing integration */

/* eslint-disable @typescript-eslint/no-unused-vars */

import { useState } from 'react';

import type React from 'react';
interface LEDESFormat {
  id: string; version: '1998B' | '2000'; name: string; description: string;
} interface UTBMSCode {
  code: string; category: 'Task' | 'Activity' | 'Expense'; description: string; phase?: string; level: number;
} interface RateSchedule {
  id: string; name: string; effectiveDate: string; expiryDate?: string; rates: RateScheduleEntry[];
} interface RateScheduleEntry {
  timekeeperLevel: string; hourlyRate: number; currency: string;
} interface EBillingPortal {
  id: string; clientName: string; portalName: string; url: string; format: 'LEDES 1998B' | 'LEDES 2000' | 'Custom'; status: 'active' | 'inactive'; lastSubmission?: string;
} interface LEDESValidation {
  isValid: boolean; errors: ValidationError[]; warnings: ValidationWarning[];
} interface ValidationError {
  line: number; field: string; message: string;
} interface ValidationWarning {
  line: number; field: string; message: string;
} interface LEDESBillingProps {
  onExport?: (format: LEDESFormat, invoiceId: string) => void; onImport?: (file: File) => void; onValidate?: (data: unknown) => Promise<LEDESValidation>;
} export const LEDESBilling: React.FC<LEDESBillingProps> = ({ onExport, onImport, onValidate,
}) => {
  const [selectedTab, setSelectedTab] = useState<'formats' | 'utbms' | 'rates' | 'portals'>('formats'); const [searchQuery, setSearchQuery] = useState(''); const [selectedFormat, setSelectedFormat] = useState<'1998B' | '2000'>('1998B'); const [showValidation, setShowValidation] = useState(false); const [validationResults, setValidationResults] = useState<LEDESValidation | null>(null); const handleExport = async (invoiceId: string) => { const format = ledesFormats.find(f => f.version === selectedFormat); if (format && onExport) { onExport(format, invoiceId); } }; const handleValidate = async (data: unknown) => { if (onValidate) { const results = await onValidate(data); setValidationResults(results); setShowValidation(true); } }; // Mock data const ledesFormats: LEDESFormat[] = [ { id: '1', version: '1998B', name: 'LEDES 1998B', description: 'Standard format for time and expense billing', }, { id: '2', version: '2000', name: 'LEDES 2000', description: 'Enhanced format with additional fields', }, ]; const utbmsCodes: UTBMSCode[] = [ { code: 'L110', category: 'Task', description: 'Case Assessment, Development, and Administration', phase: 'Pre-litigation', level: 1 }, { code: 'L120', category: 'Task', description: 'Fact Investigation/Development', phase: 'Pre-litigation', level: 1 }, { code: 'L210', category: 'Task', description: 'Pleadings', phase: 'Litigation', level: 1 }, { code: 'L220', category: 'Task', description: 'Discovery', phase: 'Litigation', level: 1 }, { code: 'L230', category: 'Task', description: 'Depositions', phase: 'Litigation', level: 1 }, { code: 'L310', category: 'Task', description: 'Motions', phase: 'Litigation', level: 1 }, { code: 'L410', category: 'Task', description: 'Trial Preparation and Support', phase: 'Trial', level: 1 }, { code: 'L420', category: 'Task', description: 'Trial', phase: 'Trial', level: 1 }, { code: 'A101', category: 'Activity', description: 'Plan/prepare/schedule for appearance, hearing, or meeting', phase: '', level: 2 }, { code: 'A102', category: 'Activity', description: 'Appear/participate in appearance, hearing, or meeting', phase: '', level: 2 }, { code: 'A103', category: 'Activity', description: 'Draft pleading/document', phase: '', level: 2 }, { code: 'A104', category: 'Activity', description: 'Review/analyze pleading/document', phase: '', level: 2 }, { code: 'E101', category: 'Expense', description: 'Court Fees', phase: '', level: 1 }, { code: 'E102', category: 'Expense', description: 'Process Server Fees', phase: '', level: 1 }, { code: 'E103', category: 'Expense', description: 'Expert/Consultant Fees', phase: '', level: 1 }, ]; const rateSchedules: RateSchedule[] = [ { id: '1', name: 'Standard Corporate Rates 2024', effectiveDate: '2024-01-01', rates: [ { timekeeperLevel: 'Partner', hourlyRate: 650.00, currency: 'USD' }, { timekeeperLevel: 'Senior Associate', hourlyRate: 475.00, currency: 'USD' }, { timekeeperLevel: 'Associate', hourlyRate: 350.00, currency: 'USD' }, { timekeeperLevel: 'Paralegal', hourlyRate: 175.00, currency: 'USD' }, ], }, { id: '2', name: 'Discounted Rates - TechCorp', effectiveDate: '2024-01-01', expiryDate: '2024-12-31', rates: [ { timekeeperLevel: 'Partner', hourlyRate: 585.00, currency: 'USD' }, { timekeeperLevel: 'Senior Associate', hourlyRate: 425.00, currency: 'USD' }, { timekeeperLevel: 'Associate', hourlyRate: 315.00, currency: 'USD' }, { timekeeperLevel: 'Paralegal', hourlyRate: 160.00, currency: 'USD' }, ], }, ]; const eBillingPortals: EBillingPortal[] = [ { id: '1', clientName: 'Acme Corporation', portalName: 'Counsel Link', url: 'https://counsellink.lexisnexis.com', format: 'LEDES 1998B', status: 'active', lastSubmission: '2024-01-02', }, { id: '2', clientName: 'TechStart LLC', portalName: 'TyMetrix', url: 'https://360.tymetrix.com', format: 'LEDES 2000', status: 'active', lastSubmission: '2023-12-28', }, { id: '3', clientName: 'GlobalTrade Inc', portalName: 'SimpleLegal', url: 'https://app.simplelegal.com', format: 'LEDES 1998B', status: 'active', }, ]; const filteredCodes = utbmsCodes.filter( (code) => code.code.toLowerCase().includes(searchQuery.toLowerCase()) || code.description.toLowerCase().includes(searchQuery.toLowerCase()) ); const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>) => { const file = event.target.files?.[0]; if (file && onImport) { onImport(file); } }; return ( <div className="space-y-6"> {/* Action Bar */} <div style={{ backgroundColor: 'var(--color-surface)', borderColor: 'var(--color-border)' }} className="flex items-center justify-between rounded-lg border p-4"> <div className="flex items-center gap-3"> <FileText className="h-5 w-5 text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]" /> <span className="text-sm font-medium text-[var(--color-text)]"> LEDES Format: {selectedFormat} </span> </div> <div className="flex gap-2"> <button onClick={() => handleValidate({})} className="inline-flex items-center gap-2 rounded-md border border-[var(--color-border)] bg-[var(--color-surface)] px-3 py-2 text-sm font-medium text-[var(--color-text)] hover:bg-[var(--color-surfaceRaised)] dark:hover:bg-gray-600" > <AlertCircle className="h-4 w-4" /> Validate </button> <button onClick={() => handleExport('invoice-123')} className="inline-flex items-center gap-2 rounded-md bg-[var(--color-primary)] px-3 py-2 text-sm font-medium text-white hover:bg-[var(--color-primaryDark)]" > <Send className="h-4 w-4" /> Send to Portal </button> </div> </div> {/* Validation Results */} {showValidation && validationResults && ( <div className="rounded-lg border border-[var(--color-borderLight)] bg-[var(--color-surface)] p-4"> <div className="flex items-center justify-between mb-4"> <h3 className="text-lg font-semibold text-[var(--color-text)]"> Validation Results </h3> <button onClick={() => setShowValidation(false)} className="text-[var(--color-textMuted)] hover:text-[var(--color-text)] dark:text-[var(--color-textMuted)] dark:hover:text-gray-200" > Ã— </button> </div> <div className="space-y-2"> {validationResults.isValid ? ( <div className="flex items-center gap-2 text-green-600"> <AlertCircle className="h-5 w-5" /> <span>All validations passed</span> </div> ) : ( <div className="space-y-2"> {validationResults.errors.map((error, idx) => ( <div key={idx} className="flex items-start gap-2 text-red-600"> <AlertCircle className="h-5 w-5 mt-0.5" /> <span className="text-sm">Line {error.line}: {error.message}</span> </div> ))} </div> )} </div> </div> )} {/* Header */} <div className="flex items-center justify-between"> <div> <h2 className="text-2xl font-bold text-[var(--color-text)]"> LEDES Billing Management </h2> <p className="mt-1 text-sm text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> LEDES format support and UTBMS code management </p> </div> <div className="flex gap-3"> <label className="inline-flex cursor-pointer items-center gap-2 rounded-md border border-[var(--color-border)] bg-[var(--color-surface)] px-4 py-2 text-sm font-medium text-[var(--color-text)] shadow-sm hover:bg-[var(--color-surfaceRaised)] dark:hover:bg-gray-600"> <Upload className="h-4 w-4" /> Import LEDES <input type="file" accept=".csv,.txt" onChange={handleFileUpload} className="hidden" /> </label> <button className="inline-flex items-center gap-2 rounded-md bg-[var(--color-primary)] px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-[var(--color-primaryDark)]"> <Download className="h-4 w-4" /> Export LEDES </button> </div> </div> {/* Format Selection */} <div className="rounded-lg border border-[var(--color-borderLight)] bg-[var(--color-surface)] p-6"> <h3 className="text-lg font-semibold text-[var(--color-text)] mb-4"> LEDES Format </h3> <div className="grid gap-4 sm:grid-cols-2"> {ledesFormats.map((format) => ( <div key={format.id} className={`cursor-pointer rounded-lg border-2 p-4 transition-colors ${selectedFormat === format.version ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20' : 'border-[var(--color-borderLight)] hover:border-[var(--color-border)] dark:hover:border-gray-600' }`} onClick={() => setSelectedFormat(format.version)} > <div className="flex items-start justify-between"> <div> <h4 className="font-medium text-[var(--color-text)]"> {format.name} </h4> <p className="mt-1 text-sm text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> {format.description} </p> </div> {selectedFormat === format.version && ( <CheckCircle className="h-5 w-5 text-[var(--color-primary)]" /> )} </div> </div> ))} </div> </div> {/* Tabs */} <div className="border-b border-[var(--color-borderLight)]"> <nav className="-mb-px flex space-x-8"> {(['formats', 'utbms', 'rates', 'portals'] as const).map((tab) => ( <button key={tab} onClick={() => setSelectedTab(tab)} className={`whitespace-nowrap border-b-2 px-1 py-4 text-sm font-medium ${selectedTab === tab ? 'border-blue-500 text-[var(--color-primary)] ' : 'border-transparent text-[var(--color-textMuted)] hover:border-[var(--color-border)] hover:text-[var(--color-text)] dark:text-[var(--color-textMuted)] dark:hover:text-gray-300' }`} > {tab === 'utbms' ? 'UTBMS Codes' : tab.charAt(0).toUpperCase() + tab.slice(1)} </button> ))} </nav> </div> {/* Tab Content */} {selectedTab === 'utbms' && ( <div className="space-y-4"> {/* Search */} <div className="flex gap-4"> <div className="flex-1"> <div className="relative"> <Search className="absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-[var(--color-textMuted)]" /> <input type="text" placeholder="Search UTBMS codes..." value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} className="w-full rounded-md border border-[var(--color-border)] bg-[var(--color-surface)] py-2 pl-10 pr-4 text-sm shadow-sm focus:border-blue-500 focus:outline-none focus:ring-blue-500" /> </div> </div> <button className="inline-flex items-center gap-2 rounded-md border border-[var(--color-border)] bg-[var(--color-surface)] px-4 py-2 text-sm font-medium text-[var(--color-text)] shadow-sm hover:bg-[var(--color-surfaceRaised)] dark:hover:bg-gray-600"> <Filter className="h-4 w-4" /> Filter </button> </div> {/* UTBMS Codes Table */} <div className="rounded-lg border border-[var(--color-borderLight)] bg-[var(--color-surface)]"> <div className="overflow-x-auto"> <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-700"> <thead className="bg-[var(--color-surfaceRaised)]"> <tr> <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> Code </th> <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> Category </th> <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> Description </th> <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> Phase </th> <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> Level </th> </tr> </thead> <tbody className="divide-y divide-gray-200 bg-[var(--color-surface)] dark:divide-gray-700"> {filteredCodes.map((code, index) => ( <tr key={index} className="hover:bg-[var(--color-surfaceRaised)] dark:hover:bg-gray-700"> <td className="whitespace-nowrap px-6 py-4 text-sm font-medium text-[var(--color-primary)]"> {code.code} </td> <td className="whitespace-nowrap px-6 py-4 text-sm text-[var(--color-text)]"> <span className={`inline-flex rounded-full px-2 py-1 text-xs font-semibold ${code.category === 'Task' ? 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 ' : code.category === 'Activity' ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300' : 'bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300' }`} > {code.category} </span> </td> <td className="px-6 py-4 text-sm text-[var(--color-text)]"> {code.description} </td> <td className="whitespace-nowrap px-6 py-4 text-sm text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> {code.phase || '-'} </td> <td className="whitespace-nowrap px-6 py-4 text-sm text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> Level {code.level} </td> </tr> ))} </tbody> </table> </div> </div> </div> )} {selectedTab === 'rates' && ( <div className="space-y-4"> {rateSchedules.map((schedule) => ( <div key={schedule.id} className="rounded-lg border border-[var(--color-borderLight)] bg-[var(--color-surface)] p-6" > <div className="mb-4 flex items-center justify-between"> <div> <h3 className="text-lg font-semibold text-[var(--color-text)]"> {schedule.name} </h3> <p className="text-sm text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> Effective: {new Date(schedule.effectiveDate).toLocaleDateString()} {schedule.expiryDate && ` - ${new Date(schedule.expiryDate).toLocaleDateString()}`} </p> </div> <button className="text-[var(--color-primary)] hover:text-blue-900 dark:hover:text-blue-300"> <Settings className="h-5 w-5" /> </button> </div> <div className="overflow-x-auto"> <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-700"> <thead className="bg-[var(--color-surfaceRaised)]"> <tr> <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> Timekeeper Level </th> <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> Hourly Rate </th> <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> Currency </th> </tr> </thead> <tbody className="divide-y divide-gray-200 bg-[var(--color-surface)] dark:divide-gray-700"> {schedule.rates.map((rate, index) => ( <tr key={index}> <td className="whitespace-nowrap px-6 py-4 text-sm font-medium text-[var(--color-text)]"> {rate.timekeeperLevel} </td> <td className="whitespace-nowrap px-6 py-4 text-sm text-[var(--color-text)]"> ${rate.hourlyRate.toFixed(2)} </td> <td className="whitespace-nowrap px-6 py-4 text-sm text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> {rate.currency} </td> </tr> ))} </tbody> </table> </div> </div> ))} </div> )} {selectedTab === 'portals' && ( <div className="rounded-lg border border-[var(--color-borderLight)] bg-[var(--color-surface)]"> <div className="border-b border-[var(--color-borderLight)] bg-[var(--color-surfaceRaised)] px-6 py-4 /50"> <h3 className="text-lg font-semibold text-[var(--color-text)]"> E-Billing Portal Integration </h3> </div> <div className="overflow-x-auto"> <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-700"> <thead className="bg-[var(--color-surfaceRaised)]"> <tr> <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> Client </th> <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> Portal Name </th> <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> Format </th> <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> Last Submission </th> <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> Status </th> <th className="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> Actions </th> </tr> </thead> <tbody className="divide-y divide-gray-200 bg-[var(--color-surface)] dark:divide-gray-700"> {eBillingPortals.map((portal) => ( <tr key={portal.id} className="hover:bg-[var(--color-surfaceRaised)] dark:hover:bg-gray-700"> <td className="whitespace-nowrap px-6 py-4 text-sm font-medium text-[var(--color-text)]"> {portal.clientName} </td> <td className="whitespace-nowrap px-6 py-4 text-sm text-[var(--color-text)]"> {portal.portalName} </td> <td className="whitespace-nowrap px-6 py-4 text-sm text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> {portal.format} </td> <td className="whitespace-nowrap px-6 py-4 text-sm text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> {portal.lastSubmission ? new Date(portal.lastSubmission).toLocaleDateString() : 'Never'} </td> <td className="whitespace-nowrap px-6 py-4"> <span className={`inline-flex rounded-full px-2 py-1 text-xs font-semibold ${portal.status === 'active' ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300' : 'bg-[var(--color-surfaceRaised)] text-[var(--color-text)] ' }`} > {portal.status.toUpperCase()} </span> </td> <td className="whitespace-nowrap px-6 py-4 text-right text-sm"> <button className="text-[var(--color-primary)] hover:text-blue-900 dark:hover:text-blue-300"> Submit </button> </td> </tr> ))} </tbody> </table> </div> </div> )} {selectedTab === 'formats' && ( <div className="rounded-lg border border-[var(--color-borderLight)] bg-[var(--color-surface)] p-6"> <h3 className="text-lg font-semibold text-[var(--color-text)] mb-4"> Format Specifications </h3> <div className="space-y-4"> <div className="rounded-lg border border-[var(--color-borderLight)] bg-[var(--color-surfaceRaised)] p-4 /50"> <h4 className="font-medium text-[var(--color-text)] mb-2"> LEDES 1998B Format </h4> <ul className="space-y-2 text-sm text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> <li className="flex items-start gap-2"> <CheckCircle className="h-4 w-4 mt-0.5 text-green-600 flex-shrink-0" /> <span>20 required fields including Invoice Number, Client ID, Law Firm Matter ID</span> </li> <li className="flex items-start gap-2"> <CheckCircle className="h-4 w-4 mt-0.5 text-green-600 flex-shrink-0" /> <span>Tab-delimited text format (.txt)</span> </li> <li className="flex items-start gap-2"> <CheckCircle className="h-4 w-4 mt-0.5 text-green-600 flex-shrink-0" /> <span>UTBMS Task and Activity codes required</span> </li> <li className="flex items-start gap-2"> <CheckCircle className="h-4 w-4 mt-0.5 text-green-600 flex-shrink-0" /> <span>Supports time entries and expenses</span> </li> </ul> </div> <div className="rounded-lg border border-[var(--color-borderLight)] bg-[var(--color-surfaceRaised)] p-4 /50"> <h4 className="font-medium text-[var(--color-text)] mb-2"> LEDES 2000 Format </h4> <ul className="space-y-2 text-sm text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> <li className="flex items-start gap-2"> <CheckCircle className="h-4 w-4 mt-0.5 text-green-600 flex-shrink-0" /> <span>Enhanced format with additional invoice-level data</span> </li> <li className="flex items-start gap-2"> <CheckCircle className="h-4 w-4 mt-0.5 text-green-600 flex-shrink-0" /> <span>Pipe-delimited text format (.txt)</span> </li> <li className="flex items-start gap-2"> <CheckCircle className="h-4 w-4 mt-0.5 text-green-600 flex-shrink-0" /> <span>Includes invoice header and line item sections</span> </li> <li className="flex items-start gap-2"> <CheckCircle className="h-4 w-4 mt-0.5 text-green-600 flex-shrink-0" /> <span>Support for adjustments and write-offs</span> </li> </ul> </div> <div className="mt-6 flex gap-3"> <button className="inline-flex items-center gap-2 rounded-md bg-[var(--color-primary)] px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-[var(--color-primaryDark)]"> <Database className="h-4 w-4" /> Validate Data </button> <button className="inline-flex items-center gap-2 rounded-md border border-[var(--color-border)] bg-[var(--color-surface)] px-4 py-2 text-sm font-medium text-[var(--color-text)] shadow-sm hover:bg-[var(--color-surfaceRaised)] dark:hover:bg-gray-600"> <Download className="h-4 w-4" /> Download Template </button> </div> </div> </div> )} </div> );
  /* eslint-enable @typescript-eslint/no-unused-vars */
};
