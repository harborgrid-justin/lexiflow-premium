/** * AuditTrail Component * * Enterprise document audit trail with: * - Complete activity history * - Filtering and search capabilities * - Export functionality * - Detailed event information * - User activity tracking */ import { useState } from 'react'; type AuditEventType = | 'created' | 'viewed' | 'downloaded' | 'edited' | 'deleted' | 'shared' | 'versioned' | 'checked_out' | 'checked_in' | 'approved' | 'rejected' | 'annotated' | 'redacted' | 'metadata_changed' | 'workflow_started' | 'workflow_completed' | 'permission_changed'; interface AuditEvent { id: string; documentId: string; documentTitle?: string; eventType: AuditEventType; userId: string; userName: string; userEmail?: string; timestamp: string; ipAddress?: string; details?: Record<string, unknown>; changes?: Array<{ field: string; oldValue: unknown; newValue: unknown; }>; metadata?: { userAgent?: string; location?: string; sessionId?: string; };
} interface AuditTrailProps { documentId?: string; events?: AuditEvent[]; showFilters?: boolean; enableExport?: boolean; onExport?: (events: AuditEvent[]) => void;
} export function AuditTrail({ documentId, events = [], showFilters = true, enableExport = true, onExport,
}: AuditTrailProps) { const [searchQuery, setSearchQuery] = useState(''); const [filterEventType, setFilterEventType] = useState<AuditEventType | 'all'>('all'); const [filterUser, setFilterUser] = useState<string>('all'); const [dateFrom, setDateFrom] = useState(''); const [dateTo, setDateTo] = useState(''); const [expandedEventId, setExpandedEventId] = useState<string | null>(null); const [selectedEvents, setSelectedEvents] = useState<Set<string>>(new Set()); // Get unique users from events const uniqueUsers = Array.from(new Set(events.map(e => e.userName))).sort(); // Filter events const filteredEvents = events.filter(event => { // Document ID filter if (documentId && event.documentId !== documentId) { return false; } // Search filter if (searchQuery) { const query = searchQuery.toLowerCase(); const matchesSearch = event.userName.toLowerCase().includes(query) || event.documentTitle?.toLowerCase().includes(query) || event.eventType.toLowerCase().includes(query) || JSON.stringify(event.details || {}).toLowerCase().includes(query); if (!matchesSearch) return false; } // Event type filter if (filterEventType !== 'all' && event.eventType !== filterEventType) { return false; } // User filter if (filterUser !== 'all' && event.userName !== filterUser) { return false; } // Date filters if (dateFrom && new Date(event.timestamp) < new Date(dateFrom)) { return false; } return !(dateTo && new Date(event.timestamp) > new Date(dateTo)); }); // Toggle event expansion const toggleEventExpansion = (eventId: string) => { setExpandedEventId(expandedEventId === eventId ? null : eventId); }; // Toggle event selection const toggleEventSelection = (eventId: string) => { const newSelected = new Set(selectedEvents); if (newSelected.has(eventId)) { newSelected.delete(eventId); } else { newSelected.add(eventId); } setSelectedEvents(newSelected); }; // Select all filtered events const selectAllFiltered = () => { setSelectedEvents(new Set(filteredEvents.map(e => e.id))); }; // Clear selection const clearSelection = () => { setSelectedEvents(new Set()); }; // Export selected events const handleExport = () => { const eventsToExport = selectedEvents.size > 0 ? filteredEvents.filter(e => selectedEvents.has(e.id)) : filteredEvents; onExport?.(eventsToExport); }; // Get event icon and color const getEventIcon = (eventType: AuditEventType): { icon: JSX.Element; color: string } => { switch (eventType) { case 'created': return { icon: ( <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /> ), color: 'text-green-600 bg-green-100 dark:bg-green-900/30', }; case 'viewed': return { icon: ( <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /> ), color: 'text-[var(--color-primary)] bg-blue-100 dark:bg-blue-900/30', }; case 'downloaded': return { icon: ( <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /> ), color: 'text-indigo-600 bg-indigo-100 dark:bg-indigo-900/30', }; case 'edited': case 'metadata_changed': return { icon: ( <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /> ), color: 'text-yellow-600 bg-yellow-100 dark:bg-yellow-900/30', }; case 'deleted': return { icon: ( <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /> ), color: 'text-red-600 bg-red-100 dark:bg-red-900/30', }; case 'shared': return { icon: ( <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" /> ), color: 'text-purple-600 bg-purple-100 dark:bg-purple-900/30', }; case 'approved': return { icon: ( <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /> ), color: 'text-green-600 bg-green-100 dark:bg-green-900/30', }; case 'rejected': return { icon: ( <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /> ), color: 'text-red-600 bg-red-100 dark:bg-red-900/30', }; case 'checked_out': case 'checked_in': return { icon: ( <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" /> ), color: 'text-orange-600 bg-orange-100 dark:bg-orange-900/30', }; default: return { icon: ( <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /> ), color: 'text-[var(--color-textMuted)] bg-[var(--color-surfaceRaised)] /30', }; } }; // Format timestamp const formatTimestamp = (timestamp: string): string => { const date = new Date(timestamp); return date.toLocaleString('en-US', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit', }); }; // Format event type for display const formatEventType = (eventType: AuditEventType): string => { return eventType .split('_') .map(word => word.charAt(0).toUpperCase() + word.slice(1)) .join(' '); }; return ( <div style={{ backgroundColor: 'var(--color-surface)', borderColor: 'var(--color-border)' }} className="h-full flex flex-col rounded-lg border"> {/* Header */} <div className="px-6 py-4 border-b border-[var(--color-borderLight)]"> <div className="flex items-center justify-between mb-4"> <div> <h2 className="text-xl font-bold text-[var(--color-text)]"> Audit Trail </h2> <p className="text-sm text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)] mt-1"> {filteredEvents.length} {filteredEvents.length === 1 ? 'event' : 'events'} {selectedEvents.size > 0 && ` • ${selectedEvents.size} selected`} </p> </div> <div className="flex items-center gap-2"> {selectedEvents.size > 0 && ( <button onClick={clearSelection} style={{ backgroundColor: 'var(--color-surfaceHover)', color: 'var(--color-text)' }} className="px-3 py-1.5 text-sm font-medium rounded-md hover:bg-[var(--color-backgroundTertiary)] dark:hover:bg-gray-600" > Clear Selection </button> )} {enableExport && ( <button onClick={handleExport} className="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-[var(--color-primary)] rounded-md hover:bg-[var(--color-primaryDark)]" > <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /> </svg> Export </button> )} </div> </div> {/* Filters */} {showFilters && ( <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3"> <input type="text" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} placeholder="Search events..." className="px-3 py-2 text-sm border border-[var(--color-border)] rounded-md focus:ring-blue-500 focus:border-blue-500" /> <select value={filterEventType} onChange={(e) => setFilterEventType(e.target.value as AuditEventType | 'all')} className="px-3 py-2 text-sm border border-[var(--color-border)] rounded-md focus:ring-blue-500 focus:border-blue-500" > <option value="all">All Events</option> <option value="created">Created</option> <option value="viewed">Viewed</option> <option value="downloaded">Downloaded</option> <option value="edited">Edited</option> <option value="deleted">Deleted</option> <option value="shared">Shared</option> <option value="approved">Approved</option> <option value="rejected">Rejected</option> <option value="checked_out">Checked Out</option> <option value="checked_in">Checked In</option> </select> <select value={filterUser} onChange={(e) => setFilterUser(e.target.value)} className="px-3 py-2 text-sm border border-[var(--color-border)] rounded-md focus:ring-blue-500 focus:border-blue-500" > <option value="all">All Users</option> {uniqueUsers.map(user => ( <option key={user} value={user}>{user}</option> ))} </select> <input type="date" value={dateFrom} onChange={(e) => setDateFrom(e.target.value)} placeholder="From date" className="px-3 py-2 text-sm border border-[var(--color-border)] rounded-md focus:ring-blue-500 focus:border-blue-500" /> <input type="date" value={dateTo} onChange={(e) => setDateTo(e.target.value)} placeholder="To date" className="px-3 py-2 text-sm border border-[var(--color-border)] rounded-md focus:ring-blue-500 focus:border-blue-500" /> </div> )} </div> {/* Bulk Actions */} {filteredEvents.length > 0 && ( <div style={{ backgroundColor: 'var(--color-surfaceHover)', borderColor: 'var(--color-border)' }} className="px-6 py-2 border-b"> <button onClick={selectAllFiltered} className="text-sm text-[var(--color-primary)] hover:text-blue-700 dark:hover:text-blue-300" > Select all {filteredEvents.length} events </button> </div> )} {/* Events List */} <div className="flex-1 overflow-auto"> {filteredEvents.length === 0 ? ( <div className="flex flex-col items-center justify-center h-full text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)] p-8"> <svg className="h-16 w-16 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /> </svg> <p className="text-lg">No audit events found</p> <p className="text-sm mt-2">Try adjusting your filters</p> </div> ) : ( <div className="divide-y divide-gray-200 dark:divide-gray-700"> {filteredEvents.map((event) => { const { icon, color } = getEventIcon(event.eventType); const isExpanded = expandedEventId === event.id; const isSelected = selectedEvents.has(event.id); return ( <div key={event.id} className={`p-4 hover:bg-[var(--color-surfaceRaised)] dark:hover:bg-gray-700/50 ${isSelected ? 'bg-blue-50 dark:bg-blue-900/20' : '' }`} > <div className="flex items-start gap-4"> {/* Checkbox */} <input type="checkbox" checked={isSelected} onChange={() => toggleEventSelection(event.id)} className="mt-1 h-4 w-4 text-[var(--color-primary)] focus:ring-blue-500 border-[var(--color-border)] rounded" /> {/* Event Icon */} <div className={`flex-shrink-0 flex items-center justify-center w-10 h-10 rounded-full ${color}`}> <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"> {icon} </svg> </div> {/* Event Details */} <div className="flex-1 min-w-0"> <div className="flex items-start justify-between mb-1"> <div className="flex-1"> <h4 className="text-sm font-medium text-[var(--color-text)]"> {formatEventType(event.eventType)} {event.documentTitle && ` • ${event.documentTitle}`} </h4> <div className="flex items-center gap-3 mt-1"> <span className="text-xs text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> {event.userName} </span> <span className="text-xs text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]"> {formatTimestamp(event.timestamp)} </span> {event.ipAddress && ( <span className="text-xs text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)] font-mono"> {event.ipAddress} </span> )} </div> </div> <button onClick={() => toggleEventExpansion(event.id)} className="ml-4 p-1 text-[var(--color-textMuted)] hover:text-[var(--color-textMuted)] dark:hover:text-gray-300" > <svg className={`h-5 w-5 transition-transform ${isExpanded ? 'rotate-180' : ''}`} fill="none" viewBox="0 0 24 24" stroke="currentColor" > <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /> </svg> </button> </div> {/* Expanded Details */} {isExpanded && ( <div className="mt-3 pt-3 border-t border-[var(--color-borderLight)] space-y-3"> {/* Changes */} {event.changes && event.changes.length > 0 && ( <div> <h5 className="text-xs font-medium text-[var(--color-text)] mb-2"> Changes </h5> <div className="space-y-2"> {event.changes.map((change, idx) => ( <div key={idx} style={{ backgroundColor: 'var(--color-surfaceHover)' }} className="text-xs p-2 rounded"> <div className="font-medium text-[var(--color-text)] mb-1"> {change.field} </div> <div className="flex items-center gap-2"> <span className="text-red-600 dark:text-red-400 line-through"> {String(change.oldValue)} </span> <svg className="h-3 w-3 text-[var(--color-textMuted)]" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14 5l7 7m0 0l-7 7m7-7H3" /> </svg> <span className="text-green-600 dark:text-green-400"> {String(change.newValue)} </span> </div> </div> ))} </div> </div> )} {/* Additional Details */} {event.details && Object.keys(event.details).length > 0 && ( <div> <h5 className="text-xs font-medium text-[var(--color-text)] mb-2"> Additional Details </h5> <div style={{ backgroundColor: 'var(--color-surfaceHover)' }} className="text-xs p-2 rounded font-mono"> <pre className="whitespace-pre-wrap text-[var(--color-text)]"> {JSON.stringify(event.details, null, 2)} </pre> </div> </div> )} {/* Metadata */} {event.metadata && ( <div> <h5 className="text-xs font-medium text-[var(--color-text)] mb-2"> Metadata </h5> <dl className="grid grid-cols-2 gap-2 text-xs"> {event.metadata.userAgent && ( <> <dt className="text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]">User Agent:</dt> <dd className="text-[var(--color-text)] font-mono truncate"> {event.metadata.userAgent} </dd> </> )} {event.metadata.location && ( <> <dt className="text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]">Location:</dt> <dd className="text-[var(--color-text)]"> {event.metadata.location} </dd> </> )} {event.metadata.sessionId && ( <> <dt className="text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]">Session ID:</dt> <dd className="text-[var(--color-text)] font-mono"> {event.metadata.sessionId} </dd> </> )} {event.userEmail && ( <> <dt className="text-[var(--color-textMuted)] dark:text-[var(--color-textMuted)]">Email:</dt> <dd className="text-[var(--color-text)]"> {event.userEmail} </dd> </> )} </dl> </div> )} </div> )} </div> </div> </div> ); })} </div> )} </div> </div> );
}
